{{!
    This file is part of Moodle - http://moodle.org/

    Moodle is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    Moodle is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with Moodle.  If not, see <http://www.gnu.org/licenses/>.
}}
{{!
    @template block_adeptus_insights/embedded_report

    Embedded report display mode showing chart and/or table.

    Context variables required for this template:
    * blockid - Block instance ID
    * show_chart - Whether to show chart
    * show_table - Whether to show table
    * chart_height - Height of chart in pixels
    * table_max_rows - Max rows to display
    * show_export - Whether to show export buttons
    * show_refresh_button - Whether to show refresh button

    Example context (json):
    {
        "blockid": 123,
        "show_chart": true,
        "show_table": true,
        "chart_height": 250
    }
}}
<div class="block-adeptus-insights block-adeptus-embedded"
     data-blockid="{{blockid}}"
     data-contextid="{{contextid}}"
     data-mode="embedded"
     data-context-type="{{context_type}}"
     data-context-id="{{context_id}}">

    {{! Toolbar }}
    <div class="block-adeptus-toolbar">
        <div class="block-adeptus-report-title">
            <span class="report-name">{{#str}}loading, block_adeptus_insights{{/str}}</span>
            {{#context_name}}
            <span class="block-adeptus-context-badge small" title="{{#str}}filteringby, block_adeptus_insights{{/str}}">
                <i class="fa fa-filter"></i> {{context_name}}
            </span>
            {{/context_name}}
        </div>

        <div class="block-adeptus-toolbar-actions">
            {{#show_export}}
            <div class="btn-group">
                <button type="button" class="btn btn-sm btn-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                    <i class="fa fa-download"></i>
                </button>
                <div class="dropdown-menu dropdown-menu-right">
                    <a class="dropdown-item block-adeptus-export" data-format="csv" href="#">
                        <i class="fa fa-file-excel-o"></i> {{#str}}exportcsv, block_adeptus_insights{{/str}}
                    </a>
                    <a class="dropdown-item block-adeptus-export" data-format="pdf" href="#">
                        <i class="fa fa-file-pdf-o"></i> {{#str}}exportpdf, block_adeptus_insights{{/str}}
                    </a>
                </div>
            </div>
            {{/show_export}}

            {{#show_refresh_button}}
            <button type="button" class="btn btn-sm btn-link block-adeptus-refresh"
                    title="{{#str}}refresh, block_adeptus_insights{{/str}}"
                    aria-label="{{#str}}aria_refreshblock, block_adeptus_insights{{/str}}">
                <i class="fa fa-refresh"></i>
            </button>
            {{/show_refresh_button}}
        </div>
    </div>

    {{! Loading state }}
    <div class="block-adeptus-loading {{^loading}}d-none{{/loading}}">
        {{#show_chart}}
        <div class="block-adeptus-skeleton-chart" style="height: {{chart_height}}px;">
            <div class="skeleton-chart-placeholder">
                <i class="fa fa-bar-chart fa-3x text-muted"></i>
            </div>
        </div>
        {{/show_chart}}
        {{#show_table}}
        <div class="block-adeptus-skeleton-table mt-3">
            <div class="skeleton-item"></div>
            <div class="skeleton-item"></div>
            <div class="skeleton-item"></div>
        </div>
        {{/show_table}}
    </div>

    {{! Content container }}
    <div class="block-adeptus-content {{#loading}}d-none{{/loading}}">
        {{! Chart area }}
        {{#show_chart}}
        <div class="block-adeptus-chart-container" style="height: {{chart_height}}px;">
            <canvas class="block-adeptus-chart"></canvas>
        </div>
        {{/show_chart}}

        {{! Table area }}
        {{#show_table}}
        <div class="block-adeptus-table-container mt-3">
            <div class="table-responsive">
                <table class="table table-sm table-striped block-adeptus-table">
                    <thead></thead>
                    <tbody></tbody>
                </table>
            </div>
            <div class="block-adeptus-table-footer">
                <span class="block-adeptus-row-count text-muted small"></span>
            </div>
        </div>
        {{/show_table}}
    </div>

    {{! Empty state }}
    <div class="block-adeptus-empty d-none text-center py-4">
        <i class="fa fa-inbox fa-2x text-muted"></i>
        <p class="text-muted mt-2">{{#str}}noreports, block_adeptus_insights{{/str}}</p>
    </div>

    {{! Error state }}
    <div class="block-adeptus-error d-none text-center py-4">
        <i class="fa fa-exclamation-triangle fa-2x text-warning"></i>
        <p class="text-muted mt-2">{{#str}}errorloadingreport, block_adeptus_insights{{/str}}</p>
        <button type="button" class="btn btn-sm btn-outline-secondary block-adeptus-retry">
            <i class="fa fa-refresh"></i> {{#str}}refresh, block_adeptus_insights{{/str}}
        </button>
    </div>

    {{! Timestamp }}
    {{#show_timestamp}}
    <div class="block-adeptus-timestamp text-muted small mt-2 d-none">
        <i class="fa fa-clock-o"></i> <span class="timestamp-text"></span>
    </div>
    {{/show_timestamp}}
</div>
