{"version":3,"file":"block.min.js","sources":["../src/block.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Main JavaScript controller for the Adeptus Insights block.\n *\n * @module     block_adeptus_insights/block\n * @copyright  2025 Adeptus Analytics\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine([\n    'jquery',\n    'core/ajax',\n    'core/notification',\n    'core/str',\n    'core/modal_factory',\n    'core/modal_events',\n    'core/templates',\n    'core/chartjs'\n], function($, Ajax, Notification, Str, ModalFactory, ModalEvents, Templates, Chart) {\n    'use strict';\n\n    /**\n     * Block controller class.\n     *\n     * @param {Object} options Configuration options\n     */\n    var BlockController = function(options) {\n        this.blockId = options.blockid;\n        this.contextId = options.contextid;\n        this.config = options.config || {};\n        this.apiKey = options.apiKey || '';  // API key passed directly from PHP\n        this.isAdmin = options.isAdmin || false;  // Site admin flag\n        this.container = null;\n        this.reports = [];\n        this.lastUpdated = null;\n        this.refreshTimer = null;\n        this.modal = null;\n        this.modalData = null;      // Current modal report data\n        this.modalReport = null;    // Current modal report metadata\n        this.chartInstance = null;  // Current Chart.js instance\n        this.currentView = 'table'; // Current view mode\n\n        // Pagination state for report list\n        this.listCurrentPage = 1;\n        this.listItemsPerPage = this.config.maxLinkItems || 10;\n        this.listTotalPages = 1;\n\n        // Pagination state for modal table\n        this.tableCurrentPage = 1;\n        this.tableRowsPerPage = 25;\n        this.tableTotalPages = 1;\n\n        // Category filter state\n        this.selectedCategory = '';\n        this.availableCategories = [];\n\n        // Report selector state (for embedded mode)\n        this.selectedReportSlug = this.config.defaultReport || '';\n        this.selectedReportSource = '';\n\n        // Embedded mode state (mirrors modal functionality)\n        this.embeddedCurrentView = 'table';\n        this.embeddedTablePage = 1;\n        this.embeddedTableRowsPerPage = 25;\n        this.embeddedChartType = 'bar';\n        this.embeddedXAxis = '';\n        this.embeddedYAxis = '';\n\n        // Cache settings\n        this.cacheKey = 'adeptus_block_reports_' + this.blockId;\n        this.cacheTTL = 5 * 60 * 1000; // 5 minutes\n        this.reportDataCache = {}; // In-memory cache for executed report data\n        this.preloadTimeout = null;\n        this.preloadingSlug = null;\n\n        // Tabs mode state (per-pane state for view toggle, pagination, chart)\n        this.tabPaneStates = {};\n        this.tabChartInstances = {};\n\n        this.init();\n    };\n\n    BlockController.prototype = {\n        /**\n         * Initialize the block.\n         */\n        init: function() {\n            // Find the block container.\n            this.container = $('[data-blockid=\"' + this.blockId + '\"]');\n            if (!this.container.length) {\n                return;\n            }\n\n            // Bind event handlers.\n            this.bindEvents();\n\n            // Load initial data.\n            this.loadReports();\n\n            // Setup auto-refresh if configured.\n            this.setupAutoRefresh();\n        },\n\n        /**\n         * Bind event handlers.\n         */\n        bindEvents: function() {\n            var self = this;\n\n            // Refresh button.\n            this.container.on('click', '.block-adeptus-refresh, .block-adeptus-retry', function(e) {\n                e.preventDefault();\n                self.refresh();\n            });\n\n            // Report item click.\n            this.container.on('click', '.block-adeptus-report-item', function(e) {\n                e.preventDefault();\n                var slug = $(this).data('slug');\n                var source = $(this).data('source');\n                self.handleReportClick(slug, source);\n            });\n\n            // Report item keyboard activation (Enter/Space).\n            this.container.on('keydown', '.block-adeptus-report-item', function(e) {\n                if (e.key === 'Enter' || e.key === ' ') {\n                    e.preventDefault();\n                    var slug = $(this).data('slug');\n                    var source = $(this).data('source');\n                    self.handleReportClick(slug, source);\n                }\n            });\n\n            // KPI card click.\n            this.container.on('click', '.block-adeptus-kpi-card', function(e) {\n                e.preventDefault();\n                var slug = $(this).data('slug');\n                var source = $(this).data('source');\n                self.handleReportClick(slug, source);\n            });\n\n            // Tab click.\n            this.container.on('shown.bs.tab', '.block-adeptus-tab-nav a', function(e) {\n                var tabPane = $($(e.target).attr('href'));\n                var slug = tabPane.data('slug');\n                var source = tabPane.data('source');\n                if (!tabPane.data('loaded')) {\n                    self.loadTabContent(tabPane, slug, source);\n                }\n            });\n\n            // Export buttons.\n            this.container.on('click', '.block-adeptus-export', function(e) {\n                e.preventDefault();\n                var format = $(this).data('format');\n                self.exportReport(format);\n            });\n\n            // Pagination - Previous button.\n            this.container.on('click', '.pagination-prev', function(e) {\n                e.preventDefault();\n                if (self.listCurrentPage > 1) {\n                    self.listCurrentPage--;\n                    self.renderCurrentPage();\n                    self.scrollToListTop();\n                }\n            });\n\n            // Pagination - Next button.\n            this.container.on('click', '.pagination-next', function(e) {\n                e.preventDefault();\n                if (self.listCurrentPage < self.listTotalPages) {\n                    self.listCurrentPage++;\n                    self.renderCurrentPage();\n                    self.scrollToListTop();\n                }\n            });\n\n            // Category filter change.\n            this.container.on('change', '.category-filter-select', function() {\n                self.selectedCategory = $(this).val();\n                self.listCurrentPage = 1; // Reset to first page\n                // For embedded mode, update the report selector based on new category\n                if (self.config.displayMode === 'embedded') {\n                    self.populateReportSelector();\n                } else {\n                    self.renderReports();\n                }\n            });\n\n            // Report selector change (for embedded mode) - hidden select fallback.\n            this.container.on('change', '.report-selector-select', function() {\n                var selectedValue = $(this).val();\n                if (selectedValue) {\n                    var parts = selectedValue.split('::');\n                    var slug = parts[0];\n                    var source = parts[1] || 'wizard';\n                    self.selectedReportSlug = slug;\n                    self.selectedReportSource = source;\n                    // Reset embedded state\n                    self.embeddedTablePage = 1;\n                    self.embeddedCurrentView = 'table';\n                    self.loadEmbeddedReport(slug, source);\n                }\n            });\n\n            // Searchable dropdown - Toggle open/close.\n            this.container.on('click', '.searchable-dropdown-toggle', function(e) {\n                e.preventDefault();\n                e.stopPropagation();\n                var dropdown = $(this).closest('.searchable-dropdown');\n                self.toggleSearchableDropdown(dropdown);\n            });\n\n            // Searchable dropdown - Search input.\n            this.container.on('input', '.searchable-dropdown-input', function() {\n                var dropdown = $(this).closest('.searchable-dropdown');\n                var query = $(this).val().toLowerCase().trim();\n                self.filterSearchableDropdown(dropdown, query);\n            });\n\n            // Searchable dropdown - Item selection.\n            this.container.on('click', '.searchable-dropdown-item', function(e) {\n                e.preventDefault();\n                e.stopPropagation();\n                var dropdown = $(this).closest('.searchable-dropdown');\n                var value = $(this).data('value');\n                var text = $(this).find('.dropdown-item-name').text();\n                self.selectSearchableDropdownItem(dropdown, value, text);\n            });\n\n            // Searchable dropdown - Keyboard navigation.\n            this.container.on('keydown', '.searchable-dropdown-input', function(e) {\n                var dropdown = $(this).closest('.searchable-dropdown');\n                var items = dropdown.find('.searchable-dropdown-item:visible');\n                var focused = dropdown.find('.searchable-dropdown-item.focused');\n\n                if (e.key === 'ArrowDown') {\n                    e.preventDefault();\n                    if (focused.length === 0) {\n                        items.first().addClass('focused');\n                    } else {\n                        var next = focused.nextAll('.searchable-dropdown-item:visible').first();\n                        if (next.length) {\n                            focused.removeClass('focused');\n                            next.addClass('focused');\n                            self.scrollDropdownItemIntoView(next);\n                        }\n                    }\n                } else if (e.key === 'ArrowUp') {\n                    e.preventDefault();\n                    if (focused.length) {\n                        var prev = focused.prevAll('.searchable-dropdown-item:visible').first();\n                        if (prev.length) {\n                            focused.removeClass('focused');\n                            prev.addClass('focused');\n                            self.scrollDropdownItemIntoView(prev);\n                        }\n                    }\n                } else if (e.key === 'Enter') {\n                    e.preventDefault();\n                    if (focused.length) {\n                        focused.trigger('click');\n                    } else if (items.length === 1) {\n                        items.first().trigger('click');\n                    }\n                } else if (e.key === 'Escape') {\n                    self.closeSearchableDropdown(dropdown);\n                }\n            });\n\n            // Close dropdown when clicking outside.\n            $(document).on('click', function(e) {\n                if (!$(e.target).closest('.searchable-dropdown').length) {\n                    self.container.find('.searchable-dropdown.open').each(function() {\n                        self.closeSearchableDropdown($(this));\n                    });\n                }\n            });\n\n            // Embedded mode - View toggle (Table/Chart).\n            this.container.on('click', '.embedded-view-toggle-btn', function(e) {\n                e.preventDefault();\n                var view = $(this).data('view');\n                self.switchEmbeddedView(view);\n            });\n\n            // Embedded mode - Table pagination.\n            this.container.on('click', '.embedded-pagination-prev', function(e) {\n                e.preventDefault();\n                if (self.embeddedTablePage > 1) {\n                    self.embeddedTablePage--;\n                    self.renderEmbeddedTablePage();\n                    self.scrollToEmbeddedTableTop();\n                }\n            });\n\n            this.container.on('click', '.embedded-pagination-next', function(e) {\n                e.preventDefault();\n                var totalPages = Math.ceil((self.embeddedData || []).length / self.embeddedTableRowsPerPage);\n                if (self.embeddedTablePage < totalPages) {\n                    self.embeddedTablePage++;\n                    self.renderEmbeddedTablePage();\n                    self.scrollToEmbeddedTableTop();\n                }\n            });\n\n            // Embedded mode - Chart type change.\n            this.container.on('change', '.embedded-chart-type', function() {\n                self.embeddedChartType = $(this).val();\n                self.renderEmbeddedChart();\n            });\n\n            // Embedded mode - X-Axis change.\n            this.container.on('change', '.embedded-chart-x-axis', function() {\n                self.embeddedXAxis = $(this).val();\n                self.renderEmbeddedChart();\n            });\n\n            // Embedded mode - Y-Axis change.\n            this.container.on('change', '.embedded-chart-y-axis', function() {\n                self.embeddedYAxis = $(this).val();\n                self.renderEmbeddedChart();\n            });\n\n            // Embedded mode - Export.\n            this.container.on('click', '.embedded-export', function(e) {\n                e.preventDefault();\n                var format = $(this).data('format');\n                self.exportEmbeddedReport(format);\n            });\n\n            // Tabs mode - View toggle (Table/Chart).\n            this.container.on('click', '.tab-view-toggle-btn', function(e) {\n                e.preventDefault();\n                var pane = $(this).closest('.tab-pane');\n                var view = $(this).data('view');\n                self.switchTabView(pane, view);\n            });\n\n            // Tabs mode - Table pagination.\n            this.container.on('click', '.tab-pagination-prev', function(e) {\n                e.preventDefault();\n                var pane = $(this).closest('.tab-pane');\n                var tabId = pane.attr('id');\n                var state = self.tabPaneStates[tabId];\n                if (state && state.tablePage > 1) {\n                    state.tablePage--;\n                    self.renderTabTablePage(pane, state);\n                }\n            });\n\n            this.container.on('click', '.tab-pagination-next', function(e) {\n                e.preventDefault();\n                var pane = $(this).closest('.tab-pane');\n                var tabId = pane.attr('id');\n                var state = self.tabPaneStates[tabId];\n                if (state) {\n                    var totalPages = Math.ceil(state.data.length / state.rowsPerPage);\n                    if (state.tablePage < totalPages) {\n                        state.tablePage++;\n                        self.renderTabTablePage(pane, state);\n                    }\n                }\n            });\n\n            // Tabs mode - Chart type change.\n            this.container.on('change', '.tab-chart-type', function() {\n                var pane = $(this).closest('.tab-pane');\n                var tabId = pane.attr('id');\n                var state = self.tabPaneStates[tabId];\n                if (state) {\n                    state.chartType = $(this).val();\n                    self.renderTabChart(pane, state);\n                }\n            });\n\n            // Tabs mode - X-Axis change.\n            this.container.on('change', '.tab-chart-x-axis', function() {\n                var pane = $(this).closest('.tab-pane');\n                var tabId = pane.attr('id');\n                var state = self.tabPaneStates[tabId];\n                if (state) {\n                    state.xAxis = $(this).val();\n                    self.renderTabChart(pane, state);\n                }\n            });\n\n            // Tabs mode - Y-Axis change.\n            this.container.on('change', '.tab-chart-y-axis', function() {\n                var pane = $(this).closest('.tab-pane');\n                var tabId = pane.attr('id');\n                var state = self.tabPaneStates[tabId];\n                if (state) {\n                    state.yAxis = $(this).val();\n                    self.renderTabChart(pane, state);\n                }\n            });\n\n            // Tabs mode - Export.\n            this.container.on('click', '.tab-export', function(e) {\n                e.preventDefault();\n                var pane = $(this).closest('.tab-pane');\n                var tabId = pane.attr('id');\n                var state = self.tabPaneStates[tabId];\n                var format = $(this).data('format');\n                if (state) {\n                    self.exportTabReport(state, format);\n                }\n            });\n\n            // Preload report data on hover (300ms delay to avoid unnecessary loads).\n            this.container.on('mouseenter', '.block-adeptus-report-item', function() {\n                var slug = $(this).data('slug');\n                var source = $(this).data('source');\n\n                // Clear any pending preload\n                if (self.preloadTimeout) {\n                    clearTimeout(self.preloadTimeout);\n                }\n\n                // Start preload after 300ms hover\n                self.preloadTimeout = setTimeout(function() {\n                    self.preloadReportData(slug, source);\n                }, 300);\n            });\n\n            this.container.on('mouseleave', '.block-adeptus-report-item', function() {\n                // Cancel pending preload if user moves away\n                if (self.preloadTimeout) {\n                    clearTimeout(self.preloadTimeout);\n                    self.preloadTimeout = null;\n                }\n            });\n        },\n\n        /**\n         * Load reports from the server or cache.\n         */\n        loadReports: function() {\n            var self = this;\n\n            this.showLoading();\n\n            // Try to load from cache first\n            var cachedData = this.getFromCache();\n            if (cachedData) {\n                this.reports = cachedData;\n                this.lastUpdated = new Date();\n                this.renderReports();\n                return;\n            }\n\n            // Wait for auth data to be available.\n            this.waitForAuth(function() {\n                self.fetchReports();\n            });\n        },\n\n        /**\n         * Get reports from sessionStorage cache.\n         *\n         * @return {Array|null}\n         */\n        getFromCache: function() {\n            try {\n                var cached = sessionStorage.getItem(this.cacheKey);\n                if (cached) {\n                    var data = JSON.parse(cached);\n                    if (data.timestamp && (Date.now() - data.timestamp) < this.cacheTTL) {\n                        return data.reports;\n                    }\n                    // Cache expired, remove it\n                    sessionStorage.removeItem(this.cacheKey);\n                }\n            } catch (e) {\n                // Ignore storage errors\n            }\n            return null;\n        },\n\n        /**\n         * Save reports to sessionStorage cache.\n         *\n         * @param {Array} reports\n         */\n        saveToCache: function(reports) {\n            try {\n                sessionStorage.setItem(this.cacheKey, JSON.stringify({\n                    timestamp: Date.now(),\n                    reports: reports\n                }));\n            } catch (e) {\n                // Ignore storage errors (quota exceeded, etc.)\n            }\n        },\n\n        /**\n         * Preload report data on hover for faster modal loading.\n         *\n         * @param {string} slug\n         * @param {string} source\n         */\n        preloadReportData: function(slug, source) {\n            var self = this;\n            var cacheKey = slug + '_' + source;\n\n            // Already cached or currently preloading\n            if (this.reportDataCache[cacheKey] || this.preloadingSlug === slug) {\n                return;\n            }\n\n            this.preloadingSlug = slug;\n\n            // Find the report from our cached list\n            var report = this.reports.find(function(r) {\n                return r.slug === slug;\n            });\n\n            if (!report) {\n                return;\n            }\n\n            if (source === 'wizard') {\n                // Preload wizard report\n                $.ajax({\n                    url: M.cfg.wwwroot + '/report/adeptus_insights/ajax/generate_report.php',\n                    method: 'POST',\n                    data: {\n                        reportid: report.name || report.report_template_id,\n                        sesskey: M.cfg.sesskey\n                    },\n                    dataType: 'json',\n                    timeout: 30000\n                }).done(function(response) {\n                    if (response.success) {\n                        self.reportDataCache[cacheKey] = {\n                            report: report,\n                            results: response.results || [],\n                            chartData: response.chart_data,\n                            chartType: response.chart_type\n                        };\n                    }\n                    self.preloadingSlug = null;\n                }).fail(function() {\n                    self.preloadingSlug = null;\n                });\n            } else {\n                // Preload AI report\n                var token = this.apiKey || (window.adeptusAuthData ? window.adeptusAuthData.api_key : null);\n                if (!token) {\n                    return;\n                }\n\n                $.ajax({\n                    url: 'https://a360backend.stagingwithswift.com/api/v1/ai-reports/' + slug,\n                    method: 'GET',\n                    headers: {\n                        'Authorization': 'Bearer ' + token,\n                        'Accept': 'application/json'\n                    },\n                    timeout: 15000\n                }).done(function(response) {\n                    if (response.success && response.report) {\n                        self.reportDataCache[cacheKey] = {\n                            report: response.report,\n                            results: response.data || [],\n                            chartData: null,\n                            chartType: null\n                        };\n                    }\n                    self.preloadingSlug = null;\n                }).fail(function() {\n                    self.preloadingSlug = null;\n                });\n            }\n        },\n\n        /**\n         * Wait for authentication data to be available.\n         * Uses API key passed directly from PHP, or falls back to AJAX.\n         *\n         * @param {Function} callback\n         */\n        waitForAuth: function(callback) {\n            var self = this;\n\n            // Use API key passed directly from PHP (preferred - no AJAX needed)\n            if (this.apiKey) {\n                window.adeptusAuthData = window.adeptusAuthData || {};\n                window.adeptusAuthData.api_key = this.apiKey;\n                callback();\n                return;\n            }\n\n            // Fallback: Check if already authenticated via parent plugin\n            if (window.adeptusAuthData && window.adeptusAuthData.api_key) {\n                callback();\n                return;\n            }\n\n            // Last resort: Try to fetch auth via AJAX\n            $.ajax({\n                url: M.cfg.wwwroot + '/report/adeptus_insights/ajax/get_auth_status.php',\n                method: 'GET',\n                dataType: 'json',\n                timeout: 10000\n            }).done(function(response) {\n                if (response && response.success && response.data) {\n                    window.adeptusAuthData = response.data;\n                    callback();\n                } else {\n                    self.showError('Authentication failed');\n                }\n            }).fail(function() {\n                self.showError('Could not authenticate');\n            });\n        },\n\n        /**\n         * Fetch reports from the backend API.\n         */\n        fetchReports: function() {\n            var self = this;\n            var token = this.apiKey || (window.adeptusAuthData ? window.adeptusAuthData.api_key : null);\n\n            if (!token) {\n                this.showError('No authentication token');\n                return;\n            }\n\n            var promises = [];\n            var source = this.config.reportSource || 'all';\n\n            if (source === 'all' || source === 'wizard') {\n                promises.push(this.fetchFromApi('/wizard-reports', token));\n            }\n\n            if (source === 'all' || source === 'ai') {\n                promises.push(this.fetchFromApi('/ai-reports', token));\n            }\n\n            $.when.apply($, promises).then(function() {\n                var allReports = [];\n\n                for (var i = 0; i < promises.length; i++) {\n                    var result;\n                    if (promises.length === 1) {\n                        result = arguments[0];\n                    } else {\n                        result = arguments[i][0];\n                    }\n\n                    var reports = result.reports || result.data || [];\n                    if (reports && reports.length) {\n                        var reportSource = (source === 'ai' || (i === 1 && source === 'all')) ? 'ai' : 'wizard';\n                        reports.forEach(function(report) {\n                            report.source = report.source || reportSource;\n                            allReports.push(report);\n                        });\n                    }\n                }\n\n                self.reports = allReports;\n                self.lastUpdated = new Date();\n                self.saveToCache(allReports);\n                self.renderReports();\n            }).fail(function() {\n                self.showError();\n            });\n        },\n\n        /**\n         * Fetch data from the backend API.\n         *\n         * @param {string} endpoint API endpoint\n         * @param {string} token Auth token\n         * @return {Promise}\n         */\n        fetchFromApi: function(endpoint, token) {\n            var baseUrl = 'https://a360backend.stagingwithswift.com/api/v1';\n\n            return $.ajax({\n                url: baseUrl + endpoint,\n                method: 'GET',\n                headers: {\n                    'Authorization': 'Bearer ' + token,\n                    'Content-Type': 'application/json',\n                    'Accept': 'application/json'\n                },\n                timeout: 15000\n            });\n        },\n\n        /**\n         * Render reports based on display mode.\n         */\n        renderReports: function() {\n            var mode = this.config.displayMode || 'links';\n\n            if (this.reports.length === 0) {\n                this.showEmpty();\n                return;\n            }\n\n            // Extract and populate category filter (only for modes that use it)\n            if (mode === 'embedded' || mode === 'links') {\n                this.populateCategoryFilter();\n            }\n\n            // Filter reports based on selected category\n            var reports = this.filterReports();\n\n            switch (mode) {\n                case 'embedded':\n                    this.renderEmbedded(reports);\n                    break;\n                case 'kpi':\n                    // For KPI mode, use specifically selected reports if configured\n                    var kpiReports = this.getSelectedReportsForMode('kpi', reports);\n                    this.renderKpi(kpiReports);\n                    break;\n                case 'tabs':\n                    // For Tabs mode, use specifically selected reports if configured\n                    var tabsReports = this.getSelectedReportsForMode('tabs', reports);\n                    this.renderTabs(tabsReports);\n                    break;\n                case 'links':\n                default:\n                    this.renderLinks(reports);\n                    break;\n            }\n\n            this.hideLoading();\n            this.updateTimestamp();\n        },\n\n        /**\n         * Get reports filtered by the selected reports configuration for a specific mode.\n         *\n         * @param {string} mode - 'kpi' or 'tabs'\n         * @param {Array} allReports - All available reports\n         * @return {Array} Filtered reports in configured order\n         */\n        getSelectedReportsForMode: function(mode, allReports) {\n            var selectedConfig = [];\n\n            if (mode === 'kpi' && this.config.kpiSelectedReports && this.config.kpiSelectedReports.length > 0) {\n                selectedConfig = this.config.kpiSelectedReports;\n            } else if (mode === 'tabs' && this.config.tabsSelectedReports && this.config.tabsSelectedReports.length > 0) {\n                selectedConfig = this.config.tabsSelectedReports;\n            }\n\n            // If no specific reports configured, return all reports\n            if (selectedConfig.length === 0) {\n                return allReports;\n            }\n\n            // Filter and order reports according to selection\n            var result = [];\n            selectedConfig.forEach(function(item) {\n                var slug = item.slug || item;\n                var source = item.source || 'wizard';\n                var report = allReports.find(function(r) {\n                    return r.slug === slug && (r.source === source || !item.source);\n                });\n                if (report) {\n                    result.push(report);\n                }\n            });\n\n            return result;\n        },\n\n        /**\n         * Extract categories from reports and populate the filter dropdown.\n         */\n        populateCategoryFilter: function() {\n            var self = this;\n            var categoryMap = {};\n\n            // Extract unique categories from reports\n            this.reports.forEach(function(report) {\n                var catInfo = report.category_info;\n                if (catInfo && catInfo.slug) {\n                    categoryMap[catInfo.slug] = {\n                        slug: catInfo.slug,\n                        name: catInfo.name || catInfo.slug,\n                        color: catInfo.color || '#6c757d'\n                    };\n                } else if (report.category) {\n                    categoryMap[report.category] = {\n                        slug: report.category,\n                        name: report.category,\n                        color: '#6c757d'\n                    };\n                }\n            });\n\n            // Convert to array and sort by name\n            this.availableCategories = Object.values(categoryMap).sort(function(a, b) {\n                return a.name.localeCompare(b.name);\n            });\n\n            // Populate hidden select\n            var select = this.container.find('.category-filter-select');\n            var dropdown = this.container.find('.category-dropdown');\n            var dropdownList = dropdown.find('.searchable-dropdown-list');\n\n            if (select.length) {\n                // Keep the first \"All Categories\" option, remove the rest\n                select.find('option:not(:first)').remove();\n\n                // Add category options to hidden select\n                this.availableCategories.forEach(function(cat) {\n                    var selected = self.selectedCategory === cat.slug ? ' selected' : '';\n                    select.append('<option value=\"' + cat.slug + '\"' + selected + '>' + cat.name + '</option>');\n                });\n            }\n\n            // Populate searchable dropdown list\n            if (dropdownList.length) {\n                dropdownList.empty();\n\n                // Add \"All Categories\" option first\n                var allSelected = !this.selectedCategory ? 'selected' : '';\n                var allItemHtml = '<li class=\"searchable-dropdown-item ' + allSelected + '\" data-value=\"\" ' +\n                    'data-search=\"all categories\" role=\"option\">' +\n                    '<span class=\"dropdown-item-name\">All Categories</span>' +\n                    '</li>';\n                dropdownList.append(allItemHtml);\n\n                // Add category options\n                this.availableCategories.forEach(function(cat) {\n                    var isSelected = self.selectedCategory === cat.slug ? 'selected' : '';\n                    var itemHtml = '<li class=\"searchable-dropdown-item ' + isSelected + '\" data-value=\"' + cat.slug + '\" ' +\n                        'data-search=\"' + cat.name.toLowerCase() + '\" role=\"option\">' +\n                        '<span class=\"dropdown-item-name\">' + self.escapeHtml(cat.name) + '</span>' +\n                        '<span class=\"dropdown-item-category\" style=\"background-color: ' + cat.color + '\">' +\n                        '<i class=\"fa fa-circle\" style=\"font-size: 0.5rem;\"></i></span>' +\n                        '</li>';\n                    dropdownList.append(itemHtml);\n                });\n\n                // Update dropdown text to show selected category\n                var selectedText = 'All Categories';\n                if (this.selectedCategory) {\n                    var selectedCat = this.availableCategories.find(function(c) {\n                        return c.slug === self.selectedCategory;\n                    });\n                    if (selectedCat) {\n                        selectedText = selectedCat.name;\n                    }\n                }\n                dropdown.find('.searchable-dropdown-text').text(selectedText);\n            }\n        },\n\n        /**\n         * Populate the report selector dropdown (for embedded mode).\n         * Filters reports based on selected category.\n         */\n        populateReportSelector: function() {\n            var self = this;\n            var select = this.container.find('.report-selector-select');\n            var dropdown = this.container.find('.block-adeptus-report-selector .searchable-dropdown');\n            var dropdownList = dropdown.find('.searchable-dropdown-list');\n\n            if (!select.length) {\n                return;\n            }\n\n            // Get filtered reports based on category\n            var reports = this.filterReports();\n\n            // Clear existing options\n            select.find('option:not(:first)').remove();\n            dropdownList.empty();\n\n            // Add report options to both hidden select and searchable dropdown\n            reports.forEach(function(report) {\n                var reportName = report.name || report.title || report.display_name || report.slug || 'Untitled';\n                var value = report.slug + '::' + report.source;\n                var categoryInfo = report.category_info || {name: 'General', color: '#6c757d'};\n                var categoryLabel = ' [' + categoryInfo.name + ']';\n                var selected = (self.selectedReportSlug === report.slug) ? ' selected' : '';\n\n                // Hidden select option\n                select.append('<option value=\"' + value + '\"' + selected + '>' + reportName + categoryLabel + '</option>');\n\n                // Searchable dropdown item\n                var itemHtml = '<li class=\"searchable-dropdown-item\" data-value=\"' + value + '\" data-search=\"' +\n                    reportName.toLowerCase() + ' ' + categoryInfo.name.toLowerCase() + '\" role=\"option\">' +\n                    '<span class=\"dropdown-item-name\">' + self.escapeHtml(reportName) + '</span>' +\n                    '<span class=\"dropdown-item-category\" style=\"background-color: ' + categoryInfo.color + '\">' +\n                    self.escapeHtml(categoryInfo.name) + '</span>' +\n                    '</li>';\n                dropdownList.append(itemHtml);\n            });\n\n            // If we have a default report configured and it's in the list, select it\n            if (this.selectedReportSlug && !select.val()) {\n                var defaultOption = select.find('option[value^=\"' + this.selectedReportSlug + '::\"]');\n                if (defaultOption.length) {\n                    defaultOption.prop('selected', true);\n                }\n            }\n\n            // If no report selected and we have reports, auto-select the first one\n            if (!select.val() && reports.length > 0) {\n                var firstReport = reports[0];\n                var firstValue = firstReport.slug + '::' + firstReport.source;\n                var firstName = firstReport.name || firstReport.title || firstReport.display_name || firstReport.slug || 'Untitled';\n                select.val(firstValue);\n                this.selectedReportSlug = firstReport.slug;\n                this.selectedReportSource = firstReport.source;\n                // Update searchable dropdown display\n                dropdown.find('.searchable-dropdown-text').text(firstName);\n                dropdown.find('.searchable-dropdown-item').removeClass('selected');\n                dropdown.find('.searchable-dropdown-item[data-value=\"' + firstValue + '\"]').addClass('selected');\n                // Load the first report\n                this.loadEmbeddedReport(firstReport.slug, firstReport.source);\n            } else if (select.val()) {\n                // A report is selected, load it and update display\n                var parts = select.val().split('::');\n                var selectedReport = reports.find(function(r) { return r.slug === parts[0]; });\n                if (selectedReport) {\n                    var selectedName = selectedReport.name || selectedReport.title || selectedReport.display_name || selectedReport.slug || 'Untitled';\n                    dropdown.find('.searchable-dropdown-text').text(selectedName);\n                    dropdown.find('.searchable-dropdown-item').removeClass('selected');\n                    dropdown.find('.searchable-dropdown-item[data-value=\"' + select.val() + '\"]').addClass('selected');\n                }\n                this.loadEmbeddedReport(parts[0], parts[1] || 'wizard');\n            } else {\n                // No reports available\n                dropdown.find('.searchable-dropdown-text').text('-- No Reports --');\n                this.showEmpty();\n            }\n        },\n\n        /**\n         * Filter reports based on configuration and selected category.\n         *\n         * @return {Array}\n         */\n        filterReports: function() {\n            var self = this;\n            var reports = this.reports.slice();\n            var config = this.config;\n\n            // Filter by selected category (from dropdown).\n            if (this.selectedCategory) {\n                reports = reports.filter(function(r) {\n                    var catSlug = r.category_info ? r.category_info.slug : (r.category || '');\n                    return catSlug === self.selectedCategory;\n                });\n            }\n\n            // Filter to manually selected reports (from block config).\n            if (config.reportSource === 'manual' && config.selectedReports && config.selectedReports.length) {\n                var selected = config.selectedReports;\n                reports = reports.filter(function(r) {\n                    return selected.indexOf(r.slug) !== -1;\n                });\n            }\n\n            // Note: We don't limit here anymore - pagination handles display limits\n\n            // Sort by name (try multiple possible name fields).\n            reports.sort(function(a, b) {\n                var nameA = a.name || a.title || a.display_name || a.report_name || a.slug || '';\n                var nameB = b.name || b.title || b.display_name || b.report_name || b.slug || '';\n                return nameA.localeCompare(nameB);\n            });\n\n            return reports;\n        },\n\n        /**\n         * Render link list mode with pagination.\n         *\n         * @param {Array} reports\n         */\n        renderLinks: function(reports) {\n            // Store filtered reports for pagination\n            this.filteredReports = reports;\n\n            // Calculate pagination\n            this.listItemsPerPage = this.config.maxLinkItems || 10;\n            this.listTotalPages = Math.ceil(reports.length / this.listItemsPerPage);\n            this.listCurrentPage = 1; // Reset to first page\n\n            // Render the first page\n            this.renderCurrentPage();\n        },\n\n        /**\n         * Render the current page of reports.\n         */\n        renderCurrentPage: function() {\n            var self = this;\n            var reports = this.filteredReports || [];\n            var listContainer = this.container.find('.block-adeptus-report-list');\n            var template = $('#block-adeptus-report-item-template-' + this.blockId);\n            var paginationContainer = this.container.find('.block-adeptus-pagination');\n\n            // Calculate page slice\n            var startIndex = (this.listCurrentPage - 1) * this.listItemsPerPage;\n            var endIndex = startIndex + this.listItemsPerPage;\n            var pageReports = reports.slice(startIndex, endIndex);\n\n            listContainer.empty();\n\n            pageReports.forEach(function(report) {\n                var item = template.html();\n                var $item = $(item);\n\n                $item.attr('data-slug', report.slug);\n                $item.attr('data-source', report.source);\n\n                // Try multiple possible name fields (API may use different field names)\n                var reportName = report.name || report.title || report.display_name || report.report_name || report.slug || 'Untitled Report';\n                $item.find('.report-item-name').text(reportName);\n\n                // Set category badge with color\n                var categoryName = report.category_info ? report.category_info.name : report.category || 'General';\n                var categoryColor = report.category_info ? report.category_info.color : '#6c757d';\n                $item.find('.report-item-category')\n                    .text(categoryName)\n                    .css('background-color', categoryColor)\n                    .css('color', '#fff');\n\n                listContainer.append($item);\n            });\n\n            listContainer.removeClass('d-none');\n\n            // Update pagination controls\n            if (this.listTotalPages > 1) {\n                // Use actual page data length for accurate count\n                var actualEnd = startIndex + pageReports.length;\n                paginationContainer.find('.pagination-showing')\n                    .text('Showing ' + (startIndex + 1) + '-' + actualEnd + ' of ' + reports.length);\n                paginationContainer.find('.pagination-pages')\n                    .text('Page ' + this.listCurrentPage + ' of ' + this.listTotalPages);\n\n                // Update button states\n                paginationContainer.find('.pagination-prev').prop('disabled', this.listCurrentPage <= 1);\n                paginationContainer.find('.pagination-next').prop('disabled', this.listCurrentPage >= this.listTotalPages);\n\n                paginationContainer.removeClass('d-none');\n            } else {\n                paginationContainer.addClass('d-none');\n            }\n        },\n\n        /**\n         * Render embedded report mode.\n         *\n         * @param {Array} reports\n         */\n        renderEmbedded: function(reports) {\n            // Initialize embedded report state\n            this.embeddedReport = null;\n            this.embeddedData = null;\n            this.embeddedChartInstance = null;\n\n            // Populate the report selector dropdown\n            // This will also auto-load the first/default report\n            this.populateReportSelector();\n\n            // Hide loading state if no reports\n            if (this.reports.length === 0) {\n                this.showEmpty();\n            }\n        },\n\n        /**\n         * Load report data for embedded display.\n         *\n         * @param {string} slug\n         * @param {string} source\n         */\n        loadEmbeddedReport: function(slug, source) {\n            var self = this;\n            var cacheKey = slug + '_' + source;\n\n            // Check cache first for instant loading (no overlay needed)\n            if (this.reportDataCache[cacheKey]) {\n                var cached = this.reportDataCache[cacheKey];\n                this.embeddedData = cached.results;\n                this.renderEmbeddedContent(cached.report, cached.results);\n                return;\n            }\n\n            // Show loading overlay for non-cached requests\n            this.showEmbeddedLoadingOverlay();\n\n            // Find the report from our cached list\n            var report = this.reports.find(function(r) {\n                return r.slug === slug;\n            });\n\n            if (!report) {\n                this.hideEmbeddedLoadingOverlay();\n                this.showError('Report not found');\n                return;\n            }\n\n            // For wizard reports, execute locally via generate_report.php\n            if (source === 'wizard') {\n                $.ajax({\n                    url: M.cfg.wwwroot + '/report/adeptus_insights/ajax/generate_report.php',\n                    method: 'POST',\n                    data: {\n                        reportid: report.name || report.report_template_id,\n                        sesskey: M.cfg.sesskey\n                    },\n                    dataType: 'json',\n                    timeout: 30000\n                }).done(function(response) {\n                    self.hideEmbeddedLoadingOverlay();\n                    if (response.success) {\n                        // Cache the result\n                        self.reportDataCache[cacheKey] = {\n                            report: report,\n                            results: response.results || [],\n                            chartData: response.chart_data,\n                            chartType: response.chart_type\n                        };\n                        self.embeddedData = response.results || [];\n                        self.renderEmbeddedContent(report, response.results || []);\n                    } else {\n                        self.showError(response.message || 'Failed to load report');\n                    }\n                }).fail(function() {\n                    self.hideEmbeddedLoadingOverlay();\n                    self.showError('Connection error');\n                });\n            } else {\n                // AI reports - fetch from backend API\n                var token = this.apiKey || (window.adeptusAuthData ? window.adeptusAuthData.api_key : null);\n\n                if (!token) {\n                    this.hideEmbeddedLoadingOverlay();\n                    this.showError('No authentication token');\n                    return;\n                }\n\n                $.ajax({\n                    url: 'https://a360backend.stagingwithswift.com/api/v1/ai-reports/' + slug,\n                    method: 'GET',\n                    headers: {\n                        'Authorization': 'Bearer ' + token,\n                        'Accept': 'application/json'\n                    },\n                    timeout: 15000\n                }).done(function(response) {\n                    self.hideEmbeddedLoadingOverlay();\n                    if (response.success && response.report) {\n                        // Cache the result\n                        self.reportDataCache[cacheKey] = {\n                            report: response.report,\n                            results: response.data || [],\n                            chartData: null,\n                            chartType: null\n                        };\n                        self.embeddedData = response.data || [];\n                        self.renderEmbeddedContent(response.report, response.data || []);\n                    } else {\n                        self.showError('Failed to load report');\n                    }\n                }).fail(function() {\n                    self.hideEmbeddedLoadingOverlay();\n                    self.showError('Connection error');\n                });\n            }\n        },\n\n        /**\n         * Render embedded content with report data.\n         *\n         * @param {Object} report\n         * @param {Array} data\n         */\n        renderEmbeddedContent: function(report, data) {\n            var contentArea = this.container.find('.block-adeptus-content');\n\n            if (!data || data.length === 0) {\n                this.showEmpty();\n                return;\n            }\n\n            // Store data for later use\n            this.embeddedReport = report;\n            this.embeddedData = data;\n\n            // Update meta bar\n            var category = report.category_info || {name: 'General', color: '#6c757d'};\n            this.container.find('.report-category')\n                .text(category.name)\n                .css('background-color', category.color)\n                .css('color', '#fff');\n            this.container.find('.row-count-num').text(data.length);\n            this.container.find('.report-date').text('Updated: ' + new Date().toLocaleTimeString());\n\n            // Populate chart axis selectors\n            this.populateEmbeddedChartControls(data);\n\n            // Reset to table view\n            this.embeddedCurrentView = 'table';\n            this.embeddedTablePage = 1;\n            this.container.find('.embedded-view-toggle-btn').removeClass('active');\n            this.container.find('.embedded-view-toggle-btn[data-view=\"table\"]').addClass('active');\n            this.container.find('.embedded-table-view').removeClass('d-none');\n            this.container.find('.embedded-chart-view').addClass('d-none');\n\n            // Render table with pagination\n            this.renderEmbeddedTablePage();\n\n            contentArea.removeClass('d-none');\n            this.hideLoading();\n            this.updateTimestamp();\n        },\n\n        /**\n         * Switch between table and chart views in embedded mode.\n         *\n         * @param {string} view - 'table' or 'chart'\n         */\n        switchEmbeddedView: function(view) {\n            this.embeddedCurrentView = view;\n\n            // Update toggle buttons\n            this.container.find('.embedded-view-toggle-btn').removeClass('active');\n            this.container.find('.embedded-view-toggle-btn[data-view=\"' + view + '\"]').addClass('active');\n\n            // Show/hide views\n            if (view === 'table') {\n                this.container.find('.embedded-table-view').removeClass('d-none');\n                this.container.find('.embedded-chart-view').addClass('d-none');\n            } else {\n                this.container.find('.embedded-table-view').addClass('d-none');\n                this.container.find('.embedded-chart-view').removeClass('d-none');\n                // Render chart when switching to chart view\n                this.renderEmbeddedChart();\n            }\n        },\n\n        /**\n         * Populate chart control dropdowns for embedded mode.\n         *\n         * @param {Array} data\n         */\n        populateEmbeddedChartControls: function(data) {\n            if (!data || data.length === 0) return;\n\n            var headers = Object.keys(data[0]);\n            var numericCols = this.detectNumericColumns(data, headers);\n\n            var xAxisSelect = this.container.find('.embedded-chart-x-axis');\n            var yAxisSelect = this.container.find('.embedded-chart-y-axis');\n\n            xAxisSelect.empty();\n            yAxisSelect.empty();\n\n            // Populate X-axis (all columns)\n            headers.forEach(function(h) {\n                var formatted = h.replace(/_/g, ' ').replace(/\\b\\w/g, function(l) { return l.toUpperCase(); });\n                xAxisSelect.append('<option value=\"' + h + '\">' + formatted + '</option>');\n            });\n\n            // Populate Y-axis (prefer numeric columns)\n            var yOptions = numericCols.length > 0 ? numericCols : headers;\n            yOptions.forEach(function(h) {\n                var formatted = h.replace(/_/g, ' ').replace(/\\b\\w/g, function(l) { return l.toUpperCase(); });\n                yAxisSelect.append('<option value=\"' + h + '\">' + formatted + '</option>');\n            });\n\n            // Set defaults\n            this.embeddedXAxis = headers[0];\n            this.embeddedYAxis = numericCols.length > 0 ? numericCols[numericCols.length - 1] : headers[headers.length - 1];\n\n            xAxisSelect.val(this.embeddedXAxis);\n            yAxisSelect.val(this.embeddedYAxis);\n        },\n\n        /**\n         * Render current page of table in embedded mode.\n         */\n        renderEmbeddedTablePage: function() {\n            var data = this.embeddedData || [];\n            var table = this.container.find('.embedded-table');\n            var thead = table.find('thead');\n            var tbody = table.find('tbody');\n\n            thead.empty();\n            tbody.empty();\n\n            if (data.length === 0) {\n                return;\n            }\n\n            // Build headers\n            var headers = Object.keys(data[0]);\n            var headerRow = $('<tr>');\n            headers.forEach(function(h) {\n                var formatted = h.replace(/_/g, ' ').replace(/\\b\\w/g, function(l) { return l.toUpperCase(); });\n                headerRow.append($('<th>').text(formatted));\n            });\n            thead.append(headerRow);\n\n            // Calculate pagination\n            var totalPages = Math.ceil(data.length / this.embeddedTableRowsPerPage);\n            var startIndex = (this.embeddedTablePage - 1) * this.embeddedTableRowsPerPage;\n            var endIndex = Math.min(startIndex + this.embeddedTableRowsPerPage, data.length);\n            var pageData = data.slice(startIndex, endIndex);\n\n            // Build rows\n            pageData.forEach(function(row) {\n                var tr = $('<tr>');\n                headers.forEach(function(h) {\n                    var val = row[h];\n                    if (val === null || val === undefined) val = '';\n                    var displayVal = String(val);\n                    if (displayVal.length > 50) {\n                        displayVal = displayVal.substring(0, 50) + '...';\n                    }\n                    tr.append($('<td>').attr('title', val).text(displayVal));\n                });\n                tbody.append(tr);\n            });\n\n            // Update pagination info\n            this.container.find('.row-count').text('Showing ' + (startIndex + 1) + '-' + endIndex + ' of ' + data.length);\n            this.container.find('.embedded-pagination-info').text('Page ' + this.embeddedTablePage + ' of ' + totalPages);\n\n            // Update button states\n            this.container.find('.embedded-pagination-prev').prop('disabled', this.embeddedTablePage <= 1);\n            this.container.find('.embedded-pagination-next').prop('disabled', this.embeddedTablePage >= totalPages);\n        },\n\n        /**\n         * Render chart in embedded mode with current settings.\n         */\n        renderEmbeddedChart: function() {\n            var data = this.embeddedData || [];\n            var canvas = this.container.find('.embedded-chart')[0];\n\n            if (!canvas || data.length === 0) {\n                return;\n            }\n\n            // Destroy existing chart\n            if (this.embeddedChartInstance) {\n                this.embeddedChartInstance.destroy();\n                this.embeddedChartInstance = null;\n            }\n\n            var chartType = this.embeddedChartType || 'bar';\n            var xAxis = this.embeddedXAxis || Object.keys(data[0])[0];\n            var yAxis = this.embeddedYAxis || Object.keys(data[0])[1];\n\n            // Prepare chart data (limit to 30 items)\n            var chartData = data.slice(0, 30);\n            var labels = chartData.map(function(row) {\n                var label = row[xAxis];\n                if (label === null || label === undefined) return 'Unknown';\n                var labelStr = String(label);\n                return labelStr.length > 20 ? labelStr.substring(0, 20) + '...' : labelStr;\n            });\n            var values = chartData.map(function(row) {\n                return parseFloat(row[yAxis]) || 0;\n            });\n\n            // Generate colors\n            var colors = this.generateChartColors(values.length, chartType);\n\n            // Build dataset config\n            var datasetConfig = {\n                label: yAxis.replace(/_/g, ' ').replace(/\\b\\w/g, function(l) { return l.toUpperCase(); }),\n                data: values\n            };\n\n            if (chartType === 'pie' || chartType === 'doughnut') {\n                datasetConfig.backgroundColor = colors;\n                datasetConfig.borderWidth = 1;\n            } else {\n                datasetConfig.backgroundColor = colors[0];\n                datasetConfig.borderColor = colors[0].replace('0.7', '1');\n                datasetConfig.borderWidth = 1;\n            }\n\n            // Chart config\n            var config = {\n                type: chartType,\n                data: {\n                    labels: labels,\n                    datasets: [datasetConfig]\n                },\n                options: {\n                    responsive: true,\n                    maintainAspectRatio: false,\n                    plugins: {\n                        legend: {\n                            display: chartType === 'pie' || chartType === 'doughnut',\n                            position: 'right'\n                        }\n                    }\n                }\n            };\n\n            // Add scales for bar/line charts\n            if (chartType === 'bar' || chartType === 'line') {\n                config.options.scales = {\n                    y: { beginAtZero: true },\n                    x: { display: data.length <= 15 }\n                };\n            }\n\n            try {\n                this.embeddedChartInstance = new Chart(canvas.getContext('2d'), config);\n            } catch (error) {\n                this.container.find('.embedded-chart-container').html(\n                    '<div class=\"alert alert-warning text-center\"><i class=\"fa fa-exclamation-circle\"></i> Could not render chart</div>'\n                );\n            }\n        },\n\n        /**\n         * Export embedded report data.\n         *\n         * @param {string} format\n         */\n        exportEmbeddedReport: function(format) {\n            var data = this.embeddedData || [];\n            var report = this.embeddedReport || {};\n\n            if (data.length === 0) {\n                return;\n            }\n\n            if (format === 'csv') {\n                var headers = Object.keys(data[0]);\n                var csvContent = headers.join(',') + '\\n';\n\n                data.forEach(function(row) {\n                    var rowValues = headers.map(function(h) {\n                        var val = row[h];\n                        if (val === null || val === undefined) return '';\n                        var strVal = String(val);\n                        // Escape quotes and wrap in quotes if contains comma\n                        if (strVal.includes(',') || strVal.includes('\"') || strVal.includes('\\n')) {\n                            strVal = '\"' + strVal.replace(/\"/g, '\"\"') + '\"';\n                        }\n                        return strVal;\n                    });\n                    csvContent += rowValues.join(',') + '\\n';\n                });\n\n                var blob = new Blob([csvContent], {type: 'text/csv;charset=utf-8;'});\n                var link = document.createElement('a');\n                var reportName = report.name || report.slug || 'report';\n                link.href = URL.createObjectURL(blob);\n                link.download = reportName.replace(/[^a-z0-9]/gi, '_') + '_' + new Date().toISOString().split('T')[0] + '.csv';\n                link.click();\n            }\n        },\n\n        /**\n         * Render KPI cards mode.\n         *\n         * @param {Array} reports\n         */\n        renderKpi: function(reports) {\n            var self = this;\n            var gridContainer = this.container.find('.block-adeptus-kpi-grid');\n            var template = $('#block-adeptus-kpi-card-template-' + this.blockId);\n            var maxCards = parseInt(this.config.kpiColumns, 10) || 2;\n            maxCards = Math.min(maxCards * 2, 4); // Max 4 KPI cards\n\n            gridContainer.empty();\n\n            var kpiReports = reports.slice(0, maxCards);\n\n            kpiReports.forEach(function(report, index) {\n                var card = template.html();\n                var $card = $(card);\n\n                var reportName = report.name || report.title || report.display_name || report.slug || 'Metric';\n                $card.attr('data-slug', report.slug);\n                $card.attr('data-source', report.source);\n                $card.find('.kpi-card-label').text(reportName);\n                $card.find('.kpi-card-value').html('<i class=\"fa fa-spinner fa-spin\"></i>');\n                $card.find('.kpi-card-trend').addClass('d-none');\n                $card.find('.kpi-card-sparkline').addClass('d-none');\n\n                // Set different icons based on index\n                var icons = ['fa-users', 'fa-graduation-cap', 'fa-clock', 'fa-check-circle'];\n                $card.find('.kpi-card-icon i').removeClass('fa-chart-line').addClass(icons[index % icons.length]);\n\n                gridContainer.append($card);\n\n                // Load KPI data for this card\n                self.loadKpiData(report, $card);\n            });\n\n            gridContainer.removeClass('d-none');\n        },\n\n        /**\n         * Load KPI data for a single card.\n         *\n         * @param {Object} report\n         * @param {jQuery} $card\n         */\n        loadKpiData: function(report, $card) {\n            var self = this;\n            var cacheKey = report.slug + '_' + report.source;\n\n            // Check cache first\n            if (this.reportDataCache[cacheKey]) {\n                var cached = this.reportDataCache[cacheKey];\n                this.renderKpiValue($card, cached.results);\n                return;\n            }\n\n            // Load data based on source\n            if (report.source === 'wizard') {\n                $.ajax({\n                    url: M.cfg.wwwroot + '/report/adeptus_insights/ajax/generate_report.php',\n                    method: 'POST',\n                    data: {\n                        reportid: report.name || report.report_template_id,\n                        sesskey: M.cfg.sesskey\n                    },\n                    dataType: 'json',\n                    timeout: 15000\n                }).done(function(response) {\n                    if (response.success) {\n                        self.reportDataCache[cacheKey] = {\n                            report: report,\n                            results: response.results || []\n                        };\n                        self.renderKpiValue($card, response.results || []);\n                    } else {\n                        $card.find('.kpi-card-value').text('--');\n                    }\n                }).fail(function() {\n                    $card.find('.kpi-card-value').text('--');\n                });\n            } else {\n                // AI reports\n                var token = this.apiKey || (window.adeptusAuthData ? window.adeptusAuthData.api_key : null);\n                if (!token) {\n                    $card.find('.kpi-card-value').text('--');\n                    return;\n                }\n\n                $.ajax({\n                    url: 'https://a360backend.stagingwithswift.com/api/v1/ai-reports/' + report.slug,\n                    method: 'GET',\n                    headers: {\n                        'Authorization': 'Bearer ' + token,\n                        'Accept': 'application/json'\n                    },\n                    timeout: 15000\n                }).done(function(response) {\n                    if (response.success && response.data) {\n                        self.reportDataCache[cacheKey] = {\n                            report: response.report || report,\n                            results: response.data || []\n                        };\n                        self.renderKpiValue($card, response.data || []);\n                    } else {\n                        $card.find('.kpi-card-value').text('--');\n                    }\n                }).fail(function() {\n                    $card.find('.kpi-card-value').text('--');\n                });\n            }\n        },\n\n        /**\n         * Render KPI value on card.\n         *\n         * @param {jQuery} $card\n         * @param {Array} data\n         */\n        renderKpiValue: function($card, data) {\n            if (!data || data.length === 0) {\n                $card.find('.kpi-card-value').text('0');\n                return;\n            }\n\n            // Find numeric column for KPI value\n            var headers = Object.keys(data[0]);\n            var numericCols = this.detectNumericColumns(data, headers);\n\n            var value;\n            var formattedValue;\n\n            if (numericCols.length > 0) {\n                // Use sum or count of the last numeric column\n                var valueCol = numericCols[numericCols.length - 1];\n\n                // If it's a count/total column, sum all values\n                if (valueCol.toLowerCase().includes('count') ||\n                    valueCol.toLowerCase().includes('total') ||\n                    data.length === 1) {\n                    value = data.reduce(function(sum, row) {\n                        return sum + (parseFloat(row[valueCol]) || 0);\n                    }, 0);\n                } else {\n                    // Otherwise show row count\n                    value = data.length;\n                }\n            } else {\n                // No numeric columns, show row count\n                value = data.length;\n            }\n\n            // Format the value nicely\n            if (value >= 1000000) {\n                formattedValue = (value / 1000000).toFixed(1) + 'M';\n            } else if (value >= 1000) {\n                formattedValue = (value / 1000).toFixed(1) + 'K';\n            } else if (Number.isInteger(value)) {\n                formattedValue = value.toLocaleString();\n            } else {\n                formattedValue = value.toFixed(1);\n            }\n\n            $card.find('.kpi-card-value').text(formattedValue);\n\n            // Add a simple trend indicator (placeholder - would need historical data)\n            var trendContainer = $card.find('.kpi-card-trend');\n            trendContainer.removeClass('d-none trend-up trend-down trend-neutral');\n            trendContainer.addClass('trend-neutral');\n            trendContainer.find('.trend-icon').html('<i class=\"fa fa-minus\"></i>');\n            trendContainer.find('.trend-value').text('vs previous');\n        },\n\n        /**\n         * Render tabbed reports mode.\n         *\n         * @param {Array} reports\n         */\n        renderTabs: function(reports) {\n            var self = this;\n            var tabNav = this.container.find('.block-adeptus-tab-nav');\n            var tabContent = this.container.find('.block-adeptus-tab-content');\n            var tabTemplate = $('#block-adeptus-tab-template-' + this.blockId);\n            var paneTemplate = $('#block-adeptus-tab-pane-template-' + this.blockId);\n            var maxTabs = 5;\n\n            tabNav.empty();\n            tabContent.empty();\n\n            // Store tab chart instances\n            this.tabChartInstances = {};\n\n            reports.slice(0, maxTabs).forEach(function(report, index) {\n                var tabId = 'tab-' + self.blockId + '-' + index;\n                var reportName = report.name || report.title || report.display_name || report.slug || 'Report';\n\n                // Create tab\n                var tab = $(tabTemplate.html());\n                tab.find('a')\n                    .attr('href', '#' + tabId)\n                    .attr('aria-controls', tabId);\n                tab.find('.tab-name').text(reportName);\n\n                if (index === 0) {\n                    tab.find('a').addClass('active').attr('aria-selected', 'true');\n                }\n\n                tabNav.append(tab);\n\n                // Create pane\n                var pane = $(paneTemplate.html());\n                pane.attr('id', tabId);\n                pane.attr('data-slug', report.slug);\n                pane.attr('data-source', report.source);\n\n                if (index === 0) {\n                    pane.addClass('show active');\n                }\n\n                tabContent.append(pane);\n            });\n\n            // Load first tab content\n            if (reports.length > 0) {\n                var firstPane = tabContent.find('.tab-pane').first();\n                this.loadTabContent(firstPane, reports[0].slug, reports[0].source);\n            }\n\n            this.container.find('.block-adeptus-tabs-container').removeClass('d-none');\n        },\n\n        /**\n         * Load content for a tab.\n         *\n         * @param {jQuery} pane\n         * @param {string} slug\n         * @param {string} source\n         */\n        loadTabContent: function(pane, slug, source) {\n            var self = this;\n            var cacheKey = slug + '_' + source;\n            pane.data('loaded', true);\n\n            // Check cache first\n            if (this.reportDataCache[cacheKey]) {\n                var cached = this.reportDataCache[cacheKey];\n                this.renderTabContent(pane, cached.report, cached.results);\n                return;\n            }\n\n            // Find the report from our cached list\n            var report = this.reports.find(function(r) {\n                return r.slug === slug;\n            });\n\n            if (!report) {\n                pane.find('.tab-pane-loading').addClass('d-none');\n                pane.find('.tab-pane-content')\n                    .removeClass('d-none')\n                    .html('<div class=\"text-center text-muted py-4\"><i class=\"fa fa-exclamation-circle\"></i><p class=\"mt-2\">Report not found</p></div>');\n                return;\n            }\n\n            // Load data based on source\n            if (source === 'wizard') {\n                $.ajax({\n                    url: M.cfg.wwwroot + '/report/adeptus_insights/ajax/generate_report.php',\n                    method: 'POST',\n                    data: {\n                        reportid: report.name || report.report_template_id,\n                        sesskey: M.cfg.sesskey\n                    },\n                    dataType: 'json',\n                    timeout: 30000\n                }).done(function(response) {\n                    if (response.success) {\n                        self.reportDataCache[cacheKey] = {\n                            report: report,\n                            results: response.results || []\n                        };\n                        self.renderTabContent(pane, report, response.results || []);\n                    } else {\n                        pane.find('.tab-pane-loading').addClass('d-none');\n                        pane.find('.tab-pane-content')\n                            .removeClass('d-none')\n                            .html('<div class=\"text-center text-muted py-4\"><i class=\"fa fa-exclamation-circle\"></i><p class=\"mt-2\">' + (response.message || 'Failed to load') + '</p></div>');\n                    }\n                }).fail(function() {\n                    pane.find('.tab-pane-loading').addClass('d-none');\n                    pane.find('.tab-pane-content')\n                        .removeClass('d-none')\n                        .html('<div class=\"text-center text-muted py-4\"><i class=\"fa fa-exclamation-circle\"></i><p class=\"mt-2\">Connection error</p></div>');\n                });\n            } else {\n                // AI reports\n                var token = this.apiKey || (window.adeptusAuthData ? window.adeptusAuthData.api_key : null);\n                if (!token) {\n                    pane.find('.tab-pane-loading').addClass('d-none');\n                    pane.find('.tab-pane-content')\n                        .removeClass('d-none')\n                        .html('<div class=\"text-center text-muted py-4\"><i class=\"fa fa-exclamation-circle\"></i><p class=\"mt-2\">Authentication required</p></div>');\n                    return;\n                }\n\n                $.ajax({\n                    url: 'https://a360backend.stagingwithswift.com/api/v1/ai-reports/' + slug,\n                    method: 'GET',\n                    headers: {\n                        'Authorization': 'Bearer ' + token,\n                        'Accept': 'application/json'\n                    },\n                    timeout: 15000\n                }).done(function(response) {\n                    if (response.success) {\n                        self.reportDataCache[cacheKey] = {\n                            report: response.report || report,\n                            results: response.data || []\n                        };\n                        self.renderTabContent(pane, response.report || report, response.data || []);\n                    } else {\n                        pane.find('.tab-pane-loading').addClass('d-none');\n                        pane.find('.tab-pane-content')\n                            .removeClass('d-none')\n                            .html('<div class=\"text-center text-muted py-4\"><i class=\"fa fa-exclamation-circle\"></i><p class=\"mt-2\">Failed to load report</p></div>');\n                    }\n                }).fail(function() {\n                    pane.find('.tab-pane-loading').addClass('d-none');\n                    pane.find('.tab-pane-content')\n                        .removeClass('d-none')\n                        .html('<div class=\"text-center text-muted py-4\"><i class=\"fa fa-exclamation-circle\"></i><p class=\"mt-2\">Connection error</p></div>');\n                });\n            }\n        },\n\n        /**\n         * Render tab content with report data - consistent with embedded/modal design.\n         *\n         * @param {jQuery} pane\n         * @param {Object} report\n         * @param {Array} data\n         */\n        renderTabContent: function(pane, report, data) {\n            var tabId = pane.attr('id');\n            pane.find('.tab-pane-loading').addClass('d-none');\n            var contentArea = pane.find('.tab-pane-content');\n\n            if (!data || data.length === 0) {\n                contentArea.removeClass('d-none')\n                    .html('<div class=\"text-center text-muted py-4\"><i class=\"fa fa-inbox\"></i><p class=\"mt-2\">No data available</p></div>');\n                return;\n            }\n\n            // Detect headers and numeric columns\n            var headers = Object.keys(data[0]);\n            var numericCols = this.detectNumericColumns(data, headers);\n\n            // Initialize state for this tab pane\n            var state = {\n                data: data,\n                report: report,\n                headers: headers,\n                numericCols: numericCols,\n                currentView: 'table',\n                tablePage: 1,\n                rowsPerPage: 25,\n                chartType: 'bar',\n                xAxis: headers[0],\n                yAxis: numericCols.length > 0 ? numericCols[numericCols.length - 1] : headers[headers.length - 1]\n            };\n            this.tabPaneStates[tabId] = state;\n\n            // Show content area\n            contentArea.removeClass('d-none');\n\n            // Update meta bar\n            this.updateTabMetaBar(pane, report, data);\n\n            // Populate chart axis selectors\n            this.populateTabChartControls(pane, state);\n\n            // Render table (default view)\n            this.renderTabTablePage(pane, state);\n\n            // Reset view toggle to table\n            pane.find('.tab-view-toggle-btn').removeClass('active');\n            pane.find('.tab-view-toggle-btn[data-view=\"table\"]').addClass('active');\n            pane.find('.tab-table-view').removeClass('d-none');\n            pane.find('.tab-chart-view').addClass('d-none');\n        },\n\n        /**\n         * Update tab meta bar with report info.\n         *\n         * @param {jQuery} pane\n         * @param {Object} report\n         * @param {Array} data\n         */\n        updateTabMetaBar: function(pane, report, data) {\n            // Category badge\n            var category = report.category || report.category_name || '';\n            var categoryBadge = pane.find('.report-category');\n            if (category) {\n                categoryBadge.text(category).removeClass('d-none');\n                // Add category color if available\n                if (report.category_color) {\n                    categoryBadge.css('background-color', report.category_color);\n                } else {\n                    categoryBadge.addClass('bg-primary');\n                }\n            } else {\n                categoryBadge.addClass('d-none');\n            }\n\n            // Row count\n            pane.find('.row-count-num').text(data.length);\n\n            // Report date\n            var dateStr = report.updated_at || report.created_at || '';\n            if (dateStr) {\n                var date = new Date(dateStr);\n                pane.find('.report-date').text(date.toLocaleDateString());\n            }\n        },\n\n        /**\n         * Populate chart control selectors for a tab.\n         *\n         * @param {jQuery} pane\n         * @param {Object} state\n         */\n        populateTabChartControls: function(pane, state) {\n            var xAxisSelect = pane.find('.tab-chart-x-axis');\n            var yAxisSelect = pane.find('.tab-chart-y-axis');\n\n            xAxisSelect.empty();\n            yAxisSelect.empty();\n\n            state.headers.forEach(function(header) {\n                var formatted = header.replace(/_/g, ' ').replace(/\\b\\w/g, function(l) { return l.toUpperCase(); });\n                xAxisSelect.append($('<option>').val(header).text(formatted));\n                yAxisSelect.append($('<option>').val(header).text(formatted));\n            });\n\n            // Set default selections\n            xAxisSelect.val(state.xAxis);\n            yAxisSelect.val(state.yAxis);\n        },\n\n        /**\n         * Switch view in a tab pane (table/chart).\n         *\n         * @param {jQuery} pane\n         * @param {string} view - 'table' or 'chart'\n         */\n        switchTabView: function(pane, view) {\n            var tabId = pane.attr('id');\n            var state = this.tabPaneStates[tabId];\n            if (!state) return;\n\n            state.currentView = view;\n\n            // Update toggle buttons\n            pane.find('.tab-view-toggle-btn').removeClass('active');\n            pane.find('.tab-view-toggle-btn[data-view=\"' + view + '\"]').addClass('active');\n\n            // Show/hide views\n            if (view === 'table') {\n                pane.find('.tab-table-view').removeClass('d-none');\n                pane.find('.tab-chart-view').addClass('d-none');\n            } else {\n                pane.find('.tab-table-view').addClass('d-none');\n                pane.find('.tab-chart-view').removeClass('d-none');\n                // Render chart if not already rendered\n                this.renderTabChart(pane, state);\n            }\n        },\n\n        /**\n         * Render table page in tab pane with pagination.\n         *\n         * @param {jQuery} pane\n         * @param {Object} state\n         */\n        renderTabTablePage: function(pane, state) {\n            var table = pane.find('.tab-table');\n            var thead = table.find('thead');\n            var tbody = table.find('tbody');\n            var data = state.data;\n            var headers = state.headers;\n\n            thead.empty();\n            tbody.empty();\n\n            // Build header row\n            var headerRow = $('<tr>');\n            headers.forEach(function(h) {\n                var formatted = h.replace(/_/g, ' ').replace(/\\b\\w/g, function(l) { return l.toUpperCase(); });\n                headerRow.append($('<th>').text(formatted));\n            });\n            thead.append(headerRow);\n\n            // Calculate pagination\n            var totalRows = data.length;\n            var totalPages = Math.ceil(totalRows / state.rowsPerPage);\n            var startIndex = (state.tablePage - 1) * state.rowsPerPage;\n            var endIndex = Math.min(startIndex + state.rowsPerPage, totalRows);\n            var pageData = data.slice(startIndex, endIndex);\n\n            // Render rows\n            pageData.forEach(function(row) {\n                var tr = $('<tr>');\n                headers.forEach(function(h) {\n                    var val = row[h];\n                    if (val === null || val === undefined) val = '';\n                    var displayVal = String(val);\n                    if (displayVal.length > 50) {\n                        displayVal = displayVal.substring(0, 50) + '...';\n                    }\n                    tr.append($('<td>').attr('title', val).text(displayVal));\n                });\n                tbody.append(tr);\n            });\n\n            // Update pagination info\n            var showingText = 'Showing ' + (startIndex + 1) + '-' + endIndex + ' of ' + totalRows;\n            pane.find('.row-count').text(showingText);\n            pane.find('.tab-pagination-info').text('Page ' + state.tablePage + ' of ' + totalPages);\n\n            // Update pagination buttons\n            pane.find('.tab-pagination-prev').prop('disabled', state.tablePage <= 1);\n            pane.find('.tab-pagination-next').prop('disabled', state.tablePage >= totalPages);\n\n            // Show/hide pagination\n            if (totalPages > 1) {\n                pane.find('.tab-table-pagination').removeClass('d-none');\n            } else {\n                pane.find('.tab-table-pagination').addClass('d-none');\n            }\n        },\n\n        /**\n         * Render chart in tab pane with current settings.\n         *\n         * @param {jQuery} pane\n         * @param {Object} state\n         */\n        renderTabChart: function(pane, state) {\n            var tabId = pane.attr('id');\n            var canvas = pane.find('.tab-chart')[0];\n\n            if (!canvas || !state.data || state.data.length === 0) {\n                return;\n            }\n\n            // Destroy existing chart for this tab\n            if (this.tabChartInstances && this.tabChartInstances[tabId]) {\n                this.tabChartInstances[tabId].destroy();\n            }\n\n            var chartType = state.chartType;\n            var xAxis = state.xAxis;\n            var yAxis = state.yAxis;\n            var data = state.data;\n\n            // Limit data for chart\n            var chartData = data.slice(0, 20);\n            var labels = chartData.map(function(row) {\n                var label = row[xAxis];\n                if (label === null || label === undefined) return 'Unknown';\n                var labelStr = String(label);\n                return labelStr.length > 20 ? labelStr.substring(0, 20) + '...' : labelStr;\n            });\n            var values = chartData.map(function(row) {\n                return parseFloat(row[yAxis]) || 0;\n            });\n\n            var colors = this.generateChartColors(values.length, chartType);\n            var yAxisFormatted = yAxis.replace(/_/g, ' ').replace(/\\b\\w/g, function(l) { return l.toUpperCase(); });\n\n            var config = {\n                type: chartType,\n                data: {\n                    labels: labels,\n                    datasets: [{\n                        label: yAxisFormatted,\n                        data: values,\n                        backgroundColor: chartType === 'pie' || chartType === 'doughnut' ? colors : colors[0],\n                        borderColor: chartType === 'line' ? colors[0] : (chartType === 'pie' || chartType === 'doughnut' ? '#fff' : colors[0]),\n                        borderWidth: chartType === 'pie' || chartType === 'doughnut' ? 2 : 1,\n                        fill: chartType === 'line' ? false : undefined,\n                        tension: chartType === 'line' ? 0.1 : undefined\n                    }]\n                },\n                options: {\n                    responsive: true,\n                    maintainAspectRatio: false,\n                    plugins: {\n                        legend: {\n                            display: chartType === 'pie' || chartType === 'doughnut',\n                            position: 'right'\n                        }\n                    },\n                    scales: chartType === 'pie' || chartType === 'doughnut' ? {} : {\n                        y: { beginAtZero: true },\n                        x: { display: data.length <= 10 }\n                    }\n                }\n            };\n\n            try {\n                this.tabChartInstances = this.tabChartInstances || {};\n                this.tabChartInstances[tabId] = new Chart(canvas.getContext('2d'), config);\n            } catch (error) {\n                pane.find('.tab-chart-container').html(\n                    '<div class=\"alert alert-warning text-center\"><i class=\"fa fa-exclamation-circle\"></i> Could not render chart</div>'\n                );\n            }\n        },\n\n        /**\n         * Export report data from a tab.\n         *\n         * @param {Object} state - Tab pane state\n         * @param {string} format - Export format (csv)\n         */\n        exportTabReport: function(state, format) {\n            if (!state || !state.data || state.data.length === 0) {\n                return;\n            }\n\n            if (format === 'csv') {\n                var headers = state.headers;\n                var csvRows = [];\n\n                // Header row\n                csvRows.push(headers.map(function(h) {\n                    return '\"' + h.replace(/\"/g, '\"\"') + '\"';\n                }).join(','));\n\n                // Data rows\n                state.data.forEach(function(row) {\n                    var rowData = headers.map(function(h) {\n                        var val = row[h];\n                        if (val === null || val === undefined) val = '';\n                        return '\"' + String(val).replace(/\"/g, '\"\"') + '\"';\n                    });\n                    csvRows.push(rowData.join(','));\n                });\n\n                var csvContent = csvRows.join('\\n');\n                var blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });\n                var url = URL.createObjectURL(blob);\n                var link = document.createElement('a');\n                var reportName = state.report.name || state.report.slug || 'report';\n                link.href = url;\n                link.download = reportName.replace(/[^a-z0-9]/gi, '_') + '.csv';\n                document.body.appendChild(link);\n                link.click();\n                document.body.removeChild(link);\n                URL.revokeObjectURL(url);\n            }\n        },\n\n        /**\n         * Render table in tab pane (legacy fallback).\n         *\n         * @param {jQuery} pane\n         * @param {Array} data\n         */\n        renderTabTable: function(pane, data) {\n            var table = pane.find('table');\n            var thead = table.find('thead');\n            var tbody = table.find('tbody');\n            var maxRows = this.config.tableMaxRows || 10;\n\n            thead.empty();\n            tbody.empty();\n\n            if (!data || data.length === 0) {\n                return;\n            }\n\n            var headers = Object.keys(data[0]);\n            var headerRow = $('<tr>');\n            headers.forEach(function(h) {\n                var formatted = h.replace(/_/g, ' ').replace(/\\b\\w/g, function(l) { return l.toUpperCase(); });\n                headerRow.append($('<th>').text(formatted));\n            });\n            thead.append(headerRow);\n\n            data.slice(0, maxRows).forEach(function(row) {\n                var tr = $('<tr>');\n                headers.forEach(function(h) {\n                    var val = row[h];\n                    if (val === null || val === undefined) val = '';\n                    var displayVal = String(val);\n                    if (displayVal.length > 40) {\n                        displayVal = displayVal.substring(0, 40) + '...';\n                    }\n                    tr.append($('<td>').attr('title', val).text(displayVal));\n                });\n                tbody.append(tr);\n            });\n        },\n\n        /**\n         * Handle report click.\n         *\n         * @param {string} slug\n         * @param {string} source\n         */\n        handleReportClick: function(slug, source) {\n            var action = this.config.clickAction || 'modal';\n\n            switch (action) {\n                case 'modal':\n                    this.openReportModal(slug, source);\n                    break;\n                case 'newtab':\n                    this.openReportNewTab(slug, source);\n                    break;\n                case 'expand':\n                    this.expandReportInline(slug, source);\n                    break;\n            }\n        },\n\n        /**\n         * Open report in modal.\n         *\n         * @param {string} slug\n         * @param {string} source\n         */\n        openReportModal: function(slug, source) {\n            var self = this;\n\n            // Find report data.\n            var report = this.reports.find(function(r) {\n                return r.slug === slug;\n            });\n\n            if (!report) {\n                return;\n            }\n\n            // Reset state\n            this.modalData = null;\n            this.modalReport = null;\n            this.currentView = 'table';\n            if (this.chartInstance) {\n                this.chartInstance.destroy();\n                this.chartInstance = null;\n            }\n\n            // First render the template, then create the modal with the rendered body\n            Templates.render('block_adeptus_insights/report_modal', {blockid: this.blockId})\n                .then(function(html) {\n                    return ModalFactory.create({\n                        type: ModalFactory.types.DEFAULT,\n                        title: report.name,\n                        body: html,\n                        large: true\n                    });\n                })\n                .then(function(modal) {\n                    self.modal = modal;\n\n                    // Bind modal event handlers\n                    self.bindModalEvents(modal);\n\n                    // Load report data after modal is shown.\n                    modal.getRoot().on(ModalEvents.shown, function() {\n                        self.loadModalReport(slug, source);\n                    });\n\n                    // Cleanup on close.\n                    modal.getRoot().on(ModalEvents.hidden, function() {\n                        if (self.chartInstance) {\n                            self.chartInstance.destroy();\n                            self.chartInstance = null;\n                        }\n                        modal.destroy();\n                        self.modal = null;\n                        self.modalData = null;\n                        self.modalReport = null;\n                    });\n\n                    modal.show();\n                    return modal;\n                }).catch(Notification.exception);\n        },\n\n        /**\n         * Bind event handlers for modal UI elements.\n         *\n         * @param {Object} modal\n         */\n        bindModalEvents: function(modal) {\n            var self = this;\n            var modalRoot = modal.getRoot();\n\n            // View toggle buttons\n            modalRoot.on('click', '.view-toggle-btn', function(e) {\n                e.preventDefault();\n                var view = $(this).data('view');\n                self.switchModalView(view);\n            });\n\n            // Chart control changes\n            modalRoot.on('change', '#modal-chart-type, #modal-chart-x-axis, #modal-chart-y-axis', function() {\n                if (self.currentView === 'chart') {\n                    self.renderModalChart();\n                }\n            });\n\n            // Retry button\n            modalRoot.on('click', '.modal-retry', function(e) {\n                e.preventDefault();\n                if (self.modalReport) {\n                    self.loadModalReport(self.modalReport.slug, self.modalReport.source);\n                }\n            });\n\n            // Export CSV\n            modalRoot.on('click', '.modal-export[data-format=\"csv\"]', function(e) {\n                e.preventDefault();\n                self.exportModalData('csv');\n            });\n\n            // Table pagination - Previous\n            modalRoot.on('click', '.table-pagination-prev', function(e) {\n                e.preventDefault();\n                if (self.tableCurrentPage > 1) {\n                    self.tableCurrentPage--;\n                    self.renderModalTablePage();\n                }\n            });\n\n            // Table pagination - Next\n            modalRoot.on('click', '.table-pagination-next', function(e) {\n                e.preventDefault();\n                if (self.tableCurrentPage < self.tableTotalPages) {\n                    self.tableCurrentPage++;\n                    self.renderModalTablePage();\n                }\n            });\n        },\n\n        /**\n         * Switch between table and chart views in modal.\n         *\n         * @param {string} view - 'table' or 'chart'\n         */\n        switchModalView: function(view) {\n            var modalBody = this.modal.getBody();\n\n            // Update toggle buttons\n            modalBody.find('.view-toggle-btn').removeClass('active');\n            modalBody.find('.view-toggle-btn[data-view=\"' + view + '\"]').addClass('active');\n\n            // Switch views\n            if (view === 'table') {\n                modalBody.find('#modal-table-view').removeClass('d-none');\n                modalBody.find('#modal-chart-view').addClass('d-none');\n            } else {\n                modalBody.find('#modal-table-view').addClass('d-none');\n                modalBody.find('#modal-chart-view').removeClass('d-none');\n                // Render chart when switching to chart view\n                this.renderModalChart();\n            }\n\n            this.currentView = view;\n        },\n\n        /**\n         * Load report data into modal.\n         *\n         * @param {string} slug\n         * @param {string} source\n         */\n        loadModalReport: function(slug, source) {\n            var self = this;\n            var modalBody = this.modal.getBody();\n            var cacheKey = slug + '_' + source;\n\n            // Check cache first for instant loading\n            if (this.reportDataCache[cacheKey]) {\n                var cached = this.reportDataCache[cacheKey];\n                modalBody.find('.modal-loading').addClass('d-none');\n                this.renderModalContent(modalBody, cached.report, cached.results, cached.chartData, cached.chartType);\n                return;\n            }\n\n            // Find the report from our cached list\n            var report = this.reports.find(function(r) {\n                return r.slug === slug;\n            });\n\n            if (!report) {\n                modalBody.find('.modal-loading').addClass('d-none');\n                modalBody.find('.modal-error').removeClass('d-none');\n                return;\n            }\n\n            // For wizard reports, execute locally via generate_report.php\n            // For AI reports, we need to fetch from backend\n            if (source === 'wizard') {\n                // Execute report via local Moodle AJAX endpoint\n                $.ajax({\n                    url: M.cfg.wwwroot + '/report/adeptus_insights/ajax/generate_report.php',\n                    method: 'POST',\n                    data: {\n                        reportid: report.name || report.report_template_id,\n                        sesskey: M.cfg.sesskey\n                    },\n                    dataType: 'json',\n                    timeout: 30000\n                }).done(function(response) {\n                    modalBody.find('.modal-loading').addClass('d-none');\n\n                    if (response.success) {\n                        // Cache the result for future use\n                        self.reportDataCache[cacheKey] = {\n                            report: report,\n                            results: response.results || [],\n                            chartData: response.chart_data,\n                            chartType: response.chart_type\n                        };\n                        self.renderModalContent(modalBody, report, response.results || [], response.chart_data, response.chart_type);\n                    } else {\n                        modalBody.find('.modal-error').removeClass('d-none');\n                        modalBody.find('.modal-error p').text(response.message || 'Failed to load report');\n                    }\n                }).fail(function() {\n                    modalBody.find('.modal-loading').addClass('d-none');\n                    modalBody.find('.modal-error').removeClass('d-none');\n                });\n            } else {\n                // AI reports - fetch from backend API\n                var token = this.apiKey || (window.adeptusAuthData ? window.adeptusAuthData.api_key : null);\n\n                if (!token) {\n                    modalBody.find('.modal-loading').addClass('d-none');\n                    modalBody.find('.modal-error').removeClass('d-none');\n                    return;\n                }\n\n                $.ajax({\n                    url: 'https://a360backend.stagingwithswift.com/api/v1/ai-reports/' + slug,\n                    method: 'GET',\n                    headers: {\n                        'Authorization': 'Bearer ' + token,\n                        'Accept': 'application/json'\n                    },\n                    timeout: 15000\n                }).done(function(response) {\n                    modalBody.find('.modal-loading').addClass('d-none');\n\n                    if (response.success && response.report) {\n                        // Cache the result for future use\n                        self.reportDataCache[cacheKey] = {\n                            report: response.report,\n                            results: response.data || [],\n                            chartData: null,\n                            chartType: null\n                        };\n                        self.renderModalContent(modalBody, response.report, response.data || [], null, null);\n                    } else {\n                        modalBody.find('.modal-error').removeClass('d-none');\n                    }\n                }).fail(function() {\n                    modalBody.find('.modal-loading').addClass('d-none');\n                    modalBody.find('.modal-error').removeClass('d-none');\n                });\n            }\n        },\n\n        /**\n         * Render modal content with report data.\n         *\n         * @param {jQuery} modalBody\n         * @param {Object} report\n         * @param {Array} data\n         * @param {Object} chartData - Pre-configured chart data from backend (unused, we use controls)\n         * @param {string} chartType - Chart type from backend (unused, we use controls)\n         */\n        renderModalContent: function(modalBody, report, data, chartData, chartType) {\n            var self = this;\n\n            // Store data for chart re-rendering\n            this.modalData = data || [];\n            this.modalReport = report;\n\n            var contentArea = modalBody.find('.modal-content-area');\n            contentArea.removeClass('d-none');\n\n            // Set report metadata\n            var category = report.category_info || {name: 'General', color: '#6c757d'};\n            modalBody.find('.report-category')\n                .text(category.name)\n                .css('background-color', category.color);\n            modalBody.find('.row-count-num').text(this.modalData.length);\n            modalBody.find('.report-date')\n                .text(report.last_executed_at ? 'Last run: ' + new Date(report.last_executed_at).toLocaleDateString() : '');\n\n            // Populate axis selectors\n            this.populateAxisSelectors(modalBody);\n\n            // Render table\n            this.renderModalTable(modalBody, this.modalData);\n\n            // Set up view full report link (admin only)\n            if (this.isAdmin) {\n                var reportUrl = M.cfg.wwwroot + '/report/adeptus_insights/generated_reports.php?slug=' + encodeURIComponent(report.slug);\n                modalBody.find('.view-full-report').attr('href', reportUrl);\n                modalBody.find('.modal-footer-link').removeClass('d-none');\n            } else {\n                modalBody.find('.modal-footer-link').addClass('d-none');\n            }\n\n            // Reset to table view\n            this.currentView = 'table';\n            modalBody.find('.view-toggle-btn').removeClass('active');\n            modalBody.find('.view-toggle-btn[data-view=\"table\"]').addClass('active');\n            modalBody.find('#modal-table-view').removeClass('d-none');\n            modalBody.find('#modal-chart-view').addClass('d-none');\n        },\n\n        /**\n         * Populate X-axis and Y-axis dropdown selectors.\n         *\n         * @param {jQuery} modalBody\n         */\n        populateAxisSelectors: function(modalBody) {\n            var data = this.modalData;\n            if (!data || data.length === 0) {\n                return;\n            }\n\n            var headers = Object.keys(data[0]);\n            var xAxisSelect = modalBody.find('#modal-chart-x-axis');\n            var yAxisSelect = modalBody.find('#modal-chart-y-axis');\n\n            // Clear existing options\n            xAxisSelect.empty();\n            yAxisSelect.empty();\n\n            // Detect numeric columns for Y-axis\n            var numericCols = this.detectNumericColumns(data, headers);\n\n            // Populate X-axis with all columns\n            headers.forEach(function(header, idx) {\n                var formattedHeader = header.replace(/_/g, ' ').replace(/\\b\\w/g, function(l) { return l.toUpperCase(); });\n                var selected = idx === 0 ? ' selected' : '';\n                xAxisSelect.append('<option value=\"' + header + '\"' + selected + '>' + formattedHeader + '</option>');\n            });\n\n            // Populate Y-axis with numeric columns (or all if none detected)\n            var yAxisOptions = numericCols.length > 0 ? numericCols : headers;\n            yAxisOptions.forEach(function(col, idx) {\n                var formattedHeader = col.replace(/_/g, ' ').replace(/\\b\\w/g, function(l) { return l.toUpperCase(); });\n                // Select the last numeric column by default (usually the main value)\n                var selected = idx === yAxisOptions.length - 1 ? ' selected' : '';\n                yAxisSelect.append('<option value=\"' + col + '\"' + selected + '>' + formattedHeader + '</option>');\n            });\n        },\n\n        /**\n         * Detect numeric columns in data.\n         *\n         * @param {Array} data\n         * @param {Array} headers\n         * @return {Array}\n         */\n        detectNumericColumns: function(data, headers) {\n            var numericCols = [];\n\n            headers.forEach(function(header) {\n                var isNumeric = data.every(function(row) {\n                    var val = row[header];\n                    if (val === null || val === undefined || val === '') {\n                        return true; // Allow nulls\n                    }\n                    return !isNaN(parseFloat(val)) && isFinite(val);\n                });\n\n                // Also check if at least some values are actually numbers\n                var hasNumbers = data.some(function(row) {\n                    var val = row[header];\n                    return val !== null && val !== undefined && val !== '' && !isNaN(parseFloat(val));\n                });\n\n                if (isNumeric && hasNumbers) {\n                    numericCols.push(header);\n                }\n            });\n\n            return numericCols;\n        },\n\n        /**\n         * Render chart in modal using current control values.\n         */\n        renderModalChart: function() {\n            var self = this;\n            var modalBody = this.modal.getBody();\n            var data = this.modalData;\n\n            if (!data || data.length === 0) {\n                modalBody.find('.chart-container').html(\n                    '<div class=\"alert alert-warning text-center\"><i class=\"fa fa-info-circle\"></i> No data available for chart</div>'\n                );\n                return;\n            }\n\n            var canvas = modalBody.find('.modal-chart')[0];\n            if (!canvas) {\n                return;\n            }\n\n            // Destroy existing chart\n            if (this.chartInstance) {\n                this.chartInstance.destroy();\n                this.chartInstance = null;\n            }\n\n            // Get control values\n            var chartType = modalBody.find('#modal-chart-type').val() || 'bar';\n            var labelKey = modalBody.find('#modal-chart-x-axis').val();\n            var valueKey = modalBody.find('#modal-chart-y-axis').val();\n\n            // Fallback if not set\n            if (!labelKey || !valueKey) {\n                var headers = Object.keys(data[0]);\n                labelKey = labelKey || headers[0];\n                valueKey = valueKey || headers[headers.length - 1];\n            }\n\n            // Format value key for display\n            var valueKeyFormatted = valueKey.replace(/_/g, ' ').replace(/\\b\\w/g, function(l) { return l.toUpperCase(); });\n\n            // Limit data for chart readability (max 50 items)\n            var chartData = data.slice(0, 50);\n            var labels = chartData.map(function(row) {\n                var label = row[labelKey];\n                if (label === null || label === undefined) return 'Unknown';\n                var labelStr = String(label);\n                return labelStr.length > 30 ? labelStr.substring(0, 30) + '...' : labelStr;\n            });\n            var values = chartData.map(function(row) {\n                return parseFloat(row[valueKey]) || 0;\n            });\n\n            // Generate colors\n            var colors = this.generateChartColors(values.length, chartType);\n\n            // Create chart config\n            var config = this.createChartConfig(chartType, labels, values, valueKeyFormatted, colors);\n\n            try {\n                this.chartInstance = new Chart(canvas.getContext('2d'), config);\n            } catch (error) {\n                modalBody.find('.chart-container').html(\n                    '<div class=\"alert alert-danger\"><i class=\"fa fa-exclamation-triangle\"></i> Error rendering chart</div>'\n                );\n            }\n        },\n\n        /**\n         * Create Chart.js configuration.\n         *\n         * @param {string} chartType\n         * @param {Array} labels\n         * @param {Array} values\n         * @param {string} valueKey\n         * @param {Array} colors\n         * @return {Object}\n         */\n        createChartConfig: function(chartType, labels, values, valueKey, colors) {\n            var reportName = this.modalReport ? this.modalReport.name : 'Report';\n\n            var baseOptions = {\n                responsive: true,\n                maintainAspectRatio: false,\n                plugins: {\n                    title: {\n                        display: true,\n                        text: reportName,\n                        font: { size: 14, weight: 'bold' },\n                        padding: { top: 10, bottom: 20 }\n                    },\n                    legend: {\n                        display: chartType === 'pie' || chartType === 'doughnut',\n                        position: 'right'\n                    }\n                }\n            };\n\n            if (chartType === 'pie' || chartType === 'doughnut') {\n                return {\n                    type: chartType,\n                    data: {\n                        labels: labels,\n                        datasets: [{\n                            data: values,\n                            backgroundColor: colors,\n                            borderWidth: 2\n                        }]\n                    },\n                    options: baseOptions\n                };\n            } else {\n                // Bar or Line chart\n                baseOptions.scales = {\n                    y: {\n                        beginAtZero: true,\n                        title: {\n                            display: true,\n                            text: valueKey\n                        }\n                    },\n                    x: {\n                        title: {\n                            display: false\n                        }\n                    }\n                };\n\n                return {\n                    type: chartType,\n                    data: {\n                        labels: labels,\n                        datasets: [{\n                            label: valueKey,\n                            data: values,\n                            backgroundColor: chartType === 'line' ? 'transparent' : colors[0],\n                            borderColor: colors[0].replace('0.7', '1'),\n                            borderWidth: 2,\n                            fill: chartType === 'line' ? false : true,\n                            tension: 0.1\n                        }]\n                    },\n                    options: baseOptions\n                };\n            }\n        },\n\n        /**\n         * Generate chart colors.\n         *\n         * @param {number} count\n         * @param {string} chartType\n         * @return {Array}\n         */\n        generateChartColors: function(count, chartType) {\n            var baseColors = [\n                'rgba(37, 99, 235, 0.7)',   // Blue\n                'rgba(16, 185, 129, 0.7)',  // Green\n                'rgba(245, 158, 11, 0.7)',  // Amber\n                'rgba(239, 68, 68, 0.7)',   // Red\n                'rgba(139, 92, 246, 0.7)',  // Purple\n                'rgba(6, 182, 212, 0.7)',   // Cyan\n                'rgba(236, 72, 153, 0.7)',  // Pink\n                'rgba(132, 204, 22, 0.7)',  // Lime\n                'rgba(249, 115, 22, 0.7)',  // Orange\n                'rgba(99, 102, 241, 0.7)'   // Indigo\n            ];\n\n            var colors = [];\n            for (var i = 0; i < count; i++) {\n                colors.push(baseColors[i % baseColors.length]);\n            }\n            return colors;\n        },\n\n        /**\n         * Export modal data as CSV.\n         *\n         * @param {string} format\n         */\n        exportModalData: function(format) {\n            var data = this.modalData;\n            var report = this.modalReport;\n\n            if (!data || data.length === 0) {\n                Notification.addNotification({\n                    message: 'No data to export',\n                    type: 'warning'\n                });\n                return;\n            }\n\n            if (format === 'csv') {\n                var headers = Object.keys(data[0]);\n                var csvContent = headers.join(',') + '\\n';\n\n                data.forEach(function(row) {\n                    var values = headers.map(function(h) {\n                        var val = row[h];\n                        if (val === null || val === undefined) val = '';\n                        // Escape quotes and wrap in quotes if contains comma\n                        val = String(val).replace(/\"/g, '\"\"');\n                        if (val.indexOf(',') !== -1 || val.indexOf('\"') !== -1 || val.indexOf('\\n') !== -1) {\n                            val = '\"' + val + '\"';\n                        }\n                        return val;\n                    });\n                    csvContent += values.join(',') + '\\n';\n                });\n\n                // Download\n                var blob = new Blob([csvContent], {type: 'text/csv;charset=utf-8;'});\n                var link = document.createElement('a');\n                link.href = URL.createObjectURL(blob);\n                link.download = (report ? report.name.replace(/[^a-z0-9]/gi, '_') : 'report') + '.csv';\n                link.click();\n            }\n        },\n\n        /**\n         * Render table in modal with pagination.\n         *\n         * @param {jQuery} modalBody\n         * @param {Array} data\n         */\n        renderModalTable: function(modalBody, data) {\n            // Reset pagination\n            this.tableCurrentPage = 1;\n            this.tableTotalPages = Math.ceil((data ? data.length : 0) / this.tableRowsPerPage);\n\n            // Build table headers once\n            var table = modalBody.find('.modal-table');\n            var thead = table.find('thead');\n\n            thead.empty();\n\n            if (!data || data.length === 0) {\n                modalBody.find('.modal-table-container').addClass('d-none');\n                return;\n            }\n\n            // Build headers from first row\n            var headers = Object.keys(data[0]);\n            var headerRow = $('<tr>');\n            headers.forEach(function(h) {\n                // Format header nicely\n                var formatted = h.replace(/_/g, ' ').replace(/\\b\\w/g, function(l) { return l.toUpperCase(); });\n                headerRow.append($('<th>').text(formatted));\n            });\n            thead.append(headerRow);\n\n            // Render first page\n            this.renderModalTablePage();\n        },\n\n        /**\n         * Render current page of table data.\n         */\n        renderModalTablePage: function() {\n            var modalBody = this.modal.getBody();\n            var data = this.modalData || [];\n            var table = modalBody.find('.modal-table');\n            var tbody = table.find('tbody');\n\n            tbody.empty();\n\n            if (!data || data.length === 0) {\n                return;\n            }\n\n            var headers = Object.keys(data[0]);\n\n            // Calculate page slice\n            var startIndex = (this.tableCurrentPage - 1) * this.tableRowsPerPage;\n            var endIndex = startIndex + this.tableRowsPerPage;\n            var pageData = data.slice(startIndex, endIndex);\n\n            // Build rows\n            pageData.forEach(function(row) {\n                var tr = $('<tr>');\n                headers.forEach(function(h) {\n                    var val = row[h];\n                    if (val === null || val === undefined) val = '';\n                    // Truncate long values\n                    var displayVal = String(val);\n                    if (displayVal.length > 100) {\n                        displayVal = displayVal.substring(0, 100) + '...';\n                    }\n                    tr.append($('<td>').attr('title', val).text(displayVal));\n                });\n                tbody.append(tr);\n            });\n\n            // Update pagination info and controls\n            var actualEnd = Math.min(endIndex, data.length);\n            modalBody.find('.row-count').text(data.length + ' total rows');\n\n            var paginationInfo = modalBody.find('.table-pagination-info');\n            paginationInfo.text((startIndex + 1) + '-' + actualEnd + ' of ' + data.length);\n\n            // Update button states\n            modalBody.find('.table-pagination-prev').prop('disabled', this.tableCurrentPage <= 1);\n            modalBody.find('.table-pagination-next').prop('disabled', this.tableCurrentPage >= this.tableTotalPages);\n\n            // Show/hide pagination based on total pages\n            if (this.tableTotalPages > 1) {\n                modalBody.find('.table-pagination').removeClass('d-none');\n            } else {\n                modalBody.find('.table-pagination').addClass('d-none');\n            }\n        },\n\n        /**\n         * Open report in new tab.\n         *\n         * @param {string} slug\n         * @param {string} source\n         */\n        openReportNewTab: function(slug, source) {\n            var url = M.cfg.wwwroot + '/report/adeptus_insights/generated_reports.php?slug=' + encodeURIComponent(slug);\n            window.open(url, '_blank');\n        },\n\n        /**\n         * Expand report inline.\n         *\n         * @param {string} slug\n         * @param {string} source\n         */\n        expandReportInline: function(slug, source) {\n            // TODO: Implement inline expansion.\n        },\n\n        /**\n         * Export report.\n         *\n         * @param {string} format\n         */\n        exportReport: function(format) {\n            // TODO: Implement export functionality.\n            Notification.addNotification({\n                message: 'Export to ' + format.toUpperCase() + ' coming soon',\n                type: 'info'\n            });\n        },\n\n        /**\n         * Refresh the block (clears cache and reloads).\n         */\n        refresh: function() {\n            var refreshBtn = this.container.find('.block-adeptus-refresh i');\n            refreshBtn.addClass('fa-spin');\n\n            // Clear all caches for fresh data\n            this.clearAllCaches();\n\n            // Force reload from server\n            this.showLoading();\n            var self = this;\n            this.waitForAuth(function() {\n                self.fetchReports();\n            });\n\n            setTimeout(function() {\n                refreshBtn.removeClass('fa-spin');\n            }, 1000);\n        },\n\n        /**\n         * Clear all caches.\n         */\n        clearAllCaches: function() {\n            // Clear sessionStorage cache\n            try {\n                sessionStorage.removeItem(this.cacheKey);\n            } catch (e) {\n                // Ignore\n            }\n            // Clear in-memory report data cache\n            this.reportDataCache = {};\n        },\n\n        /**\n         * Setup auto-refresh timer.\n         */\n        setupAutoRefresh: function() {\n            var interval = this.config.autoRefresh;\n            if (!interval || interval === 'never') {\n                return;\n            }\n\n            var ms;\n            switch (interval) {\n                case '5m':\n                    ms = 5 * 60 * 1000;\n                    break;\n                case '15m':\n                    ms = 15 * 60 * 1000;\n                    break;\n                case '30m':\n                    ms = 30 * 60 * 1000;\n                    break;\n                case '1h':\n                    ms = 60 * 60 * 1000;\n                    break;\n                default:\n                    return;\n            }\n\n            var self = this;\n            this.refreshTimer = setInterval(function() {\n                // Only refresh if page is visible.\n                if (!document.hidden) {\n                    self.refresh();\n                }\n            }, ms);\n        },\n\n        /**\n         * Show loading state.\n         */\n        showLoading: function() {\n            this.container.find('.block-adeptus-loading').removeClass('d-none');\n            this.container.find('.block-adeptus-report-list, .block-adeptus-kpi-grid, .block-adeptus-tabs-container, .block-adeptus-content').addClass('d-none');\n            this.container.find('.block-adeptus-empty, .block-adeptus-error').addClass('d-none');\n        },\n\n        /**\n         * Hide loading state.\n         */\n        hideLoading: function() {\n            this.container.find('.block-adeptus-loading').addClass('d-none');\n        },\n\n        /**\n         * Show empty state.\n         */\n        showEmpty: function() {\n            this.hideLoading();\n            this.container.find('.block-adeptus-empty').removeClass('d-none');\n        },\n\n        /**\n         * Show error state.\n         *\n         * @param {string} message\n         */\n        showError: function(message) {\n            this.hideLoading();\n            this.container.find('.block-adeptus-error').removeClass('d-none');\n        },\n\n        /**\n         * Update the timestamp display.\n         */\n        updateTimestamp: function() {\n            if (!this.config.showTimestamp || !this.lastUpdated) {\n                return;\n            }\n\n            var timestampEl = this.container.find('.block-adeptus-timestamp');\n            var text = this.formatTimeAgo(this.lastUpdated);\n\n            timestampEl.find('.timestamp-text').text(text);\n            timestampEl.removeClass('d-none');\n        },\n\n        /**\n         * Scroll to the top of the report list.\n         */\n        scrollToListTop: function() {\n            var listContainer = this.container.find('.block-adeptus-report-list');\n            if (listContainer.length) {\n                listContainer[0].scrollIntoView({behavior: 'smooth', block: 'start'});\n            }\n        },\n\n        /**\n         * Scroll to the top of the embedded table.\n         */\n        scrollToEmbeddedTableTop: function() {\n            var tableContainer = this.container.find('.embedded-table-view');\n            if (tableContainer.length) {\n                tableContainer[0].scrollIntoView({behavior: 'smooth', block: 'start'});\n            }\n        },\n\n        /**\n         * Show the embedded loading overlay.\n         */\n        showEmbeddedLoadingOverlay: function() {\n            var overlay = this.container.find('.embedded-loading-overlay');\n            var content = this.container.find('.block-adeptus-content');\n\n            // Show content area if hidden (to show overlay over it)\n            content.removeClass('d-none');\n\n            // Show overlay with fade\n            overlay.removeClass('d-none').css('opacity', 0).animate({opacity: 1}, 150);\n        },\n\n        /**\n         * Hide the embedded loading overlay.\n         */\n        hideEmbeddedLoadingOverlay: function() {\n            var overlay = this.container.find('.embedded-loading-overlay');\n            overlay.animate({opacity: 0}, 150, function() {\n                $(this).addClass('d-none');\n            });\n        },\n\n        /**\n         * Toggle searchable dropdown open/closed.\n         *\n         * @param {jQuery} dropdown\n         */\n        toggleSearchableDropdown: function(dropdown) {\n            if (dropdown.hasClass('open')) {\n                this.closeSearchableDropdown(dropdown);\n            } else {\n                this.openSearchableDropdown(dropdown);\n            }\n        },\n\n        /**\n         * Open searchable dropdown.\n         *\n         * @param {jQuery} dropdown\n         */\n        openSearchableDropdown: function(dropdown) {\n            // Close any other open dropdowns first\n            var self = this;\n            this.container.find('.searchable-dropdown.open').each(function() {\n                if (!$(this).is(dropdown)) {\n                    self.closeSearchableDropdown($(this));\n                }\n            });\n\n            dropdown.addClass('open');\n            dropdown.find('.searchable-dropdown-toggle').attr('aria-expanded', 'true');\n\n            // Clear search and show all items\n            var input = dropdown.find('.searchable-dropdown-input');\n            input.val('');\n            dropdown.find('.searchable-dropdown-item').show().removeClass('focused');\n            dropdown.find('.searchable-dropdown-empty').addClass('d-none');\n\n            // Focus search input\n            setTimeout(function() {\n                input.focus();\n            }, 50);\n        },\n\n        /**\n         * Close searchable dropdown.\n         *\n         * @param {jQuery} dropdown\n         */\n        closeSearchableDropdown: function(dropdown) {\n            dropdown.removeClass('open');\n            dropdown.find('.searchable-dropdown-toggle').attr('aria-expanded', 'false');\n            dropdown.find('.searchable-dropdown-item').removeClass('focused');\n        },\n\n        /**\n         * Filter searchable dropdown items based on search query.\n         *\n         * @param {jQuery} dropdown\n         * @param {string} query\n         */\n        filterSearchableDropdown: function(dropdown, query) {\n            var items = dropdown.find('.searchable-dropdown-item');\n            var emptyState = dropdown.find('.searchable-dropdown-empty');\n            var visibleCount = 0;\n\n            items.each(function() {\n                var searchText = $(this).data('search') || '';\n                if (query === '' || searchText.indexOf(query) !== -1) {\n                    $(this).show();\n                    visibleCount++;\n                } else {\n                    $(this).hide();\n                }\n            });\n\n            // Remove focus from hidden items\n            items.filter(':hidden').removeClass('focused');\n\n            // Show/hide empty state\n            if (visibleCount === 0) {\n                emptyState.removeClass('d-none');\n            } else {\n                emptyState.addClass('d-none');\n            }\n        },\n\n        /**\n         * Select an item from the searchable dropdown.\n         *\n         * @param {jQuery} dropdown\n         * @param {string} value\n         * @param {string} text\n         */\n        selectSearchableDropdownItem: function(dropdown, value, text) {\n            // Update display text\n            dropdown.find('.searchable-dropdown-text').text(text);\n\n            // Mark item as selected\n            dropdown.find('.searchable-dropdown-item').removeClass('selected');\n            dropdown.find('.searchable-dropdown-item[data-value=\"' + value + '\"]').addClass('selected');\n\n            // Find the hidden select sibling and trigger change\n            // Works for both category-filter-select and report-selector-select\n            var select = dropdown.siblings('select');\n            if (select.length) {\n                select.val(value).trigger('change');\n            }\n\n            // Close dropdown\n            this.closeSearchableDropdown(dropdown);\n        },\n\n        /**\n         * Scroll a dropdown item into view.\n         *\n         * @param {jQuery} item\n         */\n        scrollDropdownItemIntoView: function(item) {\n            var list = item.closest('.searchable-dropdown-list');\n            var listHeight = list.height();\n            var itemTop = item.position().top;\n            var itemHeight = item.outerHeight();\n\n            if (itemTop < 0) {\n                list.scrollTop(list.scrollTop() + itemTop);\n            } else if (itemTop + itemHeight > listHeight) {\n                list.scrollTop(list.scrollTop() + (itemTop + itemHeight - listHeight));\n            }\n        },\n\n        /**\n         * Escape HTML special characters.\n         *\n         * @param {string} text\n         * @return {string}\n         */\n        escapeHtml: function(text) {\n            var div = document.createElement('div');\n            div.textContent = text;\n            return div.innerHTML;\n        },\n\n        /**\n         * Format a date as \"X ago\".\n         *\n         * @param {Date} date\n         * @return {string}\n         */\n        formatTimeAgo: function(date) {\n            var seconds = Math.floor((new Date() - date) / 1000);\n\n            if (seconds < 60) {\n                return 'Just now';\n            }\n\n            var minutes = Math.floor(seconds / 60);\n            if (minutes < 60) {\n                return minutes + ' minute' + (minutes !== 1 ? 's' : '') + ' ago';\n            }\n\n            var hours = Math.floor(minutes / 60);\n            if (hours < 24) {\n                return hours + ' hour' + (hours !== 1 ? 's' : '') + ' ago';\n            }\n\n            var days = Math.floor(hours / 24);\n            return days + ' day' + (days !== 1 ? 's' : '') + ' ago';\n        }\n    };\n\n    return {\n        /**\n         * Initialize the block.\n         *\n         * @param {Object} options\n         */\n        init: function(options) {\n            return new BlockController(options);\n        }\n    };\n});\n"],"names":["define","$","Ajax","Notification","Str","ModalFactory","ModalEvents","Templates","Chart","BlockController","options","blockId","blockid","contextId","contextid","config","apiKey","isAdmin","container","reports","lastUpdated","refreshTimer","modal","modalData","modalReport","chartInstance","currentView","listCurrentPage","listItemsPerPage","this","maxLinkItems","listTotalPages","tableCurrentPage","tableRowsPerPage","tableTotalPages","selectedCategory","availableCategories","selectedReportSlug","defaultReport","selectedReportSource","embeddedCurrentView","embeddedTablePage","embeddedTableRowsPerPage","embeddedChartType","embeddedXAxis","embeddedYAxis","cacheKey","cacheTTL","reportDataCache","preloadTimeout","preloadingSlug","tabPaneStates","tabChartInstances","init","prototype","length","bindEvents","loadReports","setupAutoRefresh","self","on","e","preventDefault","refresh","slug","data","source","handleReportClick","key","tabPane","target","attr","loadTabContent","format","exportReport","renderCurrentPage","scrollToListTop","val","displayMode","populateReportSelector","renderReports","selectedValue","parts","split","loadEmbeddedReport","stopPropagation","dropdown","closest","toggleSearchableDropdown","query","toLowerCase","trim","filterSearchableDropdown","value","text","find","selectSearchableDropdownItem","items","focused","first","addClass","next","nextAll","removeClass","scrollDropdownItemIntoView","prev","prevAll","trigger","closeSearchableDropdown","document","each","view","switchEmbeddedView","renderEmbeddedTablePage","scrollToEmbeddedTableTop","totalPages","Math","ceil","embeddedData","renderEmbeddedChart","exportEmbeddedReport","pane","switchTabView","tabId","state","tablePage","renderTabTablePage","rowsPerPage","chartType","renderTabChart","xAxis","yAxis","exportTabReport","clearTimeout","setTimeout","preloadReportData","showLoading","cachedData","getFromCache","Date","waitForAuth","fetchReports","cached","sessionStorage","getItem","JSON","parse","timestamp","now","removeItem","saveToCache","setItem","stringify","report","r","ajax","url","M","cfg","wwwroot","method","reportid","name","report_template_id","sesskey","dataType","timeout","done","response","success","results","chartData","chart_data","chart_type","fail","token","window","adeptusAuthData","api_key","headers","callback","showError","promises","reportSource","push","fetchFromApi","when","apply","then","allReports","i","result","arguments","forEach","endpoint","mode","populateCategoryFilter","filterReports","renderEmbedded","kpiReports","getSelectedReportsForMode","renderKpi","tabsReports","renderTabs","renderLinks","hideLoading","updateTimestamp","showEmpty","selectedConfig","kpiSelectedReports","tabsSelectedReports","item","categoryMap","catInfo","category_info","color","category","Object","values","sort","a","b","localeCompare","select","dropdownList","remove","cat","selected","append","empty","allItemHtml","itemHtml","escapeHtml","selectedText","selectedCat","c","reportName","title","display_name","categoryInfo","categoryLabel","defaultOption","prop","firstReport","firstValue","firstName","selectedReport","selectedName","slice","filter","selectedReports","indexOf","nameA","report_name","nameB","filteredReports","listContainer","template","paginationContainer","startIndex","endIndex","pageReports","html","$item","categoryName","categoryColor","css","actualEnd","embeddedReport","embeddedChartInstance","renderEmbeddedContent","showEmbeddedLoadingOverlay","hideEmbeddedLoadingOverlay","message","contentArea","toLocaleTimeString","populateEmbeddedChartControls","keys","numericCols","detectNumericColumns","xAxisSelect","yAxisSelect","h","formatted","replace","l","toUpperCase","table","thead","tbody","headerRow","min","row","tr","displayVal","String","substring","canvas","destroy","labels","map","label","labelStr","parseFloat","colors","generateChartColors","datasetConfig","backgroundColor","borderWidth","borderColor","type","datasets","responsive","maintainAspectRatio","plugins","legend","display","position","scales","y","beginAtZero","x","getContext","error","csvContent","join","rowValues","strVal","includes","blob","Blob","link","createElement","href","URL","createObjectURL","download","toISOString","click","gridContainer","maxCards","parseInt","kpiColumns","index","card","$card","icons","loadKpiData","renderKpiValue","formattedValue","valueCol","reduce","sum","toFixed","Number","isInteger","toLocaleString","trendContainer","tabNav","tabContent","tabTemplate","paneTemplate","tab","firstPane","renderTabContent","updateTabMetaBar","populateTabChartControls","category_name","categoryBadge","category_color","dateStr","updated_at","created_at","date","toLocaleDateString","header","totalRows","showingText","fill","undefined","tension","csvRows","rowData","body","appendChild","removeChild","revokeObjectURL","renderTabTable","maxRows","tableMaxRows","clickAction","openReportModal","openReportNewTab","expandReportInline","render","create","types","DEFAULT","large","bindModalEvents","getRoot","shown","loadModalReport","hidden","show","catch","exception","modalRoot","switchModalView","renderModalChart","exportModalData","renderModalTablePage","modalBody","getBody","renderModalContent","last_executed_at","populateAxisSelectors","renderModalTable","reportUrl","encodeURIComponent","idx","formattedHeader","yAxisOptions","col","isNumeric","every","isNaN","isFinite","hasNumbers","some","labelKey","valueKey","valueKeyFormatted","createChartConfig","baseOptions","font","size","weight","padding","top","bottom","count","baseColors","addNotification","open","refreshBtn","clearAllCaches","interval","autoRefresh","ms","setInterval","showTimestamp","timestampEl","formatTimeAgo","scrollIntoView","behavior","block","tableContainer","overlay","animate","opacity","hasClass","openSearchableDropdown","is","input","focus","emptyState","visibleCount","searchText","hide","siblings","list","listHeight","height","itemTop","itemHeight","outerHeight","scrollTop","div","textContent","innerHTML","seconds","floor","minutes","hours","days"],"mappings":";;;;;;;AAuBAA,sCAAO,CACH,SACA,YACA,oBACA,WACA,qBACA,oBACA,iBACA,iBACD,SAASC,EAAGC,KAAMC,aAAcC,IAAKC,aAAcC,YAAaC,UAAWC,WAQtEC,gBAAkB,SAASC,cACtBC,QAAUD,QAAQE,aAClBC,UAAYH,QAAQI,eACpBC,OAASL,QAAQK,QAAU,QAC3BC,OAASN,QAAQM,QAAU,QAC3BC,QAAUP,QAAQO,UAAW,OAC7BC,UAAY,UACZC,QAAU,QACVC,YAAc,UACdC,aAAe,UACfC,MAAQ,UACRC,UAAY,UACZC,YAAc,UACdC,cAAgB,UAChBC,YAAc,aAGdC,gBAAkB,OAClBC,iBAAmBC,KAAKd,OAAOe,cAAgB,QAC/CC,eAAiB,OAGjBC,iBAAmB,OACnBC,iBAAmB,QACnBC,gBAAkB,OAGlBC,iBAAmB,QACnBC,oBAAsB,QAGtBC,mBAAqBR,KAAKd,OAAOuB,eAAiB,QAClDC,qBAAuB,QAGvBC,oBAAsB,aACtBC,kBAAoB,OACpBC,yBAA2B,QAC3BC,kBAAoB,WACpBC,cAAgB,QAChBC,cAAgB,QAGhBC,SAAW,yBAA2BjB,KAAKlB,aAC3CoC,SAAW,SACXC,gBAAkB,QAClBC,eAAiB,UACjBC,eAAiB,UAGjBC,cAAgB,QAChBC,kBAAoB,QAEpBC,eAGT5C,gBAAgB6C,UAAY,CAIxBD,KAAM,gBAEGnC,UAAYjB,EAAE,kBAAoB4B,KAAKlB,QAAU,MACjDkB,KAAKX,UAAUqC,cAKfC,kBAGAC,mBAGAC,qBAMTF,WAAY,eACJG,KAAO9B,UAGNX,UAAU0C,GAAG,QAAS,gDAAgD,SAASC,GAChFA,EAAEC,iBACFH,KAAKI,kBAIJ7C,UAAU0C,GAAG,QAAS,8BAA8B,SAASC,GAC9DA,EAAEC,qBACEE,KAAO/D,EAAE4B,MAAMoC,KAAK,QACpBC,OAASjE,EAAE4B,MAAMoC,KAAK,UAC1BN,KAAKQ,kBAAkBH,KAAME,gBAI5BhD,UAAU0C,GAAG,UAAW,8BAA8B,SAASC,MAClD,UAAVA,EAAEO,KAA6B,MAAVP,EAAEO,IAAa,CACpCP,EAAEC,qBACEE,KAAO/D,EAAE4B,MAAMoC,KAAK,QACpBC,OAASjE,EAAE4B,MAAMoC,KAAK,UAC1BN,KAAKQ,kBAAkBH,KAAME,iBAKhChD,UAAU0C,GAAG,QAAS,2BAA2B,SAASC,GAC3DA,EAAEC,qBACEE,KAAO/D,EAAE4B,MAAMoC,KAAK,QACpBC,OAASjE,EAAE4B,MAAMoC,KAAK,UAC1BN,KAAKQ,kBAAkBH,KAAME,gBAI5BhD,UAAU0C,GAAG,eAAgB,4BAA4B,SAASC,OAC/DQ,QAAUpE,EAAEA,EAAE4D,EAAES,QAAQC,KAAK,SAC7BP,KAAOK,QAAQJ,KAAK,QACpBC,OAASG,QAAQJ,KAAK,UACrBI,QAAQJ,KAAK,WACdN,KAAKa,eAAeH,QAASL,KAAME,gBAKtChD,UAAU0C,GAAG,QAAS,yBAAyB,SAASC,GACzDA,EAAEC,qBACEW,OAASxE,EAAE4B,MAAMoC,KAAK,UAC1BN,KAAKe,aAAaD,gBAIjBvD,UAAU0C,GAAG,QAAS,oBAAoB,SAASC,GACpDA,EAAEC,iBACEH,KAAKhC,gBAAkB,IACvBgC,KAAKhC,kBACLgC,KAAKgB,oBACLhB,KAAKiB,2BAKR1D,UAAU0C,GAAG,QAAS,oBAAoB,SAASC,GACpDA,EAAEC,iBACEH,KAAKhC,gBAAkBgC,KAAK5B,iBAC5B4B,KAAKhC,kBACLgC,KAAKgB,oBACLhB,KAAKiB,2BAKR1D,UAAU0C,GAAG,SAAU,2BAA2B,WACnDD,KAAKxB,iBAAmBlC,EAAE4B,MAAMgD,MAChClB,KAAKhC,gBAAkB,EAES,aAA5BgC,KAAK5C,OAAO+D,YACZnB,KAAKoB,yBAELpB,KAAKqB,wBAKR9D,UAAU0C,GAAG,SAAU,2BAA2B,eAC/CqB,cAAgBhF,EAAE4B,MAAMgD,SACxBI,cAAe,KACXC,MAAQD,cAAcE,MAAM,MAC5BnB,KAAOkB,MAAM,GACbhB,OAASgB,MAAM,IAAM,SACzBvB,KAAKtB,mBAAqB2B,KAC1BL,KAAKpB,qBAAuB2B,OAE5BP,KAAKlB,kBAAoB,EACzBkB,KAAKnB,oBAAsB,QAC3BmB,KAAKyB,mBAAmBpB,KAAME,iBAKjChD,UAAU0C,GAAG,QAAS,+BAA+B,SAASC,GAC/DA,EAAEC,iBACFD,EAAEwB,sBACEC,SAAWrF,EAAE4B,MAAM0D,QAAQ,wBAC/B5B,KAAK6B,yBAAyBF,kBAI7BpE,UAAU0C,GAAG,QAAS,8BAA8B,eACjD0B,SAAWrF,EAAE4B,MAAM0D,QAAQ,wBAC3BE,MAAQxF,EAAE4B,MAAMgD,MAAMa,cAAcC,OACxChC,KAAKiC,yBAAyBN,SAAUG,eAIvCvE,UAAU0C,GAAG,QAAS,6BAA6B,SAASC,GAC7DA,EAAEC,iBACFD,EAAEwB,sBACEC,SAAWrF,EAAE4B,MAAM0D,QAAQ,wBAC3BM,MAAQ5F,EAAE4B,MAAMoC,KAAK,SACrB6B,KAAO7F,EAAE4B,MAAMkE,KAAK,uBAAuBD,OAC/CnC,KAAKqC,6BAA6BV,SAAUO,MAAOC,cAIlD5E,UAAU0C,GAAG,UAAW,8BAA8B,SAASC,OAC5DyB,SAAWrF,EAAE4B,MAAM0D,QAAQ,wBAC3BU,MAAQX,SAASS,KAAK,qCACtBG,QAAUZ,SAASS,KAAK,wCAEd,cAAVlC,EAAEO,OACFP,EAAEC,iBACqB,IAAnBoC,QAAQ3C,OACR0C,MAAME,QAAQC,SAAS,eACpB,KACCC,KAAOH,QAAQI,QAAQ,qCAAqCH,QAC5DE,KAAK9C,SACL2C,QAAQK,YAAY,WACpBF,KAAKD,SAAS,WACdzC,KAAK6C,2BAA2BH,YAGrC,GAAc,YAAVxC,EAAEO,QACTP,EAAEC,iBACEoC,QAAQ3C,OAAQ,KACZkD,KAAOP,QAAQQ,QAAQ,qCAAqCP,QAC5DM,KAAKlD,SACL2C,QAAQK,YAAY,WACpBE,KAAKL,SAAS,WACdzC,KAAK6C,2BAA2BC,YAGvB,UAAV5C,EAAEO,KACTP,EAAEC,iBACEoC,QAAQ3C,OACR2C,QAAQS,QAAQ,SACQ,IAAjBV,MAAM1C,QACb0C,MAAME,QAAQQ,QAAQ,UAET,WAAV9C,EAAEO,KACTT,KAAKiD,wBAAwBtB,aAKrCrF,EAAE4G,UAAUjD,GAAG,SAAS,SAASC,GACxB5D,EAAE4D,EAAES,QAAQiB,QAAQ,wBAAwBhC,QAC7CI,KAAKzC,UAAU6E,KAAK,6BAA6Be,MAAK,WAClDnD,KAAKiD,wBAAwB3G,EAAE4B,kBAMtCX,UAAU0C,GAAG,QAAS,6BAA6B,SAASC,GAC7DA,EAAEC,qBACEiD,KAAO9G,EAAE4B,MAAMoC,KAAK,QACxBN,KAAKqD,mBAAmBD,cAIvB7F,UAAU0C,GAAG,QAAS,6BAA6B,SAASC,GAC7DA,EAAEC,iBACEH,KAAKlB,kBAAoB,IACzBkB,KAAKlB,oBACLkB,KAAKsD,0BACLtD,KAAKuD,oCAIRhG,UAAU0C,GAAG,QAAS,6BAA6B,SAASC,GAC7DA,EAAEC,qBACEqD,WAAaC,KAAKC,MAAM1D,KAAK2D,cAAgB,IAAI/D,OAASI,KAAKjB,0BAC/DiB,KAAKlB,kBAAoB0E,aACzBxD,KAAKlB,oBACLkB,KAAKsD,0BACLtD,KAAKuD,oCAKRhG,UAAU0C,GAAG,SAAU,wBAAwB,WAChDD,KAAKhB,kBAAoB1C,EAAE4B,MAAMgD,MACjClB,KAAK4D,8BAIJrG,UAAU0C,GAAG,SAAU,0BAA0B,WAClDD,KAAKf,cAAgB3C,EAAE4B,MAAMgD,MAC7BlB,KAAK4D,8BAIJrG,UAAU0C,GAAG,SAAU,0BAA0B,WAClDD,KAAKd,cAAgB5C,EAAE4B,MAAMgD,MAC7BlB,KAAK4D,8BAIJrG,UAAU0C,GAAG,QAAS,oBAAoB,SAASC,GACpDA,EAAEC,qBACEW,OAASxE,EAAE4B,MAAMoC,KAAK,UAC1BN,KAAK6D,qBAAqB/C,gBAIzBvD,UAAU0C,GAAG,QAAS,wBAAwB,SAASC,GACxDA,EAAEC,qBACE2D,KAAOxH,EAAE4B,MAAM0D,QAAQ,aACvBwB,KAAO9G,EAAE4B,MAAMoC,KAAK,QACxBN,KAAK+D,cAAcD,KAAMV,cAIxB7F,UAAU0C,GAAG,QAAS,wBAAwB,SAASC,GACxDA,EAAEC,qBACE2D,KAAOxH,EAAE4B,MAAM0D,QAAQ,aACvBoC,MAAQF,KAAKlD,KAAK,MAClBqD,MAAQjE,KAAKR,cAAcwE,OAC3BC,OAASA,MAAMC,UAAY,IAC3BD,MAAMC,YACNlE,KAAKmE,mBAAmBL,KAAMG,gBAIjC1G,UAAU0C,GAAG,QAAS,wBAAwB,SAASC,GACxDA,EAAEC,qBACE2D,KAAOxH,EAAE4B,MAAM0D,QAAQ,aACvBoC,MAAQF,KAAKlD,KAAK,MAClBqD,MAAQjE,KAAKR,cAAcwE,UAC3BC,MAAO,KACHT,WAAaC,KAAKC,KAAKO,MAAM3D,KAAKV,OAASqE,MAAMG,aACjDH,MAAMC,UAAYV,aAClBS,MAAMC,YACNlE,KAAKmE,mBAAmBL,KAAMG,iBAMrC1G,UAAU0C,GAAG,SAAU,mBAAmB,eACvC6D,KAAOxH,EAAE4B,MAAM0D,QAAQ,aACvBoC,MAAQF,KAAKlD,KAAK,MAClBqD,MAAQjE,KAAKR,cAAcwE,OAC3BC,QACAA,MAAMI,UAAY/H,EAAE4B,MAAMgD,MAC1BlB,KAAKsE,eAAeR,KAAMG,gBAK7B1G,UAAU0C,GAAG,SAAU,qBAAqB,eACzC6D,KAAOxH,EAAE4B,MAAM0D,QAAQ,aACvBoC,MAAQF,KAAKlD,KAAK,MAClBqD,MAAQjE,KAAKR,cAAcwE,OAC3BC,QACAA,MAAMM,MAAQjI,EAAE4B,MAAMgD,MACtBlB,KAAKsE,eAAeR,KAAMG,gBAK7B1G,UAAU0C,GAAG,SAAU,qBAAqB,eACzC6D,KAAOxH,EAAE4B,MAAM0D,QAAQ,aACvBoC,MAAQF,KAAKlD,KAAK,MAClBqD,MAAQjE,KAAKR,cAAcwE,OAC3BC,QACAA,MAAMO,MAAQlI,EAAE4B,MAAMgD,MACtBlB,KAAKsE,eAAeR,KAAMG,gBAK7B1G,UAAU0C,GAAG,QAAS,eAAe,SAASC,GAC/CA,EAAEC,qBAEE6D,MADO1H,EAAE4B,MAAM0D,QAAQ,aACVhB,KAAK,MAClBqD,MAAQjE,KAAKR,cAAcwE,OAC3BlD,OAASxE,EAAE4B,MAAMoC,KAAK,UACtB2D,OACAjE,KAAKyE,gBAAgBR,MAAOnD,gBAK/BvD,UAAU0C,GAAG,aAAc,8BAA8B,eACtDI,KAAO/D,EAAE4B,MAAMoC,KAAK,QACpBC,OAASjE,EAAE4B,MAAMoC,KAAK,UAGtBN,KAAKV,gBACLoF,aAAa1E,KAAKV,gBAItBU,KAAKV,eAAiBqF,YAAW,WAC7B3E,KAAK4E,kBAAkBvE,KAAME,UAC9B,aAGFhD,UAAU0C,GAAG,aAAc,8BAA8B,WAEtDD,KAAKV,iBACLoF,aAAa1E,KAAKV,gBAClBU,KAAKV,eAAiB,UAQlCQ,YAAa,eACLE,KAAO9B,UAEN2G,kBAGDC,WAAa5G,KAAK6G,kBAClBD,uBACKtH,QAAUsH,gBACVrH,YAAc,IAAIuH,eAClB3D,qBAKJ4D,aAAY,WACbjF,KAAKkF,mBASbH,aAAc,mBAEFI,OAASC,eAAeC,QAAQnH,KAAKiB,aACrCgG,OAAQ,KACJ7E,KAAOgF,KAAKC,MAAMJ,WAClB7E,KAAKkF,WAAcR,KAAKS,MAAQnF,KAAKkF,UAAatH,KAAKkB,gBAChDkB,KAAK9C,QAGhB4H,eAAeM,WAAWxH,KAAKiB,WAErC,MAAOe,WAGF,MAQXyF,YAAa,SAASnI,aAEd4H,eAAeQ,QAAQ1H,KAAKiB,SAAUmG,KAAKO,UAAU,CACjDL,UAAWR,KAAKS,MAChBjI,QAASA,WAEf,MAAO0C,MAWb0E,kBAAmB,SAASvE,KAAME,YAC1BP,KAAO9B,KACPiB,SAAWkB,KAAO,IAAME,WAGxBrC,KAAKmB,gBAAgBF,WAAajB,KAAKqB,iBAAmBc,WAIzDd,eAAiBc,SAGlByF,OAAS5H,KAAKV,QAAQ4E,MAAK,SAAS2D,UAC7BA,EAAE1F,OAASA,WAGjByF,UAIU,WAAXvF,OAEAjE,EAAE0J,KAAK,CACHC,IAAKC,EAAEC,IAAIC,QAAU,oDACrBC,OAAQ,OACR/F,KAAM,CACFgG,SAAUR,OAAOS,MAAQT,OAAOU,mBAChCC,QAASP,EAAEC,IAAIM,SAEnBC,SAAU,OACVC,QAAS,MACVC,MAAK,SAASC,UACTA,SAASC,UACT9G,KAAKX,gBAAgBF,UAAY,CAC7B2G,OAAQA,OACRiB,QAASF,SAASE,SAAW,GAC7BC,UAAWH,SAASI,WACpB5C,UAAWwC,SAASK,aAG5BlH,KAAKT,eAAiB,QACvB4H,MAAK,WACJnH,KAAKT,eAAiB,YAEvB,KAEC6H,MAAQlJ,KAAKb,SAAWgK,OAAOC,gBAAkBD,OAAOC,gBAAgBC,QAAU,UACjFH,aAIL9K,EAAE0J,KAAK,CACHC,IAAK,8DAAgE5F,KACrEgG,OAAQ,MACRmB,QAAS,eACY,UAAYJ,aACnB,oBAEdT,QAAS,OACVC,MAAK,SAASC,UACTA,SAASC,SAAWD,SAASf,SAC7B9F,KAAKX,gBAAgBF,UAAY,CAC7B2G,OAAQe,SAASf,OACjBiB,QAASF,SAASvG,MAAQ,GAC1B0G,UAAW,KACX3C,UAAW,OAGnBrE,KAAKT,eAAiB,QACvB4H,MAAK,WACJnH,KAAKT,eAAiB,WAWlC0F,YAAa,SAASwC,cACdzH,KAAO9B,QAGPA,KAAKb,cACLgK,OAAOC,gBAAkBD,OAAOC,iBAAmB,GACnDD,OAAOC,gBAAgBC,QAAUrJ,KAAKb,YACtCoK,WAKAJ,OAAOC,iBAAmBD,OAAOC,gBAAgBC,QACjDE,WAKJnL,EAAE0J,KAAK,CACHC,IAAKC,EAAEC,IAAIC,QAAU,oDACrBC,OAAQ,MACRK,SAAU,OACVC,QAAS,MACVC,MAAK,SAASC,UACTA,UAAYA,SAASC,SAAWD,SAASvG,MACzC+G,OAAOC,gBAAkBT,SAASvG,KAClCmH,YAEAzH,KAAK0H,UAAU,4BAEpBP,MAAK,WACJnH,KAAK0H,UAAU,8BAOvBxC,aAAc,eACNlF,KAAO9B,KACPkJ,MAAQlJ,KAAKb,SAAWgK,OAAOC,gBAAkBD,OAAOC,gBAAgBC,QAAU,SAEjFH,WAKDO,SAAW,GACXpH,OAASrC,KAAKd,OAAOwK,cAAgB,MAE1B,QAAXrH,QAA+B,WAAXA,QACpBoH,SAASE,KAAK3J,KAAK4J,aAAa,kBAAmBV,QAGxC,QAAX7G,QAA+B,OAAXA,QACpBoH,SAASE,KAAK3J,KAAK4J,aAAa,cAAeV,QAGnD9K,EAAEyL,KAAKC,MAAM1L,EAAGqL,UAAUM,MAAK,mBACvBC,WAAa,GAERC,EAAI,EAAGA,EAAIR,SAAS/H,OAAQuI,IAAK,KAClCC,OAOA5K,SALA4K,OADoB,IAApBT,SAAS/H,OACAyI,UAAU,GAEVA,UAAUF,GAAG,IAGL3K,SAAW4K,OAAO9H,MAAQ,MAC3C9C,SAAWA,QAAQoC,OAAQ,KACvBgI,aAA2B,OAAXrH,QAA0B,IAAN4H,GAAsB,QAAX5H,OAAqB,KAAO,SAC/E/C,QAAQ8K,SAAQ,SAASxC,QACrBA,OAAOvF,OAASuF,OAAOvF,QAAUqH,aACjCM,WAAWL,KAAK/B,YAK5B9F,KAAKxC,QAAU0K,WACflI,KAAKvC,YAAc,IAAIuH,KACvBhF,KAAK2F,YAAYuC,YACjBlI,KAAKqB,mBACN8F,MAAK,WACJnH,KAAK0H,yBAzCAA,UAAU,4BAoDvBI,aAAc,SAASS,SAAUnB,cAGtB9K,EAAE0J,KAAK,CACVC,IAHU,kDAGKsC,SACflC,OAAQ,MACRmB,QAAS,eACY,UAAYJ,qBACb,0BACN,oBAEdT,QAAS,QAOjBtF,cAAe,eACPmH,KAAOtK,KAAKd,OAAO+D,aAAe,WAEV,IAAxBjD,KAAKV,QAAQoC,QAMJ,aAAT4I,MAAgC,UAATA,WAClBC,6BAILjL,QAAUU,KAAKwK,uBAEXF,UACC,gBACIG,eAAenL,mBAEnB,UAEGoL,WAAa1K,KAAK2K,0BAA0B,MAAOrL,cAClDsL,UAAUF,sBAEd,WAEGG,YAAc7K,KAAK2K,0BAA0B,OAAQrL,cACpDwL,WAAWD,gCAIXE,YAAYzL,cAIpB0L,mBACAC,4BAjCIC,aA2CbP,0BAA2B,SAASL,KAAMN,gBAClCmB,eAAiB,MAER,QAATb,MAAkBtK,KAAKd,OAAOkM,oBAAsBpL,KAAKd,OAAOkM,mBAAmB1J,OAAS,EAC5FyJ,eAAiBnL,KAAKd,OAAOkM,mBACb,SAATd,MAAmBtK,KAAKd,OAAOmM,qBAAuBrL,KAAKd,OAAOmM,oBAAoB3J,OAAS,IACtGyJ,eAAiBnL,KAAKd,OAAOmM,qBAIH,IAA1BF,eAAezJ,cACRsI,eAIPE,OAAS,UACbiB,eAAef,SAAQ,SAASkB,UACxBnJ,KAAOmJ,KAAKnJ,MAAQmJ,KACpBjJ,OAASiJ,KAAKjJ,QAAU,SACxBuF,OAASoC,WAAW9F,MAAK,SAAS2D,UAC3BA,EAAE1F,OAASA,OAAS0F,EAAExF,SAAWA,SAAWiJ,KAAKjJ,WAExDuF,QACAsC,OAAOP,KAAK/B,WAIbsC,QAMXK,uBAAwB,eAChBzI,KAAO9B,KACPuL,YAAc,QAGbjM,QAAQ8K,SAAQ,SAASxC,YACtB4D,QAAU5D,OAAO6D,cACjBD,SAAWA,QAAQrJ,KACnBoJ,YAAYC,QAAQrJ,MAAQ,CACxBA,KAAMqJ,QAAQrJ,KACdkG,KAAMmD,QAAQnD,MAAQmD,QAAQrJ,KAC9BuJ,MAAOF,QAAQE,OAAS,WAErB9D,OAAO+D,WACdJ,YAAY3D,OAAO+D,UAAY,CAC3BxJ,KAAMyF,OAAO+D,SACbtD,KAAMT,OAAO+D,SACbD,MAAO,oBAMdnL,oBAAsBqL,OAAOC,OAAON,aAAaO,MAAK,SAASC,EAAGC,UAC5DD,EAAE1D,KAAK4D,cAAcD,EAAE3D,aAI9B6D,OAASlM,KAAKX,UAAU6E,KAAK,2BAC7BT,SAAWzD,KAAKX,UAAU6E,KAAK,sBAC/BiI,aAAe1I,SAASS,KAAK,gCAE7BgI,OAAOxK,SAEPwK,OAAOhI,KAAK,sBAAsBkI,cAG7B7L,oBAAoB6J,SAAQ,SAASiC,SAClCC,SAAWxK,KAAKxB,mBAAqB+L,IAAIlK,KAAO,YAAc,GAClE+J,OAAOK,OAAO,kBAAoBF,IAAIlK,KAAO,IAAMmK,SAAW,IAAMD,IAAIhE,KAAO,iBAKnF8D,aAAazK,OAAQ,CACrByK,aAAaK,YAITC,YAAc,wCADCzM,KAAKM,iBAAgC,GAAb,YACzB,yHAIlB6L,aAAaI,OAAOE,kBAGflM,oBAAoB6J,SAAQ,SAASiC,SAElCK,SAAW,wCADE5K,KAAKxB,mBAAqB+L,IAAIlK,KAAO,WAAa,IACE,iBAAmBkK,IAAIlK,KAA7E,kBACOkK,IAAIhE,KAAKxE,cADhB,oDAE2B/B,KAAK6K,WAAWN,IAAIhE,MAF/C,wEAGwDgE,IAAIX,MAH5D,wEAMfS,aAAaI,OAAOG,iBAIpBE,aAAe,oBACf5M,KAAKM,iBAAkB,KACnBuM,YAAc7M,KAAKO,oBAAoB2D,MAAK,SAAS4I,UAC9CA,EAAE3K,OAASL,KAAKxB,oBAEvBuM,cACAD,aAAeC,YAAYxE,MAGnC5E,SAASS,KAAK,6BAA6BD,KAAK2I,gBAQxD1J,uBAAwB,eAChBpB,KAAO9B,KACPkM,OAASlM,KAAKX,UAAU6E,KAAK,2BAC7BT,SAAWzD,KAAKX,UAAU6E,KAAK,uDAC/BiI,aAAe1I,SAASS,KAAK,gCAE5BgI,OAAOxK,YAKRpC,QAAUU,KAAKwK,mBAGnB0B,OAAOhI,KAAK,sBAAsBkI,SAClCD,aAAaK,QAGblN,QAAQ8K,SAAQ,SAASxC,YACjBmF,WAAanF,OAAOS,MAAQT,OAAOoF,OAASpF,OAAOqF,cAAgBrF,OAAOzF,MAAQ,WAClF6B,MAAQ4D,OAAOzF,KAAO,KAAOyF,OAAOvF,OACpC6K,aAAetF,OAAO6D,eAAiB,CAACpD,KAAM,UAAWqD,MAAO,WAChEyB,cAAgB,KAAOD,aAAa7E,KAAO,IAC3CiE,SAAYxK,KAAKtB,qBAAuBoH,OAAOzF,KAAQ,YAAc,GAGzE+J,OAAOK,OAAO,kBAAoBvI,MAAQ,IAAMsI,SAAW,IAAMS,WAAaI,cAAgB,iBAG1FT,SAAW,oDAAsD1I,MAAQ,kBACzE+I,WAAWlJ,cAAgB,IAAMqJ,aAAa7E,KAAKxE,cADxC,oDAE2B/B,KAAK6K,WAAWI,YAF3C,wEAGwDG,aAAaxB,MAAQ,KACxF5J,KAAK6K,WAAWO,aAAa7E,MAJlB,eAMf8D,aAAaI,OAAOG,aAIpB1M,KAAKQ,qBAAuB0L,OAAOlJ,MAAO,KACtCoK,cAAgBlB,OAAOhI,KAAK,kBAAoBlE,KAAKQ,mBAAqB,QAC1E4M,cAAc1L,QACd0L,cAAcC,KAAK,YAAY,OAKlCnB,OAAOlJ,OAAS1D,QAAQoC,OAAS,EAAG,KACjC4L,YAAchO,QAAQ,GACtBiO,WAAaD,YAAYnL,KAAO,KAAOmL,YAAYjL,OACnDmL,UAAYF,YAAYjF,MAAQiF,YAAYN,OAASM,YAAYL,cAAgBK,YAAYnL,MAAQ,WACzG+J,OAAOlJ,IAAIuK,iBACN/M,mBAAqB8M,YAAYnL,UACjCzB,qBAAuB4M,YAAYjL,OAExCoB,SAASS,KAAK,6BAA6BD,KAAKuJ,WAChD/J,SAASS,KAAK,6BAA6BQ,YAAY,YACvDjB,SAASS,KAAK,yCAA2CqJ,WAAa,MAAMhJ,SAAS,iBAEhFhB,mBAAmB+J,YAAYnL,KAAMmL,YAAYjL,aACnD,GAAI6J,OAAOlJ,MAAO,KAEjBK,MAAQ6I,OAAOlJ,MAAMM,MAAM,MAC3BmK,eAAiBnO,QAAQ4E,MAAK,SAAS2D,UAAYA,EAAE1F,OAASkB,MAAM,SACpEoK,eAAgB,KACZC,aAAeD,eAAepF,MAAQoF,eAAeT,OAASS,eAAeR,cAAgBQ,eAAetL,MAAQ,WACxHsB,SAASS,KAAK,6BAA6BD,KAAKyJ,cAChDjK,SAASS,KAAK,6BAA6BQ,YAAY,YACvDjB,SAASS,KAAK,yCAA2CgI,OAAOlJ,MAAQ,MAAMuB,SAAS,iBAEtFhB,mBAAmBF,MAAM,GAAIA,MAAM,IAAM,eAG9CI,SAASS,KAAK,6BAA6BD,KAAK,yBAC3CiH,cASbV,cAAe,eACP1I,KAAO9B,KACPV,QAAUU,KAAKV,QAAQqO,QACvBzO,OAASc,KAAKd,UAGdc,KAAKM,mBACLhB,QAAUA,QAAQsO,QAAO,SAAS/F,UAChBA,EAAE4D,cAAgB5D,EAAE4D,cAActJ,KAAQ0F,EAAE8D,UAAY,MACnD7J,KAAKxB,qBAKJ,WAAxBpB,OAAOwK,cAA6BxK,OAAO2O,iBAAmB3O,OAAO2O,gBAAgBnM,OAAQ,KACzF4K,SAAWpN,OAAO2O,gBACtBvO,QAAUA,QAAQsO,QAAO,SAAS/F,UACO,IAA9ByE,SAASwB,QAAQjG,EAAE1F,gBAOlC7C,QAAQwM,MAAK,SAASC,EAAGC,OACjB+B,MAAQhC,EAAE1D,MAAQ0D,EAAEiB,OAASjB,EAAEkB,cAAgBlB,EAAEiC,aAAejC,EAAE5J,MAAQ,GAC1E8L,MAAQjC,EAAE3D,MAAQ2D,EAAEgB,OAAShB,EAAEiB,cAAgBjB,EAAEgC,aAAehC,EAAE7J,MAAQ,UACvE4L,MAAM9B,cAAcgC,UAGxB3O,SAQXyL,YAAa,SAASzL,cAEb4O,gBAAkB5O,aAGlBS,iBAAmBC,KAAKd,OAAOe,cAAgB,QAC/CC,eAAiBqF,KAAKC,KAAKlG,QAAQoC,OAAS1B,KAAKD,uBACjDD,gBAAkB,OAGlBgD,qBAMTA,kBAAmB,eAEXxD,QAAUU,KAAKkO,iBAAmB,GAClCC,cAAgBnO,KAAKX,UAAU6E,KAAK,8BACpCkK,SAAWhQ,EAAE,uCAAyC4B,KAAKlB,SAC3DuP,oBAAsBrO,KAAKX,UAAU6E,KAAK,6BAG1CoK,YAActO,KAAKF,gBAAkB,GAAKE,KAAKD,iBAC/CwO,SAAWD,WAAatO,KAAKD,iBAC7ByO,YAAclP,QAAQqO,MAAMW,WAAYC,aAE5CJ,cAAc3B,QAEdgC,YAAYpE,SAAQ,SAASxC,YACrB0D,KAAO8C,SAASK,OAChBC,MAAQtQ,EAAEkN,MAEdoD,MAAMhM,KAAK,YAAakF,OAAOzF,MAC/BuM,MAAMhM,KAAK,cAAekF,OAAOvF,YAG7B0K,WAAanF,OAAOS,MAAQT,OAAOoF,OAASpF,OAAOqF,cAAgBrF,OAAOoG,aAAepG,OAAOzF,MAAQ,kBAC5GuM,MAAMxK,KAAK,qBAAqBD,KAAK8I,gBAGjC4B,aAAe/G,OAAO6D,cAAgB7D,OAAO6D,cAAcpD,KAAOT,OAAO+D,UAAY,UACrFiD,cAAgBhH,OAAO6D,cAAgB7D,OAAO6D,cAAcC,MAAQ,UACxEgD,MAAMxK,KAAK,yBACND,KAAK0K,cACLE,IAAI,mBAAoBD,eACxBC,IAAI,QAAS,QAElBV,cAAc5B,OAAOmC,UAGzBP,cAAczJ,YAAY,UAGtB1E,KAAKE,eAAiB,EAAG,KAErB4O,UAAYR,WAAaE,YAAY9M,OACzC2M,oBAAoBnK,KAAK,uBACpBD,KAAK,YAAcqK,WAAa,GAAK,IAAMQ,UAAY,OAASxP,QAAQoC,QAC7E2M,oBAAoBnK,KAAK,qBACpBD,KAAK,QAAUjE,KAAKF,gBAAkB,OAASE,KAAKE,gBAGzDmO,oBAAoBnK,KAAK,oBAAoBmJ,KAAK,WAAYrN,KAAKF,iBAAmB,GACtFuO,oBAAoBnK,KAAK,oBAAoBmJ,KAAK,WAAYrN,KAAKF,iBAAmBE,KAAKE,gBAE3FmO,oBAAoB3J,YAAY,eAEhC2J,oBAAoB9J,SAAS,WASrCkG,eAAgB,SAASnL,cAEhByP,eAAiB,UACjBtJ,aAAe,UACfuJ,sBAAwB,UAIxB9L,yBAGuB,IAAxBlD,KAAKV,QAAQoC,aACRwJ,aAUb3H,mBAAoB,SAASpB,KAAME,YAC3BP,KAAO9B,KACPiB,SAAWkB,KAAO,IAAME,UAGxBrC,KAAKmB,gBAAgBF,UAAW,KAC5BgG,OAASjH,KAAKmB,gBAAgBF,sBAC7BwE,aAAewB,OAAO4B,kBACtBoG,sBAAsBhI,OAAOW,OAAQX,OAAO4B,cAKhDqG,iCAGDtH,OAAS5H,KAAKV,QAAQ4E,MAAK,SAAS2D,UAC7BA,EAAE1F,OAASA,YAGjByF,mBACIuH,uCACA3F,UAAU,uBAKJ,WAAXnH,OACAjE,EAAE0J,KAAK,CACHC,IAAKC,EAAEC,IAAIC,QAAU,oDACrBC,OAAQ,OACR/F,KAAM,CACFgG,SAAUR,OAAOS,MAAQT,OAAOU,mBAChCC,QAASP,EAAEC,IAAIM,SAEnBC,SAAU,OACVC,QAAS,MACVC,MAAK,SAASC,UACb7G,KAAKqN,6BACDxG,SAASC,SAET9G,KAAKX,gBAAgBF,UAAY,CAC7B2G,OAAQA,OACRiB,QAASF,SAASE,SAAW,GAC7BC,UAAWH,SAASI,WACpB5C,UAAWwC,SAASK,YAExBlH,KAAK2D,aAAekD,SAASE,SAAW,GACxC/G,KAAKmN,sBAAsBrH,OAAQe,SAASE,SAAW,KAEvD/G,KAAK0H,UAAUb,SAASyG,SAAW,4BAExCnG,MAAK,WACJnH,KAAKqN,6BACLrN,KAAK0H,UAAU,2BAEhB,KAECN,MAAQlJ,KAAKb,SAAWgK,OAAOC,gBAAkBD,OAAOC,gBAAgBC,QAAU,UAEjFH,kBACIiG,uCACA3F,UAAU,2BAInBpL,EAAE0J,KAAK,CACHC,IAAK,8DAAgE5F,KACrEgG,OAAQ,MACRmB,QAAS,eACY,UAAYJ,aACnB,oBAEdT,QAAS,OACVC,MAAK,SAASC,UACb7G,KAAKqN,6BACDxG,SAASC,SAAWD,SAASf,QAE7B9F,KAAKX,gBAAgBF,UAAY,CAC7B2G,OAAQe,SAASf,OACjBiB,QAASF,SAASvG,MAAQ,GAC1B0G,UAAW,KACX3C,UAAW,MAEfrE,KAAK2D,aAAekD,SAASvG,MAAQ,GACrCN,KAAKmN,sBAAsBtG,SAASf,OAAQe,SAASvG,MAAQ,KAE7DN,KAAK0H,UAAU,4BAEpBP,MAAK,WACJnH,KAAKqN,6BACLrN,KAAK0H,UAAU,yBAW3ByF,sBAAuB,SAASrH,OAAQxF,UAChCiN,YAAcrP,KAAKX,UAAU6E,KAAK,6BAEjC9B,MAAwB,IAAhBA,KAAKV,aAMbqN,eAAiBnH,YACjBnC,aAAerD,SAGhBuJ,SAAW/D,OAAO6D,eAAiB,CAACpD,KAAM,UAAWqD,MAAO,gBAC3DrM,UAAU6E,KAAK,oBACfD,KAAK0H,SAAStD,MACdwG,IAAI,mBAAoBlD,SAASD,OACjCmD,IAAI,QAAS,aACbxP,UAAU6E,KAAK,kBAAkBD,KAAK7B,KAAKV,aAC3CrC,UAAU6E,KAAK,gBAAgBD,KAAK,aAAc,IAAI6C,MAAOwI,2BAG7DC,8BAA8BnN,WAG9BzB,oBAAsB,aACtBC,kBAAoB,OACpBvB,UAAU6E,KAAK,6BAA6BQ,YAAY,eACxDrF,UAAU6E,KAAK,gDAAgDK,SAAS,eACxElF,UAAU6E,KAAK,wBAAwBQ,YAAY,eACnDrF,UAAU6E,KAAK,wBAAwBK,SAAS,eAGhDa,0BAELiK,YAAY3K,YAAY,eACnBsG,mBACAC,4BAjCIC,aAyCb/F,mBAAoB,SAASD,WACpBvE,oBAAsBuE,UAGtB7F,UAAU6E,KAAK,6BAA6BQ,YAAY,eACxDrF,UAAU6E,KAAK,wCAA0CgB,KAAO,MAAMX,SAAS,UAGvE,UAATW,WACK7F,UAAU6E,KAAK,wBAAwBQ,YAAY,eACnDrF,UAAU6E,KAAK,wBAAwBK,SAAS,iBAEhDlF,UAAU6E,KAAK,wBAAwBK,SAAS,eAChDlF,UAAU6E,KAAK,wBAAwBQ,YAAY,eAEnDgB,wBASb6J,8BAA+B,SAASnN,SAC/BA,MAAwB,IAAhBA,KAAKV,YAEd4H,QAAUsC,OAAO4D,KAAKpN,KAAK,IAC3BqN,YAAczP,KAAK0P,qBAAqBtN,KAAMkH,SAE9CqG,YAAc3P,KAAKX,UAAU6E,KAAK,0BAClC0L,YAAc5P,KAAKX,UAAU6E,KAAK,0BAEtCyL,YAAYnD,QACZoD,YAAYpD,QAGZlD,QAAQc,SAAQ,SAASyF,OACjBC,UAAYD,EAAEE,QAAQ,KAAM,KAAKA,QAAQ,SAAS,SAASC,UAAYA,EAAEC,iBAC7EN,YAAYpD,OAAO,kBAAoBsD,EAAI,KAAOC,UAAY,iBAInDL,YAAY/N,OAAS,EAAI+N,YAAcnG,SAC7Cc,SAAQ,SAASyF,OAClBC,UAAYD,EAAEE,QAAQ,KAAM,KAAKA,QAAQ,SAAS,SAASC,UAAYA,EAAEC,iBAC7EL,YAAYrD,OAAO,kBAAoBsD,EAAI,KAAOC,UAAY,qBAI7D/O,cAAgBuI,QAAQ,QACxBtI,cAAgByO,YAAY/N,OAAS,EAAI+N,YAAYA,YAAY/N,OAAS,GAAK4H,QAAQA,QAAQ5H,OAAS,GAE7GiO,YAAY3M,IAAIhD,KAAKe,eACrB6O,YAAY5M,IAAIhD,KAAKgB,iBAMzBoE,wBAAyB,eACjBhD,KAAOpC,KAAKyF,cAAgB,GAC5ByK,MAAQlQ,KAAKX,UAAU6E,KAAK,mBAC5BiM,MAAQD,MAAMhM,KAAK,SACnBkM,MAAQF,MAAMhM,KAAK,YAEvBiM,MAAM3D,QACN4D,MAAM5D,QAEc,IAAhBpK,KAAKV,YAKL4H,QAAUsC,OAAO4D,KAAKpN,KAAK,IAC3BiO,UAAYjS,EAAE,QAClBkL,QAAQc,SAAQ,SAASyF,OACjBC,UAAYD,EAAEE,QAAQ,KAAM,KAAKA,QAAQ,SAAS,SAASC,UAAYA,EAAEC,iBAC7EI,UAAU9D,OAAOnO,EAAE,QAAQ6F,KAAK6L,eAEpCK,MAAM5D,OAAO8D,eAGT/K,WAAaC,KAAKC,KAAKpD,KAAKV,OAAS1B,KAAKa,0BAC1CyN,YAActO,KAAKY,kBAAoB,GAAKZ,KAAKa,yBACjD0N,SAAWhJ,KAAK+K,IAAIhC,WAAatO,KAAKa,yBAA0BuB,KAAKV,QAC1DU,KAAKuL,MAAMW,WAAYC,UAG7BnE,SAAQ,SAASmG,SAClBC,GAAKpS,EAAE,QACXkL,QAAQc,SAAQ,SAASyF,OACjB7M,IAAMuN,IAAIV,GACV7M,MAAAA,MAAmCA,IAAM,QACzCyN,WAAaC,OAAO1N,KACpByN,WAAW/O,OAAS,KACpB+O,WAAaA,WAAWE,UAAU,EAAG,IAAM,OAE/CH,GAAGjE,OAAOnO,EAAE,QAAQsE,KAAK,QAASM,KAAKiB,KAAKwM,gBAEhDL,MAAM7D,OAAOiE,YAIZnR,UAAU6E,KAAK,cAAcD,KAAK,YAAcqK,WAAa,GAAK,IAAMC,SAAW,OAASnM,KAAKV,aACjGrC,UAAU6E,KAAK,6BAA6BD,KAAK,QAAUjE,KAAKY,kBAAoB,OAAS0E,iBAG7FjG,UAAU6E,KAAK,6BAA6BmJ,KAAK,WAAYrN,KAAKY,mBAAqB,QACvFvB,UAAU6E,KAAK,6BAA6BmJ,KAAK,WAAYrN,KAAKY,mBAAqB0E,cAMhGI,oBAAqB,eACbtD,KAAOpC,KAAKyF,cAAgB,GAC5BmL,OAAS5Q,KAAKX,UAAU6E,KAAK,mBAAmB,MAE/C0M,QAA0B,IAAhBxO,KAAKV,QAKhB1B,KAAKgP,6BACAA,sBAAsB6B,eACtB7B,sBAAwB,UAG7B7I,UAAYnG,KAAKc,mBAAqB,MACtCuF,MAAQrG,KAAKe,eAAiB6K,OAAO4D,KAAKpN,KAAK,IAAI,GACnDkE,MAAQtG,KAAKgB,eAAiB4K,OAAO4D,KAAKpN,KAAK,IAAI,GAGnD0G,UAAY1G,KAAKuL,MAAM,EAAG,IAC1BmD,OAAShI,UAAUiI,KAAI,SAASR,SAC5BS,MAAQT,IAAIlK,UACZ2K,MAAAA,MAAuC,MAAO,cAC9CC,SAAWP,OAAOM,cACfC,SAASvP,OAAS,GAAKuP,SAASN,UAAU,EAAG,IAAM,MAAQM,YAElEpF,OAAS/C,UAAUiI,KAAI,SAASR,YACzBW,WAAWX,IAAIjK,SAAW,KAIjC6K,OAASnR,KAAKoR,oBAAoBvF,OAAOnK,OAAQyE,WAGjDkL,cAAgB,CAChBL,MAAO1K,MAAMyJ,QAAQ,KAAM,KAAKA,QAAQ,SAAS,SAASC,UAAYA,EAAEC,iBACxE7N,KAAMyJ,QAGQ,QAAd1F,WAAqC,aAAdA,WACvBkL,cAAcC,gBAAkBH,OAChCE,cAAcE,YAAc,IAE5BF,cAAcC,gBAAkBH,OAAO,GACvCE,cAAcG,YAAcL,OAAO,GAAGpB,QAAQ,MAAO,KACrDsB,cAAcE,YAAc,OAI5BrS,OAAS,CACTuS,KAAMtL,UACN/D,KAAM,CACF0O,OAAQA,OACRY,SAAU,CAACL,gBAEfxS,QAAS,CACL8S,YAAY,EACZC,qBAAqB,EACrBC,QAAS,CACLC,OAAQ,CACJC,QAAuB,QAAd5L,WAAqC,aAAdA,UAChC6L,SAAU,YAOR,QAAd7L,WAAqC,SAAdA,YACvBjH,OAAOL,QAAQoT,OAAS,CACpBC,EAAG,CAAEC,aAAa,GAClBC,EAAG,CAAEL,QAAS3P,KAAKV,QAAU,eAK5BsN,sBAAwB,IAAIrQ,MAAMiS,OAAOyB,WAAW,MAAOnT,QAClE,MAAOoT,YACAjT,UAAU6E,KAAK,6BAA6BuK,KAC7C,yHAUZ9I,qBAAsB,SAAS/C,YACvBR,KAAOpC,KAAKyF,cAAgB,GAC5BmC,OAAS5H,KAAK+O,gBAAkB,MAEhB,IAAhB3M,KAAKV,QAIM,QAAXkB,OAAkB,KACd0G,QAAUsC,OAAO4D,KAAKpN,KAAK,IAC3BmQ,WAAajJ,QAAQkJ,KAAK,KAAO,KAErCpQ,KAAKgI,SAAQ,SAASmG,SACdkC,UAAYnJ,QAAQyH,KAAI,SAASlB,OAC7B7M,IAAMuN,IAAIV,MACV7M,MAAAA,IAAmC,MAAO,OAC1C0P,OAAShC,OAAO1N,YAEhB0P,OAAOC,SAAS,MAAQD,OAAOC,SAAS,MAAQD,OAAOC,SAAS,SAChED,OAAS,IAAMA,OAAO3C,QAAQ,KAAM,MAAQ,KAEzC2C,UAEXH,YAAcE,UAAUD,KAAK,KAAO,YAGpCI,KAAO,IAAIC,KAAK,CAACN,YAAa,CAACd,KAAM,4BACrCqB,KAAO9N,SAAS+N,cAAc,KAC9BhG,WAAanF,OAAOS,MAAQT,OAAOzF,MAAQ,SAC/C2Q,KAAKE,KAAOC,IAAIC,gBAAgBN,MAChCE,KAAKK,SAAWpG,WAAWgD,QAAQ,cAAe,KAAO,KAAM,IAAIjJ,MAAOsM,cAAc9P,MAAM,KAAK,GAAK,OACxGwP,KAAKO,UASbzI,UAAW,SAAStL,aACZwC,KAAO9B,KACPsT,cAAgBtT,KAAKX,UAAU6E,KAAK,2BACpCkK,SAAWhQ,EAAE,oCAAsC4B,KAAKlB,SACxDyU,SAAWC,SAASxT,KAAKd,OAAOuU,WAAY,KAAO,EACvDF,SAAWhO,KAAK+K,IAAe,EAAXiD,SAAc,GAElCD,cAAc9G,QAEGlN,QAAQqO,MAAM,EAAG4F,UAEvBnJ,SAAQ,SAASxC,OAAQ8L,WAC5BC,KAAOvF,SAASK,OAChBmF,MAAQxV,EAAEuV,MAEV5G,WAAanF,OAAOS,MAAQT,OAAOoF,OAASpF,OAAOqF,cAAgBrF,OAAOzF,MAAQ,SACtFyR,MAAMlR,KAAK,YAAakF,OAAOzF,MAC/ByR,MAAMlR,KAAK,cAAekF,OAAOvF,QACjCuR,MAAM1P,KAAK,mBAAmBD,KAAK8I,YACnC6G,MAAM1P,KAAK,mBAAmBuK,KAAK,yCACnCmF,MAAM1P,KAAK,mBAAmBK,SAAS,UACvCqP,MAAM1P,KAAK,uBAAuBK,SAAS,cAGvCsP,MAAQ,CAAC,WAAY,oBAAqB,WAAY,mBAC1DD,MAAM1P,KAAK,oBAAoBQ,YAAY,iBAAiBH,SAASsP,MAAMH,MAAQG,MAAMnS,SAEzF4R,cAAc/G,OAAOqH,OAGrB9R,KAAKgS,YAAYlM,OAAQgM,UAG7BN,cAAc5O,YAAY,WAS9BoP,YAAa,SAASlM,OAAQgM,WACtB9R,KAAO9B,KACPiB,SAAW2G,OAAOzF,KAAO,IAAMyF,OAAOvF,UAGtCrC,KAAKmB,gBAAgBF,eACjBgG,OAASjH,KAAKmB,gBAAgBF,eAC7B8S,eAAeH,MAAO3M,OAAO4B,iBAKhB,WAAlBjB,OAAOvF,OACPjE,EAAE0J,KAAK,CACHC,IAAKC,EAAEC,IAAIC,QAAU,oDACrBC,OAAQ,OACR/F,KAAM,CACFgG,SAAUR,OAAOS,MAAQT,OAAOU,mBAChCC,QAASP,EAAEC,IAAIM,SAEnBC,SAAU,OACVC,QAAS,OACVC,MAAK,SAASC,UACTA,SAASC,SACT9G,KAAKX,gBAAgBF,UAAY,CAC7B2G,OAAQA,OACRiB,QAASF,SAASE,SAAW,IAEjC/G,KAAKiS,eAAeH,MAAOjL,SAASE,SAAW,KAE/C+K,MAAM1P,KAAK,mBAAmBD,KAAK,SAExCgF,MAAK,WACJ2K,MAAM1P,KAAK,mBAAmBD,KAAK,aAEpC,KAECiF,MAAQlJ,KAAKb,SAAWgK,OAAOC,gBAAkBD,OAAOC,gBAAgBC,QAAU,UACjFH,kBACD0K,MAAM1P,KAAK,mBAAmBD,KAAK,MAIvC7F,EAAE0J,KAAK,CACHC,IAAK,8DAAgEH,OAAOzF,KAC5EgG,OAAQ,MACRmB,QAAS,eACY,UAAYJ,aACnB,oBAEdT,QAAS,OACVC,MAAK,SAASC,UACTA,SAASC,SAAWD,SAASvG,MAC7BN,KAAKX,gBAAgBF,UAAY,CAC7B2G,OAAQe,SAASf,QAAUA,OAC3BiB,QAASF,SAASvG,MAAQ,IAE9BN,KAAKiS,eAAeH,MAAOjL,SAASvG,MAAQ,KAE5CwR,MAAM1P,KAAK,mBAAmBD,KAAK,SAExCgF,MAAK,WACJ2K,MAAM1P,KAAK,mBAAmBD,KAAK,WAW/C8P,eAAgB,SAASH,MAAOxR,SACvBA,MAAwB,IAAhBA,KAAKV,YASdsC,MACAgQ,eAJA1K,QAAUsC,OAAO4D,KAAKpN,KAAK,IAC3BqN,YAAczP,KAAK0P,qBAAqBtN,KAAMkH,YAK9CmG,YAAY/N,OAAS,EAAG,KAEpBuS,SAAWxE,YAAYA,YAAY/N,OAAS,GAM5CsC,MAHAiQ,SAASpQ,cAAc8O,SAAS,UAChCsB,SAASpQ,cAAc8O,SAAS,UAChB,IAAhBvQ,KAAKV,OACGU,KAAK8R,QAAO,SAASC,IAAK5D,YACvB4D,KAAOjD,WAAWX,IAAI0D,YAAc,KAC5C,GAGK7R,KAAKV,YAIjBsC,MAAQ5B,KAAKV,OAKbsS,eADAhQ,OAAS,KACSA,MAAQ,KAASoQ,QAAQ,GAAK,IACzCpQ,OAAS,KACEA,MAAQ,KAAMoQ,QAAQ,GAAK,IACtCC,OAAOC,UAAUtQ,OACPA,MAAMuQ,iBAENvQ,MAAMoQ,QAAQ,GAGnCR,MAAM1P,KAAK,mBAAmBD,KAAK+P,oBAG/BQ,eAAiBZ,MAAM1P,KAAK,mBAChCsQ,eAAe9P,YAAY,4CAC3B8P,eAAejQ,SAAS,iBACxBiQ,eAAetQ,KAAK,eAAeuK,KAAK,+BACxC+F,eAAetQ,KAAK,gBAAgBD,KAAK,oBAjDrC2P,MAAM1P,KAAK,mBAAmBD,KAAK,MAyD3C6G,WAAY,SAASxL,aACbwC,KAAO9B,KACPyU,OAASzU,KAAKX,UAAU6E,KAAK,0BAC7BwQ,WAAa1U,KAAKX,UAAU6E,KAAK,8BACjCyQ,YAAcvW,EAAE,+BAAiC4B,KAAKlB,SACtD8V,aAAexW,EAAE,oCAAsC4B,KAAKlB,YAGhE2V,OAAOjI,QACPkI,WAAWlI,aAGNjL,kBAAoB,GAEzBjC,QAAQqO,MAAM,EARA,GAQYvD,SAAQ,SAASxC,OAAQ8L,WAC3C5N,MAAQ,OAAShE,KAAKhD,QAAU,IAAM4U,MACtC3G,WAAanF,OAAOS,MAAQT,OAAOoF,OAASpF,OAAOqF,cAAgBrF,OAAOzF,MAAQ,SAGlF0S,IAAMzW,EAAEuW,YAAYlG,QACxBoG,IAAI3Q,KAAK,KACJxB,KAAK,OAAQ,IAAMoD,OACnBpD,KAAK,gBAAiBoD,OAC3B+O,IAAI3Q,KAAK,aAAaD,KAAK8I,YAEb,IAAV2G,OACAmB,IAAI3Q,KAAK,KAAKK,SAAS,UAAU7B,KAAK,gBAAiB,QAG3D+R,OAAOlI,OAAOsI,SAGVjP,KAAOxH,EAAEwW,aAAanG,QAC1B7I,KAAKlD,KAAK,KAAMoD,OAChBF,KAAKlD,KAAK,YAAakF,OAAOzF,MAC9ByD,KAAKlD,KAAK,cAAekF,OAAOvF,QAElB,IAAVqR,OACA9N,KAAKrB,SAAS,eAGlBmQ,WAAWnI,OAAO3G,SAIlBtG,QAAQoC,OAAS,EAAG,KAChBoT,UAAYJ,WAAWxQ,KAAK,aAAaI,aACxC3B,eAAemS,UAAWxV,QAAQ,GAAG6C,KAAM7C,QAAQ,GAAG+C,aAG1DhD,UAAU6E,KAAK,iCAAiCQ,YAAY,WAUrE/B,eAAgB,SAASiD,KAAMzD,KAAME,YAC7BP,KAAO9B,KACPiB,SAAWkB,KAAO,IAAME,UAC5BuD,KAAKxD,KAAK,UAAU,GAGhBpC,KAAKmB,gBAAgBF,eACjBgG,OAASjH,KAAKmB,gBAAgBF,eAC7B8T,iBAAiBnP,KAAMqB,OAAOW,OAAQX,OAAO4B,kBAKlDjB,OAAS5H,KAAKV,QAAQ4E,MAAK,SAAS2D,UAC7BA,EAAE1F,OAASA,YAGjByF,cACDhC,KAAK1B,KAAK,qBAAqBK,SAAS,eACxCqB,KAAK1B,KAAK,qBACLQ,YAAY,UACZ+J,KAAK,kIAKC,WAAXpM,OACAjE,EAAE0J,KAAK,CACHC,IAAKC,EAAEC,IAAIC,QAAU,oDACrBC,OAAQ,OACR/F,KAAM,CACFgG,SAAUR,OAAOS,MAAQT,OAAOU,mBAChCC,QAASP,EAAEC,IAAIM,SAEnBC,SAAU,OACVC,QAAS,MACVC,MAAK,SAASC,UACTA,SAASC,SACT9G,KAAKX,gBAAgBF,UAAY,CAC7B2G,OAAQA,OACRiB,QAASF,SAASE,SAAW,IAEjC/G,KAAKiT,iBAAiBnP,KAAMgC,OAAQe,SAASE,SAAW,MAExDjD,KAAK1B,KAAK,qBAAqBK,SAAS,UACxCqB,KAAK1B,KAAK,qBACLQ,YAAY,UACZ+J,KAAK,qGAAuG9F,SAASyG,SAAW,kBAAoB,kBAE9JnG,MAAK,WACJrD,KAAK1B,KAAK,qBAAqBK,SAAS,UACxCqB,KAAK1B,KAAK,qBACLQ,YAAY,UACZ+J,KAAK,sIAEX,KAECvF,MAAQlJ,KAAKb,SAAWgK,OAAOC,gBAAkBD,OAAOC,gBAAgBC,QAAU,UACjFH,aACDtD,KAAK1B,KAAK,qBAAqBK,SAAS,eACxCqB,KAAK1B,KAAK,qBACLQ,YAAY,UACZ+J,KAAK,sIAIdrQ,EAAE0J,KAAK,CACHC,IAAK,8DAAgE5F,KACrEgG,OAAQ,MACRmB,QAAS,eACY,UAAYJ,aACnB,oBAEdT,QAAS,OACVC,MAAK,SAASC,UACTA,SAASC,SACT9G,KAAKX,gBAAgBF,UAAY,CAC7B2G,OAAQe,SAASf,QAAUA,OAC3BiB,QAASF,SAASvG,MAAQ,IAE9BN,KAAKiT,iBAAiBnP,KAAM+C,SAASf,QAAUA,OAAQe,SAASvG,MAAQ,MAExEwD,KAAK1B,KAAK,qBAAqBK,SAAS,UACxCqB,KAAK1B,KAAK,qBACLQ,YAAY,UACZ+J,KAAK,wIAEfxF,MAAK,WACJrD,KAAK1B,KAAK,qBAAqBK,SAAS,UACxCqB,KAAK1B,KAAK,qBACLQ,YAAY,UACZ+J,KAAK,qIAYtBsG,iBAAkB,SAASnP,KAAMgC,OAAQxF,UACjC0D,MAAQF,KAAKlD,KAAK,MACtBkD,KAAK1B,KAAK,qBAAqBK,SAAS,cACpC8K,YAAczJ,KAAK1B,KAAK,wBAEvB9B,MAAwB,IAAhBA,KAAKV,YAOd4H,QAAUsC,OAAO4D,KAAKpN,KAAK,IAC3BqN,YAAczP,KAAK0P,qBAAqBtN,KAAMkH,SAG9CvD,MAAQ,CACR3D,KAAMA,KACNwF,OAAQA,OACR0B,QAASA,QACTmG,YAAaA,YACb5P,YAAa,QACbmG,UAAW,EACXE,YAAa,GACbC,UAAW,MACXE,MAAOiD,QAAQ,GACfhD,MAAOmJ,YAAY/N,OAAS,EAAI+N,YAAYA,YAAY/N,OAAS,GAAK4H,QAAQA,QAAQ5H,OAAS,SAE9FJ,cAAcwE,OAASC,MAG5BsJ,YAAY3K,YAAY,eAGnBsQ,iBAAiBpP,KAAMgC,OAAQxF,WAG/B6S,yBAAyBrP,KAAMG,YAG/BE,mBAAmBL,KAAMG,OAG9BH,KAAK1B,KAAK,wBAAwBQ,YAAY,UAC9CkB,KAAK1B,KAAK,2CAA2CK,SAAS,UAC9DqB,KAAK1B,KAAK,mBAAmBQ,YAAY,UACzCkB,KAAK1B,KAAK,mBAAmBK,SAAS,eAxClC8K,YAAY3K,YAAY,UACnB+J,KAAK,oHAiDlBuG,iBAAkB,SAASpP,KAAMgC,OAAQxF,UAEjCuJ,SAAW/D,OAAO+D,UAAY/D,OAAOsN,eAAiB,GACtDC,cAAgBvP,KAAK1B,KAAK,oBAC1ByH,UACAwJ,cAAclR,KAAK0H,UAAUjH,YAAY,UAErCkD,OAAOwN,eACPD,cAActG,IAAI,mBAAoBjH,OAAOwN,gBAE7CD,cAAc5Q,SAAS,eAG3B4Q,cAAc5Q,SAAS,UAI3BqB,KAAK1B,KAAK,kBAAkBD,KAAK7B,KAAKV,YAGlC2T,QAAUzN,OAAO0N,YAAc1N,OAAO2N,YAAc,MACpDF,QAAS,KACLG,KAAO,IAAI1O,KAAKuO,SACpBzP,KAAK1B,KAAK,gBAAgBD,KAAKuR,KAAKC,wBAU5CR,yBAA0B,SAASrP,KAAMG,WACjC4J,YAAc/J,KAAK1B,KAAK,qBACxB0L,YAAchK,KAAK1B,KAAK,qBAE5ByL,YAAYnD,QACZoD,YAAYpD,QAEZzG,MAAMuD,QAAQc,SAAQ,SAASsL,YACvB5F,UAAY4F,OAAO3F,QAAQ,KAAM,KAAKA,QAAQ,SAAS,SAASC,UAAYA,EAAEC,iBAClFN,YAAYpD,OAAOnO,EAAE,YAAY4E,IAAI0S,QAAQzR,KAAK6L,YAClDF,YAAYrD,OAAOnO,EAAE,YAAY4E,IAAI0S,QAAQzR,KAAK6L,eAItDH,YAAY3M,IAAI+C,MAAMM,OACtBuJ,YAAY5M,IAAI+C,MAAMO,QAS1BT,cAAe,SAASD,KAAMV,UACtBY,MAAQF,KAAKlD,KAAK,MAClBqD,MAAQ/F,KAAKsB,cAAcwE,OAC1BC,QAELA,MAAMlG,YAAcqF,KAGpBU,KAAK1B,KAAK,wBAAwBQ,YAAY,UAC9CkB,KAAK1B,KAAK,mCAAqCgB,KAAO,MAAMX,SAAS,UAGxD,UAATW,MACAU,KAAK1B,KAAK,mBAAmBQ,YAAY,UACzCkB,KAAK1B,KAAK,mBAAmBK,SAAS,YAEtCqB,KAAK1B,KAAK,mBAAmBK,SAAS,UACtCqB,KAAK1B,KAAK,mBAAmBQ,YAAY,eAEpC0B,eAAeR,KAAMG,UAUlCE,mBAAoB,SAASL,KAAMG,WAC3BmK,MAAQtK,KAAK1B,KAAK,cAClBiM,MAAQD,MAAMhM,KAAK,SACnBkM,MAAQF,MAAMhM,KAAK,SACnB9B,KAAO2D,MAAM3D,KACbkH,QAAUvD,MAAMuD,QAEpB6G,MAAM3D,QACN4D,MAAM5D,YAGF6D,UAAYjS,EAAE,QAClBkL,QAAQc,SAAQ,SAASyF,OACjBC,UAAYD,EAAEE,QAAQ,KAAM,KAAKA,QAAQ,SAAS,SAASC,UAAYA,EAAEC,iBAC7EI,UAAU9D,OAAOnO,EAAE,QAAQ6F,KAAK6L,eAEpCK,MAAM5D,OAAO8D,eAGTsF,UAAYvT,KAAKV,OACjB4D,WAAaC,KAAKC,KAAKmQ,UAAY5P,MAAMG,aACzCoI,YAAcvI,MAAMC,UAAY,GAAKD,MAAMG,YAC3CqI,SAAWhJ,KAAK+K,IAAIhC,WAAavI,MAAMG,YAAayP,WACzCvT,KAAKuL,MAAMW,WAAYC,UAG7BnE,SAAQ,SAASmG,SAClBC,GAAKpS,EAAE,QACXkL,QAAQc,SAAQ,SAASyF,OACjB7M,IAAMuN,IAAIV,GACV7M,MAAAA,MAAmCA,IAAM,QACzCyN,WAAaC,OAAO1N,KACpByN,WAAW/O,OAAS,KACpB+O,WAAaA,WAAWE,UAAU,EAAG,IAAM,OAE/CH,GAAGjE,OAAOnO,EAAE,QAAQsE,KAAK,QAASM,KAAKiB,KAAKwM,gBAEhDL,MAAM7D,OAAOiE,WAIboF,YAAc,YAActH,WAAa,GAAK,IAAMC,SAAW,OAASoH,UAC5E/P,KAAK1B,KAAK,cAAcD,KAAK2R,aAC7BhQ,KAAK1B,KAAK,wBAAwBD,KAAK,QAAU8B,MAAMC,UAAY,OAASV,YAG5EM,KAAK1B,KAAK,wBAAwBmJ,KAAK,WAAYtH,MAAMC,WAAa,GACtEJ,KAAK1B,KAAK,wBAAwBmJ,KAAK,WAAYtH,MAAMC,WAAaV,YAGlEA,WAAa,EACbM,KAAK1B,KAAK,yBAAyBQ,YAAY,UAE/CkB,KAAK1B,KAAK,yBAAyBK,SAAS,WAUpD6B,eAAgB,SAASR,KAAMG,WACvBD,MAAQF,KAAKlD,KAAK,MAClBkO,OAAShL,KAAK1B,KAAK,cAAc,MAEhC0M,QAAW7K,MAAM3D,MAA8B,IAAtB2D,MAAM3D,KAAKV,QAKrC1B,KAAKuB,mBAAqBvB,KAAKuB,kBAAkBuE,aAC5CvE,kBAAkBuE,OAAO+K,cAG9B1K,UAAYJ,MAAMI,UAClBE,MAAQN,MAAMM,MACdC,MAAQP,MAAMO,MACdlE,KAAO2D,MAAM3D,KAGb0G,UAAY1G,KAAKuL,MAAM,EAAG,IAC1BmD,OAAShI,UAAUiI,KAAI,SAASR,SAC5BS,MAAQT,IAAIlK,UACZ2K,MAAAA,MAAuC,MAAO,cAC9CC,SAAWP,OAAOM,cACfC,SAASvP,OAAS,GAAKuP,SAASN,UAAU,EAAG,IAAM,MAAQM,YAElEpF,OAAS/C,UAAUiI,KAAI,SAASR,YACzBW,WAAWX,IAAIjK,SAAW,KAGjC6K,OAASnR,KAAKoR,oBAAoBvF,OAAOnK,OAAQyE,WAGjDjH,OAAS,CACTuS,KAAMtL,UACN/D,KAAM,CACF0O,OAAQA,OACRY,SAAU,CAAC,CACPV,MAPS1K,MAAMyJ,QAAQ,KAAM,KAAKA,QAAQ,SAAS,SAASC,UAAYA,EAAEC,iBAQ1E7N,KAAMyJ,OACNyF,gBAA+B,QAAdnL,WAAqC,aAAdA,UAA2BgL,OAASA,OAAO,GACnFK,YAA2B,SAAdrL,UAAuBgL,OAAO,GAAoB,QAAdhL,WAAqC,aAAdA,UAA2B,OAASgL,OAAO,GACnHI,YAA2B,QAAdpL,WAAqC,aAAdA,UAA2B,EAAI,EACnE0P,KAAoB,SAAd1P,gBAA+B2P,EACrCC,QAAuB,SAAd5P,UAAuB,QAAM2P,KAG9CjX,QAAS,CACL8S,YAAY,EACZC,qBAAqB,EACrBC,QAAS,CACLC,OAAQ,CACJC,QAAuB,QAAd5L,WAAqC,aAAdA,UAChC6L,SAAU,UAGlBC,OAAsB,QAAd9L,WAAqC,aAAdA,UAA2B,GAAK,CAC3D+L,EAAG,CAAEC,aAAa,GAClBC,EAAG,CAAEL,QAAS3P,KAAKV,QAAU,gBAMhCH,kBAAoBvB,KAAKuB,mBAAqB,QAC9CA,kBAAkBuE,OAAS,IAAInH,MAAMiS,OAAOyB,WAAW,MAAOnT,QACrE,MAAOoT,OACL1M,KAAK1B,KAAK,wBAAwBuK,KAC9B,yHAWZlI,gBAAiB,SAASR,MAAOnD,WACxBmD,OAAUA,MAAM3D,MAA8B,IAAtB2D,MAAM3D,KAAKV,QAIzB,QAAXkB,OAAkB,KACd0G,QAAUvD,MAAMuD,QAChB0M,QAAU,GAGdA,QAAQrM,KAAKL,QAAQyH,KAAI,SAASlB,SACvB,IAAMA,EAAEE,QAAQ,KAAM,MAAQ,OACtCyC,KAAK,MAGRzM,MAAM3D,KAAKgI,SAAQ,SAASmG,SACpB0F,QAAU3M,QAAQyH,KAAI,SAASlB,OAC3B7M,IAAMuN,IAAIV,UACV7M,MAAAA,MAAmCA,IAAM,IACtC,IAAM0N,OAAO1N,KAAK+M,QAAQ,KAAM,MAAQ,OAEnDiG,QAAQrM,KAAKsM,QAAQzD,KAAK,aAG1BD,WAAayD,QAAQxD,KAAK,MAC1BI,KAAO,IAAIC,KAAK,CAACN,YAAa,CAAEd,KAAM,4BACtC1J,IAAMkL,IAAIC,gBAAgBN,MAC1BE,KAAO9N,SAAS+N,cAAc,KAC9BhG,WAAahH,MAAM6B,OAAOS,MAAQtC,MAAM6B,OAAOzF,MAAQ,SAC3D2Q,KAAKE,KAAOjL,IACZ+K,KAAKK,SAAWpG,WAAWgD,QAAQ,cAAe,KAAO,OACzD/K,SAASkR,KAAKC,YAAYrD,MAC1BA,KAAKO,QACLrO,SAASkR,KAAKE,YAAYtD,MAC1BG,IAAIoD,gBAAgBtO,OAU5BuO,eAAgB,SAAS1Q,KAAMxD,UACvB8N,MAAQtK,KAAK1B,KAAK,SAClBiM,MAAQD,MAAMhM,KAAK,SACnBkM,MAAQF,MAAMhM,KAAK,SACnBqS,QAAUvW,KAAKd,OAAOsX,cAAgB,MAE1CrG,MAAM3D,QACN4D,MAAM5D,QAEDpK,MAAwB,IAAhBA,KAAKV,YAId4H,QAAUsC,OAAO4D,KAAKpN,KAAK,IAC3BiO,UAAYjS,EAAE,QAClBkL,QAAQc,SAAQ,SAASyF,OACjBC,UAAYD,EAAEE,QAAQ,KAAM,KAAKA,QAAQ,SAAS,SAASC,UAAYA,EAAEC,iBAC7EI,UAAU9D,OAAOnO,EAAE,QAAQ6F,KAAK6L,eAEpCK,MAAM5D,OAAO8D,WAEbjO,KAAKuL,MAAM,EAAG4I,SAASnM,SAAQ,SAASmG,SAChCC,GAAKpS,EAAE,QACXkL,QAAQc,SAAQ,SAASyF,OACjB7M,IAAMuN,IAAIV,GACV7M,MAAAA,MAAmCA,IAAM,QACzCyN,WAAaC,OAAO1N,KACpByN,WAAW/O,OAAS,KACpB+O,WAAaA,WAAWE,UAAU,EAAG,IAAM,OAE/CH,GAAGjE,OAAOnO,EAAE,QAAQsE,KAAK,QAASM,KAAKiB,KAAKwM,gBAEhDL,MAAM7D,OAAOiE,SAUrBlO,kBAAmB,SAASH,KAAME,eACjBrC,KAAKd,OAAOuX,aAAe,aAG/B,aACIC,gBAAgBvU,KAAME,kBAE1B,cACIsU,iBAAiBxU,KAAME,kBAE3B,cACIuU,mBAAmBzU,KAAME,UAW1CqU,gBAAiB,SAASvU,KAAME,YACxBP,KAAO9B,KAGP4H,OAAS5H,KAAKV,QAAQ4E,MAAK,SAAS2D,UAC7BA,EAAE1F,OAASA,QAGjByF,cAKAlI,UAAY,UACZC,YAAc,UACdE,YAAc,QACfG,KAAKJ,qBACAA,cAAciR,eACdjR,cAAgB,MAIzBlB,UAAUmY,OAAO,sCAAuC,CAAC9X,QAASiB,KAAKlB,UAClEiL,MAAK,SAAS0E,aACJjQ,aAAasY,OAAO,CACvBrF,KAAMjT,aAAauY,MAAMC,QACzBhK,MAAOpF,OAAOS,KACd6N,KAAMzH,KACNwI,OAAO,OAGdlN,MAAK,SAAStK,cACXqC,KAAKrC,MAAQA,MAGbqC,KAAKoV,gBAAgBzX,OAGrBA,MAAM0X,UAAUpV,GAAGtD,YAAY2Y,OAAO,WAClCtV,KAAKuV,gBAAgBlV,KAAME,WAI/B5C,MAAM0X,UAAUpV,GAAGtD,YAAY6Y,QAAQ,WAC/BxV,KAAKlC,gBACLkC,KAAKlC,cAAciR,UACnB/O,KAAKlC,cAAgB,MAEzBH,MAAMoR,UACN/O,KAAKrC,MAAQ,KACbqC,KAAKpC,UAAY,KACjBoC,KAAKnC,YAAc,QAGvBF,MAAM8X,OACC9X,SACR+X,MAAMlZ,aAAamZ,aAQ9BP,gBAAiB,SAASzX,WAClBqC,KAAO9B,KACP0X,UAAYjY,MAAM0X,UAGtBO,UAAU3V,GAAG,QAAS,oBAAoB,SAASC,GAC/CA,EAAEC,qBACEiD,KAAO9G,EAAE4B,MAAMoC,KAAK,QACxBN,KAAK6V,gBAAgBzS,SAIzBwS,UAAU3V,GAAG,SAAU,+DAA+D,WACzD,UAArBD,KAAKjC,aACLiC,KAAK8V,sBAKbF,UAAU3V,GAAG,QAAS,gBAAgB,SAASC,GAC3CA,EAAEC,iBACEH,KAAKnC,aACLmC,KAAKuV,gBAAgBvV,KAAKnC,YAAYwC,KAAML,KAAKnC,YAAY0C,WAKrEqV,UAAU3V,GAAG,QAAS,oCAAoC,SAASC,GAC/DA,EAAEC,iBACFH,KAAK+V,gBAAgB,UAIzBH,UAAU3V,GAAG,QAAS,0BAA0B,SAASC,GACrDA,EAAEC,iBACEH,KAAK3B,iBAAmB,IACxB2B,KAAK3B,mBACL2B,KAAKgW,2BAKbJ,UAAU3V,GAAG,QAAS,0BAA0B,SAASC,GACrDA,EAAEC,iBACEH,KAAK3B,iBAAmB2B,KAAKzB,kBAC7ByB,KAAK3B,mBACL2B,KAAKgW,4BAUjBH,gBAAiB,SAASzS,UAClB6S,UAAY/X,KAAKP,MAAMuY,UAG3BD,UAAU7T,KAAK,oBAAoBQ,YAAY,UAC/CqT,UAAU7T,KAAK,+BAAiCgB,KAAO,MAAMX,SAAS,UAGzD,UAATW,MACA6S,UAAU7T,KAAK,qBAAqBQ,YAAY,UAChDqT,UAAU7T,KAAK,qBAAqBK,SAAS,YAE7CwT,UAAU7T,KAAK,qBAAqBK,SAAS,UAC7CwT,UAAU7T,KAAK,qBAAqBQ,YAAY,eAE3CkT,yBAGJ/X,YAAcqF,MASvBmS,gBAAiB,SAASlV,KAAME,YACxBP,KAAO9B,KACP+X,UAAY/X,KAAKP,MAAMuY,UACvB/W,SAAWkB,KAAO,IAAME,UAGxBrC,KAAKmB,gBAAgBF,UAAW,KAC5BgG,OAASjH,KAAKmB,gBAAgBF,iBAClC8W,UAAU7T,KAAK,kBAAkBK,SAAS,oBACrC0T,mBAAmBF,UAAW9Q,OAAOW,OAAQX,OAAO4B,QAAS5B,OAAO6B,UAAW7B,OAAOd,eAK3FyB,OAAS5H,KAAKV,QAAQ4E,MAAK,SAAS2D,UAC7BA,EAAE1F,OAASA,YAGjByF,cACDmQ,UAAU7T,KAAK,kBAAkBK,SAAS,eAC1CwT,UAAU7T,KAAK,gBAAgBQ,YAAY,aAMhC,WAAXrC,OAEAjE,EAAE0J,KAAK,CACHC,IAAKC,EAAEC,IAAIC,QAAU,oDACrBC,OAAQ,OACR/F,KAAM,CACFgG,SAAUR,OAAOS,MAAQT,OAAOU,mBAChCC,QAASP,EAAEC,IAAIM,SAEnBC,SAAU,OACVC,QAAS,MACVC,MAAK,SAASC,UACboP,UAAU7T,KAAK,kBAAkBK,SAAS,UAEtCoE,SAASC,SAET9G,KAAKX,gBAAgBF,UAAY,CAC7B2G,OAAQA,OACRiB,QAASF,SAASE,SAAW,GAC7BC,UAAWH,SAASI,WACpB5C,UAAWwC,SAASK,YAExBlH,KAAKmW,mBAAmBF,UAAWnQ,OAAQe,SAASE,SAAW,GAAIF,SAASI,WAAYJ,SAASK,cAEjG+O,UAAU7T,KAAK,gBAAgBQ,YAAY,UAC3CqT,UAAU7T,KAAK,kBAAkBD,KAAK0E,SAASyG,SAAW,6BAE/DnG,MAAK,WACJ8O,UAAU7T,KAAK,kBAAkBK,SAAS,UAC1CwT,UAAU7T,KAAK,gBAAgBQ,YAAY,iBAE5C,KAECwE,MAAQlJ,KAAKb,SAAWgK,OAAOC,gBAAkBD,OAAOC,gBAAgBC,QAAU,UAEjFH,aACD6O,UAAU7T,KAAK,kBAAkBK,SAAS,eAC1CwT,UAAU7T,KAAK,gBAAgBQ,YAAY,UAI/CtG,EAAE0J,KAAK,CACHC,IAAK,8DAAgE5F,KACrEgG,OAAQ,MACRmB,QAAS,eACY,UAAYJ,aACnB,oBAEdT,QAAS,OACVC,MAAK,SAASC,UACboP,UAAU7T,KAAK,kBAAkBK,SAAS,UAEtCoE,SAASC,SAAWD,SAASf,QAE7B9F,KAAKX,gBAAgBF,UAAY,CAC7B2G,OAAQe,SAASf,OACjBiB,QAASF,SAASvG,MAAQ,GAC1B0G,UAAW,KACX3C,UAAW,MAEfrE,KAAKmW,mBAAmBF,UAAWpP,SAASf,OAAQe,SAASvG,MAAQ,GAAI,KAAM,OAE/E2V,UAAU7T,KAAK,gBAAgBQ,YAAY,aAEhDuE,MAAK,WACJ8O,UAAU7T,KAAK,kBAAkBK,SAAS,UAC1CwT,UAAU7T,KAAK,gBAAgBQ,YAAY,eAcvDuT,mBAAoB,SAASF,UAAWnQ,OAAQxF,KAAM0G,UAAW3C,gBAIxDzG,UAAY0C,MAAQ,QACpBzC,YAAciI,OAEDmQ,UAAU7T,KAAK,uBACrBQ,YAAY,cAGpBiH,SAAW/D,OAAO6D,eAAiB,CAACpD,KAAM,UAAWqD,MAAO,cAChEqM,UAAU7T,KAAK,oBACVD,KAAK0H,SAAStD,MACdwG,IAAI,mBAAoBlD,SAASD,OACtCqM,UAAU7T,KAAK,kBAAkBD,KAAKjE,KAAKN,UAAUgC,QACrDqW,UAAU7T,KAAK,gBACVD,KAAK2D,OAAOsQ,iBAAmB,aAAe,IAAIpR,KAAKc,OAAOsQ,kBAAkBzC,qBAAuB,SAGvG0C,sBAAsBJ,gBAGtBK,iBAAiBL,UAAW/X,KAAKN,WAGlCM,KAAKZ,QAAS,KACViZ,UAAYrQ,EAAEC,IAAIC,QAAU,uDAAyDoQ,mBAAmB1Q,OAAOzF,MACnH4V,UAAU7T,KAAK,qBAAqBxB,KAAK,OAAQ2V,WACjDN,UAAU7T,KAAK,sBAAsBQ,YAAY,eAEjDqT,UAAU7T,KAAK,sBAAsBK,SAAS,eAI7C1E,YAAc,QACnBkY,UAAU7T,KAAK,oBAAoBQ,YAAY,UAC/CqT,UAAU7T,KAAK,uCAAuCK,SAAS,UAC/DwT,UAAU7T,KAAK,qBAAqBQ,YAAY,UAChDqT,UAAU7T,KAAK,qBAAqBK,SAAS,WAQjD4T,sBAAuB,SAASJ,eACxB3V,KAAOpC,KAAKN,aACX0C,MAAwB,IAAhBA,KAAKV,YAId4H,QAAUsC,OAAO4D,KAAKpN,KAAK,IAC3BuN,YAAcoI,UAAU7T,KAAK,uBAC7B0L,YAAcmI,UAAU7T,KAAK,uBAGjCyL,YAAYnD,QACZoD,YAAYpD,YAGRiD,YAAczP,KAAK0P,qBAAqBtN,KAAMkH,SAGlDA,QAAQc,SAAQ,SAASsL,OAAQ6C,SACzBC,gBAAkB9C,OAAO3F,QAAQ,KAAM,KAAKA,QAAQ,SAAS,SAASC,UAAYA,EAAEC,iBACpF3D,SAAmB,IAARiM,IAAY,YAAc,GACzC5I,YAAYpD,OAAO,kBAAoBmJ,OAAS,IAAMpJ,SAAW,IAAMkM,gBAAkB,oBAIzFC,aAAehJ,YAAY/N,OAAS,EAAI+N,YAAcnG,QAC1DmP,aAAarO,SAAQ,SAASsO,IAAKH,SAC3BC,gBAAkBE,IAAI3I,QAAQ,KAAM,KAAKA,QAAQ,SAAS,SAASC,UAAYA,EAAEC,iBAEjF3D,SAAWiM,MAAQE,aAAa/W,OAAS,EAAI,YAAc,GAC/DkO,YAAYrD,OAAO,kBAAoBmM,IAAM,IAAMpM,SAAW,IAAMkM,gBAAkB,kBAW9F9I,qBAAsB,SAAStN,KAAMkH,aAC7BmG,YAAc,UAElBnG,QAAQc,SAAQ,SAASsL,YACjBiD,UAAYvW,KAAKwW,OAAM,SAASrI,SAC5BvN,IAAMuN,IAAImF,eACV1S,MAAAA,KAA6C,KAARA,MAGjC6V,MAAM3H,WAAWlO,OAAS8V,SAAS9V,QAI3C+V,WAAa3W,KAAK4W,MAAK,SAASzI,SAC5BvN,IAAMuN,IAAImF,eACP1S,MAAAA,KAA6C,KAARA,MAAe6V,MAAM3H,WAAWlO,SAG5E2V,WAAaI,YACbtJ,YAAY9F,KAAK+L,WAIlBjG,aAMXmI,iBAAkB,eAEVG,UAAY/X,KAAKP,MAAMuY,UACvB5V,KAAOpC,KAAKN,aAEX0C,MAAwB,IAAhBA,KAAKV,YAOdkP,OAASmH,UAAU7T,KAAK,gBAAgB,MACvC0M,QAKD5Q,KAAKJ,qBACAA,cAAciR,eACdjR,cAAgB,UAIrBuG,UAAY4R,UAAU7T,KAAK,qBAAqBlB,OAAS,MACzDiW,SAAWlB,UAAU7T,KAAK,uBAAuBlB,MACjDkW,SAAWnB,UAAU7T,KAAK,uBAAuBlB,UAGhDiW,WAAaC,SAAU,KACpB5P,QAAUsC,OAAO4D,KAAKpN,KAAK,IAC/B6W,SAAWA,UAAY3P,QAAQ,GAC/B4P,SAAWA,UAAY5P,QAAQA,QAAQ5H,OAAS,OAIhDyX,kBAAoBD,SAASnJ,QAAQ,KAAM,KAAKA,QAAQ,SAAS,SAASC,UAAYA,EAAEC,iBAGxFnH,UAAY1G,KAAKuL,MAAM,EAAG,IAC1BmD,OAAShI,UAAUiI,KAAI,SAASR,SAC5BS,MAAQT,IAAI0I,aACZjI,MAAAA,MAAuC,MAAO,cAC9CC,SAAWP,OAAOM,cACfC,SAASvP,OAAS,GAAKuP,SAASN,UAAU,EAAG,IAAM,MAAQM,YAElEpF,OAAS/C,UAAUiI,KAAI,SAASR,YACzBW,WAAWX,IAAI2I,YAAc,KAIpC/H,OAASnR,KAAKoR,oBAAoBvF,OAAOnK,OAAQyE,WAGjDjH,OAASc,KAAKoZ,kBAAkBjT,UAAW2K,OAAQjF,OAAQsN,kBAAmBhI,iBAGzEvR,cAAgB,IAAIjB,MAAMiS,OAAOyB,WAAW,MAAOnT,QAC1D,MAAOoT,OACLyF,UAAU7T,KAAK,oBAAoBuK,KAC/B,iHAtDJsJ,UAAU7T,KAAK,oBAAoBuK,KAC/B,qHAoEZ2K,kBAAmB,SAASjT,UAAW2K,OAAQjF,OAAQqN,SAAU/H,YAGzDkI,YAAc,CACd1H,YAAY,EACZC,qBAAqB,EACrBC,QAAS,CACL7E,MAAO,CACH+E,SAAS,EACT9N,KARKjE,KAAKL,YAAcK,KAAKL,YAAY0I,KAAO,SAShDiR,KAAM,CAAEC,KAAM,GAAIC,OAAQ,QAC1BC,QAAS,CAAEC,IAAK,GAAIC,OAAQ,KAEhC7H,OAAQ,CACJC,QAAuB,QAAd5L,WAAqC,aAAdA,UAChC6L,SAAU,iBAKJ,QAAd7L,WAAqC,aAAdA,UAChB,CACHsL,KAAMtL,UACN/D,KAAM,CACF0O,OAAQA,OACRY,SAAU,CAAC,CACPtP,KAAMyJ,OACNyF,gBAAiBH,OACjBI,YAAa,KAGrB1S,QAASwa,cAIbA,YAAYpH,OAAS,CACjBC,EAAG,CACCC,aAAa,EACbnF,MAAO,CACH+E,SAAS,EACT9N,KAAMiV,WAGd9G,EAAG,CACCpF,MAAO,CACH+E,SAAS,KAKd,CACHN,KAAMtL,UACN/D,KAAM,CACF0O,OAAQA,OACRY,SAAU,CAAC,CACPV,MAAOkI,SACP9W,KAAMyJ,OACNyF,gBAA+B,SAAdnL,UAAuB,cAAgBgL,OAAO,GAC/DK,YAAaL,OAAO,GAAGpB,QAAQ,MAAO,KACtCwB,YAAa,EACbsE,KAAoB,SAAd1P,UACN4P,QAAS,MAGjBlX,QAASwa,eAYrBjI,oBAAqB,SAASwI,MAAOzT,mBAC7B0T,WAAa,CACb,yBACA,0BACA,0BACA,yBACA,0BACA,yBACA,0BACA,0BACA,0BACA,2BAGA1I,OAAS,GACJlH,EAAI,EAAGA,EAAI2P,MAAO3P,IACvBkH,OAAOxH,KAAKkQ,WAAW5P,EAAI4P,WAAWnY,gBAEnCyP,QAQX0G,gBAAiB,SAASjV,YAClBR,KAAOpC,KAAKN,UACZkI,OAAS5H,KAAKL,eAEbyC,MAAwB,IAAhBA,KAAKV,WAQH,QAAXkB,OAAkB,KACd0G,QAAUsC,OAAO4D,KAAKpN,KAAK,IAC3BmQ,WAAajJ,QAAQkJ,KAAK,KAAO,KAErCpQ,KAAKgI,SAAQ,SAASmG,SACd1E,OAASvC,QAAQyH,KAAI,SAASlB,OAC1B7M,IAAMuN,IAAIV,UACV7M,MAAAA,MAAmCA,IAAM,KAGnB,KAD1BA,IAAM0N,OAAO1N,KAAK+M,QAAQ,KAAM,OACxBjC,QAAQ,OAAqC,IAAtB9K,IAAI8K,QAAQ,OAAsC,IAAvB9K,IAAI8K,QAAQ,QAClE9K,IAAM,IAAMA,IAAM,KAEfA,OAEXuP,YAAc1G,OAAO2G,KAAK,KAAO,YAIjCI,KAAO,IAAIC,KAAK,CAACN,YAAa,CAACd,KAAM,4BACrCqB,KAAO9N,SAAS+N,cAAc,KAClCD,KAAKE,KAAOC,IAAIC,gBAAgBN,MAChCE,KAAKK,UAAYvL,OAASA,OAAOS,KAAK0H,QAAQ,cAAe,KAAO,UAAY,OAChF+C,KAAKO,cA9BL/U,aAAawb,gBAAgB,CACzB1K,QAAS,oBACTqC,KAAM,aAsClB2G,iBAAkB,SAASL,UAAW3V,WAE7BjC,iBAAmB,OACnBE,gBAAkBkF,KAAKC,MAAMpD,KAAOA,KAAKV,OAAS,GAAK1B,KAAKI,sBAI7D+P,MADQ4H,UAAU7T,KAAK,gBACTA,KAAK,YAEvBiM,MAAM3D,QAEDpK,MAAwB,IAAhBA,KAAKV,YAMd4H,QAAUsC,OAAO4D,KAAKpN,KAAK,IAC3BiO,UAAYjS,EAAE,QAClBkL,QAAQc,SAAQ,SAASyF,OAEjBC,UAAYD,EAAEE,QAAQ,KAAM,KAAKA,QAAQ,SAAS,SAASC,UAAYA,EAAEC,iBAC7EI,UAAU9D,OAAOnO,EAAE,QAAQ6F,KAAK6L,eAEpCK,MAAM5D,OAAO8D,gBAGRyH,4BAfDC,UAAU7T,KAAK,0BAA0BK,SAAS,WAqB1DuT,qBAAsB,eACdC,UAAY/X,KAAKP,MAAMuY,UACvB5V,KAAOpC,KAAKN,WAAa,GAEzB0Q,MADQ2H,UAAU7T,KAAK,gBACTA,KAAK,YAEvBkM,MAAM5D,QAEDpK,MAAwB,IAAhBA,KAAKV,YAId4H,QAAUsC,OAAO4D,KAAKpN,KAAK,IAG3BkM,YAActO,KAAKG,iBAAmB,GAAKH,KAAKI,iBAChDmO,SAAWD,WAAatO,KAAKI,iBAClBgC,KAAKuL,MAAMW,WAAYC,UAG7BnE,SAAQ,SAASmG,SAClBC,GAAKpS,EAAE,QACXkL,QAAQc,SAAQ,SAASyF,OACjB7M,IAAMuN,IAAIV,GACV7M,MAAAA,MAAmCA,IAAM,QAEzCyN,WAAaC,OAAO1N,KACpByN,WAAW/O,OAAS,MACpB+O,WAAaA,WAAWE,UAAU,EAAG,KAAO,OAEhDH,GAAGjE,OAAOnO,EAAE,QAAQsE,KAAK,QAASM,KAAKiB,KAAKwM,gBAEhDL,MAAM7D,OAAOiE,WAIb1B,UAAYvJ,KAAK+K,IAAI/B,SAAUnM,KAAKV,QACxCqW,UAAU7T,KAAK,cAAcD,KAAK7B,KAAKV,OAAS,eAE3BqW,UAAU7T,KAAK,0BACrBD,KAAMqK,WAAa,EAAK,IAAMQ,UAAY,OAAS1M,KAAKV,QAGvEqW,UAAU7T,KAAK,0BAA0BmJ,KAAK,WAAYrN,KAAKG,kBAAoB,GACnF4X,UAAU7T,KAAK,0BAA0BmJ,KAAK,WAAYrN,KAAKG,kBAAoBH,KAAKK,iBAGpFL,KAAKK,gBAAkB,EACvB0X,UAAU7T,KAAK,qBAAqBQ,YAAY,UAEhDqT,UAAU7T,KAAK,qBAAqBK,SAAS,YAUrDoS,iBAAkB,SAASxU,KAAME,YACzB0F,IAAMC,EAAEC,IAAIC,QAAU,uDAAyDoQ,mBAAmBnW,MACtGgH,OAAO4Q,KAAKhS,IAAK,WASrB6O,mBAAoB,SAASzU,KAAME,UASnCQ,aAAc,SAASD,QAEnBtE,aAAawb,gBAAgB,CACzB1K,QAAS,aAAexM,OAAOqN,cAAgB,eAC/CwB,KAAM,UAOdvP,QAAS,eACD8X,WAAaha,KAAKX,UAAU6E,KAAK,4BACrC8V,WAAWzV,SAAS,gBAGf0V,sBAGAtT,kBACD7E,KAAO9B,UACN+G,aAAY,WACbjF,KAAKkF,kBAGTP,YAAW,WACPuT,WAAWtV,YAAY,aACxB,MAMPuV,eAAgB,eAGR/S,eAAeM,WAAWxH,KAAKiB,UACjC,MAAOe,SAIJb,gBAAkB,IAM3BU,iBAAkB,eACVqY,SAAWla,KAAKd,OAAOib,eACtBD,UAAyB,UAAbA,cAIbE,UACIF,cACC,KACDE,GAAK,cAEJ,MACDA,GAAK,cAEJ,MACDA,GAAK,eAEJ,KACDA,GAAK,8BAMTtY,KAAO9B,UACNR,aAAe6a,aAAY,WAEvBrV,SAASsS,QACVxV,KAAKI,YAEVkY,MAMPzT,YAAa,gBACJtH,UAAU6E,KAAK,0BAA0BQ,YAAY,eACrDrF,UAAU6E,KAAK,8GAA8GK,SAAS,eACtIlF,UAAU6E,KAAK,8CAA8CK,SAAS,WAM/EyG,YAAa,gBACJ3L,UAAU6E,KAAK,0BAA0BK,SAAS,WAM3D2G,UAAW,gBACFF,mBACA3L,UAAU6E,KAAK,wBAAwBQ,YAAY,WAQ5D8E,UAAW,SAAS4F,cACXpE,mBACA3L,UAAU6E,KAAK,wBAAwBQ,YAAY,WAM5DuG,gBAAiB,cACRjL,KAAKd,OAAOob,eAAkBta,KAAKT,iBAIpCgb,YAAcva,KAAKX,UAAU6E,KAAK,4BAClCD,KAAOjE,KAAKwa,cAAcxa,KAAKT,aAEnCgb,YAAYrW,KAAK,mBAAmBD,KAAKA,MACzCsW,YAAY7V,YAAY,YAM5B3B,gBAAiB,eACToL,cAAgBnO,KAAKX,UAAU6E,KAAK,8BACpCiK,cAAczM,QACdyM,cAAc,GAAGsM,eAAe,CAACC,SAAU,SAAUC,MAAO,WAOpEtV,yBAA0B,eAClBuV,eAAiB5a,KAAKX,UAAU6E,KAAK,wBACrC0W,eAAelZ,QACfkZ,eAAe,GAAGH,eAAe,CAACC,SAAU,SAAUC,MAAO,WAOrEzL,2BAA4B,eACpB2L,QAAU7a,KAAKX,UAAU6E,KAAK,6BACpBlE,KAAKX,UAAU6E,KAAK,0BAG1BQ,YAAY,UAGpBmW,QAAQnW,YAAY,UAAUmK,IAAI,UAAW,GAAGiM,QAAQ,CAACC,QAAS,GAAI,MAM1E5L,2BAA4B,WACVnP,KAAKX,UAAU6E,KAAK,6BAC1B4W,QAAQ,CAACC,QAAS,GAAI,KAAK,WAC/B3c,EAAE4B,MAAMuE,SAAS,cASzBZ,yBAA0B,SAASF,UAC3BA,SAASuX,SAAS,aACbjW,wBAAwBtB,eAExBwX,uBAAuBxX,WASpCwX,uBAAwB,SAASxX,cAEzB3B,KAAO9B,UACNX,UAAU6E,KAAK,6BAA6Be,MAAK,WAC7C7G,EAAE4B,MAAMkb,GAAGzX,WACZ3B,KAAKiD,wBAAwB3G,EAAE4B,UAIvCyD,SAASc,SAAS,QAClBd,SAASS,KAAK,+BAA+BxB,KAAK,gBAAiB,YAG/DyY,MAAQ1X,SAASS,KAAK,8BAC1BiX,MAAMnY,IAAI,IACVS,SAASS,KAAK,6BAA6BqT,OAAO7S,YAAY,WAC9DjB,SAASS,KAAK,8BAA8BK,SAAS,UAGrDkC,YAAW,WACP0U,MAAMC,UACP,KAQPrW,wBAAyB,SAAStB,UAC9BA,SAASiB,YAAY,QACrBjB,SAASS,KAAK,+BAA+BxB,KAAK,gBAAiB,SACnEe,SAASS,KAAK,6BAA6BQ,YAAY,YAS3DX,yBAA0B,SAASN,SAAUG,WACrCQ,MAAQX,SAASS,KAAK,6BACtBmX,WAAa5X,SAASS,KAAK,8BAC3BoX,aAAe,EAEnBlX,MAAMa,MAAK,eACHsW,WAAand,EAAE4B,MAAMoC,KAAK,WAAa,GAC7B,KAAVwB,QAA+C,IAA/B2X,WAAWzN,QAAQlK,QACnCxF,EAAE4B,MAAMuX,OACR+D,gBAEAld,EAAE4B,MAAMwb,UAKhBpX,MAAMwJ,OAAO,WAAWlJ,YAAY,WAGf,IAAjB4W,aACAD,WAAW3W,YAAY,UAEvB2W,WAAW9W,SAAS,WAW5BJ,6BAA8B,SAASV,SAAUO,MAAOC,MAEpDR,SAASS,KAAK,6BAA6BD,KAAKA,MAGhDR,SAASS,KAAK,6BAA6BQ,YAAY,YACvDjB,SAASS,KAAK,yCAA2CF,MAAQ,MAAMO,SAAS,gBAI5E2H,OAASzI,SAASgY,SAAS,UAC3BvP,OAAOxK,QACPwK,OAAOlJ,IAAIgB,OAAOc,QAAQ,eAIzBC,wBAAwBtB,WAQjCkB,2BAA4B,SAAS2G,UAC7BoQ,KAAOpQ,KAAK5H,QAAQ,6BACpBiY,WAAaD,KAAKE,SAClBC,QAAUvQ,KAAK0G,WAAW0H,IAC1BoC,WAAaxQ,KAAKyQ,cAElBF,QAAU,EACVH,KAAKM,UAAUN,KAAKM,YAAcH,SAC3BA,QAAUC,WAAaH,YAC9BD,KAAKM,UAAUN,KAAKM,aAAeH,QAAUC,WAAaH,cAUlEhP,WAAY,SAAS1I,UACbgY,IAAMjX,SAAS+N,cAAc,cACjCkJ,IAAIC,YAAcjY,KACXgY,IAAIE,WASf3B,cAAe,SAAShF,UAChB4G,QAAU7W,KAAK8W,OAAO,IAAIvV,KAAS0O,MAAQ,QAE3C4G,QAAU,SACH,eAGPE,QAAU/W,KAAK8W,MAAMD,QAAU,OAC/BE,QAAU,UACHA,QAAU,WAAyB,IAAZA,QAAgB,IAAM,IAAM,WAG1DC,MAAQhX,KAAK8W,MAAMC,QAAU,OAC7BC,MAAQ,UACDA,MAAQ,SAAqB,IAAVA,MAAc,IAAM,IAAM,WAGpDC,KAAOjX,KAAK8W,MAAME,MAAQ,WACvBC,KAAO,QAAmB,IAATA,KAAa,IAAM,IAAM,SAIlD,CAMHhb,KAAM,SAAS3C,gBACJ,IAAID,gBAAgBC"}