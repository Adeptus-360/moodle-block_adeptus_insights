{"version":3,"file":"block.min.js","sources":["../src/block.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Main JavaScript controller for the Adeptus Insights block.\n *\n * @module     block_adeptus_insights/block\n * @copyright  2025 Adeptus Analytics\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine([\n    'jquery',\n    'core/ajax',\n    'core/notification',\n    'core/str',\n    'core/modal_factory',\n    'core/modal_events',\n    'core/templates',\n    'core/chartjs'\n], function($, Ajax, Notification, Str, ModalFactory, ModalEvents, Templates, Chart) {\n    'use strict';\n\n    /**\n     * Block controller class.\n     *\n     * @param {Object} options Configuration options\n     */\n    var BlockController = function(options) {\n        this.blockId = options.blockid;\n        this.contextId = options.contextid;\n        this.config = options.config || {};\n        this.apiKey = options.apiKey || '';  // API key passed directly from PHP\n        this.isAdmin = options.isAdmin || false;  // Site admin flag\n        this.container = null;\n        this.reports = [];\n        this.lastUpdated = null;\n        this.refreshTimer = null;\n        this.modal = null;\n        this.modalData = null;      // Current modal report data\n        this.modalReport = null;    // Current modal report metadata\n        this.chartInstance = null;  // Current Chart.js instance\n        this.currentView = 'table'; // Current view mode\n\n        // Pagination state for report list\n        this.listCurrentPage = 1;\n        this.listItemsPerPage = this.config.maxLinkItems || 10;\n        this.listTotalPages = 1;\n\n        // Pagination state for modal table\n        this.tableCurrentPage = 1;\n        this.tableRowsPerPage = 25;\n        this.tableTotalPages = 1;\n\n        // Category filter state\n        this.selectedCategory = '';\n        this.availableCategories = [];\n\n        // Cache settings\n        this.cacheKey = 'adeptus_block_reports_' + this.blockId;\n        this.cacheTTL = 5 * 60 * 1000; // 5 minutes\n        this.reportDataCache = {}; // In-memory cache for executed report data\n        this.preloadTimeout = null;\n        this.preloadingSlug = null;\n\n        this.init();\n    };\n\n    BlockController.prototype = {\n        /**\n         * Initialize the block.\n         */\n        init: function() {\n            // Find the block container.\n            this.container = $('[data-blockid=\"' + this.blockId + '\"]');\n            if (!this.container.length) {\n                return;\n            }\n\n            // Bind event handlers.\n            this.bindEvents();\n\n            // Load initial data.\n            this.loadReports();\n\n            // Setup auto-refresh if configured.\n            this.setupAutoRefresh();\n        },\n\n        /**\n         * Bind event handlers.\n         */\n        bindEvents: function() {\n            var self = this;\n\n            // Refresh button.\n            this.container.on('click', '.block-adeptus-refresh, .block-adeptus-retry', function(e) {\n                e.preventDefault();\n                self.refresh();\n            });\n\n            // Report item click.\n            this.container.on('click', '.block-adeptus-report-item', function(e) {\n                e.preventDefault();\n                var slug = $(this).data('slug');\n                var source = $(this).data('source');\n                self.handleReportClick(slug, source);\n            });\n\n            // Report item keyboard activation (Enter/Space).\n            this.container.on('keydown', '.block-adeptus-report-item', function(e) {\n                if (e.key === 'Enter' || e.key === ' ') {\n                    e.preventDefault();\n                    var slug = $(this).data('slug');\n                    var source = $(this).data('source');\n                    self.handleReportClick(slug, source);\n                }\n            });\n\n            // KPI card click.\n            this.container.on('click', '.block-adeptus-kpi-card', function(e) {\n                e.preventDefault();\n                var slug = $(this).data('slug');\n                var source = $(this).data('source');\n                self.handleReportClick(slug, source);\n            });\n\n            // Tab click.\n            this.container.on('shown.bs.tab', '.block-adeptus-tab-nav a', function(e) {\n                var tabPane = $($(e.target).attr('href'));\n                var slug = tabPane.data('slug');\n                var source = tabPane.data('source');\n                if (!tabPane.data('loaded')) {\n                    self.loadTabContent(tabPane, slug, source);\n                }\n            });\n\n            // Export buttons.\n            this.container.on('click', '.block-adeptus-export', function(e) {\n                e.preventDefault();\n                var format = $(this).data('format');\n                self.exportReport(format);\n            });\n\n            // Pagination - Previous button.\n            this.container.on('click', '.pagination-prev', function(e) {\n                e.preventDefault();\n                if (self.listCurrentPage > 1) {\n                    self.listCurrentPage--;\n                    self.renderCurrentPage();\n                    self.scrollToListTop();\n                }\n            });\n\n            // Pagination - Next button.\n            this.container.on('click', '.pagination-next', function(e) {\n                e.preventDefault();\n                if (self.listCurrentPage < self.listTotalPages) {\n                    self.listCurrentPage++;\n                    self.renderCurrentPage();\n                    self.scrollToListTop();\n                }\n            });\n\n            // Category filter change.\n            this.container.on('change', '.category-filter-select', function() {\n                self.selectedCategory = $(this).val();\n                self.listCurrentPage = 1; // Reset to first page\n                self.renderReports();\n            });\n\n            // Preload report data on hover (300ms delay to avoid unnecessary loads).\n            this.container.on('mouseenter', '.block-adeptus-report-item', function() {\n                var slug = $(this).data('slug');\n                var source = $(this).data('source');\n\n                // Clear any pending preload\n                if (self.preloadTimeout) {\n                    clearTimeout(self.preloadTimeout);\n                }\n\n                // Start preload after 300ms hover\n                self.preloadTimeout = setTimeout(function() {\n                    self.preloadReportData(slug, source);\n                }, 300);\n            });\n\n            this.container.on('mouseleave', '.block-adeptus-report-item', function() {\n                // Cancel pending preload if user moves away\n                if (self.preloadTimeout) {\n                    clearTimeout(self.preloadTimeout);\n                    self.preloadTimeout = null;\n                }\n            });\n        },\n\n        /**\n         * Load reports from the server or cache.\n         */\n        loadReports: function() {\n            var self = this;\n\n            this.showLoading();\n\n            // Try to load from cache first\n            var cachedData = this.getFromCache();\n            if (cachedData) {\n                this.reports = cachedData;\n                this.lastUpdated = new Date();\n                this.renderReports();\n                return;\n            }\n\n            // Wait for auth data to be available.\n            this.waitForAuth(function() {\n                self.fetchReports();\n            });\n        },\n\n        /**\n         * Get reports from sessionStorage cache.\n         *\n         * @return {Array|null}\n         */\n        getFromCache: function() {\n            try {\n                var cached = sessionStorage.getItem(this.cacheKey);\n                if (cached) {\n                    var data = JSON.parse(cached);\n                    if (data.timestamp && (Date.now() - data.timestamp) < this.cacheTTL) {\n                        return data.reports;\n                    }\n                    // Cache expired, remove it\n                    sessionStorage.removeItem(this.cacheKey);\n                }\n            } catch (e) {\n                // Ignore storage errors\n            }\n            return null;\n        },\n\n        /**\n         * Save reports to sessionStorage cache.\n         *\n         * @param {Array} reports\n         */\n        saveToCache: function(reports) {\n            try {\n                sessionStorage.setItem(this.cacheKey, JSON.stringify({\n                    timestamp: Date.now(),\n                    reports: reports\n                }));\n            } catch (e) {\n                // Ignore storage errors (quota exceeded, etc.)\n            }\n        },\n\n        /**\n         * Preload report data on hover for faster modal loading.\n         *\n         * @param {string} slug\n         * @param {string} source\n         */\n        preloadReportData: function(slug, source) {\n            var self = this;\n            var cacheKey = slug + '_' + source;\n\n            // Already cached or currently preloading\n            if (this.reportDataCache[cacheKey] || this.preloadingSlug === slug) {\n                return;\n            }\n\n            this.preloadingSlug = slug;\n\n            // Find the report from our cached list\n            var report = this.reports.find(function(r) {\n                return r.slug === slug;\n            });\n\n            if (!report) {\n                return;\n            }\n\n            if (source === 'wizard') {\n                // Preload wizard report\n                $.ajax({\n                    url: M.cfg.wwwroot + '/report/adeptus_insights/ajax/generate_report.php',\n                    method: 'POST',\n                    data: {\n                        reportid: report.name || report.report_template_id,\n                        sesskey: M.cfg.sesskey\n                    },\n                    dataType: 'json',\n                    timeout: 30000\n                }).done(function(response) {\n                    if (response.success) {\n                        self.reportDataCache[cacheKey] = {\n                            report: report,\n                            results: response.results || [],\n                            chartData: response.chart_data,\n                            chartType: response.chart_type\n                        };\n                    }\n                    self.preloadingSlug = null;\n                }).fail(function() {\n                    self.preloadingSlug = null;\n                });\n            } else {\n                // Preload AI report\n                var token = this.apiKey || (window.adeptusAuthData ? window.adeptusAuthData.api_key : null);\n                if (!token) {\n                    return;\n                }\n\n                $.ajax({\n                    url: 'https://a360backend.stagingwithswift.com/api/v1/ai-reports/' + slug,\n                    method: 'GET',\n                    headers: {\n                        'Authorization': 'Bearer ' + token,\n                        'Accept': 'application/json'\n                    },\n                    timeout: 15000\n                }).done(function(response) {\n                    if (response.success && response.report) {\n                        self.reportDataCache[cacheKey] = {\n                            report: response.report,\n                            results: response.data || [],\n                            chartData: null,\n                            chartType: null\n                        };\n                    }\n                    self.preloadingSlug = null;\n                }).fail(function() {\n                    self.preloadingSlug = null;\n                });\n            }\n        },\n\n        /**\n         * Wait for authentication data to be available.\n         * Uses API key passed directly from PHP, or falls back to AJAX.\n         *\n         * @param {Function} callback\n         */\n        waitForAuth: function(callback) {\n            var self = this;\n\n            // Use API key passed directly from PHP (preferred - no AJAX needed)\n            if (this.apiKey) {\n                window.adeptusAuthData = window.adeptusAuthData || {};\n                window.adeptusAuthData.api_key = this.apiKey;\n                callback();\n                return;\n            }\n\n            // Fallback: Check if already authenticated via parent plugin\n            if (window.adeptusAuthData && window.adeptusAuthData.api_key) {\n                callback();\n                return;\n            }\n\n            // Last resort: Try to fetch auth via AJAX\n            $.ajax({\n                url: M.cfg.wwwroot + '/report/adeptus_insights/ajax/get_auth_status.php',\n                method: 'GET',\n                dataType: 'json',\n                timeout: 10000\n            }).done(function(response) {\n                if (response && response.success && response.data) {\n                    window.adeptusAuthData = response.data;\n                    callback();\n                } else {\n                    self.showError('Authentication failed');\n                }\n            }).fail(function() {\n                self.showError('Could not authenticate');\n            });\n        },\n\n        /**\n         * Fetch reports from the backend API.\n         */\n        fetchReports: function() {\n            var self = this;\n            var token = this.apiKey || (window.adeptusAuthData ? window.adeptusAuthData.api_key : null);\n\n            if (!token) {\n                this.showError('No authentication token');\n                return;\n            }\n\n            var promises = [];\n            var source = this.config.reportSource || 'all';\n\n            if (source === 'all' || source === 'wizard') {\n                promises.push(this.fetchFromApi('/wizard-reports', token));\n            }\n\n            if (source === 'all' || source === 'ai') {\n                promises.push(this.fetchFromApi('/ai-reports', token));\n            }\n\n            $.when.apply($, promises).then(function() {\n                var allReports = [];\n\n                for (var i = 0; i < promises.length; i++) {\n                    var result;\n                    if (promises.length === 1) {\n                        result = arguments[0];\n                    } else {\n                        result = arguments[i][0];\n                    }\n\n                    var reports = result.reports || result.data || [];\n                    if (reports && reports.length) {\n                        var reportSource = (source === 'ai' || (i === 1 && source === 'all')) ? 'ai' : 'wizard';\n                        reports.forEach(function(report) {\n                            report.source = report.source || reportSource;\n                            allReports.push(report);\n                        });\n                    }\n                }\n\n                self.reports = allReports;\n                self.lastUpdated = new Date();\n                self.saveToCache(allReports);\n                self.renderReports();\n            }).fail(function() {\n                self.showError();\n            });\n        },\n\n        /**\n         * Fetch data from the backend API.\n         *\n         * @param {string} endpoint API endpoint\n         * @param {string} token Auth token\n         * @return {Promise}\n         */\n        fetchFromApi: function(endpoint, token) {\n            var baseUrl = 'https://a360backend.stagingwithswift.com/api/v1';\n\n            return $.ajax({\n                url: baseUrl + endpoint,\n                method: 'GET',\n                headers: {\n                    'Authorization': 'Bearer ' + token,\n                    'Content-Type': 'application/json',\n                    'Accept': 'application/json'\n                },\n                timeout: 15000\n            });\n        },\n\n        /**\n         * Render reports based on display mode.\n         */\n        renderReports: function() {\n            var mode = this.config.displayMode || 'links';\n\n            if (this.reports.length === 0) {\n                this.showEmpty();\n                return;\n            }\n\n            // Extract and populate category filter\n            this.populateCategoryFilter();\n\n            // Filter reports based on selected category\n            var reports = this.filterReports();\n\n            switch (mode) {\n                case 'embedded':\n                    this.renderEmbedded(reports);\n                    break;\n                case 'kpi':\n                    this.renderKpi(reports);\n                    break;\n                case 'tabs':\n                    this.renderTabs(reports);\n                    break;\n                case 'links':\n                default:\n                    this.renderLinks(reports);\n                    break;\n            }\n\n            this.hideLoading();\n            this.updateTimestamp();\n        },\n\n        /**\n         * Extract categories from reports and populate the filter dropdown.\n         */\n        populateCategoryFilter: function() {\n            var self = this;\n            var categoryMap = {};\n\n            // Extract unique categories from reports\n            this.reports.forEach(function(report) {\n                var catInfo = report.category_info;\n                if (catInfo && catInfo.slug) {\n                    categoryMap[catInfo.slug] = {\n                        slug: catInfo.slug,\n                        name: catInfo.name || catInfo.slug,\n                        color: catInfo.color || '#6c757d'\n                    };\n                } else if (report.category) {\n                    categoryMap[report.category] = {\n                        slug: report.category,\n                        name: report.category,\n                        color: '#6c757d'\n                    };\n                }\n            });\n\n            // Convert to array and sort by name\n            this.availableCategories = Object.values(categoryMap).sort(function(a, b) {\n                return a.name.localeCompare(b.name);\n            });\n\n            // Populate dropdown\n            var select = this.container.find('.category-filter-select');\n            if (select.length) {\n                // Keep the first \"All Categories\" option, remove the rest\n                select.find('option:not(:first)').remove();\n\n                // Add category options\n                this.availableCategories.forEach(function(cat) {\n                    var selected = self.selectedCategory === cat.slug ? ' selected' : '';\n                    select.append('<option value=\"' + cat.slug + '\"' + selected + '>' + cat.name + '</option>');\n                });\n            }\n        },\n\n        /**\n         * Filter reports based on configuration and selected category.\n         *\n         * @return {Array}\n         */\n        filterReports: function() {\n            var self = this;\n            var reports = this.reports.slice();\n            var config = this.config;\n\n            // Filter by selected category (from dropdown).\n            if (this.selectedCategory) {\n                reports = reports.filter(function(r) {\n                    var catSlug = r.category_info ? r.category_info.slug : (r.category || '');\n                    return catSlug === self.selectedCategory;\n                });\n            }\n\n            // Filter to manually selected reports (from block config).\n            if (config.reportSource === 'manual' && config.selectedReports && config.selectedReports.length) {\n                var selected = config.selectedReports;\n                reports = reports.filter(function(r) {\n                    return selected.indexOf(r.slug) !== -1;\n                });\n            }\n\n            // Note: We don't limit here anymore - pagination handles display limits\n\n            // Sort by name (try multiple possible name fields).\n            reports.sort(function(a, b) {\n                var nameA = a.name || a.title || a.display_name || a.report_name || a.slug || '';\n                var nameB = b.name || b.title || b.display_name || b.report_name || b.slug || '';\n                return nameA.localeCompare(nameB);\n            });\n\n            return reports;\n        },\n\n        /**\n         * Render link list mode with pagination.\n         *\n         * @param {Array} reports\n         */\n        renderLinks: function(reports) {\n            // Store filtered reports for pagination\n            this.filteredReports = reports;\n\n            // Calculate pagination\n            this.listItemsPerPage = this.config.maxLinkItems || 10;\n            this.listTotalPages = Math.ceil(reports.length / this.listItemsPerPage);\n            this.listCurrentPage = 1; // Reset to first page\n\n            // Render the first page\n            this.renderCurrentPage();\n        },\n\n        /**\n         * Render the current page of reports.\n         */\n        renderCurrentPage: function() {\n            var self = this;\n            var reports = this.filteredReports || [];\n            var listContainer = this.container.find('.block-adeptus-report-list');\n            var template = $('#block-adeptus-report-item-template-' + this.blockId);\n            var paginationContainer = this.container.find('.block-adeptus-pagination');\n\n            // Calculate page slice\n            var startIndex = (this.listCurrentPage - 1) * this.listItemsPerPage;\n            var endIndex = startIndex + this.listItemsPerPage;\n            var pageReports = reports.slice(startIndex, endIndex);\n\n            listContainer.empty();\n\n            pageReports.forEach(function(report) {\n                var item = template.html();\n                var $item = $(item);\n\n                $item.attr('data-slug', report.slug);\n                $item.attr('data-source', report.source);\n\n                // Try multiple possible name fields (API may use different field names)\n                var reportName = report.name || report.title || report.display_name || report.report_name || report.slug || 'Untitled Report';\n                $item.find('.report-item-name').text(reportName);\n\n                // Set category badge with color\n                var categoryName = report.category_info ? report.category_info.name : report.category || 'General';\n                var categoryColor = report.category_info ? report.category_info.color : '#6c757d';\n                $item.find('.report-item-category')\n                    .text(categoryName)\n                    .css('background-color', categoryColor)\n                    .css('color', '#fff');\n\n                listContainer.append($item);\n            });\n\n            listContainer.removeClass('d-none');\n\n            // Update pagination controls\n            if (this.listTotalPages > 1) {\n                // Use actual page data length for accurate count\n                var actualEnd = startIndex + pageReports.length;\n                paginationContainer.find('.pagination-showing')\n                    .text('Showing ' + (startIndex + 1) + '-' + actualEnd + ' of ' + reports.length);\n                paginationContainer.find('.pagination-pages')\n                    .text('Page ' + this.listCurrentPage + ' of ' + this.listTotalPages);\n\n                // Update button states\n                paginationContainer.find('.pagination-prev').prop('disabled', this.listCurrentPage <= 1);\n                paginationContainer.find('.pagination-next').prop('disabled', this.listCurrentPage >= this.listTotalPages);\n\n                paginationContainer.removeClass('d-none');\n            } else {\n                paginationContainer.addClass('d-none');\n            }\n        },\n\n        /**\n         * Render embedded report mode.\n         *\n         * @param {Array} reports\n         */\n        renderEmbedded: function(reports) {\n            if (reports.length === 0) {\n                this.showEmpty();\n                return;\n            }\n\n            // For embedded mode, show the first report.\n            var report = reports[0];\n            var reportName = report.name || report.title || report.display_name || report.slug || 'Report';\n            this.container.find('.report-name').text(reportName);\n\n            // Store current embedded report\n            this.embeddedReport = report;\n            this.embeddedData = null;\n            this.embeddedChartInstance = null;\n\n            // Load and render the report data.\n            this.loadEmbeddedReport(report.slug, report.source);\n        },\n\n        /**\n         * Load report data for embedded display.\n         *\n         * @param {string} slug\n         * @param {string} source\n         */\n        loadEmbeddedReport: function(slug, source) {\n            var self = this;\n            var cacheKey = slug + '_' + source;\n\n            // Check cache first for instant loading\n            if (this.reportDataCache[cacheKey]) {\n                var cached = this.reportDataCache[cacheKey];\n                this.embeddedData = cached.results;\n                this.renderEmbeddedContent(cached.report, cached.results);\n                return;\n            }\n\n            // Find the report from our cached list\n            var report = this.reports.find(function(r) {\n                return r.slug === slug;\n            });\n\n            if (!report) {\n                this.showError('Report not found');\n                return;\n            }\n\n            // For wizard reports, execute locally via generate_report.php\n            if (source === 'wizard') {\n                $.ajax({\n                    url: M.cfg.wwwroot + '/report/adeptus_insights/ajax/generate_report.php',\n                    method: 'POST',\n                    data: {\n                        reportid: report.name || report.report_template_id,\n                        sesskey: M.cfg.sesskey\n                    },\n                    dataType: 'json',\n                    timeout: 30000\n                }).done(function(response) {\n                    if (response.success) {\n                        // Cache the result\n                        self.reportDataCache[cacheKey] = {\n                            report: report,\n                            results: response.results || [],\n                            chartData: response.chart_data,\n                            chartType: response.chart_type\n                        };\n                        self.embeddedData = response.results || [];\n                        self.renderEmbeddedContent(report, response.results || []);\n                    } else {\n                        self.showError(response.message || 'Failed to load report');\n                    }\n                }).fail(function() {\n                    self.showError('Connection error');\n                });\n            } else {\n                // AI reports - fetch from backend API\n                var token = this.apiKey || (window.adeptusAuthData ? window.adeptusAuthData.api_key : null);\n\n                if (!token) {\n                    this.showError('No authentication token');\n                    return;\n                }\n\n                $.ajax({\n                    url: 'https://a360backend.stagingwithswift.com/api/v1/ai-reports/' + slug,\n                    method: 'GET',\n                    headers: {\n                        'Authorization': 'Bearer ' + token,\n                        'Accept': 'application/json'\n                    },\n                    timeout: 15000\n                }).done(function(response) {\n                    if (response.success && response.report) {\n                        // Cache the result\n                        self.reportDataCache[cacheKey] = {\n                            report: response.report,\n                            results: response.data || [],\n                            chartData: null,\n                            chartType: null\n                        };\n                        self.embeddedData = response.data || [];\n                        self.renderEmbeddedContent(response.report, response.data || []);\n                    } else {\n                        self.showError('Failed to load report');\n                    }\n                }).fail(function() {\n                    self.showError('Connection error');\n                });\n            }\n        },\n\n        /**\n         * Render embedded content with report data.\n         *\n         * @param {Object} report\n         * @param {Array} data\n         */\n        renderEmbeddedContent: function(report, data) {\n            var self = this;\n            var contentArea = this.container.find('.block-adeptus-content');\n\n            if (!data || data.length === 0) {\n                this.showEmpty();\n                return;\n            }\n\n            // Render chart if enabled\n            if (this.config.showChart) {\n                this.renderEmbeddedChart(report, data);\n            }\n\n            // Render table if enabled\n            if (this.config.showTable) {\n                this.renderEmbeddedTable(data);\n            }\n\n            contentArea.removeClass('d-none');\n            this.hideLoading();\n            this.updateTimestamp();\n        },\n\n        /**\n         * Render chart in embedded mode.\n         *\n         * @param {Object} report\n         * @param {Array} data\n         */\n        renderEmbeddedChart: function(report, data) {\n            var self = this;\n            var chartContainer = this.container.find('.block-adeptus-chart-container');\n            var canvas = chartContainer.find('.block-adeptus-chart')[0];\n\n            if (!canvas || !data || data.length === 0) {\n                chartContainer.addClass('d-none');\n                return;\n            }\n\n            // Destroy existing chart\n            if (this.embeddedChartInstance) {\n                this.embeddedChartInstance.destroy();\n                this.embeddedChartInstance = null;\n            }\n\n            var headers = Object.keys(data[0]);\n            var numericCols = this.detectNumericColumns(data, headers);\n\n            // Auto-detect best columns for chart\n            var labelKey = headers[0]; // First column for labels\n            var valueKey = numericCols.length > 0 ? numericCols[numericCols.length - 1] : headers[headers.length - 1];\n\n            // Format value key for display\n            var valueKeyFormatted = valueKey.replace(/_/g, ' ').replace(/\\b\\w/g, function(l) { return l.toUpperCase(); });\n\n            // Limit data for chart readability (max 20 items for embedded)\n            var chartData = data.slice(0, 20);\n            var labels = chartData.map(function(row) {\n                var label = row[labelKey];\n                if (label === null || label === undefined) return 'Unknown';\n                var labelStr = String(label);\n                return labelStr.length > 20 ? labelStr.substring(0, 20) + '...' : labelStr;\n            });\n            var values = chartData.map(function(row) {\n                return parseFloat(row[valueKey]) || 0;\n            });\n\n            // Generate colors\n            var colors = this.generateChartColors(values.length, 'bar');\n\n            // Create chart config\n            var config = {\n                type: 'bar',\n                data: {\n                    labels: labels,\n                    datasets: [{\n                        label: valueKeyFormatted,\n                        data: values,\n                        backgroundColor: colors[0],\n                        borderColor: colors[0].replace('0.7', '1'),\n                        borderWidth: 1\n                    }]\n                },\n                options: {\n                    responsive: true,\n                    maintainAspectRatio: false,\n                    plugins: {\n                        legend: {\n                            display: false\n                        }\n                    },\n                    scales: {\n                        y: {\n                            beginAtZero: true\n                        },\n                        x: {\n                            display: data.length <= 10 // Hide labels if too many\n                        }\n                    }\n                }\n            };\n\n            try {\n                this.embeddedChartInstance = new Chart(canvas.getContext('2d'), config);\n                chartContainer.removeClass('d-none');\n            } catch (error) {\n                chartContainer.html(\n                    '<div class=\"alert alert-warning text-center\"><i class=\"fa fa-exclamation-circle\"></i> Could not render chart</div>'\n                );\n            }\n        },\n\n        /**\n         * Render data table in embedded mode.\n         *\n         * @param {Array} data\n         */\n        renderEmbeddedTable: function(data) {\n            var table = this.container.find('.block-adeptus-table');\n            var thead = table.find('thead');\n            var tbody = table.find('tbody');\n            var maxRows = this.config.tableMaxRows || 10;\n\n            thead.empty();\n            tbody.empty();\n\n            if (!data || data.length === 0) {\n                this.container.find('.block-adeptus-table-container').addClass('d-none');\n                return;\n            }\n\n            // Build headers from first row\n            var headers = Object.keys(data[0]);\n            var headerRow = $('<tr>');\n            headers.forEach(function(h) {\n                var formatted = h.replace(/_/g, ' ').replace(/\\b\\w/g, function(l) { return l.toUpperCase(); });\n                headerRow.append($('<th>').text(formatted));\n            });\n            thead.append(headerRow);\n\n            // Build rows\n            data.slice(0, maxRows).forEach(function(row) {\n                var tr = $('<tr>');\n                headers.forEach(function(h) {\n                    var val = row[h];\n                    if (val === null || val === undefined) val = '';\n                    var displayVal = String(val);\n                    if (displayVal.length > 50) {\n                        displayVal = displayVal.substring(0, 50) + '...';\n                    }\n                    tr.append($('<td>').attr('title', val).text(displayVal));\n                });\n                tbody.append(tr);\n            });\n\n            // Update row count\n            var countText = 'Showing ' + Math.min(data.length, maxRows) + ' of ' + data.length + ' rows';\n            this.container.find('.block-adeptus-row-count').text(countText);\n            this.container.find('.block-adeptus-table-container').removeClass('d-none');\n        },\n\n        /**\n         * Render KPI cards mode.\n         *\n         * @param {Array} reports\n         */\n        renderKpi: function(reports) {\n            var self = this;\n            var gridContainer = this.container.find('.block-adeptus-kpi-grid');\n            var template = $('#block-adeptus-kpi-card-template-' + this.blockId);\n            var maxCards = parseInt(this.config.kpiColumns, 10) || 2;\n            maxCards = Math.min(maxCards * 2, 4); // Max 4 KPI cards\n\n            gridContainer.empty();\n\n            var kpiReports = reports.slice(0, maxCards);\n\n            kpiReports.forEach(function(report, index) {\n                var card = template.html();\n                var $card = $(card);\n\n                var reportName = report.name || report.title || report.display_name || report.slug || 'Metric';\n                $card.attr('data-slug', report.slug);\n                $card.attr('data-source', report.source);\n                $card.find('.kpi-card-label').text(reportName);\n                $card.find('.kpi-card-value').html('<i class=\"fa fa-spinner fa-spin\"></i>');\n                $card.find('.kpi-card-trend').addClass('d-none');\n                $card.find('.kpi-card-sparkline').addClass('d-none');\n\n                // Set different icons based on index\n                var icons = ['fa-users', 'fa-graduation-cap', 'fa-clock', 'fa-check-circle'];\n                $card.find('.kpi-card-icon i').removeClass('fa-chart-line').addClass(icons[index % icons.length]);\n\n                gridContainer.append($card);\n\n                // Load KPI data for this card\n                self.loadKpiData(report, $card);\n            });\n\n            gridContainer.removeClass('d-none');\n        },\n\n        /**\n         * Load KPI data for a single card.\n         *\n         * @param {Object} report\n         * @param {jQuery} $card\n         */\n        loadKpiData: function(report, $card) {\n            var self = this;\n            var cacheKey = report.slug + '_' + report.source;\n\n            // Check cache first\n            if (this.reportDataCache[cacheKey]) {\n                var cached = this.reportDataCache[cacheKey];\n                this.renderKpiValue($card, cached.results);\n                return;\n            }\n\n            // Load data based on source\n            if (report.source === 'wizard') {\n                $.ajax({\n                    url: M.cfg.wwwroot + '/report/adeptus_insights/ajax/generate_report.php',\n                    method: 'POST',\n                    data: {\n                        reportid: report.name || report.report_template_id,\n                        sesskey: M.cfg.sesskey\n                    },\n                    dataType: 'json',\n                    timeout: 15000\n                }).done(function(response) {\n                    if (response.success) {\n                        self.reportDataCache[cacheKey] = {\n                            report: report,\n                            results: response.results || []\n                        };\n                        self.renderKpiValue($card, response.results || []);\n                    } else {\n                        $card.find('.kpi-card-value').text('--');\n                    }\n                }).fail(function() {\n                    $card.find('.kpi-card-value').text('--');\n                });\n            } else {\n                // AI reports\n                var token = this.apiKey || (window.adeptusAuthData ? window.adeptusAuthData.api_key : null);\n                if (!token) {\n                    $card.find('.kpi-card-value').text('--');\n                    return;\n                }\n\n                $.ajax({\n                    url: 'https://a360backend.stagingwithswift.com/api/v1/ai-reports/' + report.slug,\n                    method: 'GET',\n                    headers: {\n                        'Authorization': 'Bearer ' + token,\n                        'Accept': 'application/json'\n                    },\n                    timeout: 15000\n                }).done(function(response) {\n                    if (response.success && response.data) {\n                        self.reportDataCache[cacheKey] = {\n                            report: response.report || report,\n                            results: response.data || []\n                        };\n                        self.renderKpiValue($card, response.data || []);\n                    } else {\n                        $card.find('.kpi-card-value').text('--');\n                    }\n                }).fail(function() {\n                    $card.find('.kpi-card-value').text('--');\n                });\n            }\n        },\n\n        /**\n         * Render KPI value on card.\n         *\n         * @param {jQuery} $card\n         * @param {Array} data\n         */\n        renderKpiValue: function($card, data) {\n            if (!data || data.length === 0) {\n                $card.find('.kpi-card-value').text('0');\n                return;\n            }\n\n            // Find numeric column for KPI value\n            var headers = Object.keys(data[0]);\n            var numericCols = this.detectNumericColumns(data, headers);\n\n            var value;\n            var formattedValue;\n\n            if (numericCols.length > 0) {\n                // Use sum or count of the last numeric column\n                var valueCol = numericCols[numericCols.length - 1];\n\n                // If it's a count/total column, sum all values\n                if (valueCol.toLowerCase().includes('count') ||\n                    valueCol.toLowerCase().includes('total') ||\n                    data.length === 1) {\n                    value = data.reduce(function(sum, row) {\n                        return sum + (parseFloat(row[valueCol]) || 0);\n                    }, 0);\n                } else {\n                    // Otherwise show row count\n                    value = data.length;\n                }\n            } else {\n                // No numeric columns, show row count\n                value = data.length;\n            }\n\n            // Format the value nicely\n            if (value >= 1000000) {\n                formattedValue = (value / 1000000).toFixed(1) + 'M';\n            } else if (value >= 1000) {\n                formattedValue = (value / 1000).toFixed(1) + 'K';\n            } else if (Number.isInteger(value)) {\n                formattedValue = value.toLocaleString();\n            } else {\n                formattedValue = value.toFixed(1);\n            }\n\n            $card.find('.kpi-card-value').text(formattedValue);\n\n            // Add a simple trend indicator (placeholder - would need historical data)\n            var trendContainer = $card.find('.kpi-card-trend');\n            trendContainer.removeClass('d-none trend-up trend-down trend-neutral');\n            trendContainer.addClass('trend-neutral');\n            trendContainer.find('.trend-icon').html('<i class=\"fa fa-minus\"></i>');\n            trendContainer.find('.trend-value').text('vs previous');\n        },\n\n        /**\n         * Render tabbed reports mode.\n         *\n         * @param {Array} reports\n         */\n        renderTabs: function(reports) {\n            var self = this;\n            var tabNav = this.container.find('.block-adeptus-tab-nav');\n            var tabContent = this.container.find('.block-adeptus-tab-content');\n            var tabTemplate = $('#block-adeptus-tab-template-' + this.blockId);\n            var paneTemplate = $('#block-adeptus-tab-pane-template-' + this.blockId);\n            var maxTabs = 5;\n\n            tabNav.empty();\n            tabContent.empty();\n\n            // Store tab chart instances\n            this.tabChartInstances = {};\n\n            reports.slice(0, maxTabs).forEach(function(report, index) {\n                var tabId = 'tab-' + self.blockId + '-' + index;\n                var reportName = report.name || report.title || report.display_name || report.slug || 'Report';\n\n                // Create tab\n                var tab = $(tabTemplate.html());\n                tab.find('a')\n                    .attr('href', '#' + tabId)\n                    .attr('aria-controls', tabId);\n                tab.find('.tab-name').text(reportName);\n\n                if (index === 0) {\n                    tab.find('a').addClass('active').attr('aria-selected', 'true');\n                }\n\n                tabNav.append(tab);\n\n                // Create pane\n                var pane = $(paneTemplate.html());\n                pane.attr('id', tabId);\n                pane.attr('data-slug', report.slug);\n                pane.attr('data-source', report.source);\n\n                if (index === 0) {\n                    pane.addClass('show active');\n                }\n\n                tabContent.append(pane);\n            });\n\n            // Load first tab content\n            if (reports.length > 0) {\n                var firstPane = tabContent.find('.tab-pane').first();\n                this.loadTabContent(firstPane, reports[0].slug, reports[0].source);\n            }\n\n            this.container.find('.block-adeptus-tabs-container').removeClass('d-none');\n        },\n\n        /**\n         * Load content for a tab.\n         *\n         * @param {jQuery} pane\n         * @param {string} slug\n         * @param {string} source\n         */\n        loadTabContent: function(pane, slug, source) {\n            var self = this;\n            var cacheKey = slug + '_' + source;\n            pane.data('loaded', true);\n\n            // Check cache first\n            if (this.reportDataCache[cacheKey]) {\n                var cached = this.reportDataCache[cacheKey];\n                this.renderTabContent(pane, cached.report, cached.results);\n                return;\n            }\n\n            // Find the report from our cached list\n            var report = this.reports.find(function(r) {\n                return r.slug === slug;\n            });\n\n            if (!report) {\n                pane.find('.tab-pane-loading').addClass('d-none');\n                pane.find('.tab-pane-content')\n                    .removeClass('d-none')\n                    .html('<div class=\"text-center text-muted py-4\"><i class=\"fa fa-exclamation-circle\"></i><p class=\"mt-2\">Report not found</p></div>');\n                return;\n            }\n\n            // Load data based on source\n            if (source === 'wizard') {\n                $.ajax({\n                    url: M.cfg.wwwroot + '/report/adeptus_insights/ajax/generate_report.php',\n                    method: 'POST',\n                    data: {\n                        reportid: report.name || report.report_template_id,\n                        sesskey: M.cfg.sesskey\n                    },\n                    dataType: 'json',\n                    timeout: 30000\n                }).done(function(response) {\n                    if (response.success) {\n                        self.reportDataCache[cacheKey] = {\n                            report: report,\n                            results: response.results || []\n                        };\n                        self.renderTabContent(pane, report, response.results || []);\n                    } else {\n                        pane.find('.tab-pane-loading').addClass('d-none');\n                        pane.find('.tab-pane-content')\n                            .removeClass('d-none')\n                            .html('<div class=\"text-center text-muted py-4\"><i class=\"fa fa-exclamation-circle\"></i><p class=\"mt-2\">' + (response.message || 'Failed to load') + '</p></div>');\n                    }\n                }).fail(function() {\n                    pane.find('.tab-pane-loading').addClass('d-none');\n                    pane.find('.tab-pane-content')\n                        .removeClass('d-none')\n                        .html('<div class=\"text-center text-muted py-4\"><i class=\"fa fa-exclamation-circle\"></i><p class=\"mt-2\">Connection error</p></div>');\n                });\n            } else {\n                // AI reports\n                var token = this.apiKey || (window.adeptusAuthData ? window.adeptusAuthData.api_key : null);\n                if (!token) {\n                    pane.find('.tab-pane-loading').addClass('d-none');\n                    pane.find('.tab-pane-content')\n                        .removeClass('d-none')\n                        .html('<div class=\"text-center text-muted py-4\"><i class=\"fa fa-exclamation-circle\"></i><p class=\"mt-2\">Authentication required</p></div>');\n                    return;\n                }\n\n                $.ajax({\n                    url: 'https://a360backend.stagingwithswift.com/api/v1/ai-reports/' + slug,\n                    method: 'GET',\n                    headers: {\n                        'Authorization': 'Bearer ' + token,\n                        'Accept': 'application/json'\n                    },\n                    timeout: 15000\n                }).done(function(response) {\n                    if (response.success) {\n                        self.reportDataCache[cacheKey] = {\n                            report: response.report || report,\n                            results: response.data || []\n                        };\n                        self.renderTabContent(pane, response.report || report, response.data || []);\n                    } else {\n                        pane.find('.tab-pane-loading').addClass('d-none');\n                        pane.find('.tab-pane-content')\n                            .removeClass('d-none')\n                            .html('<div class=\"text-center text-muted py-4\"><i class=\"fa fa-exclamation-circle\"></i><p class=\"mt-2\">Failed to load report</p></div>');\n                    }\n                }).fail(function() {\n                    pane.find('.tab-pane-loading').addClass('d-none');\n                    pane.find('.tab-pane-content')\n                        .removeClass('d-none')\n                        .html('<div class=\"text-center text-muted py-4\"><i class=\"fa fa-exclamation-circle\"></i><p class=\"mt-2\">Connection error</p></div>');\n                });\n            }\n        },\n\n        /**\n         * Render tab content with report data.\n         *\n         * @param {jQuery} pane\n         * @param {Object} report\n         * @param {Array} data\n         */\n        renderTabContent: function(pane, report, data) {\n            var self = this;\n            pane.find('.tab-pane-loading').addClass('d-none');\n            var contentArea = pane.find('.tab-pane-content');\n\n            if (!data || data.length === 0) {\n                contentArea.removeClass('d-none')\n                    .html('<div class=\"text-center text-muted py-4\"><i class=\"fa fa-inbox\"></i><p class=\"mt-2\">No data available</p></div>');\n                return;\n            }\n\n            // Create content HTML\n            var html = '';\n\n            // Chart container\n            if (this.config.showChart) {\n                html += '<div class=\"tab-chart-container\" style=\"height: ' + (this.config.chartHeight || 200) + 'px;\">' +\n                    '<canvas class=\"tab-chart\"></canvas></div>';\n            }\n\n            // Table container\n            if (this.config.showTable) {\n                html += '<div class=\"tab-table-container mt-2\"><div class=\"table-responsive\">' +\n                    '<table class=\"table table-sm table-striped\"><thead></thead><tbody></tbody></table>' +\n                    '</div></div>';\n            }\n\n            contentArea.html(html).removeClass('d-none');\n\n            // Render chart\n            if (this.config.showChart) {\n                this.renderTabChart(pane, report, data);\n            }\n\n            // Render table\n            if (this.config.showTable) {\n                this.renderTabTable(pane, data);\n            }\n        },\n\n        /**\n         * Render chart in tab pane.\n         *\n         * @param {jQuery} pane\n         * @param {Object} report\n         * @param {Array} data\n         */\n        renderTabChart: function(pane, report, data) {\n            var tabId = pane.attr('id');\n            var canvas = pane.find('.tab-chart')[0];\n\n            if (!canvas || !data || data.length === 0) {\n                return;\n            }\n\n            // Destroy existing chart for this tab\n            if (this.tabChartInstances && this.tabChartInstances[tabId]) {\n                this.tabChartInstances[tabId].destroy();\n            }\n\n            var headers = Object.keys(data[0]);\n            var numericCols = this.detectNumericColumns(data, headers);\n\n            var labelKey = headers[0];\n            var valueKey = numericCols.length > 0 ? numericCols[numericCols.length - 1] : headers[headers.length - 1];\n            var valueKeyFormatted = valueKey.replace(/_/g, ' ').replace(/\\b\\w/g, function(l) { return l.toUpperCase(); });\n\n            // Limit data\n            var chartData = data.slice(0, 15);\n            var labels = chartData.map(function(row) {\n                var label = row[labelKey];\n                if (label === null || label === undefined) return 'Unknown';\n                var labelStr = String(label);\n                return labelStr.length > 15 ? labelStr.substring(0, 15) + '...' : labelStr;\n            });\n            var values = chartData.map(function(row) {\n                return parseFloat(row[valueKey]) || 0;\n            });\n\n            var colors = this.generateChartColors(values.length, 'bar');\n\n            var config = {\n                type: 'bar',\n                data: {\n                    labels: labels,\n                    datasets: [{\n                        label: valueKeyFormatted,\n                        data: values,\n                        backgroundColor: colors[0],\n                        borderColor: colors[0].replace('0.7', '1'),\n                        borderWidth: 1\n                    }]\n                },\n                options: {\n                    responsive: true,\n                    maintainAspectRatio: false,\n                    plugins: { legend: { display: false } },\n                    scales: {\n                        y: { beginAtZero: true },\n                        x: { display: data.length <= 8 }\n                    }\n                }\n            };\n\n            try {\n                this.tabChartInstances = this.tabChartInstances || {};\n                this.tabChartInstances[tabId] = new Chart(canvas.getContext('2d'), config);\n            } catch (error) {\n                pane.find('.tab-chart-container').html(\n                    '<div class=\"alert alert-warning text-center\"><i class=\"fa fa-exclamation-circle\"></i> Could not render chart</div>'\n                );\n            }\n        },\n\n        /**\n         * Render table in tab pane.\n         *\n         * @param {jQuery} pane\n         * @param {Array} data\n         */\n        renderTabTable: function(pane, data) {\n            var table = pane.find('table');\n            var thead = table.find('thead');\n            var tbody = table.find('tbody');\n            var maxRows = this.config.tableMaxRows || 10;\n\n            thead.empty();\n            tbody.empty();\n\n            if (!data || data.length === 0) {\n                return;\n            }\n\n            var headers = Object.keys(data[0]);\n            var headerRow = $('<tr>');\n            headers.forEach(function(h) {\n                var formatted = h.replace(/_/g, ' ').replace(/\\b\\w/g, function(l) { return l.toUpperCase(); });\n                headerRow.append($('<th>').text(formatted));\n            });\n            thead.append(headerRow);\n\n            data.slice(0, maxRows).forEach(function(row) {\n                var tr = $('<tr>');\n                headers.forEach(function(h) {\n                    var val = row[h];\n                    if (val === null || val === undefined) val = '';\n                    var displayVal = String(val);\n                    if (displayVal.length > 40) {\n                        displayVal = displayVal.substring(0, 40) + '...';\n                    }\n                    tr.append($('<td>').attr('title', val).text(displayVal));\n                });\n                tbody.append(tr);\n            });\n        },\n\n        /**\n         * Handle report click.\n         *\n         * @param {string} slug\n         * @param {string} source\n         */\n        handleReportClick: function(slug, source) {\n            var action = this.config.clickAction || 'modal';\n\n            switch (action) {\n                case 'modal':\n                    this.openReportModal(slug, source);\n                    break;\n                case 'newtab':\n                    this.openReportNewTab(slug, source);\n                    break;\n                case 'expand':\n                    this.expandReportInline(slug, source);\n                    break;\n            }\n        },\n\n        /**\n         * Open report in modal.\n         *\n         * @param {string} slug\n         * @param {string} source\n         */\n        openReportModal: function(slug, source) {\n            var self = this;\n\n            // Find report data.\n            var report = this.reports.find(function(r) {\n                return r.slug === slug;\n            });\n\n            if (!report) {\n                return;\n            }\n\n            // Reset state\n            this.modalData = null;\n            this.modalReport = null;\n            this.currentView = 'table';\n            if (this.chartInstance) {\n                this.chartInstance.destroy();\n                this.chartInstance = null;\n            }\n\n            // First render the template, then create the modal with the rendered body\n            Templates.render('block_adeptus_insights/report_modal', {blockid: this.blockId})\n                .then(function(html) {\n                    return ModalFactory.create({\n                        type: ModalFactory.types.DEFAULT,\n                        title: report.name,\n                        body: html,\n                        large: true\n                    });\n                })\n                .then(function(modal) {\n                    self.modal = modal;\n\n                    // Bind modal event handlers\n                    self.bindModalEvents(modal);\n\n                    // Load report data after modal is shown.\n                    modal.getRoot().on(ModalEvents.shown, function() {\n                        self.loadModalReport(slug, source);\n                    });\n\n                    // Cleanup on close.\n                    modal.getRoot().on(ModalEvents.hidden, function() {\n                        if (self.chartInstance) {\n                            self.chartInstance.destroy();\n                            self.chartInstance = null;\n                        }\n                        modal.destroy();\n                        self.modal = null;\n                        self.modalData = null;\n                        self.modalReport = null;\n                    });\n\n                    modal.show();\n                    return modal;\n                }).catch(Notification.exception);\n        },\n\n        /**\n         * Bind event handlers for modal UI elements.\n         *\n         * @param {Object} modal\n         */\n        bindModalEvents: function(modal) {\n            var self = this;\n            var modalRoot = modal.getRoot();\n\n            // View toggle buttons\n            modalRoot.on('click', '.view-toggle-btn', function(e) {\n                e.preventDefault();\n                var view = $(this).data('view');\n                self.switchModalView(view);\n            });\n\n            // Chart control changes\n            modalRoot.on('change', '#modal-chart-type, #modal-chart-x-axis, #modal-chart-y-axis', function() {\n                if (self.currentView === 'chart') {\n                    self.renderModalChart();\n                }\n            });\n\n            // Retry button\n            modalRoot.on('click', '.modal-retry', function(e) {\n                e.preventDefault();\n                if (self.modalReport) {\n                    self.loadModalReport(self.modalReport.slug, self.modalReport.source);\n                }\n            });\n\n            // Export CSV\n            modalRoot.on('click', '.modal-export[data-format=\"csv\"]', function(e) {\n                e.preventDefault();\n                self.exportModalData('csv');\n            });\n\n            // Table pagination - Previous\n            modalRoot.on('click', '.table-pagination-prev', function(e) {\n                e.preventDefault();\n                if (self.tableCurrentPage > 1) {\n                    self.tableCurrentPage--;\n                    self.renderModalTablePage();\n                }\n            });\n\n            // Table pagination - Next\n            modalRoot.on('click', '.table-pagination-next', function(e) {\n                e.preventDefault();\n                if (self.tableCurrentPage < self.tableTotalPages) {\n                    self.tableCurrentPage++;\n                    self.renderModalTablePage();\n                }\n            });\n        },\n\n        /**\n         * Switch between table and chart views in modal.\n         *\n         * @param {string} view - 'table' or 'chart'\n         */\n        switchModalView: function(view) {\n            var modalBody = this.modal.getBody();\n\n            // Update toggle buttons\n            modalBody.find('.view-toggle-btn').removeClass('active');\n            modalBody.find('.view-toggle-btn[data-view=\"' + view + '\"]').addClass('active');\n\n            // Switch views\n            if (view === 'table') {\n                modalBody.find('#modal-table-view').removeClass('d-none');\n                modalBody.find('#modal-chart-view').addClass('d-none');\n            } else {\n                modalBody.find('#modal-table-view').addClass('d-none');\n                modalBody.find('#modal-chart-view').removeClass('d-none');\n                // Render chart when switching to chart view\n                this.renderModalChart();\n            }\n\n            this.currentView = view;\n        },\n\n        /**\n         * Load report data into modal.\n         *\n         * @param {string} slug\n         * @param {string} source\n         */\n        loadModalReport: function(slug, source) {\n            var self = this;\n            var modalBody = this.modal.getBody();\n            var cacheKey = slug + '_' + source;\n\n            // Check cache first for instant loading\n            if (this.reportDataCache[cacheKey]) {\n                var cached = this.reportDataCache[cacheKey];\n                modalBody.find('.modal-loading').addClass('d-none');\n                this.renderModalContent(modalBody, cached.report, cached.results, cached.chartData, cached.chartType);\n                return;\n            }\n\n            // Find the report from our cached list\n            var report = this.reports.find(function(r) {\n                return r.slug === slug;\n            });\n\n            if (!report) {\n                modalBody.find('.modal-loading').addClass('d-none');\n                modalBody.find('.modal-error').removeClass('d-none');\n                return;\n            }\n\n            // For wizard reports, execute locally via generate_report.php\n            // For AI reports, we need to fetch from backend\n            if (source === 'wizard') {\n                // Execute report via local Moodle AJAX endpoint\n                $.ajax({\n                    url: M.cfg.wwwroot + '/report/adeptus_insights/ajax/generate_report.php',\n                    method: 'POST',\n                    data: {\n                        reportid: report.name || report.report_template_id,\n                        sesskey: M.cfg.sesskey\n                    },\n                    dataType: 'json',\n                    timeout: 30000\n                }).done(function(response) {\n                    modalBody.find('.modal-loading').addClass('d-none');\n\n                    if (response.success) {\n                        // Cache the result for future use\n                        self.reportDataCache[cacheKey] = {\n                            report: report,\n                            results: response.results || [],\n                            chartData: response.chart_data,\n                            chartType: response.chart_type\n                        };\n                        self.renderModalContent(modalBody, report, response.results || [], response.chart_data, response.chart_type);\n                    } else {\n                        modalBody.find('.modal-error').removeClass('d-none');\n                        modalBody.find('.modal-error p').text(response.message || 'Failed to load report');\n                    }\n                }).fail(function() {\n                    modalBody.find('.modal-loading').addClass('d-none');\n                    modalBody.find('.modal-error').removeClass('d-none');\n                });\n            } else {\n                // AI reports - fetch from backend API\n                var token = this.apiKey || (window.adeptusAuthData ? window.adeptusAuthData.api_key : null);\n\n                if (!token) {\n                    modalBody.find('.modal-loading').addClass('d-none');\n                    modalBody.find('.modal-error').removeClass('d-none');\n                    return;\n                }\n\n                $.ajax({\n                    url: 'https://a360backend.stagingwithswift.com/api/v1/ai-reports/' + slug,\n                    method: 'GET',\n                    headers: {\n                        'Authorization': 'Bearer ' + token,\n                        'Accept': 'application/json'\n                    },\n                    timeout: 15000\n                }).done(function(response) {\n                    modalBody.find('.modal-loading').addClass('d-none');\n\n                    if (response.success && response.report) {\n                        // Cache the result for future use\n                        self.reportDataCache[cacheKey] = {\n                            report: response.report,\n                            results: response.data || [],\n                            chartData: null,\n                            chartType: null\n                        };\n                        self.renderModalContent(modalBody, response.report, response.data || [], null, null);\n                    } else {\n                        modalBody.find('.modal-error').removeClass('d-none');\n                    }\n                }).fail(function() {\n                    modalBody.find('.modal-loading').addClass('d-none');\n                    modalBody.find('.modal-error').removeClass('d-none');\n                });\n            }\n        },\n\n        /**\n         * Render modal content with report data.\n         *\n         * @param {jQuery} modalBody\n         * @param {Object} report\n         * @param {Array} data\n         * @param {Object} chartData - Pre-configured chart data from backend (unused, we use controls)\n         * @param {string} chartType - Chart type from backend (unused, we use controls)\n         */\n        renderModalContent: function(modalBody, report, data, chartData, chartType) {\n            var self = this;\n\n            // Store data for chart re-rendering\n            this.modalData = data || [];\n            this.modalReport = report;\n\n            var contentArea = modalBody.find('.modal-content-area');\n            contentArea.removeClass('d-none');\n\n            // Set report metadata\n            var category = report.category_info || {name: 'General', color: '#6c757d'};\n            modalBody.find('.report-category')\n                .text(category.name)\n                .css('background-color', category.color);\n            modalBody.find('.row-count-num').text(this.modalData.length);\n            modalBody.find('.report-date')\n                .text(report.last_executed_at ? 'Last run: ' + new Date(report.last_executed_at).toLocaleDateString() : '');\n\n            // Populate axis selectors\n            this.populateAxisSelectors(modalBody);\n\n            // Render table\n            this.renderModalTable(modalBody, this.modalData);\n\n            // Set up view full report link (admin only)\n            if (this.isAdmin) {\n                var reportUrl = M.cfg.wwwroot + '/report/adeptus_insights/generated_reports.php?slug=' + encodeURIComponent(report.slug);\n                modalBody.find('.view-full-report').attr('href', reportUrl);\n                modalBody.find('.modal-footer-link').removeClass('d-none');\n            } else {\n                modalBody.find('.modal-footer-link').addClass('d-none');\n            }\n\n            // Reset to table view\n            this.currentView = 'table';\n            modalBody.find('.view-toggle-btn').removeClass('active');\n            modalBody.find('.view-toggle-btn[data-view=\"table\"]').addClass('active');\n            modalBody.find('#modal-table-view').removeClass('d-none');\n            modalBody.find('#modal-chart-view').addClass('d-none');\n        },\n\n        /**\n         * Populate X-axis and Y-axis dropdown selectors.\n         *\n         * @param {jQuery} modalBody\n         */\n        populateAxisSelectors: function(modalBody) {\n            var data = this.modalData;\n            if (!data || data.length === 0) {\n                return;\n            }\n\n            var headers = Object.keys(data[0]);\n            var xAxisSelect = modalBody.find('#modal-chart-x-axis');\n            var yAxisSelect = modalBody.find('#modal-chart-y-axis');\n\n            // Clear existing options\n            xAxisSelect.empty();\n            yAxisSelect.empty();\n\n            // Detect numeric columns for Y-axis\n            var numericCols = this.detectNumericColumns(data, headers);\n\n            // Populate X-axis with all columns\n            headers.forEach(function(header, idx) {\n                var formattedHeader = header.replace(/_/g, ' ').replace(/\\b\\w/g, function(l) { return l.toUpperCase(); });\n                var selected = idx === 0 ? ' selected' : '';\n                xAxisSelect.append('<option value=\"' + header + '\"' + selected + '>' + formattedHeader + '</option>');\n            });\n\n            // Populate Y-axis with numeric columns (or all if none detected)\n            var yAxisOptions = numericCols.length > 0 ? numericCols : headers;\n            yAxisOptions.forEach(function(col, idx) {\n                var formattedHeader = col.replace(/_/g, ' ').replace(/\\b\\w/g, function(l) { return l.toUpperCase(); });\n                // Select the last numeric column by default (usually the main value)\n                var selected = idx === yAxisOptions.length - 1 ? ' selected' : '';\n                yAxisSelect.append('<option value=\"' + col + '\"' + selected + '>' + formattedHeader + '</option>');\n            });\n        },\n\n        /**\n         * Detect numeric columns in data.\n         *\n         * @param {Array} data\n         * @param {Array} headers\n         * @return {Array}\n         */\n        detectNumericColumns: function(data, headers) {\n            var numericCols = [];\n\n            headers.forEach(function(header) {\n                var isNumeric = data.every(function(row) {\n                    var val = row[header];\n                    if (val === null || val === undefined || val === '') {\n                        return true; // Allow nulls\n                    }\n                    return !isNaN(parseFloat(val)) && isFinite(val);\n                });\n\n                // Also check if at least some values are actually numbers\n                var hasNumbers = data.some(function(row) {\n                    var val = row[header];\n                    return val !== null && val !== undefined && val !== '' && !isNaN(parseFloat(val));\n                });\n\n                if (isNumeric && hasNumbers) {\n                    numericCols.push(header);\n                }\n            });\n\n            return numericCols;\n        },\n\n        /**\n         * Render chart in modal using current control values.\n         */\n        renderModalChart: function() {\n            var self = this;\n            var modalBody = this.modal.getBody();\n            var data = this.modalData;\n\n            if (!data || data.length === 0) {\n                modalBody.find('.chart-container').html(\n                    '<div class=\"alert alert-warning text-center\"><i class=\"fa fa-info-circle\"></i> No data available for chart</div>'\n                );\n                return;\n            }\n\n            var canvas = modalBody.find('.modal-chart')[0];\n            if (!canvas) {\n                return;\n            }\n\n            // Destroy existing chart\n            if (this.chartInstance) {\n                this.chartInstance.destroy();\n                this.chartInstance = null;\n            }\n\n            // Get control values\n            var chartType = modalBody.find('#modal-chart-type').val() || 'bar';\n            var labelKey = modalBody.find('#modal-chart-x-axis').val();\n            var valueKey = modalBody.find('#modal-chart-y-axis').val();\n\n            // Fallback if not set\n            if (!labelKey || !valueKey) {\n                var headers = Object.keys(data[0]);\n                labelKey = labelKey || headers[0];\n                valueKey = valueKey || headers[headers.length - 1];\n            }\n\n            // Format value key for display\n            var valueKeyFormatted = valueKey.replace(/_/g, ' ').replace(/\\b\\w/g, function(l) { return l.toUpperCase(); });\n\n            // Limit data for chart readability (max 50 items)\n            var chartData = data.slice(0, 50);\n            var labels = chartData.map(function(row) {\n                var label = row[labelKey];\n                if (label === null || label === undefined) return 'Unknown';\n                var labelStr = String(label);\n                return labelStr.length > 30 ? labelStr.substring(0, 30) + '...' : labelStr;\n            });\n            var values = chartData.map(function(row) {\n                return parseFloat(row[valueKey]) || 0;\n            });\n\n            // Generate colors\n            var colors = this.generateChartColors(values.length, chartType);\n\n            // Create chart config\n            var config = this.createChartConfig(chartType, labels, values, valueKeyFormatted, colors);\n\n            try {\n                this.chartInstance = new Chart(canvas.getContext('2d'), config);\n            } catch (error) {\n                modalBody.find('.chart-container').html(\n                    '<div class=\"alert alert-danger\"><i class=\"fa fa-exclamation-triangle\"></i> Error rendering chart</div>'\n                );\n            }\n        },\n\n        /**\n         * Create Chart.js configuration.\n         *\n         * @param {string} chartType\n         * @param {Array} labels\n         * @param {Array} values\n         * @param {string} valueKey\n         * @param {Array} colors\n         * @return {Object}\n         */\n        createChartConfig: function(chartType, labels, values, valueKey, colors) {\n            var reportName = this.modalReport ? this.modalReport.name : 'Report';\n\n            var baseOptions = {\n                responsive: true,\n                maintainAspectRatio: false,\n                plugins: {\n                    title: {\n                        display: true,\n                        text: reportName,\n                        font: { size: 14, weight: 'bold' },\n                        padding: { top: 10, bottom: 20 }\n                    },\n                    legend: {\n                        display: chartType === 'pie' || chartType === 'doughnut',\n                        position: 'right'\n                    }\n                }\n            };\n\n            if (chartType === 'pie' || chartType === 'doughnut') {\n                return {\n                    type: chartType,\n                    data: {\n                        labels: labels,\n                        datasets: [{\n                            data: values,\n                            backgroundColor: colors,\n                            borderWidth: 2\n                        }]\n                    },\n                    options: baseOptions\n                };\n            } else {\n                // Bar or Line chart\n                baseOptions.scales = {\n                    y: {\n                        beginAtZero: true,\n                        title: {\n                            display: true,\n                            text: valueKey\n                        }\n                    },\n                    x: {\n                        title: {\n                            display: false\n                        }\n                    }\n                };\n\n                return {\n                    type: chartType,\n                    data: {\n                        labels: labels,\n                        datasets: [{\n                            label: valueKey,\n                            data: values,\n                            backgroundColor: chartType === 'line' ? 'transparent' : colors[0],\n                            borderColor: colors[0].replace('0.7', '1'),\n                            borderWidth: 2,\n                            fill: chartType === 'line' ? false : true,\n                            tension: 0.1\n                        }]\n                    },\n                    options: baseOptions\n                };\n            }\n        },\n\n        /**\n         * Generate chart colors.\n         *\n         * @param {number} count\n         * @param {string} chartType\n         * @return {Array}\n         */\n        generateChartColors: function(count, chartType) {\n            var baseColors = [\n                'rgba(37, 99, 235, 0.7)',   // Blue\n                'rgba(16, 185, 129, 0.7)',  // Green\n                'rgba(245, 158, 11, 0.7)',  // Amber\n                'rgba(239, 68, 68, 0.7)',   // Red\n                'rgba(139, 92, 246, 0.7)',  // Purple\n                'rgba(6, 182, 212, 0.7)',   // Cyan\n                'rgba(236, 72, 153, 0.7)',  // Pink\n                'rgba(132, 204, 22, 0.7)',  // Lime\n                'rgba(249, 115, 22, 0.7)',  // Orange\n                'rgba(99, 102, 241, 0.7)'   // Indigo\n            ];\n\n            var colors = [];\n            for (var i = 0; i < count; i++) {\n                colors.push(baseColors[i % baseColors.length]);\n            }\n            return colors;\n        },\n\n        /**\n         * Export modal data as CSV.\n         *\n         * @param {string} format\n         */\n        exportModalData: function(format) {\n            var data = this.modalData;\n            var report = this.modalReport;\n\n            if (!data || data.length === 0) {\n                Notification.addNotification({\n                    message: 'No data to export',\n                    type: 'warning'\n                });\n                return;\n            }\n\n            if (format === 'csv') {\n                var headers = Object.keys(data[0]);\n                var csvContent = headers.join(',') + '\\n';\n\n                data.forEach(function(row) {\n                    var values = headers.map(function(h) {\n                        var val = row[h];\n                        if (val === null || val === undefined) val = '';\n                        // Escape quotes and wrap in quotes if contains comma\n                        val = String(val).replace(/\"/g, '\"\"');\n                        if (val.indexOf(',') !== -1 || val.indexOf('\"') !== -1 || val.indexOf('\\n') !== -1) {\n                            val = '\"' + val + '\"';\n                        }\n                        return val;\n                    });\n                    csvContent += values.join(',') + '\\n';\n                });\n\n                // Download\n                var blob = new Blob([csvContent], {type: 'text/csv;charset=utf-8;'});\n                var link = document.createElement('a');\n                link.href = URL.createObjectURL(blob);\n                link.download = (report ? report.name.replace(/[^a-z0-9]/gi, '_') : 'report') + '.csv';\n                link.click();\n            }\n        },\n\n        /**\n         * Render table in modal with pagination.\n         *\n         * @param {jQuery} modalBody\n         * @param {Array} data\n         */\n        renderModalTable: function(modalBody, data) {\n            // Reset pagination\n            this.tableCurrentPage = 1;\n            this.tableTotalPages = Math.ceil((data ? data.length : 0) / this.tableRowsPerPage);\n\n            // Build table headers once\n            var table = modalBody.find('.modal-table');\n            var thead = table.find('thead');\n\n            thead.empty();\n\n            if (!data || data.length === 0) {\n                modalBody.find('.modal-table-container').addClass('d-none');\n                return;\n            }\n\n            // Build headers from first row\n            var headers = Object.keys(data[0]);\n            var headerRow = $('<tr>');\n            headers.forEach(function(h) {\n                // Format header nicely\n                var formatted = h.replace(/_/g, ' ').replace(/\\b\\w/g, function(l) { return l.toUpperCase(); });\n                headerRow.append($('<th>').text(formatted));\n            });\n            thead.append(headerRow);\n\n            // Render first page\n            this.renderModalTablePage();\n        },\n\n        /**\n         * Render current page of table data.\n         */\n        renderModalTablePage: function() {\n            var modalBody = this.modal.getBody();\n            var data = this.modalData || [];\n            var table = modalBody.find('.modal-table');\n            var tbody = table.find('tbody');\n\n            tbody.empty();\n\n            if (!data || data.length === 0) {\n                return;\n            }\n\n            var headers = Object.keys(data[0]);\n\n            // Calculate page slice\n            var startIndex = (this.tableCurrentPage - 1) * this.tableRowsPerPage;\n            var endIndex = startIndex + this.tableRowsPerPage;\n            var pageData = data.slice(startIndex, endIndex);\n\n            // Build rows\n            pageData.forEach(function(row) {\n                var tr = $('<tr>');\n                headers.forEach(function(h) {\n                    var val = row[h];\n                    if (val === null || val === undefined) val = '';\n                    // Truncate long values\n                    var displayVal = String(val);\n                    if (displayVal.length > 100) {\n                        displayVal = displayVal.substring(0, 100) + '...';\n                    }\n                    tr.append($('<td>').attr('title', val).text(displayVal));\n                });\n                tbody.append(tr);\n            });\n\n            // Update pagination info and controls\n            var actualEnd = Math.min(endIndex, data.length);\n            modalBody.find('.row-count').text(data.length + ' total rows');\n\n            var paginationInfo = modalBody.find('.table-pagination-info');\n            paginationInfo.text((startIndex + 1) + '-' + actualEnd + ' of ' + data.length);\n\n            // Update button states\n            modalBody.find('.table-pagination-prev').prop('disabled', this.tableCurrentPage <= 1);\n            modalBody.find('.table-pagination-next').prop('disabled', this.tableCurrentPage >= this.tableTotalPages);\n\n            // Show/hide pagination based on total pages\n            if (this.tableTotalPages > 1) {\n                modalBody.find('.table-pagination').removeClass('d-none');\n            } else {\n                modalBody.find('.table-pagination').addClass('d-none');\n            }\n        },\n\n        /**\n         * Open report in new tab.\n         *\n         * @param {string} slug\n         * @param {string} source\n         */\n        openReportNewTab: function(slug, source) {\n            var url = M.cfg.wwwroot + '/report/adeptus_insights/generated_reports.php?slug=' + encodeURIComponent(slug);\n            window.open(url, '_blank');\n        },\n\n        /**\n         * Expand report inline.\n         *\n         * @param {string} slug\n         * @param {string} source\n         */\n        expandReportInline: function(slug, source) {\n            // TODO: Implement inline expansion.\n        },\n\n        /**\n         * Export report.\n         *\n         * @param {string} format\n         */\n        exportReport: function(format) {\n            // TODO: Implement export functionality.\n            Notification.addNotification({\n                message: 'Export to ' + format.toUpperCase() + ' coming soon',\n                type: 'info'\n            });\n        },\n\n        /**\n         * Refresh the block (clears cache and reloads).\n         */\n        refresh: function() {\n            var refreshBtn = this.container.find('.block-adeptus-refresh i');\n            refreshBtn.addClass('fa-spin');\n\n            // Clear all caches for fresh data\n            this.clearAllCaches();\n\n            // Force reload from server\n            this.showLoading();\n            var self = this;\n            this.waitForAuth(function() {\n                self.fetchReports();\n            });\n\n            setTimeout(function() {\n                refreshBtn.removeClass('fa-spin');\n            }, 1000);\n        },\n\n        /**\n         * Clear all caches.\n         */\n        clearAllCaches: function() {\n            // Clear sessionStorage cache\n            try {\n                sessionStorage.removeItem(this.cacheKey);\n            } catch (e) {\n                // Ignore\n            }\n            // Clear in-memory report data cache\n            this.reportDataCache = {};\n        },\n\n        /**\n         * Setup auto-refresh timer.\n         */\n        setupAutoRefresh: function() {\n            var interval = this.config.autoRefresh;\n            if (!interval || interval === 'never') {\n                return;\n            }\n\n            var ms;\n            switch (interval) {\n                case '5m':\n                    ms = 5 * 60 * 1000;\n                    break;\n                case '15m':\n                    ms = 15 * 60 * 1000;\n                    break;\n                case '30m':\n                    ms = 30 * 60 * 1000;\n                    break;\n                case '1h':\n                    ms = 60 * 60 * 1000;\n                    break;\n                default:\n                    return;\n            }\n\n            var self = this;\n            this.refreshTimer = setInterval(function() {\n                // Only refresh if page is visible.\n                if (!document.hidden) {\n                    self.refresh();\n                }\n            }, ms);\n        },\n\n        /**\n         * Show loading state.\n         */\n        showLoading: function() {\n            this.container.find('.block-adeptus-loading').removeClass('d-none');\n            this.container.find('.block-adeptus-report-list, .block-adeptus-kpi-grid, .block-adeptus-tabs-container, .block-adeptus-content').addClass('d-none');\n            this.container.find('.block-adeptus-empty, .block-adeptus-error').addClass('d-none');\n        },\n\n        /**\n         * Hide loading state.\n         */\n        hideLoading: function() {\n            this.container.find('.block-adeptus-loading').addClass('d-none');\n        },\n\n        /**\n         * Show empty state.\n         */\n        showEmpty: function() {\n            this.hideLoading();\n            this.container.find('.block-adeptus-empty').removeClass('d-none');\n        },\n\n        /**\n         * Show error state.\n         *\n         * @param {string} message\n         */\n        showError: function(message) {\n            this.hideLoading();\n            this.container.find('.block-adeptus-error').removeClass('d-none');\n        },\n\n        /**\n         * Update the timestamp display.\n         */\n        updateTimestamp: function() {\n            if (!this.config.showTimestamp || !this.lastUpdated) {\n                return;\n            }\n\n            var timestampEl = this.container.find('.block-adeptus-timestamp');\n            var text = this.formatTimeAgo(this.lastUpdated);\n\n            timestampEl.find('.timestamp-text').text(text);\n            timestampEl.removeClass('d-none');\n        },\n\n        /**\n         * Scroll to the top of the report list.\n         */\n        scrollToListTop: function() {\n            var listContainer = this.container.find('.block-adeptus-report-list');\n            if (listContainer.length) {\n                listContainer[0].scrollIntoView({behavior: 'smooth', block: 'start'});\n            }\n        },\n\n        /**\n         * Format a date as \"X ago\".\n         *\n         * @param {Date} date\n         * @return {string}\n         */\n        formatTimeAgo: function(date) {\n            var seconds = Math.floor((new Date() - date) / 1000);\n\n            if (seconds < 60) {\n                return 'Just now';\n            }\n\n            var minutes = Math.floor(seconds / 60);\n            if (minutes < 60) {\n                return minutes + ' minute' + (minutes !== 1 ? 's' : '') + ' ago';\n            }\n\n            var hours = Math.floor(minutes / 60);\n            if (hours < 24) {\n                return hours + ' hour' + (hours !== 1 ? 's' : '') + ' ago';\n            }\n\n            var days = Math.floor(hours / 24);\n            return days + ' day' + (days !== 1 ? 's' : '') + ' ago';\n        }\n    };\n\n    return {\n        /**\n         * Initialize the block.\n         *\n         * @param {Object} options\n         */\n        init: function(options) {\n            return new BlockController(options);\n        }\n    };\n});\n"],"names":["define","$","Ajax","Notification","Str","ModalFactory","ModalEvents","Templates","Chart","BlockController","options","blockId","blockid","contextId","contextid","config","apiKey","isAdmin","container","reports","lastUpdated","refreshTimer","modal","modalData","modalReport","chartInstance","currentView","listCurrentPage","listItemsPerPage","this","maxLinkItems","listTotalPages","tableCurrentPage","tableRowsPerPage","tableTotalPages","selectedCategory","availableCategories","cacheKey","cacheTTL","reportDataCache","preloadTimeout","preloadingSlug","init","prototype","length","bindEvents","loadReports","setupAutoRefresh","self","on","e","preventDefault","refresh","slug","data","source","handleReportClick","key","tabPane","target","attr","loadTabContent","format","exportReport","renderCurrentPage","scrollToListTop","val","renderReports","clearTimeout","setTimeout","preloadReportData","showLoading","cachedData","getFromCache","Date","waitForAuth","fetchReports","cached","sessionStorage","getItem","JSON","parse","timestamp","now","removeItem","saveToCache","setItem","stringify","report","find","r","ajax","url","M","cfg","wwwroot","method","reportid","name","report_template_id","sesskey","dataType","timeout","done","response","success","results","chartData","chart_data","chartType","chart_type","fail","token","window","adeptusAuthData","api_key","headers","callback","showError","promises","reportSource","push","fetchFromApi","when","apply","then","allReports","i","result","arguments","forEach","endpoint","mode","displayMode","populateCategoryFilter","filterReports","renderEmbedded","renderKpi","renderTabs","renderLinks","hideLoading","updateTimestamp","showEmpty","categoryMap","catInfo","category_info","color","category","Object","values","sort","a","b","localeCompare","select","remove","cat","selected","append","slice","filter","selectedReports","indexOf","nameA","title","display_name","report_name","nameB","filteredReports","Math","ceil","listContainer","template","paginationContainer","startIndex","endIndex","pageReports","empty","item","html","$item","reportName","text","categoryName","categoryColor","css","removeClass","actualEnd","prop","addClass","embeddedReport","embeddedData","embeddedChartInstance","loadEmbeddedReport","renderEmbeddedContent","message","contentArea","showChart","renderEmbeddedChart","showTable","renderEmbeddedTable","chartContainer","canvas","destroy","keys","numericCols","detectNumericColumns","labelKey","valueKey","valueKeyFormatted","replace","l","toUpperCase","labels","map","row","label","labelStr","String","substring","parseFloat","colors","generateChartColors","type","datasets","backgroundColor","borderColor","borderWidth","responsive","maintainAspectRatio","plugins","legend","display","scales","y","beginAtZero","x","getContext","error","table","thead","tbody","maxRows","tableMaxRows","headerRow","h","formatted","tr","displayVal","countText","min","gridContainer","maxCards","parseInt","kpiColumns","index","card","$card","icons","loadKpiData","renderKpiValue","value","formattedValue","valueCol","toLowerCase","includes","reduce","sum","toFixed","Number","isInteger","toLocaleString","trendContainer","tabNav","tabContent","tabTemplate","paneTemplate","tabChartInstances","tabId","tab","pane","firstPane","first","renderTabContent","chartHeight","renderTabChart","renderTabTable","clickAction","openReportModal","openReportNewTab","expandReportInline","render","create","types","DEFAULT","body","large","bindModalEvents","getRoot","shown","loadModalReport","hidden","show","catch","exception","modalRoot","view","switchModalView","renderModalChart","exportModalData","renderModalTablePage","modalBody","getBody","renderModalContent","last_executed_at","toLocaleDateString","populateAxisSelectors","renderModalTable","reportUrl","encodeURIComponent","xAxisSelect","yAxisSelect","header","idx","formattedHeader","yAxisOptions","col","isNumeric","every","isNaN","isFinite","hasNumbers","some","createChartConfig","baseOptions","font","size","weight","padding","top","bottom","position","fill","tension","count","baseColors","csvContent","join","blob","Blob","link","document","createElement","href","URL","createObjectURL","download","click","addNotification","open","refreshBtn","clearAllCaches","interval","autoRefresh","ms","setInterval","showTimestamp","timestampEl","formatTimeAgo","scrollIntoView","behavior","block","date","seconds","floor","minutes","hours","days"],"mappings":"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"}