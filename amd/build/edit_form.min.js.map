{"version":3,"file":"edit_form.min.js","sources":["../src/edit_form.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * JavaScript for the block edit form - report selection UI with searchable dropdown.\n *\n * @module     block_adeptus_insights/edit_form\n * @copyright  2025 Adeptus Analytics\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/str', 'core/notification'], function($, Str, Notification) {\n    'use strict';\n\n\n    /**\n     * Report Selector class for managing report selection in the edit form.\n     *\n     * @param {Object} options Configuration options\n     */\n    // Available icons for KPI cards (FontAwesome 4).\n    var KPI_ICONS = [\n        {id: 'fa-users', label: 'Users', category: 'People'},\n        {id: 'fa-user', label: 'User', category: 'People'},\n        {id: 'fa-user-plus', label: 'New User', category: 'People'},\n        {id: 'fa-graduation-cap', label: 'Education', category: 'Education'},\n        {id: 'fa-book', label: 'Book', category: 'Education'},\n        {id: 'fa-certificate', label: 'Certificate', category: 'Education'},\n        {id: 'fa-clock-o', label: 'Time', category: 'Time'},\n        {id: 'fa-calendar', label: 'Calendar', category: 'Time'},\n        {id: 'fa-hourglass-half', label: 'Hourglass', category: 'Time'},\n        {id: 'fa-check-circle', label: 'Complete', category: 'Status'},\n        {id: 'fa-check', label: 'Check', category: 'Status'},\n        {id: 'fa-trophy', label: 'Trophy', category: 'Status'},\n        {id: 'fa-star', label: 'Star', category: 'Status'},\n        {id: 'fa-bar-chart', label: 'Bar Chart', category: 'Analytics'},\n        {id: 'fa-line-chart', label: 'Line Chart', category: 'Analytics'},\n        {id: 'fa-pie-chart', label: 'Pie Chart', category: 'Analytics'},\n        {id: 'fa-area-chart', label: 'Area Chart', category: 'Analytics'},\n        {id: 'fa-percent', label: 'Percent', category: 'Numbers'},\n        {id: 'fa-hashtag', label: 'Number', category: 'Numbers'},\n        {id: 'fa-sort-numeric-asc', label: 'Ranking', category: 'Numbers'},\n        {id: 'fa-dollar', label: 'Dollar', category: 'Financial'},\n        {id: 'fa-gbp', label: 'Pound', category: 'Financial'},\n        {id: 'fa-money', label: 'Money', category: 'Financial'},\n        {id: 'fa-tasks', label: 'Tasks', category: 'Progress'},\n        {id: 'fa-spinner', label: 'Progress', category: 'Progress'},\n        {id: 'fa-bullseye', label: 'Target', category: 'Progress'},\n        {id: 'fa-flag', label: 'Flag', category: 'Progress'},\n        {id: 'fa-envelope', label: 'Email', category: 'Communication'},\n        {id: 'fa-comments', label: 'Comments', category: 'Communication'},\n        {id: 'fa-bell', label: 'Notifications', category: 'Communication'},\n        {id: 'fa-exclamation-triangle', label: 'Warning', category: 'Alerts'},\n        {id: 'fa-info-circle', label: 'Info', category: 'Alerts'},\n        {id: 'fa-thumbs-up', label: 'Thumbs Up', category: 'Feedback'},\n        {id: 'fa-thumbs-down', label: 'Thumbs Down', category: 'Feedback'},\n        {id: 'fa-smile-o', label: 'Satisfaction', category: 'Feedback'}\n    ];\n\n    // Default icons for KPI cards (fallback when no icon selected).\n    var DEFAULT_KPI_ICONS = ['fa-users', 'fa-graduation-cap', 'fa-clock-o', 'fa-check-circle'];\n\n    /**\n     * Report Selector component for picking KPI/Tab reports.\n     * @param {Object} options Configuration options\n     */\n    var ReportSelector = function(options) {\n        this.mode = options.mode || 'kpi'; // 'kpi' or 'tabs'\n        this.apiKey = options.apiKey || '';\n        this.containerId = options.containerId;\n        this.textareaName = options.textareaName;\n        this.container = null;\n        this.textarea = null;\n        this.reports = [];\n        this.filteredReports = [];\n        this.selectedReports = [];\n        this.strings = {};\n        this.searchTimeout = null;\n        this.highlightedIndex = -1;\n        this.isDropdownOpen = false;\n\n        this.init();\n    };\n\n    ReportSelector.prototype = {\n        /**\n         * Initialize the report selector.\n         */\n        init: function() {\n            var self = this;\n\n            this.container = $('#' + this.containerId);\n            this.textarea = $('[name=\"' + this.textareaName + '\"]');\n\n            if (!this.container.length || !this.textarea.length) {\n                return;\n            }\n\n            // Load existing selection from textarea\n            this.loadExistingSelection();\n\n            // Load language strings\n            this.loadStrings().then(function() {\n                // Render the UI\n                self.render();\n\n                // Fetch reports from API\n                self.fetchReports();\n\n                // Bind events\n                self.bindEvents();\n\n                // Show container - Moodle's hideIf handles visibility based on display_mode.\n                self.container.show();\n            });\n        },\n\n        /**\n         * Load language strings.\n         *\n         * @return {Promise}\n         */\n        loadStrings: function() {\n            var self = this;\n            return Str.get_strings([\n                {key: 'addreport', component: 'block_adeptus_insights'},\n                {key: 'removereport', component: 'block_adeptus_insights'},\n                {key: 'noreportsselected', component: 'block_adeptus_insights'},\n                {key: 'selectareport', component: 'block_adeptus_insights'},\n                {key: 'loading', component: 'block_adeptus_insights'},\n                {key: 'config_alert_report_placeholder', component: 'block_adeptus_insights'}\n            ]).then(function(strings) {\n                self.strings = {\n                    addreport: strings[0],\n                    removereport: strings[1],\n                    noreportsselected: strings[2],\n                    selectareport: strings[3],\n                    loading: strings[4],\n                    searchplaceholder: strings[5] || 'Search reports by name, category, or type...'\n                };\n            });\n        },\n\n        /**\n         * Load existing selection from textarea.\n         */\n        loadExistingSelection: function() {\n            try {\n                var value = this.textarea.val();\n                if (value) {\n                    this.selectedReports = JSON.parse(value);\n                }\n            } catch (e) {\n                this.selectedReports = [];\n            }\n        },\n\n        /**\n         * Render the report selector UI with searchable dropdown.\n         */\n        render: function() {\n            var modeLabels = {\n                'kpi': 'KPI Reports',\n                'tabs': 'Tab Reports',\n                'manual': 'Selected Reports'\n            };\n            var modeLabel = modeLabels[this.mode] || 'Reports';\n            var uniqueId = this.mode + '-search-' + Date.now();\n\n            var html = '<div class=\"report-selector-ui\">' +\n                '<div class=\"report-selector-header d-flex justify-content-between align-items-center mb-2\">' +\n                '<span class=\"font-weight-bold\">' + modeLabel + '</span>' +\n                '<span class=\"badge badge-secondary report-count\">0 selected</span>' +\n                '</div>' +\n\n                // Searchable dropdown container\n                '<div class=\"report-selector-search-container mb-3 position-relative\">' +\n                '<div class=\"input-group\">' +\n                '<div class=\"input-group-prepend\">' +\n                '<span class=\"input-group-text\"><i class=\"fa fa-search\"></i></span>' +\n                '</div>' +\n                '<input type=\"text\" class=\"form-control report-search-input\" ' +\n                'id=\"' + uniqueId + '\" ' +\n                'placeholder=\"' + this.strings.searchplaceholder + '\" ' +\n                'autocomplete=\"off\" ' +\n                'aria-haspopup=\"listbox\" ' +\n                'aria-expanded=\"false\">' +\n                '<div class=\"input-group-append\">' +\n                '<button type=\"button\" class=\"btn btn-primary report-selector-add-btn\" disabled>' +\n                '<i class=\"fa fa-plus\"></i> ' + this.strings.addreport +\n                '</button>' +\n                '</div>' +\n                '</div>' +\n\n                // Dropdown results container\n                '<div class=\"report-search-dropdown position-absolute w-100 bg-white border rounded shadow-sm\" ' +\n                'style=\"display:none; z-index:1050; max-height:350px; overflow-y:auto; top:100%; left:0;\">' +\n                '<div class=\"report-search-results\"></div>' +\n                '<div class=\"report-search-empty text-muted text-center py-3\" style=\"display:none;\">' +\n                '<i class=\"fa fa-search\"></i> No matching reports found' +\n                '</div>' +\n                '<div class=\"report-search-loading text-center py-3\" style=\"display:none;\">' +\n                '<i class=\"fa fa-spinner fa-spin\"></i> ' + this.strings.loading +\n                '</div>' +\n                '</div>' +\n                '</div>' +\n\n                // Selected reports list\n                '<div class=\"report-selector-list-container\">' +\n                '<ul class=\"list-group report-selector-list\"></ul>' +\n                '<div class=\"report-selector-empty text-muted text-center py-3\">' +\n                '<i class=\"fa fa-inbox fa-2x mb-2\"></i><br>' +\n                this.strings.noreportsselected +\n                '</div>' +\n                '</div>' +\n                '</div>';\n\n            this.container.html(html);\n            this.updateListDisplay();\n            this.updateSelectedCount();\n        },\n\n        /**\n         * Fetch reports from the API.\n         */\n        fetchReports: function() {\n            var self = this;\n\n            if (!this.apiKey) {\n                this.container.find('.report-search-loading').hide();\n                this.container.find('.report-search-empty').show().html(\n                    '<i class=\"fa fa-exclamation-triangle\"></i> API key not configured'\n                );\n                return;\n            }\n\n            this.container.find('.report-search-loading').show();\n\n            var baseUrl = 'https://backend.adeptus360.com/api/v1';\n\n            // Fetch both wizard and AI reports\n            $.when(\n                $.ajax({\n                    url: baseUrl + '/wizard-reports',\n                    method: 'GET',\n                    headers: {\n                        'Authorization': 'Bearer ' + this.apiKey,\n                        'Accept': 'application/json'\n                    },\n                    timeout: 15000\n                }),\n                $.ajax({\n                    url: baseUrl + '/ai-reports',\n                    method: 'GET',\n                    headers: {\n                        'Authorization': 'Bearer ' + this.apiKey,\n                        'Accept': 'application/json'\n                    },\n                    timeout: 15000\n                })\n            ).then(function(wizardResult, aiResult) {\n                var allReports = [];\n\n                // Process wizard reports\n                var wizardReports = wizardResult[0].reports || wizardResult[0].data || [];\n                wizardReports.forEach(function(r) {\n                    r.source = 'wizard';\n                    r.displayName = r.name || r.title || r.display_name || r.slug;\n                    r.categoryName = r.category_info ? r.category_info.name : 'General';\n                    allReports.push(r);\n                });\n\n                // Process AI reports\n                var aiReports = aiResult[0].reports || aiResult[0].data || [];\n                aiReports.forEach(function(r) {\n                    r.source = 'ai';\n                    r.displayName = r.name || r.title || r.display_name || r.slug;\n                    r.categoryName = r.category_info ? r.category_info.name : 'AI Generated';\n                    allReports.push(r);\n                });\n\n                // Sort alphabetically by name\n                allReports.sort(function(a, b) {\n                    return a.displayName.localeCompare(b.displayName);\n                });\n\n                self.reports = allReports;\n                self.filteredReports = self.getAvailableReports();\n                self.container.find('.report-search-loading').hide();\n                self.renderSelectedList();\n            }).fail(function() {\n                self.container.find('.report-search-loading').hide();\n                Notification.addNotification({\n                    message: 'Failed to load reports',\n                    type: 'error'\n                });\n            });\n        },\n\n        /**\n         * Get reports that haven't been selected yet.\n         *\n         * @return {Array}\n         */\n        getAvailableReports: function() {\n            var self = this;\n            return this.reports.filter(function(report) {\n                return !self.selectedReports.some(function(s) {\n                    return s.slug === report.slug && s.source === report.source;\n                });\n            });\n        },\n\n        /**\n         * Filter reports based on search query.\n         *\n         * @param {string} query Search query\n         * @return {Array} Filtered reports\n         */\n        filterReports: function(query) {\n            var available = this.getAvailableReports();\n\n            if (!query || query.length < 1) {\n                return available;\n            }\n\n            query = query.toLowerCase().trim();\n            var terms = query.split(/\\s+/);\n\n            return available.filter(function(report) {\n                var searchText = (\n                    report.displayName + ' ' +\n                    report.categoryName + ' ' +\n                    report.source + ' ' +\n                    (report.slug || '')\n                ).toLowerCase();\n\n                // All terms must match\n                return terms.every(function(term) {\n                    return searchText.indexOf(term) !== -1;\n                });\n            }).slice(0, 50); // Limit to 50 results for performance\n        },\n\n        /**\n         * Render the search dropdown results.\n         *\n         * @param {string} query Current search query for highlighting\n         */\n        renderSearchResults: function(query) {\n            var self = this;\n            var resultsContainer = this.container.find('.report-search-results');\n            var emptyContainer = this.container.find('.report-search-empty');\n\n            resultsContainer.empty();\n\n            if (this.filteredReports.length === 0) {\n                emptyContainer.show();\n                return;\n            }\n\n            emptyContainer.hide();\n\n            // Group by category\n            var byCategory = {};\n            this.filteredReports.forEach(function(report) {\n                var cat = report.categoryName || 'Other';\n                if (!byCategory[cat]) {\n                    byCategory[cat] = [];\n                }\n                byCategory[cat].push(report);\n            });\n\n            var index = 0;\n            Object.keys(byCategory).sort().forEach(function(category) {\n                // Category header\n                resultsContainer.append(\n                    '<div class=\"report-search-category px-3 py-1 bg-light border-bottom\">' +\n                    '<small class=\"text-muted font-weight-bold\">' + self.escapeHtml(category) + '</small>' +\n                    '</div>'\n                );\n\n                // Reports in category\n                byCategory[category].forEach(function(report) {\n                    var highlightedName = self.highlightMatch(report.displayName, query);\n                    var sourceBadge = report.source === 'ai'\n                        ? '<span class=\"badge badge-info ml-2\">AI</span>'\n                        : '<span class=\"badge badge-primary ml-2\">Wizard</span>';\n\n                    var itemHtml = '<div class=\"report-search-item px-3 py-2 cursor-pointer\" ' +\n                        'data-index=\"' + index + '\" ' +\n                        'data-slug=\"' + report.slug + '\" ' +\n                        'data-source=\"' + report.source + '\" ' +\n                        'role=\"option\" ' +\n                        'tabindex=\"-1\">' +\n                        '<div class=\"d-flex justify-content-between align-items-center\">' +\n                        '<span class=\"report-name\">' + highlightedName + '</span>' +\n                        sourceBadge +\n                        '</div>' +\n                        '</div>';\n\n                    resultsContainer.append(itemHtml);\n                    index++;\n                });\n            });\n\n            // Apply hover styling\n            resultsContainer.find('.report-search-item')\n                .css('cursor', 'pointer')\n                .hover(\n                    function() {\n                        $(this).addClass('bg-light');\n                        self.highlightedIndex = parseInt($(this).data('index'), 10);\n                        self.updateHighlight();\n                    },\n                    function() {\n                        $(this).removeClass('bg-light');\n                    }\n                );\n        },\n\n        /**\n         * Highlight matching text in a string.\n         *\n         * @param {string} text Text to highlight\n         * @param {string} query Search query\n         * @return {string} HTML with highlighted matches\n         */\n        highlightMatch: function(text, query) {\n            if (!query || !text) {\n                return this.escapeHtml(text);\n            }\n\n            var escaped = this.escapeHtml(text);\n            var terms = query.toLowerCase().trim().split(/\\s+/);\n\n            terms.forEach(function(term) {\n                if (term.length > 0) {\n                    var regex = new RegExp('(' + term.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&') + ')', 'gi');\n                    escaped = escaped.replace(regex, '<mark class=\"bg-warning px-0\">$1</mark>');\n                }\n            });\n\n            return escaped;\n        },\n\n        /**\n         * Update the highlighted item in dropdown.\n         */\n        updateHighlight: function() {\n            var items = this.container.find('.report-search-item');\n            items.removeClass('bg-primary text-white bg-light');\n\n            if (this.highlightedIndex >= 0 && this.highlightedIndex < items.length) {\n                var item = items.eq(this.highlightedIndex);\n                item.removeClass('bg-light').addClass('bg-primary text-white');\n\n                // Scroll into view\n                var dropdown = this.container.find('.report-search-dropdown');\n                var itemTop = item.position().top;\n                var itemHeight = item.outerHeight();\n                var dropdownHeight = dropdown.height();\n                var scrollTop = dropdown.scrollTop();\n\n                if (itemTop < 0) {\n                    dropdown.scrollTop(scrollTop + itemTop);\n                } else if (itemTop + itemHeight > dropdownHeight) {\n                    dropdown.scrollTop(scrollTop + itemTop + itemHeight - dropdownHeight);\n                }\n            }\n        },\n\n        /**\n         * Open the search dropdown.\n         */\n        openDropdown: function() {\n            if (this.isDropdownOpen) {\n                return;\n            }\n\n            this.isDropdownOpen = true;\n            this.highlightedIndex = -1;\n\n            var dropdown = this.container.find('.report-search-dropdown');\n            var input = this.container.find('.report-search-input');\n\n            dropdown.show();\n            input.attr('aria-expanded', 'true');\n\n            // Render current results\n            var query = input.val();\n            this.filteredReports = this.filterReports(query);\n            this.renderSearchResults(query);\n        },\n\n        /**\n         * Close the search dropdown.\n         */\n        closeDropdown: function() {\n            if (!this.isDropdownOpen) {\n                return;\n            }\n\n            this.isDropdownOpen = false;\n            this.highlightedIndex = -1;\n\n            var dropdown = this.container.find('.report-search-dropdown');\n            var input = this.container.find('.report-search-input');\n\n            dropdown.hide();\n            input.attr('aria-expanded', 'false');\n        },\n\n        /**\n         * Handle search input.\n         *\n         * @param {string} query Search query\n         */\n        handleSearch: function(query) {\n            var self = this;\n\n            // Clear previous timeout\n            if (this.searchTimeout) {\n                clearTimeout(this.searchTimeout);\n            }\n\n            // Debounce search\n            this.searchTimeout = setTimeout(function() {\n                self.filteredReports = self.filterReports(query);\n                self.renderSearchResults(query);\n                self.highlightedIndex = -1;\n            }, 150);\n        },\n\n        /**\n         * Select the currently highlighted item.\n         */\n        selectHighlightedItem: function() {\n            if (this.highlightedIndex < 0 || this.highlightedIndex >= this.filteredReports.length) {\n                return;\n            }\n\n            var report = this.filteredReports[this.highlightedIndex];\n            this.addReport(report);\n        },\n\n        /**\n         * Add a report to the selection.\n         *\n         * @param {Object} report Report object\n         */\n        addReport: function(report) {\n            // Determine default icon based on current count (for KPI mode)\n            var defaultIcon = DEFAULT_KPI_ICONS[this.selectedReports.length % DEFAULT_KPI_ICONS.length];\n\n            // Add to selected list\n            var reportData = {\n                slug: report.slug,\n                source: report.source,\n                name: report.displayName || report.name || report.title || report.slug\n            };\n\n            // Add icon for KPI mode only\n            if (this.mode === 'kpi') {\n                reportData.icon = defaultIcon;\n            }\n\n            this.selectedReports.push(reportData);\n\n            this.saveSelection();\n            this.updateSelectedCount();\n\n            // Update available reports and re-render\n            this.filteredReports = this.getAvailableReports();\n\n            // Clear search and close dropdown\n            var input = this.container.find('.report-search-input');\n            input.val('');\n            this.closeDropdown();\n\n            // Re-render selected list\n            this.renderSelectedList();\n        },\n\n        /**\n         * Render the selected reports list.\n         */\n        renderSelectedList: function() {\n            var self = this;\n            var list = this.container.find('.report-selector-list');\n            list.empty();\n\n            this.selectedReports.forEach(function(selected, index) {\n                // Find full report info\n                var report = self.reports.find(function(r) {\n                    return r.slug === selected.slug && r.source === selected.source;\n                });\n\n                var name = selected.name || (report ? report.displayName : selected.slug);\n                var categoryName = report ? report.categoryName : 'Unknown';\n\n                // Build icon picker for KPI mode\n                var iconPicker = '';\n                if (self.mode === 'kpi') {\n                    var currentIcon = selected.icon || DEFAULT_KPI_ICONS[index % DEFAULT_KPI_ICONS.length];\n                    iconPicker = self.buildIconPicker(currentIcon, index);\n                }\n\n                var item = '<li class=\"list-group-item d-flex justify-content-between align-items-center\" ' +\n                    'data-index=\"' + index + '\" data-slug=\"' + selected.slug + '\" data-source=\"' + selected.source + '\">' +\n                    '<div class=\"d-flex align-items-center flex-grow-1 min-width-0\">' +\n                    '<span class=\"drag-handle mr-2\" style=\"cursor: move;\"><i class=\"fa fa-bars text-muted\"></i></span>' +\n                    iconPicker +\n                    '<span class=\"badge badge-secondary mr-2\">' + (index + 1) + '</span>' +\n                    '<span class=\"text-truncate\" title=\"' + self.escapeHtml(name) + '\">' + self.escapeHtml(name) + '</span>' +\n                    '<small class=\"text-muted ml-2 d-none d-md-inline\">[' + self.escapeHtml(categoryName) + ']</small>' +\n                    '<span class=\"badge badge-' + (selected.source === 'ai' ? 'info' : 'primary') + ' ml-2\">' +\n                    selected.source.toUpperCase() + '</span>' +\n                    '</div>' +\n                    '<button type=\"button\" class=\"btn btn-sm btn-outline-danger report-selector-remove ml-2\" title=\"' +\n                    self.strings.removereport + '\">' +\n                    '<i class=\"fa fa-times\"></i>' +\n                    '</button>' +\n                    '</li>';\n\n                list.append(item);\n            });\n\n            this.updateListDisplay();\n            this.initSortable();\n            this.initIconPickers();\n        },\n\n        /**\n         * Build icon picker dropdown HTML.\n         *\n         * @param {string} currentIcon Current icon class\n         * @param {number} index Report index\n         * @return {string} HTML for icon picker\n         */\n        buildIconPicker: function(currentIcon, index) {\n            var html = '<div class=\"dropdown kpi-icon-picker mr-2\" data-index=\"' + index + '\">' +\n                '<button class=\"btn btn-sm btn-outline-secondary dropdown-toggle\" type=\"button\" ' +\n                'data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\" title=\"Select icon\">' +\n                '<i class=\"fa ' + currentIcon + '\"></i>' +\n                '</button>' +\n                '<div class=\"dropdown-menu kpi-icon-dropdown\">' +\n                '<div class=\"px-2 py-1\">' +\n                '<small class=\"text-muted\">Select an icon</small>' +\n                '</div>' +\n                '<div class=\"dropdown-divider\"></div>' +\n                '<div class=\"kpi-icon-grid px-2\">';\n\n            // Group icons by category\n            var categories = {};\n            KPI_ICONS.forEach(function(icon) {\n                if (!categories[icon.category]) {\n                    categories[icon.category] = [];\n                }\n                categories[icon.category].push(icon);\n            });\n\n            // Render icons grouped by category\n            Object.keys(categories).forEach(function(category) {\n                html += '<div class=\"kpi-icon-category mb-1\">' +\n                    '<small class=\"text-muted d-block mb-1\">' + category + '</small>' +\n                    '<div class=\"d-flex flex-wrap\">';\n\n                categories[category].forEach(function(icon) {\n                    var isActive = icon.id === currentIcon ? ' active' : '';\n                    html += '<button type=\"button\" class=\"btn btn-sm btn-light kpi-icon-option m-1' + isActive + '\" ' +\n                        'data-icon=\"' + icon.id + '\" title=\"' + icon.label + '\">' +\n                        '<i class=\"fa ' + icon.id + '\"></i>' +\n                        '</button>';\n                });\n\n                html += '</div></div>';\n            });\n\n            html += '</div></div></div>';\n\n            return html;\n        },\n\n        /**\n         * Initialize icon picker event handlers.\n         * Manually handles dropdown toggle since Bootstrap doesn't auto-init dynamic content.\n         */\n        initIconPickers: function() {\n            var self = this;\n\n            // Handle dropdown toggle (manual implementation for dynamic content)\n            this.container.find('.kpi-icon-picker .dropdown-toggle').off('click.iconpicker').on('click.iconpicker', function(e) {\n                e.preventDefault();\n                e.stopPropagation();\n\n                var $btn = $(this);\n                var $picker = $btn.closest('.kpi-icon-picker');\n                var $menu = $picker.find('.dropdown-menu');\n                var isOpen = $menu.hasClass('show');\n\n                // Close all other open dropdowns first\n                self.container.find('.kpi-icon-picker .dropdown-menu.show').removeClass('show');\n                self.container.find('.kpi-icon-picker .dropdown-toggle').attr('aria-expanded', 'false');\n\n                if (!isOpen) {\n                    // Calculate if dropdown would overflow - use dropup if needed\n                    var pickerRect = $picker[0].getBoundingClientRect();\n                    var viewportHeight = window.innerHeight;\n                    var spaceBelow = viewportHeight - pickerRect.bottom;\n\n                    // Use dropup if less than 320px below\n                    if (spaceBelow < 320) {\n                        $picker.addClass('dropup');\n                    } else {\n                        $picker.removeClass('dropup');\n                    }\n\n                    // Open this dropdown\n                    $menu.addClass('show');\n                    $btn.attr('aria-expanded', 'true');\n                }\n            });\n\n            // Handle icon selection\n            this.container.find('.kpi-icon-option').off('click.iconpicker').on('click.iconpicker', function(e) {\n                e.preventDefault();\n                e.stopPropagation();\n\n                var $btn = $(this);\n                var $picker = $btn.closest('.kpi-icon-picker');\n                var index = parseInt($picker.data('index'), 10);\n                var newIcon = $btn.data('icon');\n\n                // Update selected report\n                if (self.selectedReports[index]) {\n                    self.selectedReports[index].icon = newIcon;\n                    self.saveSelection();\n\n                    // Update picker button icon\n                    $picker.find('.dropdown-toggle i').removeClass().addClass('fa ' + newIcon);\n\n                    // Update active state\n                    $picker.find('.kpi-icon-option').removeClass('active');\n                    $btn.addClass('active');\n\n                    // Close dropdown\n                    $picker.find('.dropdown-menu').removeClass('show');\n                    $picker.find('.dropdown-toggle').attr('aria-expanded', 'false');\n                }\n            });\n\n            // Close dropdown when clicking outside\n            $(document).off('click.iconpicker-close').on('click.iconpicker-close', function(e) {\n                if (!$(e.target).closest('.kpi-icon-picker').length) {\n                    self.container.find('.kpi-icon-picker .dropdown-menu.show').removeClass('show');\n                    self.container.find('.kpi-icon-picker .dropdown-toggle').attr('aria-expanded', 'false');\n                }\n            });\n        },\n\n        /**\n         * Update list display (show/hide empty state).\n         */\n        updateListDisplay: function() {\n            var list = this.container.find('.report-selector-list');\n            var empty = this.container.find('.report-selector-empty');\n\n            if (this.selectedReports.length > 0) {\n                list.show();\n                empty.hide();\n            } else {\n                list.hide();\n                empty.show();\n            }\n        },\n\n        /**\n         * Update the selected count badge.\n         */\n        updateSelectedCount: function() {\n            var count = this.selectedReports.length;\n            var text = count === 1 ? '1 selected' : count + ' selected';\n            this.container.find('.report-count').text(text);\n        },\n\n        /**\n         * Initialize sortable for drag-and-drop reordering.\n         */\n        initSortable: function() {\n            var self = this;\n            var list = this.container.find('.report-selector-list');\n\n            // Simple sortable implementation using jQuery UI if available\n            if ($.fn.sortable) {\n                list.sortable({\n                    handle: '.drag-handle',\n                    update: function() {\n                        self.updateOrderFromDOM();\n                    }\n                });\n            } else {\n                // Fallback: manual drag handling\n                this.initManualSort();\n            }\n        },\n\n        /**\n         * Initialize manual sort without jQuery UI.\n         */\n        initManualSort: function() {\n            var self = this;\n            var list = this.container.find('.report-selector-list');\n            var dragItem = null;\n\n            list.on('dragstart', 'li', function(e) {\n                dragItem = this;\n                $(this).addClass('dragging opacity-50');\n                e.originalEvent.dataTransfer.effectAllowed = 'move';\n            });\n\n            list.on('dragend', 'li', function() {\n                $(this).removeClass('dragging opacity-50');\n                self.updateOrderFromDOM();\n            });\n\n            list.on('dragover', 'li', function(e) {\n                e.preventDefault();\n                var rect = this.getBoundingClientRect();\n                var midY = rect.top + rect.height / 2;\n                if (e.originalEvent.clientY < midY) {\n                    $(this).before(dragItem);\n                } else {\n                    $(this).after(dragItem);\n                }\n            });\n\n            // Make items draggable\n            list.find('li').attr('draggable', 'true');\n        },\n\n        /**\n         * Update the order from DOM after sorting.\n         */\n        updateOrderFromDOM: function() {\n            var self = this;\n            var newOrder = [];\n\n            this.container.find('.report-selector-list li').each(function() {\n                var slug = $(this).data('slug');\n                var source = $(this).data('source');\n                var existing = self.selectedReports.find(function(s) {\n                    return s.slug === slug && s.source === source;\n                });\n                if (existing) {\n                    newOrder.push(existing);\n                }\n            });\n\n            this.selectedReports = newOrder;\n            this.saveSelection();\n            this.renderSelectedList();\n        },\n\n        /**\n         * Bind event handlers.\n         */\n        bindEvents: function() {\n            var self = this;\n            var input = this.container.find('.report-search-input');\n            var dropdown = this.container.find('.report-search-dropdown');\n\n            // Focus on input opens dropdown\n            input.on('focus', function() {\n                self.openDropdown();\n            });\n\n            // Input changes trigger search\n            input.on('input', function() {\n                var query = $(this).val();\n                self.openDropdown();\n                self.handleSearch(query);\n            });\n\n            // Keyboard navigation\n            input.on('keydown', function(e) {\n                var items = self.container.find('.report-search-item');\n                var maxIndex = items.length - 1;\n\n                switch (e.keyCode) {\n                    case 40: // Down arrow\n                        e.preventDefault();\n                        if (!self.isDropdownOpen) {\n                            self.openDropdown();\n                        }\n                        self.highlightedIndex = Math.min(self.highlightedIndex + 1, maxIndex);\n                        self.updateHighlight();\n                        break;\n\n                    case 38: // Up arrow\n                        e.preventDefault();\n                        self.highlightedIndex = Math.max(self.highlightedIndex - 1, 0);\n                        self.updateHighlight();\n                        break;\n\n                    case 13: // Enter\n                        e.preventDefault();\n                        if (self.highlightedIndex >= 0) {\n                            self.selectHighlightedItem();\n                        }\n                        break;\n\n                    case 27: // Escape\n                        e.preventDefault();\n                        self.closeDropdown();\n                        input.blur();\n                        break;\n\n                    case 9: // Tab\n                        self.closeDropdown();\n                        break;\n                }\n            });\n\n            // Click on dropdown item\n            dropdown.on('click', '.report-search-item', function() {\n                var slug = $(this).data('slug');\n                var source = $(this).data('source');\n                var report = self.reports.find(function(r) {\n                    return r.slug === slug && r.source === source;\n                });\n                if (report) {\n                    self.addReport(report);\n                }\n            });\n\n            // Click outside closes dropdown\n            $(document).on('click', function(e) {\n                if (!$(e.target).closest(self.container).length) {\n                    self.closeDropdown();\n                }\n            });\n\n            // Remove report button\n            this.container.on('click', '.report-selector-remove', function(e) {\n                e.stopPropagation();\n                var item = $(this).closest('li');\n                var slug = item.data('slug');\n                var source = item.data('source');\n                self.removeReport(slug, source);\n            });\n\n            // Note: Container visibility is handled by Moodle's hideIf based on display_mode.\n        },\n\n        /**\n         * Remove a report from selection.\n         *\n         * @param {string} slug\n         * @param {string} source\n         */\n        removeReport: function(slug, source) {\n            this.selectedReports = this.selectedReports.filter(function(s) {\n                return !(s.slug === slug && s.source === source);\n            });\n\n            this.saveSelection();\n            this.updateSelectedCount();\n            this.filteredReports = this.getAvailableReports();\n            this.renderSelectedList();\n\n            // Re-render dropdown if open\n            if (this.isDropdownOpen) {\n                var query = this.container.find('.report-search-input').val();\n                this.filteredReports = this.filterReports(query);\n                this.renderSearchResults(query);\n            }\n        },\n\n        /**\n         * Save selection to textarea.\n         */\n        saveSelection: function() {\n            this.textarea.val(JSON.stringify(this.selectedReports));\n        },\n\n        /**\n         * Escape HTML special characters.\n         *\n         * @param {string} text\n         * @return {string}\n         */\n        escapeHtml: function(text) {\n            if (!text) {\n                return '';\n            }\n            var div = document.createElement('div');\n            div.textContent = text;\n            return div.innerHTML;\n        }\n    };\n\n    /**\n     * AlertsManager class for managing multiple alert configurations.\n     *\n     * @param {Object} options Configuration options\n     */\n    var AlertsManager = function(options) {\n        this.apiKey = options.apiKey || '';\n        this.container = null;\n        this.textarea = null;\n        this.alerts = [];\n        this.reports = [];\n        this.filteredReports = [];\n        this.operators = {};\n        this.intervals = {};\n        this.cooldowns = {};\n        this.roles = {};\n        this.editingIndex = -1;\n        this.isDropdownOpen = false;\n        this.searchTimeout = null;\n        this.strings = {};\n\n        this.init();\n    };\n\n    AlertsManager.prototype = {\n        /**\n         * Initialize the alerts manager.\n         */\n        init: function() {\n            var self = this;\n\n            this.container = $('#alerts-manager-container');\n            this.textarea = $('#id_config_alerts_json');\n\n            if (!this.container.length) {\n                return;\n            }\n\n            // Load language strings first, then proceed with initialization.\n            this.loadStrings().then(function() {\n                // Load configuration data from container attributes.\n                self.operators = JSON.parse(self.container.attr('data-operators') || '{}');\n                self.intervals = JSON.parse(self.container.attr('data-intervals') || '{}');\n                self.cooldowns = JSON.parse(self.container.attr('data-cooldowns') || '{}');\n                self.roles = JSON.parse(self.container.attr('data-roles') || '{}');\n\n                // Load existing alerts.\n                var existingAlerts = JSON.parse(self.container.attr('data-existing-alerts') || '[]');\n                self.alerts = existingAlerts;\n\n                // Populate select options.\n                self.populateSelectOptions();\n\n                // Fetch reports for the dropdown.\n                self.fetchReports();\n\n                // Bind events.\n                self.bindEvents();\n\n                // Initial render.\n                self.renderAlertsList();\n                self.saveToTextarea();\n\n                // Show/hide based on alerts_enabled checkbox.\n                self.handleAlertsEnabledToggle();\n            });\n        },\n\n        /**\n         * Load language strings.\n         *\n         * @return {Promise}\n         */\n        loadStrings: function() {\n            var self = this;\n            return Str.get_strings([\n                {key: 'edit_alert', component: 'block_adeptus_insights'},\n                {key: 'delete_alert', component: 'block_adeptus_insights'},\n                {key: 'alert_delete_confirm', component: 'block_adeptus_insights'},\n                {key: 'add_new_alert', component: 'block_adeptus_insights'},\n                {key: 'alert_disabled', component: 'block_adeptus_insights'},\n                {key: 'config_add_alert', component: 'block_adeptus_insights'}\n            ]).then(function(strings) {\n                self.strings = {\n                    editAlert: strings[0],\n                    deleteAlert: strings[1],\n                    deleteConfirm: strings[2],\n                    addNewAlert: strings[3],\n                    disabled: strings[4],\n                    addAlert: strings[5]\n                };\n            });\n        },\n\n        /**\n         * Populate select element options.\n         */\n        populateSelectOptions: function() {\n            var self = this;\n\n            // Populate operators.\n            var operatorSelect = $('#alert-edit-operator');\n            operatorSelect.empty();\n            $.each(this.operators, function(key, value) {\n                operatorSelect.append($('<option>', {value: key, text: value}));\n            });\n\n            // Populate intervals.\n            var intervalSelect = $('#alert-edit-interval');\n            intervalSelect.empty();\n            $.each(this.intervals, function(key, value) {\n                intervalSelect.append($('<option>', {value: key, text: value}));\n            });\n\n            // Populate cooldowns.\n            var cooldownSelect = $('#alert-edit-cooldown');\n            cooldownSelect.empty();\n            $.each(this.cooldowns, function(key, value) {\n                cooldownSelect.append($('<option>', {value: key, text: value}));\n            });\n\n            // Populate roles.\n            var rolesSelect = $('#alert-edit-notify-roles');\n            rolesSelect.empty();\n            $.each(this.roles, function(key, value) {\n                rolesSelect.append($('<option>', {value: key, text: value}));\n            });\n        },\n\n        /**\n         * Fetch reports from the API.\n         */\n        fetchReports: function() {\n            var self = this;\n\n            if (!this.apiKey) {\n                return;\n            }\n\n            var baseUrl = 'https://backend.adeptus360.com/api/v1';\n\n            $.when(\n                $.ajax({\n                    url: baseUrl + '/wizard-reports',\n                    method: 'GET',\n                    headers: {\n                        'Authorization': 'Bearer ' + this.apiKey,\n                        'Accept': 'application/json'\n                    },\n                    timeout: 15000\n                }),\n                $.ajax({\n                    url: baseUrl + '/ai-reports',\n                    method: 'GET',\n                    headers: {\n                        'Authorization': 'Bearer ' + this.apiKey,\n                        'Accept': 'application/json'\n                    },\n                    timeout: 15000\n                })\n            ).then(function(wizardResult, aiResult) {\n                var allReports = [];\n\n                var wizardReports = wizardResult[0].reports || wizardResult[0].data || [];\n                wizardReports.forEach(function(r) {\n                    r.source = 'wizard';\n                    r.displayName = r.name || r.title || r.display_name || r.slug;\n                    r.categoryName = r.category_info ? r.category_info.name : 'General';\n                    allReports.push(r);\n                });\n\n                var aiReports = aiResult[0].reports || aiResult[0].data || [];\n                aiReports.forEach(function(r) {\n                    r.source = 'ai';\n                    r.displayName = r.name || r.title || r.display_name || r.slug;\n                    r.categoryName = r.category_info ? r.category_info.name : 'AI Generated';\n                    allReports.push(r);\n                });\n\n                allReports.sort(function(a, b) {\n                    return a.displayName.localeCompare(b.displayName);\n                });\n\n                self.reports = allReports;\n                self.filteredReports = allReports;\n            }).fail(function() {\n                Notification.addNotification({\n                    message: 'Failed to load reports for alerts',\n                    type: 'error'\n                });\n            });\n        },\n\n        /**\n         * Handle alerts_enabled checkbox toggle.\n         */\n        handleAlertsEnabledToggle: function() {\n            var self = this;\n            var checkbox = $('[name=\"config_alerts_enabled\"]');\n            var displayMode = $('[name=\"config_display_mode\"]');\n\n            var updateVisibility = function() {\n                var enabled = checkbox.is(':checked');\n                var isKpi = displayMode.val() === 'kpi';\n\n                if (enabled && isKpi) {\n                    self.container.show();\n                } else {\n                    self.container.hide();\n                }\n            };\n\n            checkbox.on('change', updateVisibility);\n            displayMode.on('change', updateVisibility);\n            updateVisibility();\n        },\n\n        /**\n         * Bind event handlers.\n         */\n        bindEvents: function() {\n            var self = this;\n\n            // Add alert button.\n            this.container.on('click', '#add-alert-btn', function() {\n                self.openEditPanel(-1);\n            });\n\n            // Edit alert button.\n            this.container.on('click', '.alert-edit-btn', function() {\n                var index = $(this).closest('.alert-item').data('index');\n                self.openEditPanel(index);\n            });\n\n            // Delete alert button.\n            this.container.on('click', '.alert-delete-btn', function() {\n                var index = $(this).closest('.alert-item').data('index');\n                if (confirm(self.strings.deleteConfirm)) {\n                    self.deleteAlert(index);\n                }\n            });\n\n            // Toggle alert enabled/disabled.\n            this.container.on('change', '.alert-enabled-toggle', function() {\n                var index = $(this).closest('.alert-item').data('index');\n                self.alerts[index].enabled = $(this).is(':checked');\n                self.saveToTextarea();\n                self.renderAlertsList();\n            });\n\n            // Panel close buttons.\n            this.container.on('click', '.alert-panel-close, .alert-panel-cancel', function() {\n                self.closeEditPanel();\n            });\n\n            // Panel save button.\n            this.container.on('click', '.alert-panel-save', function() {\n                self.saveEditPanel();\n            });\n\n            // Toggle email addresses visibility based on notify_email checkbox.\n            $('#alert-edit-notify-email').on('change', function() {\n                if ($(this).is(':checked')) {\n                    $('#email-addresses-group').show();\n                } else {\n                    $('#email-addresses-group').hide();\n                }\n            });\n\n            // Report search input.\n            var searchInput = $('#alert-edit-report-search');\n            var dropdown = $('#alert-report-dropdown');\n\n            searchInput.on('focus', function() {\n                self.openReportDropdown();\n            });\n\n            searchInput.on('input', function() {\n                var query = $(this).val();\n                self.handleReportSearch(query);\n            });\n\n            searchInput.on('keydown', function(e) {\n                if (e.keyCode === 27) { // Escape\n                    self.closeReportDropdown();\n                }\n            });\n\n            dropdown.on('click', '.report-dropdown-item', function() {\n                var slug = $(this).data('slug');\n                var name = $(this).data('name');\n                self.selectReport(slug, name);\n            });\n\n            // Close dropdown when clicking outside.\n            $(document).on('click', function(e) {\n                if (!$(e.target).closest('#alert-edit-report-search, #alert-report-dropdown').length) {\n                    self.closeReportDropdown();\n                }\n            });\n        },\n\n        /**\n         * Render the alerts list.\n         */\n        renderAlertsList: function() {\n            var self = this;\n            var list = $('#alerts-list');\n            var emptyState = list.find('.alerts-empty');\n\n            // Clear existing items (except empty state).\n            list.find('.alert-item').remove();\n\n            if (this.alerts.length === 0) {\n                emptyState.show();\n            } else {\n                emptyState.hide();\n\n                this.alerts.forEach(function(alert, index) {\n                    var reportName = alert.report_name || alert.report_slug;\n                    var alertName = alert.alert_name || reportName;\n                    var operatorLabel = self.operators[alert.operator] || alert.operator;\n\n                    // Build threshold display.\n                    var thresholds = [];\n                    if (alert.warning_value !== null && alert.warning_value !== '') {\n                        thresholds.push('Warning: ' + alert.warning_value);\n                    }\n                    if (alert.critical_value !== null && alert.critical_value !== '') {\n                        thresholds.push('Critical: ' + alert.critical_value);\n                    }\n                    var thresholdText = thresholds.join(', ') || 'No thresholds set';\n\n                    // Get interval label.\n                    var intervalLabel = self.intervals[alert.check_interval] || alert.check_interval + 's';\n\n                    // Status badge.\n                    var statusBadge = '';\n                    if (alert.current_status === 'warning') {\n                        statusBadge = '<span class=\"badge badge-warning ml-2\">Warning</span>';\n                    } else if (alert.current_status === 'critical') {\n                        statusBadge = '<span class=\"badge badge-danger ml-2\">Critical</span>';\n                    } else if (alert.current_status) {\n                        statusBadge = '<span class=\"badge badge-success ml-2\">OK</span>';\n                    }\n\n                    var html = '<div class=\"alert-item card mb-2\" data-index=\"' + index + '\">' +\n                        '<div class=\"card-body py-2 px-3\">' +\n                        '<div class=\"d-flex justify-content-between align-items-start\">' +\n                        '<div class=\"flex-grow-1\">' +\n                        '<div class=\"d-flex align-items-center mb-1\">' +\n                        '<strong>' + self.escapeHtml(alertName) + '</strong>' +\n                        statusBadge +\n                        (alert.enabled ? '' : '<span class=\"badge badge-secondary ml-2\">' + self.strings.disabled + '</span>') +\n                        '</div>' +\n                        '<small class=\"text-muted d-block\">' + self.escapeHtml(reportName) + '</small>' +\n                        '<small class=\"text-muted d-block\">' + self.escapeHtml(operatorLabel) + ' | ' +\n                        thresholdText + ' | ' + intervalLabel + '</small>' +\n                        '</div>' +\n                        '<div class=\"alert-actions d-flex align-items-center\">' +\n                        '<div class=\"custom-control custom-switch mr-2\">' +\n                        '<input type=\"checkbox\" class=\"custom-control-input alert-enabled-toggle\" ' +\n                        'id=\"alert-enabled-' + index + '\"' + (alert.enabled ? ' checked' : '') + '>' +\n                        '<label class=\"custom-control-label\" for=\"alert-enabled-' + index + '\"></label>' +\n                        '</div>' +\n                        '<button type=\"button\" class=\"btn btn-sm btn-outline-primary alert-edit-btn mr-1\" title=\"' + self.strings.editAlert + '\">' +\n                        '<i class=\"fa fa-pencil\"></i>' +\n                        '</button>' +\n                        '<button type=\"button\" class=\"btn btn-sm btn-outline-danger alert-delete-btn\" title=\"' + self.strings.deleteAlert + '\">' +\n                        '<i class=\"fa fa-trash\"></i>' +\n                        '</button>' +\n                        '</div>' +\n                        '</div>' +\n                        '</div>' +\n                        '</div>';\n\n                    list.append(html);\n                });\n            }\n\n            // Update count badge.\n            this.container.find('.alerts-count').text(this.alerts.length);\n        },\n\n        /**\n         * Open the edit panel for an alert.\n         *\n         * @param {number} index Alert index (-1 for new)\n         */\n        openEditPanel: function(index) {\n            var panel = $('#alert-edit-panel');\n            this.editingIndex = index;\n\n            // Reset form.\n            $('#alert-edit-report').val('');\n            $('#alert-edit-report-search').val('');\n            $('#alert-edit-report-display').text('');\n            $('#alert-edit-name').val('');\n            $('#alert-edit-operator').val('gt');\n            $('#alert-edit-warning').val('');\n            $('#alert-edit-critical').val('');\n            $('#alert-edit-interval').val('3600');\n            $('#alert-edit-cooldown').val('3600');\n            $('#alert-edit-notify-warning').prop('checked', true);\n            $('#alert-edit-notify-critical').prop('checked', true);\n            $('#alert-edit-notify-recovery').prop('checked', true);\n            $('#alert-edit-notify-email').prop('checked', false);\n            $('#alert-edit-email-addresses').val('');\n            $('#email-addresses-group').hide();\n            $('#alert-edit-notify-roles').val([]);\n\n            // Populate if editing existing.\n            if (index >= 0 && this.alerts[index]) {\n                var alert = this.alerts[index];\n                $('#alert-edit-report').val(alert.report_slug);\n                $('#alert-edit-report-search').val(alert.report_name || alert.report_slug);\n                $('#alert-edit-report-display').text('Selected: ' + (alert.report_name || alert.report_slug));\n                $('#alert-edit-name').val(alert.alert_name || '');\n                $('#alert-edit-operator').val(alert.operator || 'gt');\n                $('#alert-edit-warning').val(alert.warning_value || '');\n                $('#alert-edit-critical').val(alert.critical_value || '');\n                $('#alert-edit-interval').val(alert.check_interval || 3600);\n                $('#alert-edit-cooldown').val(alert.cooldown_seconds || 3600);\n                $('#alert-edit-notify-warning').prop('checked', alert.notify_on_warning !== false);\n                $('#alert-edit-notify-critical').prop('checked', alert.notify_on_critical !== false);\n                $('#alert-edit-notify-recovery').prop('checked', alert.notify_on_recovery !== false);\n                $('#alert-edit-notify-email').prop('checked', !!alert.notify_email);\n                $('#alert-edit-email-addresses').val(alert.notify_emails || '');\n                if (alert.notify_email) {\n                    $('#email-addresses-group').show();\n                }\n                $('#alert-edit-notify-roles').val(alert.notify_roles || []);\n\n                panel.find('.alert-panel-title').text(this.strings.editAlert);\n            } else {\n                panel.find('.alert-panel-title').text(this.strings.addNewAlert);\n            }\n\n            panel.show();\n        },\n\n        /**\n         * Close the edit panel.\n         */\n        closeEditPanel: function() {\n            $('#alert-edit-panel').hide();\n            this.editingIndex = -1;\n        },\n\n        /**\n         * Save the edit panel data.\n         */\n        saveEditPanel: function() {\n            var reportSlug = $('#alert-edit-report').val();\n            var reportName = $('#alert-edit-report-search').val();\n            var warningValue = $('#alert-edit-warning').val();\n            var criticalValue = $('#alert-edit-critical').val();\n\n            // Validation.\n            if (!reportSlug) {\n                Notification.addNotification({\n                    message: 'Please select a report to monitor.',\n                    type: 'error'\n                });\n                return;\n            }\n\n            if (!warningValue && !criticalValue) {\n                Notification.addNotification({\n                    message: 'At least one threshold (warning or critical) is required.',\n                    type: 'error'\n                });\n                return;\n            }\n\n            var alertData = {\n                report_slug: reportSlug,\n                report_name: reportName,\n                alert_name: $('#alert-edit-name').val(),\n                operator: $('#alert-edit-operator').val(),\n                warning_value: warningValue ? parseFloat(warningValue) : null,\n                critical_value: criticalValue ? parseFloat(criticalValue) : null,\n                check_interval: parseInt($('#alert-edit-interval').val(), 10),\n                cooldown_seconds: parseInt($('#alert-edit-cooldown').val(), 10),\n                notify_on_warning: $('#alert-edit-notify-warning').is(':checked'),\n                notify_on_critical: $('#alert-edit-notify-critical').is(':checked'),\n                notify_on_recovery: $('#alert-edit-notify-recovery').is(':checked'),\n                notify_email: $('#alert-edit-notify-email').is(':checked'),\n                notify_emails: $('#alert-edit-email-addresses').val().trim(),\n                notify_roles: $('#alert-edit-notify-roles').val() || [],\n                enabled: true\n            };\n\n            if (this.editingIndex >= 0) {\n                // Update existing alert, preserve ID and status.\n                alertData.id = this.alerts[this.editingIndex].id;\n                alertData.current_status = this.alerts[this.editingIndex].current_status;\n                alertData.enabled = this.alerts[this.editingIndex].enabled;\n                this.alerts[this.editingIndex] = alertData;\n            } else {\n                // Add new alert.\n                alertData.current_status = 'ok';\n                this.alerts.push(alertData);\n            }\n\n            this.saveToTextarea();\n            this.renderAlertsList();\n            this.closeEditPanel();\n        },\n\n        /**\n         * Delete an alert.\n         *\n         * @param {number} index Alert index\n         */\n        deleteAlert: function(index) {\n            this.alerts.splice(index, 1);\n            this.saveToTextarea();\n            this.renderAlertsList();\n        },\n\n        /**\n         * Save alerts to the hidden textarea.\n         */\n        saveToTextarea: function() {\n            this.textarea.val(JSON.stringify(this.alerts));\n        },\n\n        /**\n         * Open the report dropdown.\n         */\n        openReportDropdown: function() {\n            if (this.isDropdownOpen) {\n                return;\n            }\n\n            this.isDropdownOpen = true;\n            var dropdown = $('#alert-report-dropdown');\n            var input = $('#alert-edit-report-search');\n\n            // Position dropdown.\n            dropdown.css('width', input.outerWidth() + 'px');\n            dropdown.show();\n\n            this.filteredReports = this.reports;\n            this.renderReportDropdown('');\n        },\n\n        /**\n         * Close the report dropdown.\n         */\n        closeReportDropdown: function() {\n            this.isDropdownOpen = false;\n            $('#alert-report-dropdown').hide();\n        },\n\n        /**\n         * Handle report search input.\n         *\n         * @param {string} query Search query\n         */\n        handleReportSearch: function(query) {\n            var self = this;\n\n            if (this.searchTimeout) {\n                clearTimeout(this.searchTimeout);\n            }\n\n            this.searchTimeout = setTimeout(function() {\n                self.filteredReports = self.filterReports(query);\n                self.renderReportDropdown(query);\n            }, 150);\n        },\n\n        /**\n         * Filter reports based on search query.\n         *\n         * @param {string} query Search query\n         * @return {Array} Filtered reports\n         */\n        filterReports: function(query) {\n            if (!query || query.length < 1) {\n                return this.reports;\n            }\n\n            query = query.toLowerCase().trim();\n            var terms = query.split(/\\s+/);\n\n            return this.reports.filter(function(report) {\n                var searchText = (\n                    report.displayName + ' ' +\n                    report.categoryName + ' ' +\n                    report.source + ' ' +\n                    (report.slug || '')\n                ).toLowerCase();\n\n                return terms.every(function(term) {\n                    return searchText.indexOf(term) !== -1;\n                });\n            }).slice(0, 30);\n        },\n\n        /**\n         * Render the report dropdown.\n         *\n         * @param {string} query Current search query\n         */\n        renderReportDropdown: function(query) {\n            var self = this;\n            var dropdown = $('#alert-report-dropdown');\n            dropdown.empty();\n\n            if (this.filteredReports.length === 0) {\n                dropdown.append('<div class=\"p-3 text-muted text-center\">No matching reports found</div>');\n                return;\n            }\n\n            // Group by category.\n            var byCategory = {};\n            this.filteredReports.forEach(function(report) {\n                var cat = report.categoryName || 'Other';\n                if (!byCategory[cat]) {\n                    byCategory[cat] = [];\n                }\n                byCategory[cat].push(report);\n            });\n\n            Object.keys(byCategory).sort().forEach(function(category) {\n                dropdown.append(\n                    '<div class=\"px-3 py-1 bg-light border-bottom\">' +\n                    '<small class=\"text-muted font-weight-bold\">' + self.escapeHtml(category) + '</small>' +\n                    '</div>'\n                );\n\n                byCategory[category].forEach(function(report) {\n                    var sourceBadge = report.source === 'ai'\n                        ? '<span class=\"badge badge-info ml-2\">AI</span>'\n                        : '<span class=\"badge badge-primary ml-2\">Wizard</span>';\n\n                    dropdown.append(\n                        '<div class=\"report-dropdown-item px-3 py-2\" style=\"cursor:pointer;\" ' +\n                        'data-slug=\"' + report.slug + '\" data-name=\"' + self.escapeHtml(report.displayName) + '\">' +\n                        '<span>' + self.escapeHtml(report.displayName) + '</span>' +\n                        sourceBadge +\n                        '</div>'\n                    );\n                });\n            });\n\n            // Add hover effects.\n            dropdown.find('.report-dropdown-item').hover(\n                function() { $(this).addClass('bg-light'); },\n                function() { $(this).removeClass('bg-light'); }\n            );\n        },\n\n        /**\n         * Select a report from the dropdown.\n         *\n         * @param {string} slug Report slug\n         * @param {string} name Report display name\n         */\n        selectReport: function(slug, name) {\n            $('#alert-edit-report').val(slug);\n            $('#alert-edit-report-search').val(name);\n            $('#alert-edit-report-display').text('Selected: ' + name);\n            this.closeReportDropdown();\n        },\n\n        /**\n         * Escape HTML special characters.\n         *\n         * @param {string} text\n         * @return {string}\n         */\n        escapeHtml: function(text) {\n            if (!text) {\n                return '';\n            }\n            var div = document.createElement('div');\n            div.textContent = text;\n            return div.innerHTML;\n        }\n    };\n\n    // Track if module has been initialized to prevent duplicates.\n    var moduleInitialized = false;\n\n    return {\n        /**\n         * Initialize report selectors for the edit form.\n         * Uses MutationObserver to detect when modal content is loaded.\n         *\n         * @param {Object} options Configuration options\n         */\n        init: function(options) {\n            // Prevent duplicate initialization (can happen when both block and edit_form load the module).\n            if (moduleInitialized) {\n                return;\n            }\n            moduleInitialized = true;\n\n            var initialized = {\n                kpi: false,\n                tabs: false,\n                alerts: false\n            };\n\n            /**\n             * Try to initialize selectors if their containers exist.\n             */\n            var tryInitialize = function() {\n                // Initialize KPI report selector.\n                if (!initialized.kpi && $('#kpi-report-selector-container').length) {\n                    new ReportSelector({\n                        mode: 'kpi',\n                        apiKey: options.apiKey,\n                        containerId: 'kpi-report-selector-container',\n                        textareaName: 'config_kpi_selected_reports'\n                    });\n                    initialized.kpi = true;\n                }\n\n                // Initialize Tabs report selector.\n                if (!initialized.tabs && $('#tabs-report-selector-container').length) {\n                    new ReportSelector({\n                        mode: 'tabs',\n                        apiKey: options.apiKey,\n                        containerId: 'tabs-report-selector-container',\n                        textareaName: 'config_tabs_selected_reports'\n                    });\n                    initialized.tabs = true;\n                }\n\n                // Initialize Alerts manager.\n                if (!initialized.alerts && $('#alerts-manager-container').length) {\n                    new AlertsManager({\n                        apiKey: options.apiKey\n                    });\n                    initialized.alerts = true;\n                }\n            };\n\n            // Try immediately in case elements exist.\n            tryInitialize();\n\n            // Watch for modal content to be added to DOM.\n            var observer = new MutationObserver(function() {\n                tryInitialize();\n\n                // Stop observing once all are initialized.\n                if (initialized.kpi && initialized.tabs && initialized.alerts) {\n                    observer.disconnect();\n                }\n            });\n\n            // Observe the entire document for added nodes.\n            observer.observe(document.body, {\n                childList: true,\n                subtree: true\n            });\n\n            // Also listen for Moodle modal events.\n            $(document).on('modal-shown', function() {\n                setTimeout(tryInitialize, 100);\n            });\n        }\n    };\n});\n"],"names":["define","$","Str","Notification","KPI_ICONS","id","label","category","DEFAULT_KPI_ICONS","ReportSelector","options","mode","apiKey","containerId","textareaName","container","textarea","reports","filteredReports","selectedReports","strings","searchTimeout","highlightedIndex","isDropdownOpen","init","prototype","self","this","length","loadExistingSelection","loadStrings","then","render","fetchReports","bindEvents","show","get_strings","key","component","addreport","removereport","noreportsselected","selectareport","loading","searchplaceholder","value","val","JSON","parse","e","html","Date","now","updateListDisplay","updateSelectedCount","find","hide","baseUrl","when","ajax","url","method","headers","timeout","wizardResult","aiResult","allReports","data","forEach","r","source","displayName","name","title","display_name","slug","categoryName","category_info","push","sort","a","b","localeCompare","getAvailableReports","renderSelectedList","fail","addNotification","message","type","filter","report","some","s","filterReports","query","available","terms","toLowerCase","trim","split","searchText","every","term","indexOf","slice","renderSearchResults","resultsContainer","emptyContainer","empty","byCategory","cat","index","Object","keys","append","escapeHtml","highlightedName","highlightMatch","sourceBadge","itemHtml","css","hover","addClass","parseInt","updateHighlight","removeClass","text","escaped","regex","RegExp","replace","items","item","eq","dropdown","itemTop","position","top","itemHeight","outerHeight","dropdownHeight","height","scrollTop","openDropdown","input","attr","closeDropdown","handleSearch","clearTimeout","setTimeout","selectHighlightedItem","addReport","defaultIcon","reportData","icon","saveSelection","list","selected","iconPicker","currentIcon","buildIconPicker","toUpperCase","initSortable","initIconPickers","categories","isActive","off","on","preventDefault","stopPropagation","$btn","$picker","closest","$menu","isOpen","hasClass","pickerRect","getBoundingClientRect","window","innerHeight","bottom","newIcon","document","target","count","fn","sortable","handle","update","updateOrderFromDOM","initManualSort","dragItem","originalEvent","dataTransfer","effectAllowed","rect","midY","clientY","before","after","newOrder","each","existing","maxIndex","keyCode","Math","min","max","blur","removeReport","stringify","div","createElement","textContent","innerHTML","AlertsManager","alerts","operators","intervals","cooldowns","roles","editingIndex","existingAlerts","populateSelectOptions","renderAlertsList","saveToTextarea","handleAlertsEnabledToggle","editAlert","deleteAlert","deleteConfirm","addNewAlert","disabled","addAlert","operatorSelect","intervalSelect","cooldownSelect","rolesSelect","checkbox","displayMode","updateVisibility","enabled","is","isKpi","openEditPanel","confirm","closeEditPanel","saveEditPanel","searchInput","openReportDropdown","handleReportSearch","closeReportDropdown","selectReport","emptyState","remove","alert","reportName","report_name","report_slug","alertName","alert_name","operatorLabel","operator","thresholds","warning_value","critical_value","thresholdText","join","intervalLabel","check_interval","statusBadge","current_status","panel","prop","cooldown_seconds","notify_on_warning","notify_on_critical","notify_on_recovery","notify_email","notify_emails","notify_roles","reportSlug","warningValue","criticalValue","alertData","parseFloat","splice","outerWidth","renderReportDropdown","moduleInitialized","initialized","kpi","tabs","tryInitialize","observer","MutationObserver","disconnect","observe","body","childList","subtree"],"mappings":"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"}