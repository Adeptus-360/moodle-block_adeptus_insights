{"version":3,"file":"edit_form.min.js","sources":["../src/edit_form.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * JavaScript for the block edit form - report selection UI with searchable dropdown.\n *\n * @module     block_adeptus_insights/edit_form\n * @copyright  2026 Adeptus 360 <info@adeptus360.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/str', 'core/notification'], function($, Str, Notification) {\n    'use strict';\n\n\n    /**\n     * Report Selector class for managing report selection in the edit form.\n     *\n     * @param {Object} options Configuration options\n     */\n    // Available icons for KPI cards (FontAwesome 4).\n    var KPI_ICONS = [\n        {id: 'fa-users', label: 'Users', category: 'People'},\n        {id: 'fa-user', label: 'User', category: 'People'},\n        {id: 'fa-user-plus', label: 'New User', category: 'People'},\n        {id: 'fa-graduation-cap', label: 'Education', category: 'Education'},\n        {id: 'fa-book', label: 'Book', category: 'Education'},\n        {id: 'fa-certificate', label: 'Certificate', category: 'Education'},\n        {id: 'fa-clock-o', label: 'Time', category: 'Time'},\n        {id: 'fa-calendar', label: 'Calendar', category: 'Time'},\n        {id: 'fa-hourglass-half', label: 'Hourglass', category: 'Time'},\n        {id: 'fa-check-circle', label: 'Complete', category: 'Status'},\n        {id: 'fa-check', label: 'Check', category: 'Status'},\n        {id: 'fa-trophy', label: 'Trophy', category: 'Status'},\n        {id: 'fa-star', label: 'Star', category: 'Status'},\n        {id: 'fa-bar-chart', label: 'Bar Chart', category: 'Analytics'},\n        {id: 'fa-line-chart', label: 'Line Chart', category: 'Analytics'},\n        {id: 'fa-pie-chart', label: 'Pie Chart', category: 'Analytics'},\n        {id: 'fa-area-chart', label: 'Area Chart', category: 'Analytics'},\n        {id: 'fa-percent', label: 'Percent', category: 'Numbers'},\n        {id: 'fa-hashtag', label: 'Number', category: 'Numbers'},\n        {id: 'fa-sort-numeric-asc', label: 'Ranking', category: 'Numbers'},\n        {id: 'fa-dollar', label: 'Dollar', category: 'Financial'},\n        {id: 'fa-gbp', label: 'Pound', category: 'Financial'},\n        {id: 'fa-money', label: 'Money', category: 'Financial'},\n        {id: 'fa-tasks', label: 'Tasks', category: 'Progress'},\n        {id: 'fa-spinner', label: 'Progress', category: 'Progress'},\n        {id: 'fa-bullseye', label: 'Target', category: 'Progress'},\n        {id: 'fa-flag', label: 'Flag', category: 'Progress'},\n        {id: 'fa-envelope', label: 'Email', category: 'Communication'},\n        {id: 'fa-comments', label: 'Comments', category: 'Communication'},\n        {id: 'fa-bell', label: 'Notifications', category: 'Communication'},\n        {id: 'fa-exclamation-triangle', label: 'Warning', category: 'Alerts'},\n        {id: 'fa-info-circle', label: 'Info', category: 'Alerts'},\n        {id: 'fa-thumbs-up', label: 'Thumbs Up', category: 'Feedback'},\n        {id: 'fa-thumbs-down', label: 'Thumbs Down', category: 'Feedback'},\n        {id: 'fa-smile-o', label: 'Satisfaction', category: 'Feedback'}\n    ];\n\n    // Default icons for KPI cards (fallback when no icon selected).\n    var DEFAULT_KPI_ICONS = ['fa-users', 'fa-graduation-cap', 'fa-clock-o', 'fa-check-circle'];\n\n    /**\n     * Report Selector component for picking KPI/Tab reports.\n     * @param {Object} options Configuration options\n     */\n    var ReportSelector = function(options) {\n        this.mode = options.mode || 'kpi'; // 'kpi' or 'tabs'\n        this.apiKey = options.apiKey || '';\n        this.containerId = options.containerId;\n        this.textareaName = options.textareaName;\n        this.container = null;\n        this.textarea = null;\n        this.reports = [];\n        this.filteredReports = [];\n        this.selectedReports = [];\n        this.strings = {};\n        this.searchTimeout = null;\n        this.highlightedIndex = -1;\n        this.isDropdownOpen = false;\n\n        this.init();\n    };\n\n    ReportSelector.prototype = {\n        /**\n         * Initialize the report selector.\n         */\n        init: function() {\n            var self = this;\n\n            this.container = $('#' + this.containerId);\n            this.textarea = $('[name=\"' + this.textareaName + '\"]');\n\n            if (!this.container.length || !this.textarea.length) {\n                return;\n            }\n\n            // Load existing selection from textarea\n            this.loadExistingSelection();\n\n            // Load language strings\n            this.loadStrings().then(function() {\n                // Render the UI\n                self.render();\n\n                // Fetch reports from API\n                self.fetchReports();\n\n                // Bind events\n                self.bindEvents();\n\n                // Show container - Moodle's hideIf handles visibility based on display_mode.\n                self.container.show();\n            });\n        },\n\n        /**\n         * Load language strings.\n         *\n         * @return {Promise}\n         */\n        loadStrings: function() {\n            var self = this;\n            return Str.get_strings([\n                {key: 'addreport', component: 'block_adeptus_insights'},\n                {key: 'removereport', component: 'block_adeptus_insights'},\n                {key: 'noreportsselected', component: 'block_adeptus_insights'},\n                {key: 'selectareport', component: 'block_adeptus_insights'},\n                {key: 'loading', component: 'block_adeptus_insights'},\n                {key: 'config_alert_report_placeholder', component: 'block_adeptus_insights'},\n                {key: 'js_failed_load_reports', component: 'block_adeptus_insights'}\n            ]).then(function(strings) {\n                self.strings = {\n                    addreport: strings[0],\n                    removereport: strings[1],\n                    noreportsselected: strings[2],\n                    selectareport: strings[3],\n                    loading: strings[4],\n                    searchplaceholder: strings[5] || 'Search reports by name, category, or type...',\n                    failedLoadReports: strings[6]\n                };\n            });\n        },\n\n        /**\n         * Load existing selection from textarea.\n         */\n        loadExistingSelection: function() {\n            try {\n                var value = this.textarea.val();\n                if (value) {\n                    this.selectedReports = JSON.parse(value);\n                }\n            } catch (e) {\n                this.selectedReports = [];\n            }\n        },\n\n        /**\n         * Render the report selector UI with searchable dropdown.\n         */\n        render: function() {\n            var modeLabels = {\n                'kpi': 'KPI Reports',\n                'tabs': 'Tab Reports',\n                'manual': 'Selected Reports'\n            };\n            var modeLabel = modeLabels[this.mode] || 'Reports';\n            var uniqueId = this.mode + '-search-' + Date.now();\n\n            var html = '<div class=\"report-selector-ui\">' +\n                '<div class=\"report-selector-header d-flex justify-content-between align-items-center mb-2\">' +\n                '<span class=\"font-weight-bold\">' + modeLabel + '</span>' +\n                '<span class=\"badge badge-secondary report-count\">0 selected</span>' +\n                '</div>' +\n\n                // Searchable dropdown container\n                '<div class=\"report-selector-search-container mb-3 position-relative\">' +\n                '<div class=\"input-group\">' +\n                '<div class=\"input-group-prepend\">' +\n                '<span class=\"input-group-text\"><i class=\"fa fa-search\"></i></span>' +\n                '</div>' +\n                '<input type=\"text\" class=\"form-control report-search-input\" ' +\n                'id=\"' + uniqueId + '\" ' +\n                'placeholder=\"' + this.strings.searchplaceholder + '\" ' +\n                'autocomplete=\"off\" ' +\n                'aria-haspopup=\"listbox\" ' +\n                'aria-expanded=\"false\">' +\n                '<div class=\"input-group-append\">' +\n                '<button type=\"button\" class=\"btn btn-primary report-selector-add-btn\" disabled>' +\n                '<i class=\"fa fa-plus\"></i> ' + this.strings.addreport +\n                '</button>' +\n                '</div>' +\n                '</div>' +\n\n                // Dropdown results container\n                '<div class=\"report-search-dropdown position-absolute w-100 bg-white border rounded shadow-sm\" ' +\n                'style=\"display:none; z-index:1050; max-height:350px; overflow-y:auto; top:100%; left:0;\">' +\n                '<div class=\"report-search-results\"></div>' +\n                '<div class=\"report-search-empty text-muted text-center py-3\" style=\"display:none;\">' +\n                '<i class=\"fa fa-search\"></i> No matching reports found' +\n                '</div>' +\n                '<div class=\"report-search-loading text-center py-3\" style=\"display:none;\">' +\n                '<i class=\"fa fa-spinner fa-spin\"></i> ' + this.strings.loading +\n                '</div>' +\n                '</div>' +\n                '</div>' +\n\n                // Selected reports list\n                '<div class=\"report-selector-list-container\">' +\n                '<ul class=\"list-group report-selector-list\"></ul>' +\n                '<div class=\"report-selector-empty text-muted text-center py-3\">' +\n                '<i class=\"fa fa-inbox fa-2x mb-2\"></i><br>' +\n                this.strings.noreportsselected +\n                '</div>' +\n                '</div>' +\n                '</div>';\n\n            this.container.html(html);\n            this.updateListDisplay();\n            this.updateSelectedCount();\n        },\n\n        /**\n         * Fetch reports from the API.\n         */\n        fetchReports: function() {\n            var self = this;\n\n            if (!this.apiKey) {\n                this.container.find('.report-search-loading').hide();\n                this.container.find('.report-search-empty').show().html(\n                    '<i class=\"fa fa-exclamation-triangle\"></i> API key not configured'\n                );\n                return;\n            }\n\n            this.container.find('.report-search-loading').show();\n\n            var baseUrl = 'https://backend.adeptus360.com/api/v1';\n\n            // Fetch both wizard and AI reports\n            $.when(\n                $.ajax({\n                    url: baseUrl + '/wizard-reports',\n                    method: 'GET',\n                    headers: {\n                        'Authorization': 'Bearer ' + this.apiKey,\n                        'Accept': 'application/json'\n                    },\n                    timeout: 15000\n                }),\n                $.ajax({\n                    url: baseUrl + '/ai-reports',\n                    method: 'GET',\n                    headers: {\n                        'Authorization': 'Bearer ' + this.apiKey,\n                        'Accept': 'application/json'\n                    },\n                    timeout: 15000\n                })\n            ).then(function(wizardResult, aiResult) {\n                var allReports = [];\n\n                // Process wizard reports\n                var wizardReports = wizardResult[0].reports || wizardResult[0].data || [];\n                wizardReports.forEach(function(r) {\n                    r.source = 'wizard';\n                    r.displayName = r.name || r.title || r.display_name || r.slug;\n                    r.categoryName = r.category_info ? r.category_info.name : 'General';\n                    allReports.push(r);\n                });\n\n                // Process AI reports\n                var aiReports = aiResult[0].reports || aiResult[0].data || [];\n                aiReports.forEach(function(r) {\n                    r.source = 'ai';\n                    r.displayName = r.name || r.title || r.display_name || r.slug;\n                    r.categoryName = r.category_info ? r.category_info.name : 'AI Generated';\n                    allReports.push(r);\n                });\n\n                // Sort alphabetically by name\n                allReports.sort(function(a, b) {\n                    return a.displayName.localeCompare(b.displayName);\n                });\n\n                self.reports = allReports;\n                self.filteredReports = self.getAvailableReports();\n                self.container.find('.report-search-loading').hide();\n                self.renderSelectedList();\n            }).fail(function() {\n                self.container.find('.report-search-loading').hide();\n                Notification.addNotification({\n                    message: self.strings.failedLoadReports,\n                    type: 'error'\n                });\n            });\n        },\n\n        /**\n         * Get reports that haven't been selected yet.\n         *\n         * @return {Array}\n         */\n        getAvailableReports: function() {\n            var self = this;\n            return this.reports.filter(function(report) {\n                return !self.selectedReports.some(function(s) {\n                    return s.slug === report.slug && s.source === report.source;\n                });\n            });\n        },\n\n        /**\n         * Filter reports based on search query.\n         *\n         * @param {string} query Search query\n         * @return {Array} Filtered reports\n         */\n        filterReports: function(query) {\n            var available = this.getAvailableReports();\n\n            if (!query || query.length < 1) {\n                return available;\n            }\n\n            query = query.toLowerCase().trim();\n            var terms = query.split(/\\s+/);\n\n            return available.filter(function(report) {\n                var searchText = (\n                    report.displayName + ' ' +\n                    report.categoryName + ' ' +\n                    report.source + ' ' +\n                    (report.slug || '')\n                ).toLowerCase();\n\n                // All terms must match\n                return terms.every(function(term) {\n                    return searchText.indexOf(term) !== -1;\n                });\n            }).slice(0, 50); // Limit to 50 results for performance\n        },\n\n        /**\n         * Render the search dropdown results.\n         *\n         * @param {string} query Current search query for highlighting\n         */\n        renderSearchResults: function(query) {\n            var self = this;\n            var resultsContainer = this.container.find('.report-search-results');\n            var emptyContainer = this.container.find('.report-search-empty');\n\n            resultsContainer.empty();\n\n            if (this.filteredReports.length === 0) {\n                emptyContainer.show();\n                return;\n            }\n\n            emptyContainer.hide();\n\n            // Group by category\n            var byCategory = {};\n            this.filteredReports.forEach(function(report) {\n                var cat = report.categoryName || 'Other';\n                if (!byCategory[cat]) {\n                    byCategory[cat] = [];\n                }\n                byCategory[cat].push(report);\n            });\n\n            var index = 0;\n            Object.keys(byCategory).sort().forEach(function(category) {\n                // Category header\n                resultsContainer.append(\n                    '<div class=\"report-search-category px-3 py-1 bg-light border-bottom\">' +\n                    '<small class=\"text-muted font-weight-bold\">' + self.escapeHtml(category) + '</small>' +\n                    '</div>'\n                );\n\n                // Reports in category\n                byCategory[category].forEach(function(report) {\n                    var highlightedName = self.highlightMatch(report.displayName, query);\n                    var sourceBadge = report.source === 'ai'\n                        ? '<span class=\"badge badge-info ml-2\">AI</span>'\n                        : '<span class=\"badge badge-primary ml-2\">Wizard</span>';\n\n                    var itemHtml = '<div class=\"report-search-item px-3 py-2 cursor-pointer\" ' +\n                        'data-index=\"' + index + '\" ' +\n                        'data-slug=\"' + report.slug + '\" ' +\n                        'data-source=\"' + report.source + '\" ' +\n                        'role=\"option\" ' +\n                        'tabindex=\"-1\">' +\n                        '<div class=\"d-flex justify-content-between align-items-center\">' +\n                        '<span class=\"report-name\">' + highlightedName + '</span>' +\n                        sourceBadge +\n                        '</div>' +\n                        '</div>';\n\n                    resultsContainer.append(itemHtml);\n                    index++;\n                });\n            });\n\n            // Apply hover styling\n            resultsContainer.find('.report-search-item')\n                .css('cursor', 'pointer')\n                .hover(\n                    function() {\n                        $(this).addClass('bg-light');\n                        self.highlightedIndex = parseInt($(this).data('index'), 10);\n                        self.updateHighlight();\n                    },\n                    function() {\n                        $(this).removeClass('bg-light');\n                    }\n                );\n        },\n\n        /**\n         * Highlight matching text in a string.\n         *\n         * @param {string} text Text to highlight\n         * @param {string} query Search query\n         * @return {string} HTML with highlighted matches\n         */\n        highlightMatch: function(text, query) {\n            if (!query || !text) {\n                return this.escapeHtml(text);\n            }\n\n            var escaped = this.escapeHtml(text);\n            var terms = query.toLowerCase().trim().split(/\\s+/);\n\n            terms.forEach(function(term) {\n                if (term.length > 0) {\n                    var regex = new RegExp('(' + term.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&') + ')', 'gi');\n                    escaped = escaped.replace(regex, '<mark class=\"bg-warning px-0\">$1</mark>');\n                }\n            });\n\n            return escaped;\n        },\n\n        /**\n         * Update the highlighted item in dropdown.\n         */\n        updateHighlight: function() {\n            var items = this.container.find('.report-search-item');\n            items.removeClass('bg-primary text-white bg-light');\n\n            if (this.highlightedIndex >= 0 && this.highlightedIndex < items.length) {\n                var item = items.eq(this.highlightedIndex);\n                item.removeClass('bg-light').addClass('bg-primary text-white');\n\n                // Scroll into view\n                var dropdown = this.container.find('.report-search-dropdown');\n                var itemTop = item.position().top;\n                var itemHeight = item.outerHeight();\n                var dropdownHeight = dropdown.height();\n                var scrollTop = dropdown.scrollTop();\n\n                if (itemTop < 0) {\n                    dropdown.scrollTop(scrollTop + itemTop);\n                } else if (itemTop + itemHeight > dropdownHeight) {\n                    dropdown.scrollTop(scrollTop + itemTop + itemHeight - dropdownHeight);\n                }\n            }\n        },\n\n        /**\n         * Open the search dropdown.\n         */\n        openDropdown: function() {\n            if (this.isDropdownOpen) {\n                return;\n            }\n\n            this.isDropdownOpen = true;\n            this.highlightedIndex = -1;\n\n            var dropdown = this.container.find('.report-search-dropdown');\n            var input = this.container.find('.report-search-input');\n\n            dropdown.show();\n            input.attr('aria-expanded', 'true');\n\n            // Render current results\n            var query = input.val();\n            this.filteredReports = this.filterReports(query);\n            this.renderSearchResults(query);\n        },\n\n        /**\n         * Close the search dropdown.\n         */\n        closeDropdown: function() {\n            if (!this.isDropdownOpen) {\n                return;\n            }\n\n            this.isDropdownOpen = false;\n            this.highlightedIndex = -1;\n\n            var dropdown = this.container.find('.report-search-dropdown');\n            var input = this.container.find('.report-search-input');\n\n            dropdown.hide();\n            input.attr('aria-expanded', 'false');\n        },\n\n        /**\n         * Handle search input.\n         *\n         * @param {string} query Search query\n         */\n        handleSearch: function(query) {\n            var self = this;\n\n            // Clear previous timeout\n            if (this.searchTimeout) {\n                clearTimeout(this.searchTimeout);\n            }\n\n            // Debounce search\n            this.searchTimeout = setTimeout(function() {\n                self.filteredReports = self.filterReports(query);\n                self.renderSearchResults(query);\n                self.highlightedIndex = -1;\n            }, 150);\n        },\n\n        /**\n         * Select the currently highlighted item.\n         */\n        selectHighlightedItem: function() {\n            if (this.highlightedIndex < 0 || this.highlightedIndex >= this.filteredReports.length) {\n                return;\n            }\n\n            var report = this.filteredReports[this.highlightedIndex];\n            this.addReport(report);\n        },\n\n        /**\n         * Add a report to the selection.\n         *\n         * @param {Object} report Report object\n         */\n        addReport: function(report) {\n            // Determine default icon based on current count (for KPI mode)\n            var defaultIcon = DEFAULT_KPI_ICONS[this.selectedReports.length % DEFAULT_KPI_ICONS.length];\n\n            // Add to selected list\n            var reportData = {\n                slug: report.slug,\n                source: report.source,\n                name: report.displayName || report.name || report.title || report.slug\n            };\n\n            // Add icon for KPI mode only\n            if (this.mode === 'kpi') {\n                reportData.icon = defaultIcon;\n            }\n\n            this.selectedReports.push(reportData);\n\n            this.saveSelection();\n            this.updateSelectedCount();\n\n            // Update available reports and re-render\n            this.filteredReports = this.getAvailableReports();\n\n            // Clear search and close dropdown\n            var input = this.container.find('.report-search-input');\n            input.val('');\n            this.closeDropdown();\n\n            // Re-render selected list\n            this.renderSelectedList();\n        },\n\n        /**\n         * Render the selected reports list.\n         */\n        renderSelectedList: function() {\n            var self = this;\n            var list = this.container.find('.report-selector-list');\n            list.empty();\n\n            this.selectedReports.forEach(function(selected, index) {\n                // Find full report info\n                var report = self.reports.find(function(r) {\n                    return r.slug === selected.slug && r.source === selected.source;\n                });\n\n                var name = selected.name || (report ? report.displayName : selected.slug);\n                var categoryName = report ? report.categoryName : 'Unknown';\n\n                // Build icon picker for KPI mode\n                var iconPicker = '';\n                if (self.mode === 'kpi') {\n                    var currentIcon = selected.icon || DEFAULT_KPI_ICONS[index % DEFAULT_KPI_ICONS.length];\n                    iconPicker = self.buildIconPicker(currentIcon, index);\n                }\n\n                var item = '<li class=\"list-group-item d-flex justify-content-between align-items-center\" ' +\n                    'data-index=\"' + index + '\" data-slug=\"' + selected.slug + '\" data-source=\"' + selected.source + '\">' +\n                    '<div class=\"d-flex align-items-center flex-grow-1 min-width-0\">' +\n                    '<span class=\"drag-handle mr-2\" style=\"cursor: move;\"><i class=\"fa fa-bars text-muted\"></i></span>' +\n                    iconPicker +\n                    '<span class=\"badge badge-secondary mr-2\">' + (index + 1) + '</span>' +\n                    '<span class=\"text-truncate\" title=\"' + self.escapeHtml(name) + '\">' + self.escapeHtml(name) + '</span>' +\n                    '<small class=\"text-muted ml-2 d-none d-md-inline\">[' + self.escapeHtml(categoryName) + ']</small>' +\n                    '<span class=\"badge badge-' + (selected.source === 'ai' ? 'info' : 'primary') + ' ml-2\">' +\n                    selected.source.toUpperCase() + '</span>' +\n                    '</div>' +\n                    '<button type=\"button\" class=\"btn btn-sm btn-outline-danger report-selector-remove ml-2\" title=\"' +\n                    self.strings.removereport + '\">' +\n                    '<i class=\"fa fa-times\"></i>' +\n                    '</button>' +\n                    '</li>';\n\n                list.append(item);\n            });\n\n            this.updateListDisplay();\n            this.initSortable();\n            this.initIconPickers();\n        },\n\n        /**\n         * Build icon picker dropdown HTML.\n         *\n         * @param {string} currentIcon Current icon class\n         * @param {number} index Report index\n         * @return {string} HTML for icon picker\n         */\n        buildIconPicker: function(currentIcon, index) {\n            var html = '<div class=\"dropdown kpi-icon-picker mr-2\" data-index=\"' + index + '\">' +\n                '<button class=\"btn btn-sm btn-outline-secondary dropdown-toggle\" type=\"button\" ' +\n                'data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\" title=\"Select icon\">' +\n                '<i class=\"fa ' + currentIcon + '\"></i>' +\n                '</button>' +\n                '<div class=\"dropdown-menu kpi-icon-dropdown\">' +\n                '<div class=\"px-2 py-1\">' +\n                '<small class=\"text-muted\">Select an icon</small>' +\n                '</div>' +\n                '<div class=\"dropdown-divider\"></div>' +\n                '<div class=\"kpi-icon-grid px-2\">';\n\n            // Group icons by category\n            var categories = {};\n            KPI_ICONS.forEach(function(icon) {\n                if (!categories[icon.category]) {\n                    categories[icon.category] = [];\n                }\n                categories[icon.category].push(icon);\n            });\n\n            // Render icons grouped by category\n            Object.keys(categories).forEach(function(category) {\n                html += '<div class=\"kpi-icon-category mb-1\">' +\n                    '<small class=\"text-muted d-block mb-1\">' + category + '</small>' +\n                    '<div class=\"d-flex flex-wrap\">';\n\n                categories[category].forEach(function(icon) {\n                    var isActive = icon.id === currentIcon ? ' active' : '';\n                    html += '<button type=\"button\" class=\"btn btn-sm btn-light kpi-icon-option m-1' + isActive + '\" ' +\n                        'data-icon=\"' + icon.id + '\" title=\"' + icon.label + '\">' +\n                        '<i class=\"fa ' + icon.id + '\"></i>' +\n                        '</button>';\n                });\n\n                html += '</div></div>';\n            });\n\n            html += '</div></div></div>';\n\n            return html;\n        },\n\n        /**\n         * Initialize icon picker event handlers.\n         * Manually handles dropdown toggle since Bootstrap doesn't auto-init dynamic content.\n         */\n        initIconPickers: function() {\n            var self = this;\n\n            // Handle dropdown toggle (manual implementation for dynamic content)\n            this.container.find('.kpi-icon-picker .dropdown-toggle').off('click.iconpicker').on('click.iconpicker', function(e) {\n                e.preventDefault();\n                e.stopPropagation();\n\n                var $btn = $(this);\n                var $picker = $btn.closest('.kpi-icon-picker');\n                var $menu = $picker.find('.dropdown-menu');\n                var isOpen = $menu.hasClass('show');\n\n                // Close all other open dropdowns first\n                self.container.find('.kpi-icon-picker .dropdown-menu.show').removeClass('show');\n                self.container.find('.kpi-icon-picker .dropdown-toggle').attr('aria-expanded', 'false');\n\n                if (!isOpen) {\n                    // Calculate if dropdown would overflow - use dropup if needed\n                    var pickerRect = $picker[0].getBoundingClientRect();\n                    var viewportHeight = window.innerHeight;\n                    var spaceBelow = viewportHeight - pickerRect.bottom;\n\n                    // Use dropup if less than 320px below\n                    if (spaceBelow < 320) {\n                        $picker.addClass('dropup');\n                    } else {\n                        $picker.removeClass('dropup');\n                    }\n\n                    // Open this dropdown\n                    $menu.addClass('show');\n                    $btn.attr('aria-expanded', 'true');\n                }\n            });\n\n            // Handle icon selection\n            this.container.find('.kpi-icon-option').off('click.iconpicker').on('click.iconpicker', function(e) {\n                e.preventDefault();\n                e.stopPropagation();\n\n                var $btn = $(this);\n                var $picker = $btn.closest('.kpi-icon-picker');\n                var index = parseInt($picker.data('index'), 10);\n                var newIcon = $btn.data('icon');\n\n                // Update selected report\n                if (self.selectedReports[index]) {\n                    self.selectedReports[index].icon = newIcon;\n                    self.saveSelection();\n\n                    // Update picker button icon\n                    $picker.find('.dropdown-toggle i').removeClass().addClass('fa ' + newIcon);\n\n                    // Update active state\n                    $picker.find('.kpi-icon-option').removeClass('active');\n                    $btn.addClass('active');\n\n                    // Close dropdown\n                    $picker.find('.dropdown-menu').removeClass('show');\n                    $picker.find('.dropdown-toggle').attr('aria-expanded', 'false');\n                }\n            });\n\n            // Close dropdown when clicking outside\n            $(document).off('click.iconpicker-close').on('click.iconpicker-close', function(e) {\n                if (!$(e.target).closest('.kpi-icon-picker').length) {\n                    self.container.find('.kpi-icon-picker .dropdown-menu.show').removeClass('show');\n                    self.container.find('.kpi-icon-picker .dropdown-toggle').attr('aria-expanded', 'false');\n                }\n            });\n        },\n\n        /**\n         * Update list display (show/hide empty state).\n         */\n        updateListDisplay: function() {\n            var list = this.container.find('.report-selector-list');\n            var empty = this.container.find('.report-selector-empty');\n\n            if (this.selectedReports.length > 0) {\n                list.show();\n                empty.hide();\n            } else {\n                list.hide();\n                empty.show();\n            }\n        },\n\n        /**\n         * Update the selected count badge.\n         */\n        updateSelectedCount: function() {\n            var count = this.selectedReports.length;\n            var text = count === 1 ? '1 selected' : count + ' selected';\n            this.container.find('.report-count').text(text);\n        },\n\n        /**\n         * Initialize sortable for drag-and-drop reordering.\n         */\n        initSortable: function() {\n            var self = this;\n            var list = this.container.find('.report-selector-list');\n\n            // Simple sortable implementation using jQuery UI if available\n            if ($.fn.sortable) {\n                list.sortable({\n                    handle: '.drag-handle',\n                    update: function() {\n                        self.updateOrderFromDOM();\n                    }\n                });\n            } else {\n                // Fallback: manual drag handling\n                this.initManualSort();\n            }\n        },\n\n        /**\n         * Initialize manual sort without jQuery UI.\n         */\n        initManualSort: function() {\n            var self = this;\n            var list = this.container.find('.report-selector-list');\n            var dragItem = null;\n\n            list.on('dragstart', 'li', function(e) {\n                dragItem = this;\n                $(this).addClass('dragging opacity-50');\n                e.originalEvent.dataTransfer.effectAllowed = 'move';\n            });\n\n            list.on('dragend', 'li', function() {\n                $(this).removeClass('dragging opacity-50');\n                self.updateOrderFromDOM();\n            });\n\n            list.on('dragover', 'li', function(e) {\n                e.preventDefault();\n                var rect = this.getBoundingClientRect();\n                var midY = rect.top + rect.height / 2;\n                if (e.originalEvent.clientY < midY) {\n                    $(this).before(dragItem);\n                } else {\n                    $(this).after(dragItem);\n                }\n            });\n\n            // Make items draggable\n            list.find('li').attr('draggable', 'true');\n        },\n\n        /**\n         * Update the order from DOM after sorting.\n         */\n        updateOrderFromDOM: function() {\n            var self = this;\n            var newOrder = [];\n\n            this.container.find('.report-selector-list li').each(function() {\n                var slug = $(this).data('slug');\n                var source = $(this).data('source');\n                var existing = self.selectedReports.find(function(s) {\n                    return s.slug === slug && s.source === source;\n                });\n                if (existing) {\n                    newOrder.push(existing);\n                }\n            });\n\n            this.selectedReports = newOrder;\n            this.saveSelection();\n            this.renderSelectedList();\n        },\n\n        /**\n         * Bind event handlers.\n         */\n        bindEvents: function() {\n            var self = this;\n            var input = this.container.find('.report-search-input');\n            var dropdown = this.container.find('.report-search-dropdown');\n\n            // Focus on input opens dropdown\n            input.on('focus', function() {\n                self.openDropdown();\n            });\n\n            // Input changes trigger search\n            input.on('input', function() {\n                var query = $(this).val();\n                self.openDropdown();\n                self.handleSearch(query);\n            });\n\n            // Keyboard navigation\n            input.on('keydown', function(e) {\n                var items = self.container.find('.report-search-item');\n                var maxIndex = items.length - 1;\n\n                switch (e.keyCode) {\n                    case 40: // Down arrow\n                        e.preventDefault();\n                        if (!self.isDropdownOpen) {\n                            self.openDropdown();\n                        }\n                        self.highlightedIndex = Math.min(self.highlightedIndex + 1, maxIndex);\n                        self.updateHighlight();\n                        break;\n\n                    case 38: // Up arrow\n                        e.preventDefault();\n                        self.highlightedIndex = Math.max(self.highlightedIndex - 1, 0);\n                        self.updateHighlight();\n                        break;\n\n                    case 13: // Enter\n                        e.preventDefault();\n                        if (self.highlightedIndex >= 0) {\n                            self.selectHighlightedItem();\n                        }\n                        break;\n\n                    case 27: // Escape\n                        e.preventDefault();\n                        self.closeDropdown();\n                        input.blur();\n                        break;\n\n                    case 9: // Tab\n                        self.closeDropdown();\n                        break;\n                }\n            });\n\n            // Click on dropdown item\n            dropdown.on('click', '.report-search-item', function() {\n                var slug = $(this).data('slug');\n                var source = $(this).data('source');\n                var report = self.reports.find(function(r) {\n                    return r.slug === slug && r.source === source;\n                });\n                if (report) {\n                    self.addReport(report);\n                }\n            });\n\n            // Click outside closes dropdown\n            $(document).on('click', function(e) {\n                if (!$(e.target).closest(self.container).length) {\n                    self.closeDropdown();\n                }\n            });\n\n            // Remove report button\n            this.container.on('click', '.report-selector-remove', function(e) {\n                e.stopPropagation();\n                var item = $(this).closest('li');\n                var slug = item.data('slug');\n                var source = item.data('source');\n                self.removeReport(slug, source);\n            });\n\n            // Note: Container visibility is handled by Moodle's hideIf based on display_mode.\n        },\n\n        /**\n         * Remove a report from selection.\n         *\n         * @param {string} slug\n         * @param {string} source\n         */\n        removeReport: function(slug, source) {\n            this.selectedReports = this.selectedReports.filter(function(s) {\n                return !(s.slug === slug && s.source === source);\n            });\n\n            this.saveSelection();\n            this.updateSelectedCount();\n            this.filteredReports = this.getAvailableReports();\n            this.renderSelectedList();\n\n            // Re-render dropdown if open\n            if (this.isDropdownOpen) {\n                var query = this.container.find('.report-search-input').val();\n                this.filteredReports = this.filterReports(query);\n                this.renderSearchResults(query);\n            }\n        },\n\n        /**\n         * Save selection to textarea.\n         */\n        saveSelection: function() {\n            this.textarea.val(JSON.stringify(this.selectedReports)).trigger('change');\n        },\n\n        /**\n         * Escape HTML special characters.\n         *\n         * @param {string} text\n         * @return {string}\n         */\n        escapeHtml: function(text) {\n            if (!text) {\n                return '';\n            }\n            var div = document.createElement('div');\n            div.textContent = text;\n            return div.innerHTML;\n        }\n    };\n\n    /**\n     * AlertsManager class for managing multiple alert configurations.\n     *\n     * @param {Object} options Configuration options\n     */\n    var AlertsManager = function(options) {\n        this.apiKey = options.apiKey || '';\n        this.container = null;\n        this.textarea = null;\n        this.alerts = [];\n        this.reports = [];\n        this.filteredReports = [];\n        this.operators = {};\n        this.intervals = {};\n        this.cooldowns = {};\n        this.roles = {};\n        this.editingIndex = -1;\n        this.isDropdownOpen = false;\n        this.isUserDropdownOpen = false;\n        this.searchTimeout = null;\n        this.userSearchTimeout = null;\n        this.selectedUsers = [];\n        this.strings = {};\n\n        this.init();\n    };\n\n    AlertsManager.prototype = {\n        /**\n         * Initialize the alerts manager.\n         */\n        init: function() {\n            var self = this;\n\n            this.container = $('#alerts-manager-container');\n            this.textarea = $('#id_config_alerts_json');\n\n            if (!this.container.length) {\n                return;\n            }\n\n            // Load language strings first, then proceed with initialization.\n            this.loadStrings().then(function() {\n                // Load configuration data from container attributes.\n                self.operators = JSON.parse(self.container.attr('data-operators') || '{}');\n                self.intervals = JSON.parse(self.container.attr('data-intervals') || '{}');\n                self.cooldowns = JSON.parse(self.container.attr('data-cooldowns') || '{}');\n                self.roles = JSON.parse(self.container.attr('data-roles') || '{}');\n\n                // Load existing alerts.\n                var existingAlerts = JSON.parse(self.container.attr('data-existing-alerts') || '[]');\n                self.alerts = existingAlerts;\n\n                // Clean up any orphaned backend alerts that no longer exist in local config.\n                // This ensures backend stays in sync with Moodle's source of truth.\n                if (existingAlerts.length > 0) {\n                    self.cleanupOrphanedAlerts();\n                }\n\n                // Populate select options.\n                self.populateSelectOptions();\n\n                // Fetch reports for the dropdown.\n                self.fetchReports();\n\n                // Bind events.\n                self.bindEvents();\n\n                // Initial render.\n                self.renderAlertsList();\n                self.saveToTextarea();\n\n                // Show/hide based on alerts_enabled checkbox.\n                self.handleAlertsEnabledToggle();\n            });\n        },\n\n        /**\n         * Load language strings.\n         *\n         * @return {Promise}\n         */\n        loadStrings: function() {\n            var self = this;\n            return Str.get_strings([\n                {key: 'edit_alert', component: 'block_adeptus_insights'},\n                {key: 'delete_alert', component: 'block_adeptus_insights'},\n                {key: 'alert_delete_confirm', component: 'block_adeptus_insights'},\n                {key: 'add_new_alert', component: 'block_adeptus_insights'},\n                {key: 'alert_disabled', component: 'block_adeptus_insights'},\n                {key: 'config_add_alert', component: 'block_adeptus_insights'},\n                {key: 'js_selected', component: 'block_adeptus_insights'},\n                {key: 'js_alert_no_reports', component: 'block_adeptus_insights'},\n                {key: 'js_no_thresholds_set', component: 'block_adeptus_insights'},\n                {key: 'alert_threshold_warning_only', component: 'block_adeptus_insights'},\n                {key: 'alert_threshold_critical_only', component: 'block_adeptus_insights'},\n                {key: 'alert_status_badge_warning', component: 'block_adeptus_insights'},\n                {key: 'alert_status_badge_critical', component: 'block_adeptus_insights'},\n                {key: 'alert_status_badge_ok', component: 'block_adeptus_insights'},\n                {key: 'js_failed_load_reports', component: 'block_adeptus_insights'},\n                {key: 'js_alert_failed_create', component: 'block_adeptus_insights'},\n                {key: 'js_alert_failed_update', component: 'block_adeptus_insights'},\n                {key: 'js_alert_failed_delete', component: 'block_adeptus_insights'},\n                {key: 'js_alert_created', component: 'block_adeptus_insights'},\n                {key: 'js_alert_updated', component: 'block_adeptus_insights'},\n                {key: 'js_alert_deleted', component: 'block_adeptus_insights'},\n                {key: 'js_alert_select_report', component: 'block_adeptus_insights'},\n                {key: 'js_alert_enter_threshold', component: 'block_adeptus_insights'}\n            ]).then(function(strings) {\n                self.strings = {\n                    editAlert: strings[0],\n                    deleteAlert: strings[1],\n                    deleteConfirm: strings[2],\n                    addNewAlert: strings[3],\n                    disabled: strings[4],\n                    addAlert: strings[5],\n                    selected: strings[6],\n                    noReports: strings[7],\n                    noThresholdsSet: strings[8],\n                    thresholdWarning: strings[9],\n                    thresholdCritical: strings[10],\n                    statusWarning: strings[11],\n                    statusCritical: strings[12],\n                    statusOk: strings[13],\n                    failedLoadReports: strings[14],\n                    failedCreateAlert: strings[15],\n                    failedUpdateAlert: strings[16],\n                    failedDeleteAlert: strings[17],\n                    alertCreated: strings[18],\n                    alertUpdated: strings[19],\n                    alertDeleted: strings[20],\n                    selectReport: strings[21],\n                    enterThreshold: strings[22]\n                };\n            });\n        },\n\n        /**\n         * Populate select element options.\n         */\n        populateSelectOptions: function() {\n            var self = this;\n\n            // Populate operators.\n            var operatorSelect = $('#alert-edit-operator');\n            operatorSelect.empty();\n            $.each(this.operators, function(key, value) {\n                operatorSelect.append($('<option>', {value: key, text: value}));\n            });\n\n            // Populate intervals.\n            var intervalSelect = $('#alert-edit-interval');\n            intervalSelect.empty();\n            $.each(this.intervals, function(key, value) {\n                intervalSelect.append($('<option>', {value: key, text: value}));\n            });\n\n            // Populate cooldowns.\n            var cooldownSelect = $('#alert-edit-cooldown');\n            cooldownSelect.empty();\n            $.each(this.cooldowns, function(key, value) {\n                cooldownSelect.append($('<option>', {value: key, text: value}));\n            });\n\n            // Populate role filter dropdown.\n            var roleFilter = $('#alert-edit-role-filter');\n            if (roleFilter.length) {\n                roleFilter.find('option:not(:first)').remove(); // Keep \"All users\" option.\n                $.each(this.roles, function(key, value) {\n                    roleFilter.append($('<option>', {value: key, text: value}));\n                });\n            } else {\n                // Element not found yet, might be in a modal - will be populated on openEditPanel.\n                console.warn('Role filter element not found during init, will populate on panel open');\n            }\n        },\n\n        /**\n         * Load reports from the block's selected reports.\n         *\n         * Only shows reports that are already configured in the block's\n         * KPI or Tabs report selectors, not all available reports.\n         */\n        fetchReports: function() {\n            var self = this;\n            var allReports = [];\n\n            // Get selected reports from the KPI report selector textarea.\n            var kpiTextarea = $('[name=\"config_kpi_selected_reports\"]');\n            if (kpiTextarea.length && kpiTextarea.val()) {\n                try {\n                    var kpiReports = JSON.parse(kpiTextarea.val());\n                    if (Array.isArray(kpiReports)) {\n                        kpiReports.forEach(function(r) {\n                            r.displayName = r.name || r.title || r.display_name || r.slug;\n                            r.categoryName = r.category_info ? r.category_info.name : (r.source === 'ai' ? 'AI Generated' : 'General');\n                            allReports.push(r);\n                        });\n                    }\n                } catch (e) {\n                    // Invalid JSON, ignore.\n                }\n            }\n\n            // Get selected reports from the Tabs report selector textarea.\n            var tabsTextarea = $('[name=\"config_tabs_selected_reports\"]');\n            if (tabsTextarea.length && tabsTextarea.val()) {\n                try {\n                    var tabsReports = JSON.parse(tabsTextarea.val());\n                    if (Array.isArray(tabsReports)) {\n                        tabsReports.forEach(function(r) {\n                            // Avoid duplicates (same slug).\n                            var exists = allReports.some(function(existing) {\n                                return existing.slug === r.slug;\n                            });\n                            if (!exists) {\n                                r.displayName = r.name || r.title || r.display_name || r.slug;\n                                r.categoryName = r.category_info ? r.category_info.name : (r.source === 'ai' ? 'AI Generated' : 'General');\n                                allReports.push(r);\n                            }\n                        });\n                    }\n                } catch (e) {\n                    // Invalid JSON, ignore.\n                }\n            }\n\n            // Sort alphabetically by display name.\n            allReports.sort(function(a, b) {\n                return (a.displayName || '').localeCompare(b.displayName || '');\n            });\n\n            this.reports = allReports;\n            this.filteredReports = allReports;\n\n            // Update UI to show message if no reports selected.\n            if (allReports.length === 0) {\n                this.container.find('.alert-report-empty-message').remove();\n                this.container.find('.alerts-edit-panel').prepend(\n                    '<div class=\"alert alert-info alert-report-empty-message\">' +\n                    '<i class=\"fa fa-info-circle\"></i> ' +\n                    this.strings.noReports +\n                    '</div>'\n                );\n            }\n        },\n\n        /**\n         * Handle alerts_enabled checkbox toggle.\n         */\n        handleAlertsEnabledToggle: function() {\n            var self = this;\n            var checkbox = $('[name=\"config_alerts_enabled\"]');\n            var displayMode = $('[name=\"config_display_mode\"]');\n\n            var updateVisibility = function() {\n                var enabled = checkbox.is(':checked');\n                var isKpi = displayMode.val() === 'kpi';\n\n                if (enabled && isKpi) {\n                    self.container.show();\n                } else {\n                    self.container.hide();\n                }\n            };\n\n            checkbox.on('change', updateVisibility);\n            displayMode.on('change', updateVisibility);\n            updateVisibility();\n        },\n\n        /**\n         * Bind event handlers.\n         */\n        bindEvents: function() {\n            var self = this;\n\n            // Listen for changes to the report selector textareas.\n            // When reports are added/removed from KPI or Tabs, refresh the alerts report list.\n            $('[name=\"config_kpi_selected_reports\"], [name=\"config_tabs_selected_reports\"]').on('change', function() {\n                self.fetchReports();\n            });\n\n            // Add alert button.\n            this.container.on('click', '#add-alert-btn', function() {\n                self.openEditPanel(-1);\n            });\n\n            // Edit alert button.\n            this.container.on('click', '.alert-edit-btn', function() {\n                var index = $(this).closest('.alert-item').data('index');\n                self.openEditPanel(index);\n            });\n\n            // Delete alert button.\n            this.container.on('click', '.alert-delete-btn', function() {\n                var index = $(this).closest('.alert-item').data('index');\n                if (confirm(self.strings.deleteConfirm)) {\n                    self.deleteAlert(index);\n                }\n            });\n\n            // Toggle alert enabled/disabled.\n            this.container.on('change', '.alert-enabled-toggle', function() {\n                var index = $(this).closest('.alert-item').data('index');\n                self.alerts[index].enabled = $(this).is(':checked');\n                self.saveToTextarea();\n                self.renderAlertsList();\n            });\n\n            // Panel close buttons.\n            this.container.on('click', '.alert-panel-close, .alert-panel-cancel', function() {\n                self.closeEditPanel();\n            });\n\n            // Panel save button.\n            this.container.on('click', '.alert-panel-save', function() {\n                self.saveEditPanel();\n            });\n\n            // Toggle email addresses visibility based on notify_email checkbox.\n            $('#alert-edit-notify-email').on('change', function() {\n                if ($(this).is(':checked')) {\n                    $('#email-addresses-group').show();\n                } else {\n                    $('#email-addresses-group').hide();\n                }\n            });\n\n            // Report search input.\n            var searchInput = $('#alert-edit-report-search');\n            var dropdown = $('#alert-report-dropdown');\n\n            searchInput.on('focus', function() {\n                self.openReportDropdown();\n            });\n\n            searchInput.on('input', function() {\n                var query = $(this).val();\n                self.handleReportSearch(query);\n            });\n\n            searchInput.on('keydown', function(e) {\n                if (e.keyCode === 27) { // Escape\n                    self.closeReportDropdown();\n                }\n            });\n\n            dropdown.on('click', '.report-dropdown-item', function() {\n                var slug = $(this).data('slug');\n                var name = $(this).data('name');\n                self.selectReport(slug, name);\n            });\n\n            // Close dropdown when clicking outside.\n            $(document).on('click', function(e) {\n                if (!$(e.target).closest('#alert-edit-report-search, #alert-report-dropdown').length) {\n                    self.closeReportDropdown();\n                }\n                if (!$(e.target).closest('#alert-edit-user-search, #alert-user-dropdown').length) {\n                    self.closeUserDropdown();\n                }\n            });\n\n            // Role filter change - reload users.\n            $('#alert-edit-role-filter').on('change', function() {\n                // Clear search and reload with new filter.\n                $('#alert-edit-user-search').val('');\n                self.loadUsers();\n            });\n\n            // User search input.\n            var userSearchInput = $('#alert-edit-user-search');\n            var userDropdown = $('#alert-user-dropdown');\n\n            userSearchInput.on('focus', function() {\n                self.openUserDropdown();\n            });\n\n            userSearchInput.on('input', function() {\n                var query = $(this).val();\n                self.handleUserSearch(query);\n            });\n\n            userSearchInput.on('keydown', function(e) {\n                if (e.keyCode === 27) { // Escape.\n                    self.closeUserDropdown();\n                }\n            });\n\n            userDropdown.on('click', '.user-dropdown-item', function() {\n                var userId = $(this).data('userid');\n                var userName = $(this).data('name');\n                var userEmail = $(this).data('email');\n                self.addSelectedUser(userId, userName, userEmail);\n            });\n\n            // Remove selected user.\n            this.container.on('click', '.remove-selected-user', function() {\n                var userId = $(this).data('userid');\n                self.removeSelectedUser(userId);\n            });\n        },\n\n        /**\n         * Render the alerts list.\n         */\n        renderAlertsList: function() {\n            var self = this;\n            var list = $('#alerts-list');\n            var emptyState = list.find('.alerts-empty');\n\n            // Clear existing items (except empty state).\n            list.find('.alert-item').remove();\n\n            if (this.alerts.length === 0) {\n                emptyState.show();\n            } else {\n                emptyState.hide();\n\n                this.alerts.forEach(function(alert, index) {\n                    var reportName = alert.report_name || alert.report_slug;\n                    var alertName = alert.alert_name || reportName;\n                    var operatorLabel = self.operators[alert.operator] || alert.operator;\n\n                    // Build threshold display.\n                    var thresholds = [];\n                    if (alert.warning_value !== null && alert.warning_value !== '') {\n                        thresholds.push(self.strings.thresholdWarning.replace('{$a}', alert.warning_value));\n                    }\n                    if (alert.critical_value !== null && alert.critical_value !== '') {\n                        thresholds.push(self.strings.thresholdCritical.replace('{$a}', alert.critical_value));\n                    }\n                    var thresholdText = thresholds.join(', ') || self.strings.noThresholdsSet;\n\n                    // Get interval label.\n                    var intervalLabel = self.intervals[alert.check_interval] || alert.check_interval + 's';\n\n                    // Status badge.\n                    var statusBadge = '';\n                    if (alert.current_status === 'warning') {\n                        statusBadge = '<span class=\"badge badge-warning ml-2\">' + self.strings.statusWarning + '</span>';\n                    } else if (alert.current_status === 'critical') {\n                        statusBadge = '<span class=\"badge badge-danger ml-2\">' + self.strings.statusCritical + '</span>';\n                    } else if (alert.current_status) {\n                        statusBadge = '<span class=\"badge badge-success ml-2\">' + self.strings.statusOk + '</span>';\n                    }\n\n                    var html = '<div class=\"alert-item card mb-2\" data-index=\"' + index + '\">' +\n                        '<div class=\"card-body py-2 px-3\">' +\n                        '<div class=\"d-flex justify-content-between align-items-start\">' +\n                        '<div class=\"flex-grow-1\">' +\n                        '<div class=\"d-flex align-items-center mb-1\">' +\n                        '<strong>' + self.escapeHtml(alertName) + '</strong>' +\n                        statusBadge +\n                        (alert.enabled ? '' : '<span class=\"badge badge-secondary ml-2\">' + self.strings.disabled + '</span>') +\n                        '</div>' +\n                        '<small class=\"text-muted d-block\">' + self.escapeHtml(reportName) + '</small>' +\n                        '<small class=\"text-muted d-block\">' + self.escapeHtml(operatorLabel) + ' | ' +\n                        thresholdText + ' | ' + intervalLabel + '</small>' +\n                        '</div>' +\n                        '<div class=\"alert-actions d-flex align-items-center\">' +\n                        '<div class=\"custom-control custom-switch mr-2\">' +\n                        '<input type=\"checkbox\" class=\"custom-control-input alert-enabled-toggle\" ' +\n                        'id=\"alert-enabled-' + index + '\"' + (alert.enabled ? ' checked' : '') + '>' +\n                        '<label class=\"custom-control-label\" for=\"alert-enabled-' + index + '\"></label>' +\n                        '</div>' +\n                        '<button type=\"button\" class=\"btn btn-sm btn-outline-primary alert-edit-btn mr-1\" title=\"' + self.strings.editAlert + '\">' +\n                        '<i class=\"fa fa-pencil\"></i>' +\n                        '</button>' +\n                        '<button type=\"button\" class=\"btn btn-sm btn-outline-danger alert-delete-btn\" title=\"' + self.strings.deleteAlert + '\">' +\n                        '<i class=\"fa fa-trash\"></i>' +\n                        '</button>' +\n                        '</div>' +\n                        '</div>' +\n                        '</div>' +\n                        '</div>';\n\n                    list.append(html);\n                });\n            }\n\n            // Update count badge.\n            this.container.find('.alerts-count').text(this.alerts.length);\n        },\n\n        /**\n         * Open the edit panel for an alert.\n         *\n         * @param {number} index Alert index (-1 for new)\n         */\n        openEditPanel: function(index) {\n            var self = this;\n            var panel = $('#alert-edit-panel');\n            this.editingIndex = index;\n\n            // Ensure role filter is populated (might not have been during init).\n            var roleFilter = $('#alert-edit-role-filter');\n            if (roleFilter.length && roleFilter.find('option').length <= 1) {\n                $.each(this.roles, function(key, value) {\n                    roleFilter.append($('<option>', {value: key, text: value}));\n                });\n            }\n\n            // Reset form.\n            $('#alert-edit-report').val('');\n            $('#alert-edit-report-search').val('');\n            $('#alert-edit-report-display').text('');\n            $('#alert-edit-name').val('');\n            $('#alert-edit-operator').val('gt');\n            $('#alert-edit-warning').val('');\n            $('#alert-edit-critical').val('');\n            $('#alert-edit-interval').val('3600');\n            $('#alert-edit-cooldown').val('3600');\n            $('#alert-edit-notify-warning').prop('checked', true);\n            $('#alert-edit-notify-critical').prop('checked', true);\n            $('#alert-edit-notify-recovery').prop('checked', true);\n            $('#alert-edit-notify-email').prop('checked', false);\n            $('#alert-edit-email-addresses').val('');\n            $('#email-addresses-group').hide();\n            $('#alert-edit-role-filter').val('');\n            this.selectedUsers = [];\n            this.renderSelectedUsers();\n\n            // Populate if editing existing.\n            if (index >= 0 && this.alerts[index]) {\n                var alert = this.alerts[index];\n                $('#alert-edit-report').val(alert.report_slug);\n                $('#alert-edit-report-search').val(alert.report_name || alert.report_slug);\n                $('#alert-edit-report-display').text(this.strings.selected.replace('{$a}', alert.report_name || alert.report_slug));\n                $('#alert-edit-name').val(alert.alert_name || '');\n                $('#alert-edit-operator').val(alert.operator || 'gt');\n                $('#alert-edit-warning').val(alert.warning_value || '');\n                $('#alert-edit-critical').val(alert.critical_value || '');\n                $('#alert-edit-interval').val(alert.check_interval || 3600);\n                $('#alert-edit-cooldown').val(alert.cooldown_seconds || 3600);\n                $('#alert-edit-notify-warning').prop('checked', alert.notify_on_warning !== false);\n                $('#alert-edit-notify-critical').prop('checked', alert.notify_on_critical !== false);\n                $('#alert-edit-notify-recovery').prop('checked', alert.notify_on_recovery !== false);\n                $('#alert-edit-notify-email').prop('checked', !!alert.notify_email);\n                $('#alert-edit-email-addresses').val(alert.notify_emails || '');\n                if (alert.notify_email) {\n                    $('#email-addresses-group').show();\n                }\n                // Load selected users from alert data.\n                this.selectedUsers = alert.notify_users || [];\n                this.renderSelectedUsers();\n\n                panel.find('.alert-panel-title').text(this.strings.editAlert);\n            } else {\n                panel.find('.alert-panel-title').text(this.strings.addNewAlert);\n            }\n\n            panel.show();\n        },\n\n        /**\n         * Close the edit panel.\n         */\n        closeEditPanel: function() {\n            $('#alert-edit-panel').hide();\n            this.editingIndex = -1;\n        },\n\n        /**\n         * Get the API endpoint base URL for a report based on its source.\n         *\n         * @param {string} reportSlug Report slug.\n         * @return {string} API endpoint path ('/wizard-reports/' or '/ai-reports/').\n         */\n        getReportEndpoint: function(reportSlug) {\n            // Find the report in our list to get its source.\n            var report = this.reports.find(function(r) {\n                return r.slug === reportSlug;\n            });\n\n            // Default to wizard-reports if source is 'wizard' or unknown.\n            if (report && report.source === 'ai') {\n                return '/ai-reports/';\n            }\n            return '/wizard-reports/';\n        },\n\n        /**\n         * Save the edit panel data - syncs to backend API.\n         */\n        saveEditPanel: function() {\n            var self = this;\n            var reportSlug = $('#alert-edit-report').val();\n            var reportName = $('#alert-edit-report-search').val();\n            var thresholdValue = $('#alert-edit-warning').val() || $('#alert-edit-critical').val();\n            var operator = $('#alert-edit-operator').val();\n\n            // Validation.\n            if (!reportSlug) {\n                Notification.addNotification({\n                    message: this.strings.selectReport,\n                    type: 'error'\n                });\n                return;\n            }\n\n            if (!thresholdValue) {\n                Notification.addNotification({\n                    message: this.strings.enterThreshold,\n                    type: 'error'\n                });\n                return;\n            }\n\n            // Map operator to condition_type for backend API.\n            var conditionType = 'threshold';\n            var backendOperator = operator;\n            if (operator === 'change_pct') {\n                conditionType = 'change_percent';\n                backendOperator = 'gte'; // Change by X% or more.\n            } else if (operator === 'increase_pct') {\n                conditionType = 'change_percent';\n                backendOperator = 'gte';\n            } else if (operator === 'decrease_pct') {\n                conditionType = 'change_percent';\n                backendOperator = 'lte';\n                thresholdValue = -Math.abs(parseFloat(thresholdValue)); // Negative for decrease.\n            }\n\n            // Prepare backend API payload.\n            // Note: cooldown_minutes is set to 0 to disable backend cooldown.\n            // Moodle handles fire-once logic per severity (warning/critical/recovery)\n            // via the block_adeptus_insights_alert_log table.\n            var notifyEmail = $('#alert-edit-notify-email').is(':checked');\n            var backendPayload = {\n                name: $('#alert-edit-name').val() || reportName,\n                condition_type: conditionType,\n                operator: backendOperator,\n                value: parseFloat(thresholdValue) || 0,\n                cooldown_minutes: 0,\n                is_enabled: true,\n                notification_channels: notifyEmail ? ['email'] : ['moodle']\n            };\n\n            // Local alert data for UI.\n            var alertData = {\n                report_slug: reportSlug,\n                report_name: reportName,\n                alert_name: backendPayload.name,\n                operator: operator,\n                condition_type: conditionType,\n                threshold_value: parseFloat(thresholdValue),\n                warning_value: $('#alert-edit-warning').val() ? parseFloat($('#alert-edit-warning').val()) : null,\n                critical_value: $('#alert-edit-critical').val() ? parseFloat($('#alert-edit-critical').val()) : null,\n                check_interval: parseInt($('#alert-edit-interval').val(), 10),\n                cooldown_seconds: parseInt($('#alert-edit-cooldown').val(), 10),\n                notify_on_warning: $('#alert-edit-notify-warning').is(':checked'),\n                notify_on_critical: $('#alert-edit-notify-critical').is(':checked'),\n                notify_on_recovery: $('#alert-edit-notify-recovery').is(':checked'),\n                notify_email: $('#alert-edit-notify-email').is(':checked'),\n                notify_emails: $('#alert-edit-email-addresses').val().trim(),\n                notify_users: this.selectedUsers,\n                enabled: true\n            };\n\n            var isUpdate = this.editingIndex >= 0 && this.alerts[this.editingIndex] &&\n                           this.alerts[this.editingIndex].backend_id;\n\n            if (isUpdate) {\n                // Update existing alert on backend.\n                var backendId = this.alerts[this.editingIndex].backend_id;\n                this.updateAlertOnBackend(reportSlug, backendId, backendPayload, alertData);\n            } else {\n                // Create new alert on backend.\n                this.createAlertOnBackend(reportSlug, backendPayload, alertData);\n            }\n        },\n\n        /**\n         * Create a new alert on the backend.\n         *\n         * @param {string} reportSlug Report slug.\n         * @param {Object} payload Backend API payload.\n         * @param {Object} alertData Local alert data.\n         */\n        createAlertOnBackend: function(reportSlug, payload, alertData) {\n            var self = this;\n            var endpoint = this.getReportEndpoint(reportSlug);\n\n            $.ajax({\n                url: 'https://backend.adeptus360.com/api/v1' + endpoint +\n                     encodeURIComponent(reportSlug) + '/alerts',\n                method: 'POST',\n                headers: {\n                    'Authorization': 'Bearer ' + this.apiKey,\n                    'Content-Type': 'application/json',\n                    'Accept': 'application/json'\n                },\n                data: JSON.stringify(payload),\n                timeout: 15000\n            }).done(function(response) {\n                if (response.success && response.alert) {\n                    // Store backend ID for future updates.\n                    alertData.backend_id = response.alert.id;\n                    alertData.current_status = 'ok';\n\n                    if (self.editingIndex >= 0) {\n                        self.alerts[self.editingIndex] = alertData;\n                    } else {\n                        self.alerts.push(alertData);\n                    }\n\n                    self.saveToTextarea();\n                    self.renderAlertsList();\n                    self.closeEditPanel();\n\n                    Notification.addNotification({\n                        message: self.strings.alertCreated,\n                        type: 'success'\n                    });\n                } else {\n                    Notification.addNotification({\n                        message: response.message || self.strings.failedCreateAlert,\n                        type: 'error'\n                    });\n                }\n            }).fail(function(xhr) {\n                var message = self.strings.failedCreateAlert;\n                if (xhr.responseJSON) {\n                    if (xhr.responseJSON.message) {\n                        message = xhr.responseJSON.message;\n                    }\n                    // Show validation errors if present.\n                    if (xhr.responseJSON.errors) {\n                        var errors = xhr.responseJSON.errors;\n                        var errorDetails = [];\n                        for (var field in errors) {\n                            if (errors.hasOwnProperty(field)) {\n                                errorDetails.push(field + ': ' + errors[field].join(', '));\n                            }\n                        }\n                        if (errorDetails.length > 0) {\n                            message += ' - ' + errorDetails.join('; ');\n                        }\n                    }\n                }\n                console.error('Alert creation failed:', xhr.responseJSON);\n                Notification.addNotification({\n                    message: message,\n                    type: 'error'\n                });\n            });\n        },\n\n        /**\n         * Update an existing alert on the backend.\n         *\n         * @param {string} reportSlug Report slug.\n         * @param {number} alertId Backend alert ID.\n         * @param {Object} payload Backend API payload.\n         * @param {Object} alertData Local alert data.\n         */\n        updateAlertOnBackend: function(reportSlug, alertId, payload, alertData) {\n            var self = this;\n            var endpoint = this.getReportEndpoint(reportSlug);\n\n            $.ajax({\n                url: 'https://backend.adeptus360.com/api/v1' + endpoint +\n                     encodeURIComponent(reportSlug) + '/alerts/' + alertId,\n                method: 'PUT',\n                headers: {\n                    'Authorization': 'Bearer ' + this.apiKey,\n                    'Content-Type': 'application/json',\n                    'Accept': 'application/json'\n                },\n                data: JSON.stringify(payload),\n                timeout: 15000\n            }).done(function(response) {\n                if (response.success) {\n                    alertData.backend_id = alertId;\n                    alertData.current_status = self.alerts[self.editingIndex].current_status;\n                    alertData.enabled = self.alerts[self.editingIndex].enabled;\n                    self.alerts[self.editingIndex] = alertData;\n\n                    self.saveToTextarea();\n                    self.renderAlertsList();\n                    self.closeEditPanel();\n\n                    Notification.addNotification({\n                        message: self.strings.alertUpdated,\n                        type: 'success'\n                    });\n                } else {\n                    Notification.addNotification({\n                        message: response.message || self.strings.failedUpdateAlert,\n                        type: 'error'\n                    });\n                }\n            }).fail(function(xhr) {\n                var message = self.strings.failedUpdateAlert;\n                if (xhr.responseJSON && xhr.responseJSON.message) {\n                    message = xhr.responseJSON.message;\n                }\n                Notification.addNotification({\n                    message: message,\n                    type: 'error'\n                });\n            });\n        },\n\n        /**\n         * Delete an alert - syncs to backend API.\n         *\n         * @param {number} index Alert index\n         */\n        deleteAlert: function(index) {\n            var self = this;\n            var alert = this.alerts[index];\n\n            if (!alert) {\n                return;\n            }\n\n            // If alert has backend ID, delete from backend first.\n            if (alert.backend_id && alert.report_slug) {\n                var endpoint = this.getReportEndpoint(alert.report_slug);\n                $.ajax({\n                    url: 'https://backend.adeptus360.com/api/v1' + endpoint +\n                         encodeURIComponent(alert.report_slug) + '/alerts/' + alert.backend_id,\n                    method: 'DELETE',\n                    headers: {\n                        'Authorization': 'Bearer ' + this.apiKey,\n                        'Accept': 'application/json'\n                    },\n                    timeout: 15000\n                }).done(function(response) {\n                    // Remove from local list.\n                    self.alerts.splice(index, 1);\n                    self.saveToTextarea();\n                    self.renderAlertsList();\n\n                    Notification.addNotification({\n                        message: self.strings.alertDeleted,\n                        type: 'success'\n                    });\n                }).fail(function(xhr) {\n                    var message = self.strings.failedDeleteAlert;\n                    if (xhr.responseJSON && xhr.responseJSON.message) {\n                        message = xhr.responseJSON.message;\n                    }\n                    Notification.addNotification({\n                        message: message,\n                        type: 'error'\n                    });\n                });\n            } else {\n                // No backend ID, just remove locally.\n                this.alerts.splice(index, 1);\n                this.saveToTextarea();\n                this.renderAlertsList();\n            }\n        },\n\n        /**\n         * Clean up orphaned backend alerts that no longer exist in local config.\n         * This runs on initialization to sync backend with local Moodle config.\n         */\n        cleanupOrphanedAlerts: function() {\n            var self = this;\n\n            // Get unique report slugs from local alerts.\n            var reportSlugs = {};\n            var localBackendIds = {};\n\n            this.alerts.forEach(function(alert) {\n                if (alert.report_slug) {\n                    reportSlugs[alert.report_slug] = true;\n                    if (alert.backend_id) {\n                        if (!localBackendIds[alert.report_slug]) {\n                            localBackendIds[alert.report_slug] = [];\n                        }\n                        localBackendIds[alert.report_slug].push(alert.backend_id);\n                    }\n                }\n            });\n\n            // For each report slug, fetch backend alerts and delete orphans.\n            Object.keys(reportSlugs).forEach(function(reportSlug) {\n                var endpoint = self.getReportEndpoint(reportSlug);\n                var localIds = localBackendIds[reportSlug] || [];\n\n                $.ajax({\n                    url: 'https://backend.adeptus360.com/api/v1' + endpoint +\n                         encodeURIComponent(reportSlug) + '/alerts',\n                    method: 'GET',\n                    headers: {\n                        'Authorization': 'Bearer ' + self.apiKey,\n                        'Accept': 'application/json'\n                    },\n                    timeout: 10000\n                }).done(function(response) {\n                    if (response.success && response.alerts) {\n                        var backendAlerts = response.alerts;\n\n                        // Find orphans (backend alerts not in local config).\n                        backendAlerts.forEach(function(backendAlert) {\n                            if (localIds.indexOf(backendAlert.id) === -1) {\n                                // This backend alert is orphaned - delete it.\n                                self.deleteOrphanedAlert(reportSlug, backendAlert.id);\n                            }\n                        });\n                    }\n                }).fail(function() {\n                    // Silently fail - orphan cleanup is best-effort.\n                    console.warn('Failed to fetch backend alerts for orphan cleanup:', reportSlug);\n                });\n            });\n        },\n\n        /**\n         * Delete an orphaned alert from the backend (no local state changes).\n         *\n         * @param {string} reportSlug Report slug.\n         * @param {number} alertId Backend alert ID to delete.\n         */\n        deleteOrphanedAlert: function(reportSlug, alertId) {\n            var endpoint = this.getReportEndpoint(reportSlug);\n\n            $.ajax({\n                url: 'https://backend.adeptus360.com/api/v1' + endpoint +\n                     encodeURIComponent(reportSlug) + '/alerts/' + alertId,\n                method: 'DELETE',\n                headers: {\n                    'Authorization': 'Bearer ' + this.apiKey,\n                    'Accept': 'application/json'\n                },\n                timeout: 10000\n            }).done(function() {\n                console.log('Cleaned up orphaned backend alert:', alertId, 'for report:', reportSlug);\n            }).fail(function() {\n                console.warn('Failed to delete orphaned alert:', alertId, 'for report:', reportSlug);\n            });\n        },\n\n        /**\n         * Save alerts to the hidden textarea.\n         */\n        saveToTextarea: function() {\n            this.textarea.val(JSON.stringify(this.alerts));\n        },\n\n        /**\n         * Open the report dropdown.\n         */\n        openReportDropdown: function() {\n            if (this.isDropdownOpen) {\n                return;\n            }\n\n            this.isDropdownOpen = true;\n            var dropdown = $('#alert-report-dropdown');\n            var input = $('#alert-edit-report-search');\n\n            // Position dropdown.\n            dropdown.css('width', input.outerWidth() + 'px');\n            dropdown.show();\n\n            this.filteredReports = this.reports;\n            this.renderReportDropdown('');\n        },\n\n        /**\n         * Close the report dropdown.\n         */\n        closeReportDropdown: function() {\n            this.isDropdownOpen = false;\n            $('#alert-report-dropdown').hide();\n        },\n\n        /**\n         * Handle report search input.\n         *\n         * @param {string} query Search query\n         */\n        handleReportSearch: function(query) {\n            var self = this;\n\n            if (this.searchTimeout) {\n                clearTimeout(this.searchTimeout);\n            }\n\n            this.searchTimeout = setTimeout(function() {\n                self.filteredReports = self.filterReports(query);\n                self.renderReportDropdown(query);\n            }, 150);\n        },\n\n        /**\n         * Filter reports based on search query.\n         *\n         * @param {string} query Search query\n         * @return {Array} Filtered reports\n         */\n        filterReports: function(query) {\n            if (!query || query.length < 1) {\n                return this.reports;\n            }\n\n            query = query.toLowerCase().trim();\n            var terms = query.split(/\\s+/);\n\n            return this.reports.filter(function(report) {\n                var searchText = (\n                    report.displayName + ' ' +\n                    report.categoryName + ' ' +\n                    report.source + ' ' +\n                    (report.slug || '')\n                ).toLowerCase();\n\n                return terms.every(function(term) {\n                    return searchText.indexOf(term) !== -1;\n                });\n            }).slice(0, 30);\n        },\n\n        /**\n         * Render the report dropdown.\n         *\n         * @param {string} query Current search query\n         */\n        renderReportDropdown: function(query) {\n            var self = this;\n            var dropdown = $('#alert-report-dropdown');\n            dropdown.empty();\n\n            if (this.filteredReports.length === 0) {\n                dropdown.append('<div class=\"p-3 text-muted text-center\">No matching reports found</div>');\n                return;\n            }\n\n            // Group by category.\n            var byCategory = {};\n            this.filteredReports.forEach(function(report) {\n                var cat = report.categoryName || 'Other';\n                if (!byCategory[cat]) {\n                    byCategory[cat] = [];\n                }\n                byCategory[cat].push(report);\n            });\n\n            Object.keys(byCategory).sort().forEach(function(category) {\n                dropdown.append(\n                    '<div class=\"px-3 py-1 bg-light border-bottom\">' +\n                    '<small class=\"text-muted font-weight-bold\">' + self.escapeHtml(category) + '</small>' +\n                    '</div>'\n                );\n\n                byCategory[category].forEach(function(report) {\n                    var sourceBadge = report.source === 'ai'\n                        ? '<span class=\"badge badge-info ml-2\">AI</span>'\n                        : '<span class=\"badge badge-primary ml-2\">Wizard</span>';\n\n                    dropdown.append(\n                        '<div class=\"report-dropdown-item px-3 py-2\" style=\"cursor:pointer;\" ' +\n                        'data-slug=\"' + report.slug + '\" data-name=\"' + self.escapeHtml(report.displayName) + '\">' +\n                        '<span>' + self.escapeHtml(report.displayName) + '</span>' +\n                        sourceBadge +\n                        '</div>'\n                    );\n                });\n            });\n\n            // Add hover effects.\n            dropdown.find('.report-dropdown-item').hover(\n                function() { $(this).addClass('bg-light'); },\n                function() { $(this).removeClass('bg-light'); }\n            );\n        },\n\n        /**\n         * Select a report from the dropdown.\n         *\n         * @param {string} slug Report slug\n         * @param {string} name Report display name\n         */\n        selectReport: function(slug, name) {\n            $('#alert-edit-report').val(slug);\n            $('#alert-edit-report-search').val(name);\n            $('#alert-edit-report-display').text(this.strings.selected.replace('{$a}', name));\n            this.closeReportDropdown();\n        },\n\n        /**\n         * Open the user search dropdown.\n         */\n        openUserDropdown: function() {\n            if (this.isUserDropdownOpen) {\n                return;\n            }\n\n            this.isUserDropdownOpen = true;\n            var dropdown = $('#alert-user-dropdown');\n            dropdown.show();\n\n            // Load users if not already loaded.\n            this.loadUsers();\n        },\n\n        /**\n         * Close the user search dropdown.\n         */\n        closeUserDropdown: function() {\n            this.isUserDropdownOpen = false;\n            $('#alert-user-dropdown').hide();\n        },\n\n        /**\n         * Load users from the server.\n         */\n        loadUsers: function() {\n            var self = this;\n            var roleId = $('#alert-edit-role-filter').val() || 0;\n            var search = $('#alert-edit-user-search').val() || '';\n\n            var dropdown = $('#alert-user-dropdown');\n            dropdown.html('<div class=\"p-3 text-center text-muted\"><i class=\"fa fa-spinner fa-spin\"></i> Loading...</div>');\n\n            require(['core/ajax'], function(Ajax) {\n                Ajax.call([{\n                    methodname: 'block_adeptus_insights_get_users_by_role',\n                    args: {\n                        roleid: parseInt(roleId, 10),\n                        search: search,\n                        limit: 50\n                    }\n                }])[0].done(function(response) {\n                    self.renderUserDropdown(response.users);\n                }).fail(function() {\n                    dropdown.html('<div class=\"p-3 text-center text-danger\">Failed to load users</div>');\n                });\n            });\n        },\n\n        /**\n         * Handle user search input with debouncing.\n         *\n         * @param {string} query Search query\n         */\n        handleUserSearch: function(query) {\n            var self = this;\n\n            if (this.userSearchTimeout) {\n                clearTimeout(this.userSearchTimeout);\n            }\n\n            this.userSearchTimeout = setTimeout(function() {\n                self.loadUsers();\n            }, 300);\n        },\n\n        /**\n         * Render the user dropdown.\n         *\n         * @param {Array} users Array of user objects\n         */\n        renderUserDropdown: function(users) {\n            var self = this;\n            var dropdown = $('#alert-user-dropdown');\n            dropdown.empty();\n\n            if (users.length === 0) {\n                dropdown.html('<div class=\"p-3 text-center text-muted\">No users found</div>');\n                return;\n            }\n\n            users.forEach(function(user) {\n                // Check if already selected.\n                var isSelected = self.selectedUsers.some(function(s) {\n                    return s.id === user.id;\n                });\n\n                if (isSelected) {\n                    return; // Skip already selected users.\n                }\n\n                var html = '<div class=\"user-dropdown-item px-3 py-2 d-flex align-items-center\" ' +\n                    'style=\"cursor:pointer;\" ' +\n                    'data-userid=\"' + user.id + '\" ' +\n                    'data-name=\"' + self.escapeHtml(user.fullname) + '\" ' +\n                    'data-email=\"' + self.escapeHtml(user.email) + '\">' +\n                    '<img src=\"' + user.profileimageurl + '\" class=\"rounded-circle mr-2\" ' +\n                    'width=\"32\" height=\"32\" alt=\"\">' +\n                    '<div class=\"flex-grow-1 min-width-0\">' +\n                    '<div class=\"text-truncate font-weight-bold\">' + self.escapeHtml(user.fullname) + '</div>' +\n                    '<small class=\"text-muted text-truncate d-block\">' + self.escapeHtml(user.email) + '</small>' +\n                    '</div>' +\n                    '</div>';\n\n                dropdown.append(html);\n            });\n\n            if (dropdown.children().length === 0) {\n                dropdown.html('<div class=\"p-3 text-center text-muted\">All matching users already selected</div>');\n            }\n\n            // Add hover effects.\n            dropdown.find('.user-dropdown-item').hover(\n                function() { $(this).addClass('bg-light'); },\n                function() { $(this).removeClass('bg-light'); }\n            );\n        },\n\n        /**\n         * Add a user to the selected list.\n         *\n         * @param {number} userId User ID\n         * @param {string} userName User full name\n         * @param {string} userEmail User email\n         */\n        addSelectedUser: function(userId, userName, userEmail) {\n            // Check if already selected.\n            var exists = this.selectedUsers.some(function(u) {\n                return u.id === userId;\n            });\n\n            if (exists) {\n                return;\n            }\n\n            this.selectedUsers.push({\n                id: userId,\n                name: userName,\n                email: userEmail\n            });\n\n            this.renderSelectedUsers();\n            this.closeUserDropdown();\n            $('#alert-edit-user-search').val('');\n        },\n\n        /**\n         * Remove a user from the selected list.\n         *\n         * @param {number} userId User ID\n         */\n        removeSelectedUser: function(userId) {\n            this.selectedUsers = this.selectedUsers.filter(function(u) {\n                return u.id !== userId;\n            });\n\n            this.renderSelectedUsers();\n        },\n\n        /**\n         * Render the selected users list.\n         */\n        renderSelectedUsers: function() {\n            var self = this;\n            var container = $('#alert-selected-users');\n            container.empty();\n\n            if (this.selectedUsers.length === 0) {\n                container.html('<div class=\"text-muted small py-2\"><i class=\"fa fa-user-o mr-1\"></i> No recipients selected</div>');\n                return;\n            }\n\n            this.selectedUsers.forEach(function(user) {\n                var html = '<div class=\"selected-user-chip d-inline-flex align-items-center bg-light border rounded px-2 py-1 mr-2 mb-2\">' +\n                    '<span class=\"mr-2\">' + self.escapeHtml(user.name) + '</span>' +\n                    '<button type=\"button\" class=\"btn btn-sm btn-link p-0 text-danger remove-selected-user\" ' +\n                    'data-userid=\"' + user.id + '\" title=\"Remove\">' +\n                    '<i class=\"fa fa-times\"></i>' +\n                    '</button>' +\n                    '</div>';\n\n                container.append(html);\n            });\n\n            // Update hidden input with user data.\n            $('#alert-edit-notify-users-data').val(JSON.stringify(this.selectedUsers));\n        },\n\n        /**\n         * Escape HTML special characters.\n         *\n         * @param {string} text\n         * @return {string}\n         */\n        escapeHtml: function(text) {\n            if (!text) {\n                return '';\n            }\n            var div = document.createElement('div');\n            div.textContent = text;\n            return div.innerHTML;\n        }\n    };\n\n    // Track if module has been initialized to prevent duplicates.\n    var moduleInitialized = false;\n\n    return {\n        /**\n         * Initialize report selectors for the edit form.\n         * Uses MutationObserver to detect when modal content is loaded.\n         *\n         * @param {Object} options Configuration options\n         */\n        init: function(options) {\n            // Prevent duplicate initialization (can happen when both block and edit_form load the module).\n            if (moduleInitialized) {\n                return;\n            }\n            moduleInitialized = true;\n\n            var initialized = {\n                kpi: false,\n                tabs: false,\n                alerts: false\n            };\n\n            /**\n             * Try to initialize selectors if their containers exist.\n             */\n            var tryInitialize = function() {\n                // Initialize KPI report selector.\n                if (!initialized.kpi && $('#kpi-report-selector-container').length) {\n                    new ReportSelector({\n                        mode: 'kpi',\n                        apiKey: options.apiKey,\n                        containerId: 'kpi-report-selector-container',\n                        textareaName: 'config_kpi_selected_reports'\n                    });\n                    initialized.kpi = true;\n                }\n\n                // Initialize Tabs report selector.\n                if (!initialized.tabs && $('#tabs-report-selector-container').length) {\n                    new ReportSelector({\n                        mode: 'tabs',\n                        apiKey: options.apiKey,\n                        containerId: 'tabs-report-selector-container',\n                        textareaName: 'config_tabs_selected_reports'\n                    });\n                    initialized.tabs = true;\n                }\n\n                // Initialize Alerts manager.\n                if (!initialized.alerts && $('#alerts-manager-container').length) {\n                    new AlertsManager({\n                        apiKey: options.apiKey\n                    });\n                    initialized.alerts = true;\n                }\n\n                // Handle Alert Configuration notice visibility based on display mode.\n                // Shows a notice when non-KPI mode is selected, hides it for KPI mode.\n                var displayModeSelect = $('[name=\"config_display_mode\"]');\n                var alertsNotice = $('#alerts-kpi-only-notice');\n                if (displayModeSelect.length && alertsNotice.length && !displayModeSelect.data('alerts-notice-bound')) {\n\n                    var updateAlertNoticeVisibility = function() {\n                        var isKpi = displayModeSelect.val() === 'kpi';\n                        if (isKpi) {\n                            alertsNotice.hide();\n                        } else {\n                            alertsNotice.show();\n                        }\n                    };\n\n                    // Bind change handler.\n                    displayModeSelect.on('change', updateAlertNoticeVisibility);\n\n                    // Set initial visibility.\n                    setTimeout(updateAlertNoticeVisibility, 50);\n\n                    // Mark as bound to prevent duplicate handlers.\n                    displayModeSelect.data('alerts-notice-bound', true);\n                }\n            };\n\n            // Try immediately in case elements exist.\n            tryInitialize();\n\n            // Watch for modal content to be added to DOM.\n            var observer = new MutationObserver(function() {\n                tryInitialize();\n\n                // Stop observing once all are initialized.\n                if (initialized.kpi && initialized.tabs && initialized.alerts) {\n                    observer.disconnect();\n                }\n            });\n\n            // Observe the entire document for added nodes.\n            observer.observe(document.body, {\n                childList: true,\n                subtree: true\n            });\n\n            // Also listen for Moodle modal events.\n            $(document).on('modal-shown', function() {\n                setTimeout(tryInitialize, 100);\n            });\n        }\n    };\n});\n"],"names":["define","$","Str","Notification","KPI_ICONS","id","label","category","DEFAULT_KPI_ICONS","ReportSelector","options","mode","apiKey","containerId","textareaName","container","textarea","reports","filteredReports","selectedReports","strings","searchTimeout","highlightedIndex","isDropdownOpen","init","prototype","self","this","length","loadExistingSelection","loadStrings","then","render","fetchReports","bindEvents","show","get_strings","key","component","addreport","removereport","noreportsselected","selectareport","loading","searchplaceholder","failedLoadReports","value","val","JSON","parse","e","html","Date","now","updateListDisplay","updateSelectedCount","find","hide","baseUrl","when","ajax","url","method","headers","timeout","wizardResult","aiResult","allReports","data","forEach","r","source","displayName","name","title","display_name","slug","categoryName","category_info","push","sort","a","b","localeCompare","getAvailableReports","renderSelectedList","fail","addNotification","message","type","filter","report","some","s","filterReports","query","available","terms","toLowerCase","trim","split","searchText","every","term","indexOf","slice","renderSearchResults","resultsContainer","emptyContainer","empty","byCategory","cat","index","Object","keys","append","escapeHtml","highlightedName","highlightMatch","sourceBadge","itemHtml","css","hover","addClass","parseInt","updateHighlight","removeClass","text","escaped","regex","RegExp","replace","items","item","eq","dropdown","itemTop","position","top","itemHeight","outerHeight","dropdownHeight","height","scrollTop","openDropdown","input","attr","closeDropdown","handleSearch","clearTimeout","setTimeout","selectHighlightedItem","addReport","defaultIcon","reportData","icon","saveSelection","list","selected","iconPicker","currentIcon","buildIconPicker","toUpperCase","initSortable","initIconPickers","categories","isActive","off","on","preventDefault","stopPropagation","$btn","$picker","closest","$menu","isOpen","hasClass","pickerRect","getBoundingClientRect","window","innerHeight","bottom","newIcon","document","target","count","fn","sortable","handle","update","updateOrderFromDOM","initManualSort","dragItem","originalEvent","dataTransfer","effectAllowed","rect","midY","clientY","before","after","newOrder","each","existing","maxIndex","keyCode","Math","min","max","blur","removeReport","stringify","trigger","div","createElement","textContent","innerHTML","AlertsManager","alerts","operators","intervals","cooldowns","roles","editingIndex","isUserDropdownOpen","userSearchTimeout","selectedUsers","existingAlerts","cleanupOrphanedAlerts","populateSelectOptions","renderAlertsList","saveToTextarea","handleAlertsEnabledToggle","editAlert","deleteAlert","deleteConfirm","addNewAlert","disabled","addAlert","noReports","noThresholdsSet","thresholdWarning","thresholdCritical","statusWarning","statusCritical","statusOk","failedCreateAlert","failedUpdateAlert","failedDeleteAlert","alertCreated","alertUpdated","alertDeleted","selectReport","enterThreshold","operatorSelect","intervalSelect","cooldownSelect","roleFilter","remove","console","warn","kpiTextarea","kpiReports","Array","isArray","tabsTextarea","tabsReports","prepend","checkbox","displayMode","updateVisibility","enabled","is","isKpi","openEditPanel","confirm","closeEditPanel","saveEditPanel","searchInput","openReportDropdown","handleReportSearch","closeReportDropdown","closeUserDropdown","loadUsers","userSearchInput","userDropdown","openUserDropdown","handleUserSearch","userId","userName","userEmail","addSelectedUser","removeSelectedUser","emptyState","alert","reportName","report_name","report_slug","alertName","alert_name","operatorLabel","operator","thresholds","warning_value","critical_value","thresholdText","join","intervalLabel","check_interval","statusBadge","current_status","panel","prop","renderSelectedUsers","cooldown_seconds","notify_on_warning","notify_on_critical","notify_on_recovery","notify_email","notify_emails","notify_users","getReportEndpoint","reportSlug","thresholdValue","conditionType","backendOperator","abs","parseFloat","notifyEmail","backendPayload","condition_type","cooldown_minutes","is_enabled","notification_channels","alertData","threshold_value","backend_id","backendId","updateAlertOnBackend","createAlertOnBackend","payload","endpoint","encodeURIComponent","done","response","success","xhr","responseJSON","errors","errorDetails","field","hasOwnProperty","error","alertId","splice","reportSlugs","localBackendIds","localIds","backendAlert","deleteOrphanedAlert","log","outerWidth","renderReportDropdown","roleId","search","require","Ajax","call","methodname","args","roleid","limit","renderUserDropdown","users","user","fullname","email","profileimageurl","children","u","moduleInitialized","initialized","kpi","tabs","tryInitialize","displayModeSelect","alertsNotice","updateAlertNoticeVisibility","observer","MutationObserver","disconnect","observe","body","childList","subtree"],"mappings":"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"}