{"version":3,"file":"edit_form.min.js","sources":["../src/edit_form.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * JavaScript for the block edit form - report selection UI with searchable dropdown.\n *\n * @module     block_adeptus_insights/edit_form\n * @copyright  2026 Adeptus 360 <info@adeptus360.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/str', 'core/notification'], function($, Str, Notification) {\n    'use strict';\n\n\n    /**\n     * Report Selector class for managing report selection in the edit form.\n     *\n     * @param {Object} options Configuration options\n     */\n    // Available icons for KPI cards (FontAwesome 4).\n    var KPI_ICONS = [\n        {id: 'fa-users', label: 'Users', category: 'People'},\n        {id: 'fa-user', label: 'User', category: 'People'},\n        {id: 'fa-user-plus', label: 'New User', category: 'People'},\n        {id: 'fa-graduation-cap', label: 'Education', category: 'Education'},\n        {id: 'fa-book', label: 'Book', category: 'Education'},\n        {id: 'fa-certificate', label: 'Certificate', category: 'Education'},\n        {id: 'fa-clock-o', label: 'Time', category: 'Time'},\n        {id: 'fa-calendar', label: 'Calendar', category: 'Time'},\n        {id: 'fa-hourglass-half', label: 'Hourglass', category: 'Time'},\n        {id: 'fa-check-circle', label: 'Complete', category: 'Status'},\n        {id: 'fa-check', label: 'Check', category: 'Status'},\n        {id: 'fa-trophy', label: 'Trophy', category: 'Status'},\n        {id: 'fa-star', label: 'Star', category: 'Status'},\n        {id: 'fa-bar-chart', label: 'Bar Chart', category: 'Analytics'},\n        {id: 'fa-line-chart', label: 'Line Chart', category: 'Analytics'},\n        {id: 'fa-pie-chart', label: 'Pie Chart', category: 'Analytics'},\n        {id: 'fa-area-chart', label: 'Area Chart', category: 'Analytics'},\n        {id: 'fa-percent', label: 'Percent', category: 'Numbers'},\n        {id: 'fa-hashtag', label: 'Number', category: 'Numbers'},\n        {id: 'fa-sort-numeric-asc', label: 'Ranking', category: 'Numbers'},\n        {id: 'fa-dollar', label: 'Dollar', category: 'Financial'},\n        {id: 'fa-gbp', label: 'Pound', category: 'Financial'},\n        {id: 'fa-money', label: 'Money', category: 'Financial'},\n        {id: 'fa-tasks', label: 'Tasks', category: 'Progress'},\n        {id: 'fa-spinner', label: 'Progress', category: 'Progress'},\n        {id: 'fa-bullseye', label: 'Target', category: 'Progress'},\n        {id: 'fa-flag', label: 'Flag', category: 'Progress'},\n        {id: 'fa-envelope', label: 'Email', category: 'Communication'},\n        {id: 'fa-comments', label: 'Comments', category: 'Communication'},\n        {id: 'fa-bell', label: 'Notifications', category: 'Communication'},\n        {id: 'fa-exclamation-triangle', label: 'Warning', category: 'Alerts'},\n        {id: 'fa-info-circle', label: 'Info', category: 'Alerts'},\n        {id: 'fa-thumbs-up', label: 'Thumbs Up', category: 'Feedback'},\n        {id: 'fa-thumbs-down', label: 'Thumbs Down', category: 'Feedback'},\n        {id: 'fa-smile-o', label: 'Satisfaction', category: 'Feedback'}\n    ];\n\n    // Default icons for KPI cards (fallback when no icon selected).\n    var DEFAULT_KPI_ICONS = ['fa-users', 'fa-graduation-cap', 'fa-clock-o', 'fa-check-circle'];\n\n    /**\n     * Report Selector component for picking KPI/Tab reports.\n     * @param {Object} options Configuration options\n     */\n    var ReportSelector = function(options) {\n        this.mode = options.mode || 'kpi'; // 'kpi' or 'tabs'\n        this.apiKey = options.apiKey || '';\n        this.containerId = options.containerId;\n        this.textareaName = options.textareaName;\n        this.container = null;\n        this.textarea = null;\n        this.reports = [];\n        this.filteredReports = [];\n        this.selectedReports = [];\n        this.strings = {};\n        this.searchTimeout = null;\n        this.highlightedIndex = -1;\n        this.isDropdownOpen = false;\n\n        this.init();\n    };\n\n    ReportSelector.prototype = {\n        /**\n         * Initialize the report selector.\n         */\n        init: function() {\n            var self = this;\n\n            this.container = $('#' + this.containerId);\n            this.textarea = $('[name=\"' + this.textareaName + '\"]');\n\n            if (!this.container.length || !this.textarea.length) {\n                return;\n            }\n\n            // Load existing selection from textarea\n            this.loadExistingSelection();\n\n            // Load language strings\n            this.loadStrings().then(function() {\n                // Render the UI\n                self.render();\n\n                // Fetch reports from API\n                self.fetchReports();\n\n                // Bind events\n                self.bindEvents();\n\n                // Show container - Moodle's hideIf handles visibility based on display_mode.\n                self.container.show();\n                return true;\n            }).catch(function() {\n                // String loading failed, continue anyway.\n                return false;\n            });\n        },\n\n        /**\n         * Load language strings.\n         *\n         * @return {Promise}\n         */\n        loadStrings: function() {\n            var self = this;\n            return Str.get_strings([\n                {key: 'addreport', component: 'block_adeptus_insights'},\n                {key: 'removereport', component: 'block_adeptus_insights'},\n                {key: 'noreportsselected', component: 'block_adeptus_insights'},\n                {key: 'selectareport', component: 'block_adeptus_insights'},\n                {key: 'loading', component: 'block_adeptus_insights'},\n                {key: 'config_alert_report_placeholder', component: 'block_adeptus_insights'},\n                {key: 'js_failed_load_reports', component: 'block_adeptus_insights'}\n            ]).then(function(strings) {\n                self.strings = {\n                    addreport: strings[0],\n                    removereport: strings[1],\n                    noreportsselected: strings[2],\n                    selectareport: strings[3],\n                    loading: strings[4],\n                    searchplaceholder: strings[5] || 'Search reports by name, category, or type...',\n                    failedLoadReports: strings[6]\n                };\n                return self.strings;\n            });\n        },\n\n        /**\n         * Load existing selection from textarea.\n         */\n        loadExistingSelection: function() {\n            try {\n                var value = this.textarea.val();\n                if (value) {\n                    this.selectedReports = JSON.parse(value);\n                }\n            } catch (_e) {\n                this.selectedReports = [];\n            }\n        },\n\n        /**\n         * Render the report selector UI with searchable dropdown.\n         */\n        render: function() {\n            var modeLabels = {\n                'kpi': 'KPI Reports',\n                'tabs': 'Tab Reports',\n                'manual': 'Selected Reports'\n            };\n            var modeLabel = modeLabels[this.mode] || 'Reports';\n            var uniqueId = this.mode + '-search-' + Date.now();\n\n            var html = '<div class=\"report-selector-ui\">' +\n                '<div class=\"report-selector-header d-flex justify-content-between align-items-center mb-2\">' +\n                '<span class=\"font-weight-bold\">' + modeLabel + '</span>' +\n                '<span class=\"badge badge-secondary block-adeptus-report-count\">0 selected</span>' +\n                '</div>' +\n\n                // Searchable dropdown container\n                '<div class=\"report-selector-search-container mb-3 position-relative\">' +\n                '<div class=\"input-group\">' +\n                '<div class=\"input-group-prepend\">' +\n                '<span class=\"input-group-text\"><i class=\"fa fa-search\"></i></span>' +\n                '</div>' +\n                '<input type=\"text\" class=\"form-control report-search-input\" ' +\n                'id=\"' + uniqueId + '\" ' +\n                'placeholder=\"' + this.strings.searchplaceholder + '\" ' +\n                'autocomplete=\"off\" ' +\n                'aria-haspopup=\"listbox\" ' +\n                'aria-expanded=\"false\">' +\n                '<div class=\"input-group-append\">' +\n                '<button type=\"button\" class=\"btn btn-primary report-selector-add-btn\" disabled>' +\n                '<i class=\"fa fa-plus\"></i> ' + this.strings.addreport +\n                '</button>' +\n                '</div>' +\n                '</div>' +\n\n                // Dropdown results container\n                '<div class=\"report-search-dropdown position-absolute w-100 bg-white border rounded shadow-sm\" ' +\n                'style=\"display:none; z-index:1050; max-height:350px; overflow-y:auto; top:100%; left:0;\">' +\n                '<div class=\"report-search-results\"></div>' +\n                '<div class=\"report-search-empty text-muted text-center py-3\" style=\"display:none;\">' +\n                '<i class=\"fa fa-search\"></i> No matching reports found' +\n                '</div>' +\n                '<div class=\"report-search-loading text-center py-3\" style=\"display:none;\">' +\n                '<i class=\"fa fa-spinner fa-spin\"></i> ' + this.strings.loading +\n                '</div>' +\n                '</div>' +\n                '</div>' +\n\n                // Selected reports list\n                '<div class=\"report-selector-list-container\">' +\n                '<ul class=\"list-group report-selector-list\"></ul>' +\n                '<div class=\"report-selector-empty text-muted text-center py-3\">' +\n                '<i class=\"fa fa-inbox fa-2x mb-2\"></i><br>' +\n                this.strings.noreportsselected +\n                '</div>' +\n                '</div>' +\n                '</div>';\n\n            this.container.html(html);\n            this.updateListDisplay();\n            this.updateSelectedCount();\n        },\n\n        /**\n         * Fetch reports from the API.\n         */\n        fetchReports: function() {\n            var self = this;\n\n            if (!this.apiKey) {\n                this.container.find('.report-search-loading').hide();\n                this.container.find('.report-search-empty').show().html(\n                    '<i class=\"fa fa-exclamation-triangle\"></i> API key not configured'\n                );\n                return;\n            }\n\n            this.container.find('.report-search-loading').show();\n\n            var baseUrl = 'https://backend.adeptus360.com/api/v1';\n\n            // Fetch both wizard and AI reports\n            $.when(\n                $.ajax({\n                    url: baseUrl + '/wizard-reports',\n                    method: 'GET',\n                    headers: {\n                        'Authorization': 'Bearer ' + this.apiKey,\n                        'Accept': 'application/json'\n                    },\n                    timeout: 15000\n                }),\n                $.ajax({\n                    url: baseUrl + '/ai-reports',\n                    method: 'GET',\n                    headers: {\n                        'Authorization': 'Bearer ' + this.apiKey,\n                        'Accept': 'application/json'\n                    },\n                    timeout: 15000\n                })\n            ).then(function(wizardResult, aiResult) {\n                var allReports = [];\n\n                // Process wizard reports\n                var wizardReports = wizardResult[0].reports || wizardResult[0].data || [];\n                wizardReports.forEach(function(r) {\n                    r.source = 'wizard';\n                    r.displayName = r.name || r.title || r.display_name || r.slug;\n                    r.categoryName = r.category_info ? r.category_info.name : 'General';\n                    allReports.push(r);\n                });\n\n                // Process AI reports\n                var aiReports = aiResult[0].reports || aiResult[0].data || [];\n                aiReports.forEach(function(r) {\n                    r.source = 'ai';\n                    r.displayName = r.name || r.title || r.display_name || r.slug;\n                    r.categoryName = r.category_info ? r.category_info.name : 'AI Generated';\n                    allReports.push(r);\n                });\n\n                // Sort alphabetically by name\n                allReports.sort(function(a, b) {\n                    return a.displayName.localeCompare(b.displayName);\n                });\n\n                self.reports = allReports;\n                self.filteredReports = self.getAvailableReports();\n                self.container.find('.report-search-loading').hide();\n                self.renderSelectedList();\n                return allReports;\n            }).fail(function() {\n                self.container.find('.report-search-loading').hide();\n                Notification.addNotification({\n                    message: self.strings.failedLoadReports,\n                    type: 'error'\n                });\n                return null;\n            });\n        },\n\n        /**\n         * Get reports that haven't been selected yet.\n         *\n         * @return {Array}\n         */\n        getAvailableReports: function() {\n            var self = this;\n            return this.reports.filter(function(report) {\n                return !self.selectedReports.some(function(s) {\n                    return s.slug === report.slug && s.source === report.source;\n                });\n            });\n        },\n\n        /**\n         * Filter reports based on search query.\n         *\n         * @param {string} query Search query\n         * @return {Array} Filtered reports\n         */\n        filterReports: function(query) {\n            var available = this.getAvailableReports();\n\n            if (!query || query.length < 1) {\n                return available;\n            }\n\n            query = query.toLowerCase().trim();\n            var terms = query.split(/\\s+/);\n\n            return available.filter(function(report) {\n                var searchText = (\n                    report.displayName + ' ' +\n                    report.categoryName + ' ' +\n                    report.source + ' ' +\n                    (report.slug || '')\n                ).toLowerCase();\n\n                // All terms must match\n                return terms.every(function(term) {\n                    return searchText.indexOf(term) !== -1;\n                });\n            }).slice(0, 50); // Limit to 50 results for performance\n        },\n\n        /**\n         * Render the search dropdown results.\n         *\n         * @param {string} query Current search query for highlighting\n         */\n        renderSearchResults: function(query) {\n            var self = this;\n            var resultsContainer = this.container.find('.report-search-results');\n            var emptyContainer = this.container.find('.report-search-empty');\n\n            resultsContainer.empty();\n\n            if (this.filteredReports.length === 0) {\n                emptyContainer.show();\n                return;\n            }\n\n            emptyContainer.hide();\n\n            // Group by category\n            var byCategory = {};\n            this.filteredReports.forEach(function(report) {\n                var cat = report.categoryName || 'Other';\n                if (!byCategory[cat]) {\n                    byCategory[cat] = [];\n                }\n                byCategory[cat].push(report);\n            });\n\n            var index = 0;\n            Object.keys(byCategory).sort().forEach(function(category) {\n                // Category header\n                resultsContainer.append(\n                    '<div class=\"report-search-category px-3 py-1 bg-light border-bottom\">' +\n                    '<small class=\"text-muted font-weight-bold\">' + self.escapeHtml(category) + '</small>' +\n                    '</div>'\n                );\n\n                // Reports in category\n                byCategory[category].forEach(function(report) {\n                    var highlightedName = self.highlightMatch(report.displayName, query);\n                    var sourceBadge = report.source === 'ai'\n                        ? '<span class=\"badge badge-info ml-2\">AI</span>'\n                        : '<span class=\"badge badge-primary ml-2\">Wizard</span>';\n\n                    var itemHtml = '<div class=\"report-search-item px-3 py-2 cursor-pointer\" ' +\n                        'data-index=\"' + index + '\" ' +\n                        'data-slug=\"' + report.slug + '\" ' +\n                        'data-source=\"' + report.source + '\" ' +\n                        'role=\"option\" ' +\n                        'tabindex=\"-1\">' +\n                        '<div class=\"d-flex justify-content-between align-items-center\">' +\n                        '<span class=\"report-name\">' + highlightedName + '</span>' +\n                        sourceBadge +\n                        '</div>' +\n                        '</div>';\n\n                    resultsContainer.append(itemHtml);\n                    index++;\n                });\n            });\n\n            // Apply hover styling\n            resultsContainer.find('.report-search-item')\n                .css('cursor', 'pointer')\n                .hover(\n                    function() {\n                        $(this).addClass('bg-light');\n                        self.highlightedIndex = parseInt($(this).data('index'), 10);\n                        self.updateHighlight();\n                    },\n                    function() {\n                        $(this).removeClass('bg-light');\n                    }\n                );\n        },\n\n        /**\n         * Highlight matching text in a string.\n         *\n         * @param {string} text Text to highlight\n         * @param {string} query Search query\n         * @return {string} HTML with highlighted matches\n         */\n        highlightMatch: function(text, query) {\n            if (!query || !text) {\n                return this.escapeHtml(text);\n            }\n\n            var escaped = this.escapeHtml(text);\n            var terms = query.toLowerCase().trim().split(/\\s+/);\n\n            terms.forEach(function(term) {\n                if (term.length > 0) {\n                    var regex = new RegExp('(' + term.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&') + ')', 'gi');\n                    escaped = escaped.replace(regex, '<mark class=\"bg-warning px-0\">$1</mark>');\n                }\n            });\n\n            return escaped;\n        },\n\n        /**\n         * Update the highlighted item in dropdown.\n         */\n        updateHighlight: function() {\n            var items = this.container.find('.report-search-item');\n            items.removeClass('bg-primary text-white bg-light');\n\n            if (this.highlightedIndex >= 0 && this.highlightedIndex < items.length) {\n                var item = items.eq(this.highlightedIndex);\n                item.removeClass('bg-light').addClass('bg-primary text-white');\n\n                // Scroll into view\n                var dropdown = this.container.find('.report-search-dropdown');\n                var itemTop = item.position().top;\n                var itemHeight = item.outerHeight();\n                var dropdownHeight = dropdown.height();\n                var scrollTop = dropdown.scrollTop();\n\n                if (itemTop < 0) {\n                    dropdown.scrollTop(scrollTop + itemTop);\n                } else if (itemTop + itemHeight > dropdownHeight) {\n                    dropdown.scrollTop(scrollTop + itemTop + itemHeight - dropdownHeight);\n                }\n            }\n        },\n\n        /**\n         * Open the search dropdown.\n         */\n        openDropdown: function() {\n            if (this.isDropdownOpen) {\n                return;\n            }\n\n            this.isDropdownOpen = true;\n            this.highlightedIndex = -1;\n\n            var dropdown = this.container.find('.report-search-dropdown');\n            var input = this.container.find('.report-search-input');\n\n            dropdown.show();\n            input.attr('aria-expanded', 'true');\n\n            // Render current results\n            var query = input.val();\n            this.filteredReports = this.filterReports(query);\n            this.renderSearchResults(query);\n        },\n\n        /**\n         * Close the search dropdown.\n         */\n        closeDropdown: function() {\n            if (!this.isDropdownOpen) {\n                return;\n            }\n\n            this.isDropdownOpen = false;\n            this.highlightedIndex = -1;\n\n            var dropdown = this.container.find('.report-search-dropdown');\n            var input = this.container.find('.report-search-input');\n\n            dropdown.hide();\n            input.attr('aria-expanded', 'false');\n        },\n\n        /**\n         * Handle search input.\n         *\n         * @param {string} query Search query\n         */\n        handleSearch: function(query) {\n            var self = this;\n\n            // Clear previous timeout\n            if (this.searchTimeout) {\n                clearTimeout(this.searchTimeout);\n            }\n\n            // Debounce search\n            this.searchTimeout = setTimeout(function() {\n                self.filteredReports = self.filterReports(query);\n                self.renderSearchResults(query);\n                self.highlightedIndex = -1;\n            }, 150);\n        },\n\n        /**\n         * Select the currently highlighted item.\n         */\n        selectHighlightedItem: function() {\n            if (this.highlightedIndex < 0 || this.highlightedIndex >= this.filteredReports.length) {\n                return;\n            }\n\n            var report = this.filteredReports[this.highlightedIndex];\n            this.addReport(report);\n        },\n\n        /**\n         * Add a report to the selection.\n         *\n         * @param {Object} report Report object\n         */\n        addReport: function(report) {\n            // Determine default icon based on current count (for KPI mode)\n            var defaultIcon = DEFAULT_KPI_ICONS[this.selectedReports.length % DEFAULT_KPI_ICONS.length];\n\n            // Add to selected list\n            var reportData = {\n                slug: report.slug,\n                source: report.source,\n                name: report.displayName || report.name || report.title || report.slug\n            };\n\n            // Add icon for KPI mode only\n            if (this.mode === 'kpi') {\n                reportData.icon = defaultIcon;\n            }\n\n            this.selectedReports.push(reportData);\n\n            this.saveSelection();\n            this.updateSelectedCount();\n\n            // Update available reports and re-render\n            this.filteredReports = this.getAvailableReports();\n\n            // Clear search and close dropdown\n            var input = this.container.find('.report-search-input');\n            input.val('');\n            this.closeDropdown();\n\n            // Re-render selected list\n            this.renderSelectedList();\n        },\n\n        /**\n         * Render the selected reports list.\n         */\n        renderSelectedList: function() {\n            var self = this;\n            var list = this.container.find('.report-selector-list');\n            list.empty();\n\n            this.selectedReports.forEach(function(selected, index) {\n                // Find full report info\n                var report = self.reports.find(function(r) {\n                    return r.slug === selected.slug && r.source === selected.source;\n                });\n\n                var name = selected.name || (report ? report.displayName : selected.slug);\n                var categoryName = report ? report.categoryName : 'Unknown';\n\n                // Build icon picker for KPI mode\n                var iconPicker = '';\n                if (self.mode === 'kpi') {\n                    var currentIcon = selected.icon || DEFAULT_KPI_ICONS[index % DEFAULT_KPI_ICONS.length];\n                    iconPicker = self.buildIconPicker(currentIcon, index);\n                }\n\n                var item = '<li class=\"list-group-item d-flex justify-content-between align-items-center\" ' +\n                    'data-index=\"' + index + '\" data-slug=\"' + selected.slug + '\" data-source=\"' + selected.source + '\">' +\n                    '<div class=\"d-flex align-items-center flex-grow-1 min-width-0\">' +\n                    '<span class=\"drag-handle mr-2\" style=\"cursor: move;\"><i class=\"fa fa-bars text-muted\"></i></span>' +\n                    iconPicker +\n                    '<span class=\"badge badge-secondary mr-2\">' + (index + 1) + '</span>' +\n                    '<span class=\"text-truncate\" title=\"' + self.escapeHtml(name) + '\">' + self.escapeHtml(name) + '</span>' +\n                    '<small class=\"text-muted ml-2 d-none d-md-inline\">[' + self.escapeHtml(categoryName) + ']</small>' +\n                    '<span class=\"badge badge-' + (selected.source === 'ai' ? 'info' : 'primary') + ' ml-2\">' +\n                    selected.source.toUpperCase() + '</span>' +\n                    '</div>' +\n                    '<button type=\"button\" class=\"btn btn-sm btn-outline-danger report-selector-remove ml-2\" title=\"' +\n                    self.strings.removereport + '\">' +\n                    '<i class=\"fa fa-times\"></i>' +\n                    '</button>' +\n                    '</li>';\n\n                list.append(item);\n            });\n\n            this.updateListDisplay();\n            this.initSortable();\n            this.initIconPickers();\n        },\n\n        /**\n         * Build icon picker dropdown HTML.\n         *\n         * @param {string} currentIcon Current icon class\n         * @param {number} index Report index\n         * @return {string} HTML for icon picker\n         */\n        buildIconPicker: function(currentIcon, index) {\n            var html = '<div class=\"dropdown block-adeptus-kpi-icon-picker mr-2\" data-index=\"' + index + '\">' +\n                '<button class=\"btn btn-sm btn-outline-secondary dropdown-toggle\" type=\"button\" ' +\n                'data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\" title=\"Select icon\">' +\n                '<i class=\"fa ' + currentIcon + '\"></i>' +\n                '</button>' +\n                '<div class=\"dropdown-menu block-adeptus-kpi-icon-dropdown\">' +\n                '<div class=\"px-2 py-1\">' +\n                '<small class=\"text-muted\">Select an icon</small>' +\n                '</div>' +\n                '<div class=\"dropdown-divider\"></div>' +\n                '<div class=\"block-adeptus-kpi-icon-grid px-2\">';\n\n            // Group icons by category\n            var categories = {};\n            KPI_ICONS.forEach(function(icon) {\n                if (!categories[icon.category]) {\n                    categories[icon.category] = [];\n                }\n                categories[icon.category].push(icon);\n            });\n\n            // Render icons grouped by category\n            Object.keys(categories).forEach(function(category) {\n                html += '<div class=\"block-adeptus-kpi-icon-category mb-1\">' +\n                    '<small class=\"text-muted d-block mb-1\">' + category + '</small>' +\n                    '<div class=\"d-flex flex-wrap\">';\n\n                categories[category].forEach(function(icon) {\n                    var isActive = icon.id === currentIcon ? ' active' : '';\n                    html += '<button type=\"button\" ' +\n                        'class=\"btn btn-sm btn-light block-adeptus-kpi-icon-option m-1' +\n                        isActive + '\" ' +\n                        'data-icon=\"' + icon.id + '\" title=\"' + icon.label + '\">' +\n                        '<i class=\"fa ' + icon.id + '\"></i>' +\n                        '</button>';\n                });\n\n                html += '</div></div>';\n            });\n\n            html += '</div></div></div>';\n\n            return html;\n        },\n\n        /**\n         * Initialize icon picker event handlers.\n         * Manually handles dropdown toggle since Bootstrap doesn't auto-init dynamic content.\n         */\n        initIconPickers: function() {\n            var self = this;\n\n            // Handle dropdown toggle (manual implementation for dynamic content)\n            var iconPickerSelector = '.block-adeptus-kpi-icon-picker .dropdown-toggle';\n            this.container.find(iconPickerSelector).off('click.iconpicker').on('click.iconpicker', function(e) {\n                e.preventDefault();\n                e.stopPropagation();\n\n                var $btn = $(this);\n                var $picker = $btn.closest('.block-adeptus-kpi-icon-picker');\n                var $menu = $picker.find('.dropdown-menu');\n                var isOpen = $menu.hasClass('show');\n\n                // Close all other open dropdowns first\n                self.container.find('.block-adeptus-kpi-icon-picker .dropdown-menu.show').removeClass('show');\n                self.container.find('.block-adeptus-kpi-icon-picker .dropdown-toggle').attr('aria-expanded', 'false');\n\n                if (!isOpen) {\n                    // Calculate if dropdown would overflow - use dropup if needed\n                    var pickerRect = $picker[0].getBoundingClientRect();\n                    var viewportHeight = window.innerHeight;\n                    var spaceBelow = viewportHeight - pickerRect.bottom;\n\n                    // Use dropup if less than 320px below\n                    if (spaceBelow < 320) {\n                        $picker.addClass('dropup');\n                    } else {\n                        $picker.removeClass('dropup');\n                    }\n\n                    // Open this dropdown\n                    $menu.addClass('show');\n                    $btn.attr('aria-expanded', 'true');\n                }\n            });\n\n            // Handle icon selection\n            this.container.find('.block-adeptus-kpi-icon-option').off('click.iconpicker').on('click.iconpicker', function(e) {\n                e.preventDefault();\n                e.stopPropagation();\n\n                var $btn = $(this);\n                var $picker = $btn.closest('.block-adeptus-kpi-icon-picker');\n                var index = parseInt($picker.data('index'), 10);\n                var newIcon = $btn.data('icon');\n\n                // Update selected report\n                if (self.selectedReports[index]) {\n                    self.selectedReports[index].icon = newIcon;\n                    self.saveSelection();\n\n                    // Update picker button icon\n                    $picker.find('.dropdown-toggle i').removeClass().addClass('fa ' + newIcon);\n\n                    // Update active state\n                    $picker.find('.block-adeptus-kpi-icon-option').removeClass('active');\n                    $btn.addClass('active');\n\n                    // Close dropdown\n                    $picker.find('.dropdown-menu').removeClass('show');\n                    $picker.find('.dropdown-toggle').attr('aria-expanded', 'false');\n                }\n            });\n\n            // Close dropdown when clicking outside\n            $(document).off('click.iconpicker-close').on('click.iconpicker-close', function(e) {\n                if (!$(e.target).closest('.block-adeptus-kpi-icon-picker').length) {\n                    self.container.find('.block-adeptus-kpi-icon-picker .dropdown-menu.show').removeClass('show');\n                    self.container.find('.block-adeptus-kpi-icon-picker .dropdown-toggle').attr('aria-expanded', 'false');\n                }\n            });\n        },\n\n        /**\n         * Update list display (show/hide empty state).\n         */\n        updateListDisplay: function() {\n            var list = this.container.find('.report-selector-list');\n            var empty = this.container.find('.report-selector-empty');\n\n            if (this.selectedReports.length > 0) {\n                list.show();\n                empty.hide();\n            } else {\n                list.hide();\n                empty.show();\n            }\n        },\n\n        /**\n         * Update the selected count badge.\n         */\n        updateSelectedCount: function() {\n            var count = this.selectedReports.length;\n            var text = count === 1 ? '1 selected' : count + ' selected';\n            this.container.find('.block-adeptus-report-count').text(text);\n        },\n\n        /**\n         * Initialize sortable for drag-and-drop reordering.\n         */\n        initSortable: function() {\n            var self = this;\n            var list = this.container.find('.report-selector-list');\n\n            // Simple sortable implementation using jQuery UI if available\n            if ($.fn.sortable) {\n                list.sortable({\n                    handle: '.drag-handle',\n                    update: function() {\n                        self.updateOrderFromDOM();\n                    }\n                });\n            } else {\n                // Fallback: manual drag handling\n                this.initManualSort();\n            }\n        },\n\n        /**\n         * Initialize manual sort without jQuery UI.\n         */\n        initManualSort: function() {\n            var self = this;\n            var list = this.container.find('.report-selector-list');\n            var dragItem = null;\n\n            list.on('dragstart', 'li', function(e) {\n                dragItem = this;\n                $(this).addClass('dragging opacity-50');\n                e.originalEvent.dataTransfer.effectAllowed = 'move';\n            });\n\n            list.on('dragend', 'li', function() {\n                $(this).removeClass('dragging opacity-50');\n                self.updateOrderFromDOM();\n            });\n\n            list.on('dragover', 'li', function(e) {\n                e.preventDefault();\n                var rect = this.getBoundingClientRect();\n                var midY = rect.top + rect.height / 2;\n                if (e.originalEvent.clientY < midY) {\n                    $(this).before(dragItem);\n                } else {\n                    $(this).after(dragItem);\n                }\n            });\n\n            // Make items draggable\n            list.find('li').attr('draggable', 'true');\n        },\n\n        /**\n         * Update the order from DOM after sorting.\n         */\n        updateOrderFromDOM: function() {\n            var self = this;\n            var newOrder = [];\n\n            this.container.find('.report-selector-list li').each(function() {\n                var slug = $(this).data('slug');\n                var source = $(this).data('source');\n                var existing = self.selectedReports.find(function(s) {\n                    return s.slug === slug && s.source === source;\n                });\n                if (existing) {\n                    newOrder.push(existing);\n                }\n            });\n\n            this.selectedReports = newOrder;\n            this.saveSelection();\n            this.renderSelectedList();\n        },\n\n        /**\n         * Bind event handlers.\n         */\n        bindEvents: function() {\n            var self = this;\n            var input = this.container.find('.report-search-input');\n            var dropdown = this.container.find('.report-search-dropdown');\n\n            // Focus on input opens dropdown\n            input.on('focus', function() {\n                self.openDropdown();\n            });\n\n            // Input changes trigger search\n            input.on('input', function() {\n                var query = $(this).val();\n                self.openDropdown();\n                self.handleSearch(query);\n            });\n\n            // Keyboard navigation\n            input.on('keydown', function(e) {\n                var items = self.container.find('.report-search-item');\n                var maxIndex = items.length - 1;\n\n                switch (e.keyCode) {\n                    case 40: // Down arrow\n                        e.preventDefault();\n                        if (!self.isDropdownOpen) {\n                            self.openDropdown();\n                        }\n                        self.highlightedIndex = Math.min(self.highlightedIndex + 1, maxIndex);\n                        self.updateHighlight();\n                        break;\n\n                    case 38: // Up arrow\n                        e.preventDefault();\n                        self.highlightedIndex = Math.max(self.highlightedIndex - 1, 0);\n                        self.updateHighlight();\n                        break;\n\n                    case 13: // Enter\n                        e.preventDefault();\n                        if (self.highlightedIndex >= 0) {\n                            self.selectHighlightedItem();\n                        }\n                        break;\n\n                    case 27: // Escape\n                        e.preventDefault();\n                        self.closeDropdown();\n                        input.blur();\n                        break;\n\n                    case 9: // Tab\n                        self.closeDropdown();\n                        break;\n                }\n            });\n\n            // Click on dropdown item\n            dropdown.on('click', '.report-search-item', function() {\n                var slug = $(this).data('slug');\n                var source = $(this).data('source');\n                var report = self.reports.find(function(r) {\n                    return r.slug === slug && r.source === source;\n                });\n                if (report) {\n                    self.addReport(report);\n                }\n            });\n\n            // Click outside closes dropdown\n            $(document).on('click', function(e) {\n                if (!$(e.target).closest(self.container).length) {\n                    self.closeDropdown();\n                }\n            });\n\n            // Remove report button\n            this.container.on('click', '.report-selector-remove', function(e) {\n                e.stopPropagation();\n                var item = $(this).closest('li');\n                var slug = item.data('slug');\n                var source = item.data('source');\n                self.removeReport(slug, source);\n            });\n\n            // Note: Container visibility is handled by Moodle's hideIf based on display_mode.\n        },\n\n        /**\n         * Remove a report from selection.\n         *\n         * @param {string} slug\n         * @param {string} source\n         */\n        removeReport: function(slug, source) {\n            this.selectedReports = this.selectedReports.filter(function(s) {\n                return !(s.slug === slug && s.source === source);\n            });\n\n            this.saveSelection();\n            this.updateSelectedCount();\n            this.filteredReports = this.getAvailableReports();\n            this.renderSelectedList();\n\n            // Re-render dropdown if open\n            if (this.isDropdownOpen) {\n                var query = this.container.find('.report-search-input').val();\n                this.filteredReports = this.filterReports(query);\n                this.renderSearchResults(query);\n            }\n        },\n\n        /**\n         * Save selection to textarea.\n         */\n        saveSelection: function() {\n            this.textarea.val(JSON.stringify(this.selectedReports)).trigger('change');\n        },\n\n        /**\n         * Escape HTML special characters.\n         *\n         * @param {string} text\n         * @return {string}\n         */\n        escapeHtml: function(text) {\n            if (!text) {\n                return '';\n            }\n            var div = document.createElement('div');\n            div.textContent = text;\n            return div.innerHTML;\n        }\n    };\n\n    /**\n     * AlertsManager class for managing multiple alert configurations.\n     *\n     * @param {Object} options Configuration options\n     */\n    var AlertsManager = function(options) {\n        this.apiKey = options.apiKey || '';\n        this.container = null;\n        this.textarea = null;\n        this.alerts = [];\n        this.reports = [];\n        this.filteredReports = [];\n        this.operators = {};\n        this.intervals = {};\n        this.cooldowns = {};\n        this.roles = {};\n        this.editingIndex = -1;\n        this.isDropdownOpen = false;\n        this.isUserDropdownOpen = false;\n        this.searchTimeout = null;\n        this.userSearchTimeout = null;\n        this.selectedUsers = [];\n        this.strings = {};\n\n        this.init();\n    };\n\n    AlertsManager.prototype = {\n        /**\n         * Initialize the alerts manager.\n         */\n        init: function() {\n            var self = this;\n\n            this.container = $('#alerts-manager-container');\n            this.textarea = $('#id_config_alerts_json');\n\n            if (!this.container.length) {\n                return;\n            }\n\n            // Load language strings first, then proceed with initialization.\n            this.loadStrings().then(function() {\n                // Load configuration data from container attributes.\n                self.operators = JSON.parse(self.container.attr('data-operators') || '{}');\n                self.intervals = JSON.parse(self.container.attr('data-intervals') || '{}');\n                self.cooldowns = JSON.parse(self.container.attr('data-cooldowns') || '{}');\n                self.roles = JSON.parse(self.container.attr('data-roles') || '{}');\n\n                // Load existing alerts.\n                var existingAlerts = JSON.parse(self.container.attr('data-existing-alerts') || '[]');\n                self.alerts = existingAlerts;\n\n                // Clean up any orphaned backend alerts that no longer exist in local config.\n                // This ensures backend stays in sync with Moodle's source of truth.\n                if (existingAlerts.length > 0) {\n                    self.cleanupOrphanedAlerts();\n                }\n\n                // Populate select options.\n                self.populateSelectOptions();\n\n                // Fetch reports for the dropdown.\n                self.fetchReports();\n\n                // Bind events.\n                self.bindEvents();\n\n                // Initial render.\n                self.renderAlertsList();\n                self.saveToTextarea();\n\n                // Show/hide based on alerts_enabled checkbox.\n                self.handleAlertsEnabledToggle();\n                return true;\n            }).catch(function() {\n                // String loading failed, continue anyway.\n                return false;\n            });\n        },\n\n        /**\n         * Load language strings.\n         *\n         * @return {Promise}\n         */\n        loadStrings: function() {\n            var self = this;\n            return Str.get_strings([\n                {key: 'edit_alert', component: 'block_adeptus_insights'},\n                {key: 'delete_alert', component: 'block_adeptus_insights'},\n                {key: 'alert_delete_confirm', component: 'block_adeptus_insights'},\n                {key: 'add_new_alert', component: 'block_adeptus_insights'},\n                {key: 'alert_disabled', component: 'block_adeptus_insights'},\n                {key: 'config_add_alert', component: 'block_adeptus_insights'},\n                {key: 'js_selected', component: 'block_adeptus_insights'},\n                {key: 'js_alert_no_reports', component: 'block_adeptus_insights'},\n                {key: 'js_no_thresholds_set', component: 'block_adeptus_insights'},\n                {key: 'alert_threshold_warning_only', component: 'block_adeptus_insights'},\n                {key: 'alert_threshold_critical_only', component: 'block_adeptus_insights'},\n                {key: 'alert_status_badge_warning', component: 'block_adeptus_insights'},\n                {key: 'alert_status_badge_critical', component: 'block_adeptus_insights'},\n                {key: 'alert_status_badge_ok', component: 'block_adeptus_insights'},\n                {key: 'js_failed_load_reports', component: 'block_adeptus_insights'},\n                {key: 'js_alert_failed_create', component: 'block_adeptus_insights'},\n                {key: 'js_alert_failed_update', component: 'block_adeptus_insights'},\n                {key: 'js_alert_failed_delete', component: 'block_adeptus_insights'},\n                {key: 'js_alert_created', component: 'block_adeptus_insights'},\n                {key: 'js_alert_updated', component: 'block_adeptus_insights'},\n                {key: 'js_alert_deleted', component: 'block_adeptus_insights'},\n                {key: 'js_alert_select_report', component: 'block_adeptus_insights'},\n                {key: 'js_alert_enter_threshold', component: 'block_adeptus_insights'}\n            ]).then(function(strings) {\n                self.strings = {\n                    editAlert: strings[0],\n                    deleteAlert: strings[1],\n                    deleteConfirm: strings[2],\n                    addNewAlert: strings[3],\n                    disabled: strings[4],\n                    addAlert: strings[5],\n                    selected: strings[6],\n                    noReports: strings[7],\n                    noThresholdsSet: strings[8],\n                    thresholdWarning: strings[9],\n                    thresholdCritical: strings[10],\n                    statusWarning: strings[11],\n                    statusCritical: strings[12],\n                    statusOk: strings[13],\n                    failedLoadReports: strings[14],\n                    failedCreateAlert: strings[15],\n                    failedUpdateAlert: strings[16],\n                    failedDeleteAlert: strings[17],\n                    alertCreated: strings[18],\n                    alertUpdated: strings[19],\n                    alertDeleted: strings[20],\n                    selectReport: strings[21],\n                    enterThreshold: strings[22]\n                };\n                return self.strings;\n            });\n        },\n\n        /**\n         * Populate select element options.\n         */\n        populateSelectOptions: function() {\n            // Populate operators.\n            var operatorSelect = $('#alert-edit-operator');\n            operatorSelect.empty();\n            $.each(this.operators, function(key, value) {\n                operatorSelect.append($('<option>', {value: key, text: value}));\n            });\n\n            // Populate intervals.\n            var intervalSelect = $('#alert-edit-interval');\n            intervalSelect.empty();\n            $.each(this.intervals, function(key, value) {\n                intervalSelect.append($('<option>', {value: key, text: value}));\n            });\n\n            // Populate cooldowns.\n            var cooldownSelect = $('#alert-edit-cooldown');\n            cooldownSelect.empty();\n            $.each(this.cooldowns, function(key, value) {\n                cooldownSelect.append($('<option>', {value: key, text: value}));\n            });\n\n            // Populate role filter dropdown.\n            var roleFilter = $('#alert-edit-role-filter');\n            if (roleFilter.length) {\n                roleFilter.find('option:not(:first)').remove(); // Keep \"All users\" option.\n                $.each(this.roles, function(key, value) {\n                    roleFilter.append($('<option>', {value: key, text: value}));\n                });\n            }\n            // Element not found yet, might be in a modal - will be populated on openEditPanel.\n        },\n\n        /**\n         * Load reports from the block's selected reports.\n         *\n         * Only shows reports that are already configured in the block's\n         * KPI or Tabs report selectors, not all available reports.\n         */\n        fetchReports: function() {\n            var allReports = [];\n\n            // Get selected reports from the KPI report selector textarea.\n            var kpiTextarea = $('[name=\"config_kpi_selected_reports\"]');\n            if (kpiTextarea.length && kpiTextarea.val()) {\n                try {\n                    var kpiReports = JSON.parse(kpiTextarea.val());\n                    if (Array.isArray(kpiReports)) {\n                        kpiReports.forEach(function(r) {\n                            r.displayName = r.name || r.title || r.display_name || r.slug;\n                            var catInfo = r.category_info;\n                            var isAi = r.source === 'ai';\n                            var defaultCategory = isAi ? 'AI Generated' : 'General';\n                            r.categoryName = catInfo ? catInfo.name : defaultCategory;\n                            allReports.push(r);\n                        });\n                    }\n                } catch (_e) {\n                    // Invalid JSON, ignore.\n                }\n            }\n\n            // Get selected reports from the Tabs report selector textarea.\n            var tabsTextarea = $('[name=\"config_tabs_selected_reports\"]');\n            if (tabsTextarea.length && tabsTextarea.val()) {\n                try {\n                    var tabsReports = JSON.parse(tabsTextarea.val());\n                    if (Array.isArray(tabsReports)) {\n                        tabsReports.forEach(function(r) {\n                            // Avoid duplicates (same slug).\n                            var exists = allReports.some(function(existing) {\n                                return existing.slug === r.slug;\n                            });\n                            if (!exists) {\n                                r.displayName = r.name || r.title || r.display_name || r.slug;\n                                var catInfo = r.category_info;\n                                var isAi = r.source === 'ai';\n                                var defaultCategory = isAi ? 'AI Generated' : 'General';\n                                r.categoryName = catInfo ? catInfo.name : defaultCategory;\n                                allReports.push(r);\n                            }\n                        });\n                    }\n                } catch (_e) {\n                    // Invalid JSON, ignore.\n                }\n            }\n\n            // Sort alphabetically by display name.\n            allReports.sort(function(a, b) {\n                return (a.displayName || '').localeCompare(b.displayName || '');\n            });\n\n            this.reports = allReports;\n            this.filteredReports = allReports;\n\n            // Update UI to show message if no reports selected.\n            if (allReports.length === 0) {\n                this.container.find('.alert-report-empty-message').remove();\n                this.container.find('.alerts-edit-panel').prepend(\n                    '<div class=\"alert alert-info alert-report-empty-message\">' +\n                    '<i class=\"fa fa-info-circle\"></i> ' +\n                    this.strings.noReports +\n                    '</div>'\n                );\n            }\n        },\n\n        /**\n         * Handle alerts_enabled checkbox toggle.\n         */\n        handleAlertsEnabledToggle: function() {\n            var self = this;\n            var checkbox = $('[name=\"config_alerts_enabled\"]');\n            var displayMode = $('[name=\"config_display_mode\"]');\n\n            var updateVisibility = function() {\n                var enabled = checkbox.is(':checked');\n                var isKpi = displayMode.val() === 'kpi';\n\n                if (enabled && isKpi) {\n                    self.container.show();\n                } else {\n                    self.container.hide();\n                }\n            };\n\n            checkbox.on('change', updateVisibility);\n            displayMode.on('change', updateVisibility);\n            updateVisibility();\n        },\n\n        /**\n         * Bind event handlers.\n         */\n        bindEvents: function() {\n            var self = this;\n\n            // Listen for changes to the report selector textareas.\n            // When reports are added/removed from KPI or Tabs, refresh the alerts report list.\n            $('[name=\"config_kpi_selected_reports\"], [name=\"config_tabs_selected_reports\"]').on('change', function() {\n                self.fetchReports();\n            });\n\n            // Add alert button.\n            this.container.on('click', '#add-alert-btn', function() {\n                self.openEditPanel(-1);\n            });\n\n            // Edit alert button.\n            this.container.on('click', '.alert-edit-btn', function() {\n                var index = $(this).closest('.alert-item').data('index');\n                self.openEditPanel(index);\n            });\n\n            // Delete alert button.\n            this.container.on('click', '.alert-delete-btn', function() {\n                var index = $(this).closest('.alert-item').data('index');\n                // eslint-disable-next-line no-alert\n                if (confirm(self.strings.deleteConfirm)) {\n                    self.deleteAlert(index);\n                }\n            });\n\n            // Toggle alert enabled/disabled.\n            this.container.on('change', '.alert-enabled-toggle', function() {\n                var index = $(this).closest('.alert-item').data('index');\n                self.alerts[index].enabled = $(this).is(':checked');\n                self.saveToTextarea();\n                self.renderAlertsList();\n            });\n\n            // Panel close buttons.\n            this.container.on('click', '.alert-panel-close, .alert-panel-cancel', function() {\n                self.closeEditPanel();\n            });\n\n            // Panel save button.\n            this.container.on('click', '.alert-panel-save', function() {\n                self.saveEditPanel();\n            });\n\n            // Toggle email addresses visibility based on notify_email checkbox.\n            $('#alert-edit-notify-email').on('change', function() {\n                if ($(this).is(':checked')) {\n                    $('#email-addresses-group').show();\n                } else {\n                    $('#email-addresses-group').hide();\n                }\n            });\n\n            // Report search input.\n            var searchInput = $('#alert-edit-report-search');\n            var dropdown = $('#alert-report-dropdown');\n\n            searchInput.on('focus', function() {\n                self.openReportDropdown();\n            });\n\n            searchInput.on('input', function() {\n                var query = $(this).val();\n                self.handleReportSearch(query);\n            });\n\n            searchInput.on('keydown', function(e) {\n                if (e.keyCode === 27) { // Escape\n                    self.closeReportDropdown();\n                }\n            });\n\n            dropdown.on('click', '.report-dropdown-item', function() {\n                var slug = $(this).data('slug');\n                var name = $(this).data('name');\n                self.selectReport(slug, name);\n            });\n\n            // Close dropdown when clicking outside.\n            $(document).on('click', function(e) {\n                if (!$(e.target).closest('#alert-edit-report-search, #alert-report-dropdown').length) {\n                    self.closeReportDropdown();\n                }\n                if (!$(e.target).closest('#alert-edit-user-search, #alert-user-dropdown').length) {\n                    self.closeUserDropdown();\n                }\n            });\n\n            // Role filter change - reload users.\n            $('#alert-edit-role-filter').on('change', function() {\n                // Clear search and reload with new filter.\n                $('#alert-edit-user-search').val('');\n                self.loadUsers();\n            });\n\n            // User search input.\n            var userSearchInput = $('#alert-edit-user-search');\n            var userDropdown = $('#alert-user-dropdown');\n\n            userSearchInput.on('focus', function() {\n                self.openUserDropdown();\n            });\n\n            userSearchInput.on('input', function() {\n                self.handleUserSearch();\n            });\n\n            userSearchInput.on('keydown', function(e) {\n                if (e.keyCode === 27) { // Escape.\n                    self.closeUserDropdown();\n                }\n            });\n\n            userDropdown.on('click', '.user-dropdown-item', function() {\n                var userId = $(this).data('userid');\n                var userName = $(this).data('name');\n                var userEmail = $(this).data('email');\n                self.addSelectedUser(userId, userName, userEmail);\n            });\n\n            // Remove selected user.\n            this.container.on('click', '.remove-selected-user', function() {\n                var userId = $(this).data('userid');\n                self.removeSelectedUser(userId);\n            });\n        },\n\n        /**\n         * Render the alerts list.\n         */\n        renderAlertsList: function() {\n            var self = this;\n            var list = $('#alerts-list');\n            var emptyState = list.find('.alerts-empty');\n\n            // Clear existing items (except empty state).\n            list.find('.alert-item').remove();\n\n            if (this.alerts.length === 0) {\n                emptyState.show();\n            } else {\n                emptyState.hide();\n\n                this.alerts.forEach(function(alert, index) {\n                    var reportName = alert.report_name || alert.report_slug;\n                    var alertName = alert.alert_name || reportName;\n                    var operatorLabel = self.operators[alert.operator] || alert.operator;\n\n                    // Build threshold display.\n                    var thresholds = [];\n                    if (alert.warning_value !== null && alert.warning_value !== '') {\n                        thresholds.push(self.strings.thresholdWarning.replace('{$a}', alert.warning_value));\n                    }\n                    if (alert.critical_value !== null && alert.critical_value !== '') {\n                        thresholds.push(self.strings.thresholdCritical.replace('{$a}', alert.critical_value));\n                    }\n                    var thresholdText = thresholds.join(', ') || self.strings.noThresholdsSet;\n\n                    // Get interval label.\n                    var intervalLabel = self.intervals[alert.check_interval] || alert.check_interval + 's';\n\n                    // Status badge.\n                    var statusBadge = '';\n                    if (alert.current_status === 'warning') {\n                        statusBadge = '<span class=\"badge badge-warning ml-2\">' + self.strings.statusWarning + '</span>';\n                    } else if (alert.current_status === 'critical') {\n                        statusBadge = '<span class=\"badge badge-danger ml-2\">' + self.strings.statusCritical + '</span>';\n                    } else if (alert.current_status) {\n                        statusBadge = '<span class=\"badge badge-success ml-2\">' + self.strings.statusOk + '</span>';\n                    }\n\n                    var html = '<div class=\"alert-item card mb-2\" data-index=\"' + index + '\">' +\n                        '<div class=\"card-body py-2 px-3\">' +\n                        '<div class=\"d-flex justify-content-between align-items-start\">' +\n                        '<div class=\"flex-grow-1\">' +\n                        '<div class=\"d-flex align-items-center mb-1\">' +\n                        '<strong>' + self.escapeHtml(alertName) + '</strong>' +\n                        statusBadge +\n                        (alert.enabled ? '' : '<span class=\"badge badge-secondary ml-2\">' + self.strings.disabled + '</span>') +\n                        '</div>' +\n                        '<small class=\"text-muted d-block\">' + self.escapeHtml(reportName) + '</small>' +\n                        '<small class=\"text-muted d-block\">' + self.escapeHtml(operatorLabel) + ' | ' +\n                        thresholdText + ' | ' + intervalLabel + '</small>' +\n                        '</div>' +\n                        '<div class=\"alert-actions d-flex align-items-center\">' +\n                        '<div class=\"custom-control custom-switch mr-2\">' +\n                        '<input type=\"checkbox\" class=\"custom-control-input alert-enabled-toggle\" ' +\n                        'id=\"alert-enabled-' + index + '\"' + (alert.enabled ? ' checked' : '') + '>' +\n                        '<label class=\"custom-control-label\" for=\"alert-enabled-' + index + '\"></label>' +\n                        '</div>' +\n                        '<button type=\"button\" ' +\n                        'class=\"btn btn-sm btn-outline-primary alert-edit-btn mr-1\" ' +\n                        'title=\"' + self.strings.editAlert + '\">' +\n                        '<i class=\"fa fa-pencil\"></i>' +\n                        '</button>' +\n                        '<button type=\"button\" ' +\n                        'class=\"btn btn-sm btn-outline-danger alert-delete-btn\" ' +\n                        'title=\"' + self.strings.deleteAlert + '\">' +\n                        '<i class=\"fa fa-trash\"></i>' +\n                        '</button>' +\n                        '</div>' +\n                        '</div>' +\n                        '</div>' +\n                        '</div>';\n\n                    list.append(html);\n                });\n            }\n\n            // Update count badge.\n            this.container.find('.alerts-count').text(this.alerts.length);\n        },\n\n        /**\n         * Open the edit panel for an alert.\n         *\n         * @param {number} index Alert index (-1 for new)\n         */\n        openEditPanel: function(index) {\n            var panel = $('#alert-edit-panel');\n            this.editingIndex = index;\n\n            // Ensure role filter is populated (might not have been during init).\n            var roleFilter = $('#alert-edit-role-filter');\n            if (roleFilter.length && roleFilter.find('option').length <= 1) {\n                $.each(this.roles, function(key, value) {\n                    roleFilter.append($('<option>', {value: key, text: value}));\n                });\n            }\n\n            // Reset form.\n            $('#alert-edit-report').val('');\n            $('#alert-edit-report-search').val('');\n            $('#alert-edit-report-display').text('');\n            $('#alert-edit-name').val('');\n            $('#alert-edit-operator').val('gt');\n            $('#alert-edit-warning').val('');\n            $('#alert-edit-critical').val('');\n            $('#alert-edit-interval').val('3600');\n            $('#alert-edit-cooldown').val('3600');\n            $('#alert-edit-notify-warning').prop('checked', true);\n            $('#alert-edit-notify-critical').prop('checked', true);\n            $('#alert-edit-notify-recovery').prop('checked', true);\n            $('#alert-edit-notify-email').prop('checked', false);\n            $('#alert-edit-email-addresses').val('');\n            $('#email-addresses-group').hide();\n            $('#alert-edit-role-filter').val('');\n            this.selectedUsers = [];\n            this.renderSelectedUsers();\n\n            // Populate if editing existing.\n            if (index >= 0 && this.alerts[index]) {\n                var alert = this.alerts[index];\n                $('#alert-edit-report').val(alert.report_slug);\n                $('#alert-edit-report-search').val(alert.report_name || alert.report_slug);\n                $('#alert-edit-report-display').text(this.strings.selected.replace('{$a}', alert.report_name || alert.report_slug));\n                $('#alert-edit-name').val(alert.alert_name || '');\n                $('#alert-edit-operator').val(alert.operator || 'gt');\n                $('#alert-edit-warning').val(alert.warning_value || '');\n                $('#alert-edit-critical').val(alert.critical_value || '');\n                $('#alert-edit-interval').val(alert.check_interval || 3600);\n                $('#alert-edit-cooldown').val(alert.cooldown_seconds || 3600);\n                $('#alert-edit-notify-warning').prop('checked', alert.notify_on_warning !== false);\n                $('#alert-edit-notify-critical').prop('checked', alert.notify_on_critical !== false);\n                $('#alert-edit-notify-recovery').prop('checked', alert.notify_on_recovery !== false);\n                $('#alert-edit-notify-email').prop('checked', !!alert.notify_email);\n                $('#alert-edit-email-addresses').val(alert.notify_emails || '');\n                if (alert.notify_email) {\n                    $('#email-addresses-group').show();\n                }\n                // Load selected users from alert data.\n                this.selectedUsers = alert.notify_users || [];\n                this.renderSelectedUsers();\n\n                panel.find('.alert-panel-title').text(this.strings.editAlert);\n            } else {\n                panel.find('.alert-panel-title').text(this.strings.addNewAlert);\n            }\n\n            panel.show();\n        },\n\n        /**\n         * Close the edit panel.\n         */\n        closeEditPanel: function() {\n            $('#alert-edit-panel').hide();\n            this.editingIndex = -1;\n        },\n\n        /**\n         * Get the API endpoint base URL for a report based on its source.\n         *\n         * @param {string} reportSlug Report slug.\n         * @return {string} API endpoint path ('/wizard-reports/' or '/ai-reports/').\n         */\n        getReportEndpoint: function(reportSlug) {\n            // Find the report in our list to get its source.\n            var report = this.reports.find(function(r) {\n                return r.slug === reportSlug;\n            });\n\n            // Default to wizard-reports if source is 'wizard' or unknown.\n            if (report && report.source === 'ai') {\n                return '/ai-reports/';\n            }\n            return '/wizard-reports/';\n        },\n\n        /**\n         * Save the edit panel data - syncs to backend API.\n         */\n        saveEditPanel: function() {\n            var reportSlug = $('#alert-edit-report').val();\n            var reportName = $('#alert-edit-report-search').val();\n            var thresholdValue = $('#alert-edit-warning').val() || $('#alert-edit-critical').val();\n            var operator = $('#alert-edit-operator').val();\n\n            // Validation.\n            if (!reportSlug) {\n                Notification.addNotification({\n                    message: this.strings.selectReport,\n                    type: 'error'\n                });\n                return;\n            }\n\n            if (!thresholdValue) {\n                Notification.addNotification({\n                    message: this.strings.enterThreshold,\n                    type: 'error'\n                });\n                return;\n            }\n\n            // Map operator to condition_type for backend API.\n            var conditionType = 'threshold';\n            var backendOperator = operator;\n            if (operator === 'change_pct') {\n                conditionType = 'change_percent';\n                backendOperator = 'gte'; // Change by X% or more.\n            } else if (operator === 'increase_pct') {\n                conditionType = 'change_percent';\n                backendOperator = 'gte';\n            } else if (operator === 'decrease_pct') {\n                conditionType = 'change_percent';\n                backendOperator = 'lte';\n                thresholdValue = -Math.abs(parseFloat(thresholdValue)); // Negative for decrease.\n            }\n\n            // Prepare backend API payload.\n            // Note: cooldown_minutes is set to 0 to disable backend cooldown.\n            // Moodle handles fire-once logic per severity (warning/critical/recovery)\n            // via the block_adeptus_insights_alert_log table.\n            var notifyEmail = $('#alert-edit-notify-email').is(':checked');\n            /* eslint-disable camelcase */\n            var backendPayload = {\n                name: $('#alert-edit-name').val() || reportName,\n                condition_type: conditionType,\n                operator: backendOperator,\n                value: parseFloat(thresholdValue) || 0,\n                cooldown_minutes: 0,\n                is_enabled: true,\n                notification_channels: notifyEmail ? ['email'] : ['moodle']\n            };\n\n            // Local alert data for UI.\n            var alertData = {\n                report_slug: reportSlug,\n                report_name: reportName,\n                alert_name: backendPayload.name,\n                operator: operator,\n                condition_type: conditionType,\n                threshold_value: parseFloat(thresholdValue),\n                warning_value: $('#alert-edit-warning').val() ? parseFloat($('#alert-edit-warning').val()) : null,\n                critical_value: $('#alert-edit-critical').val() ? parseFloat($('#alert-edit-critical').val()) : null,\n                check_interval: parseInt($('#alert-edit-interval').val(), 10),\n                cooldown_seconds: parseInt($('#alert-edit-cooldown').val(), 10),\n                notify_on_warning: $('#alert-edit-notify-warning').is(':checked'),\n                notify_on_critical: $('#alert-edit-notify-critical').is(':checked'),\n                notify_on_recovery: $('#alert-edit-notify-recovery').is(':checked'),\n                notify_email: $('#alert-edit-notify-email').is(':checked'),\n                notify_emails: $('#alert-edit-email-addresses').val().trim(),\n                notify_users: this.selectedUsers,\n                enabled: true\n            };\n            /* eslint-enable camelcase */\n\n            var isUpdate = this.editingIndex >= 0 && this.alerts[this.editingIndex] &&\n                           this.alerts[this.editingIndex].backend_id;\n\n            if (isUpdate) {\n                // Update existing alert on backend.\n                var backendId = this.alerts[this.editingIndex].backend_id;\n                this.updateAlertOnBackend(reportSlug, backendId, backendPayload, alertData);\n            } else {\n                // Create new alert on backend.\n                this.createAlertOnBackend(reportSlug, backendPayload, alertData);\n            }\n        },\n\n        /**\n         * Create a new alert on the backend.\n         *\n         * @param {string} reportSlug Report slug.\n         * @param {Object} payload Backend API payload.\n         * @param {Object} alertData Local alert data.\n         */\n        createAlertOnBackend: function(reportSlug, payload, alertData) {\n            var self = this;\n            var endpoint = this.getReportEndpoint(reportSlug);\n\n            $.ajax({\n                url: 'https://backend.adeptus360.com/api/v1' + endpoint +\n                     encodeURIComponent(reportSlug) + '/alerts',\n                method: 'POST',\n                headers: {\n                    'Authorization': 'Bearer ' + this.apiKey,\n                    'Content-Type': 'application/json',\n                    'Accept': 'application/json'\n                },\n                data: JSON.stringify(payload),\n                timeout: 15000\n            }).done(function(response) {\n                if (response.success && response.alert) {\n                    // Store backend ID for future updates.\n                    /* eslint-disable camelcase */\n                    alertData.backend_id = response.alert.id;\n                    alertData.current_status = 'ok';\n                    /* eslint-enable camelcase */\n\n                    if (self.editingIndex >= 0) {\n                        self.alerts[self.editingIndex] = alertData;\n                    } else {\n                        self.alerts.push(alertData);\n                    }\n\n                    self.saveToTextarea();\n                    self.renderAlertsList();\n                    self.closeEditPanel();\n\n                    Notification.addNotification({\n                        message: self.strings.alertCreated,\n                        type: 'success'\n                    });\n                } else {\n                    Notification.addNotification({\n                        message: response.message || self.strings.failedCreateAlert,\n                        type: 'error'\n                    });\n                }\n                return response;\n            }).fail(function(xhr) {\n                var message = self.strings.failedCreateAlert;\n                if (xhr.responseJSON) {\n                    if (xhr.responseJSON.message) {\n                        message = xhr.responseJSON.message;\n                    }\n                    // Show validation errors if present.\n                    if (xhr.responseJSON.errors) {\n                        var errors = xhr.responseJSON.errors;\n                        var errorDetails = [];\n                        for (var field in errors) {\n                            if (errors.hasOwnProperty(field)) {\n                                errorDetails.push(field + ': ' + errors[field].join(', '));\n                            }\n                        }\n                        if (errorDetails.length > 0) {\n                            message += ' - ' + errorDetails.join('; ');\n                        }\n                    }\n                }\n                Notification.addNotification({\n                    message: message,\n                    type: 'error'\n                });\n                return null;\n            });\n        },\n\n        /**\n         * Update an existing alert on the backend.\n         *\n         * @param {string} reportSlug Report slug.\n         * @param {number} alertId Backend alert ID.\n         * @param {Object} payload Backend API payload.\n         * @param {Object} alertData Local alert data.\n         */\n        updateAlertOnBackend: function(reportSlug, alertId, payload, alertData) {\n            var self = this;\n            var endpoint = this.getReportEndpoint(reportSlug);\n\n            $.ajax({\n                url: 'https://backend.adeptus360.com/api/v1' + endpoint +\n                     encodeURIComponent(reportSlug) + '/alerts/' + alertId,\n                method: 'PUT',\n                headers: {\n                    'Authorization': 'Bearer ' + this.apiKey,\n                    'Content-Type': 'application/json',\n                    'Accept': 'application/json'\n                },\n                data: JSON.stringify(payload),\n                timeout: 15000\n            }).done(function(response) {\n                if (response.success) {\n                    /* eslint-disable camelcase */\n                    alertData.backend_id = alertId;\n                    alertData.current_status = self.alerts[self.editingIndex].current_status;\n                    /* eslint-enable camelcase */\n                    alertData.enabled = self.alerts[self.editingIndex].enabled;\n                    self.alerts[self.editingIndex] = alertData;\n\n                    self.saveToTextarea();\n                    self.renderAlertsList();\n                    self.closeEditPanel();\n\n                    Notification.addNotification({\n                        message: self.strings.alertUpdated,\n                        type: 'success'\n                    });\n                } else {\n                    Notification.addNotification({\n                        message: response.message || self.strings.failedUpdateAlert,\n                        type: 'error'\n                    });\n                }\n                return response;\n            }).fail(function(xhr) {\n                var message = self.strings.failedUpdateAlert;\n                if (xhr.responseJSON && xhr.responseJSON.message) {\n                    message = xhr.responseJSON.message;\n                }\n                Notification.addNotification({\n                    message: message,\n                    type: 'error'\n                });\n                return null;\n            });\n        },\n\n        /**\n         * Delete an alert - syncs to backend API.\n         *\n         * @param {number} index Alert index\n         */\n        deleteAlert: function(index) {\n            var self = this;\n            var alert = this.alerts[index];\n\n            if (!alert) {\n                return;\n            }\n\n            // If alert has backend ID, delete from backend first.\n            if (alert.backend_id && alert.report_slug) {\n                var endpoint = this.getReportEndpoint(alert.report_slug);\n                $.ajax({\n                    url: 'https://backend.adeptus360.com/api/v1' + endpoint +\n                         encodeURIComponent(alert.report_slug) + '/alerts/' + alert.backend_id,\n                    method: 'DELETE',\n                    headers: {\n                        'Authorization': 'Bearer ' + this.apiKey,\n                        'Accept': 'application/json'\n                    },\n                    timeout: 15000\n                }).done(function() {\n                    // Remove from local list.\n                    self.alerts.splice(index, 1);\n                    self.saveToTextarea();\n                    self.renderAlertsList();\n\n                    Notification.addNotification({\n                        message: self.strings.alertDeleted,\n                        type: 'success'\n                    });\n                    return true;\n                }).fail(function(xhr) {\n                    var message = self.strings.failedDeleteAlert;\n                    if (xhr.responseJSON && xhr.responseJSON.message) {\n                        message = xhr.responseJSON.message;\n                    }\n                    Notification.addNotification({\n                        message: message,\n                        type: 'error'\n                    });\n                    return false;\n                });\n            } else {\n                // No backend ID, just remove locally.\n                this.alerts.splice(index, 1);\n                this.saveToTextarea();\n                this.renderAlertsList();\n            }\n        },\n\n        /**\n         * Clean up orphaned backend alerts that no longer exist in local config.\n         * This runs on initialization to sync backend with local Moodle config.\n         */\n        cleanupOrphanedAlerts: function() {\n            var self = this;\n\n            // Get unique report slugs from local alerts.\n            var reportSlugs = {};\n            var localBackendIds = {};\n\n            this.alerts.forEach(function(alert) {\n                if (alert.report_slug) {\n                    reportSlugs[alert.report_slug] = true;\n                    if (alert.backend_id) {\n                        if (!localBackendIds[alert.report_slug]) {\n                            localBackendIds[alert.report_slug] = [];\n                        }\n                        localBackendIds[alert.report_slug].push(alert.backend_id);\n                    }\n                }\n            });\n\n            // For each report slug, fetch backend alerts and delete orphans.\n            Object.keys(reportSlugs).forEach(function(reportSlug) {\n                var endpoint = self.getReportEndpoint(reportSlug);\n                var localIds = localBackendIds[reportSlug] || [];\n\n                $.ajax({\n                    url: 'https://backend.adeptus360.com/api/v1' + endpoint +\n                         encodeURIComponent(reportSlug) + '/alerts',\n                    method: 'GET',\n                    headers: {\n                        'Authorization': 'Bearer ' + self.apiKey,\n                        'Accept': 'application/json'\n                    },\n                    timeout: 10000\n                }).done(function(response) {\n                    if (response.success && response.alerts) {\n                        var backendAlerts = response.alerts;\n\n                        // Find orphans (backend alerts not in local config).\n                        backendAlerts.forEach(function(backendAlert) {\n                            if (localIds.indexOf(backendAlert.id) === -1) {\n                                // This backend alert is orphaned - delete it.\n                                self.deleteOrphanedAlert(reportSlug, backendAlert.id);\n                            }\n                        });\n                    }\n                    return response;\n                }).fail(function() {\n                    // Silently fail - orphan cleanup is best-effort.\n                    return null;\n                });\n            });\n        },\n\n        /**\n         * Delete an orphaned alert from the backend (no local state changes).\n         *\n         * @param {string} reportSlug Report slug.\n         * @param {number} alertId Backend alert ID to delete.\n         */\n        deleteOrphanedAlert: function(reportSlug, alertId) {\n            var endpoint = this.getReportEndpoint(reportSlug);\n\n            $.ajax({\n                url: 'https://backend.adeptus360.com/api/v1' + endpoint +\n                     encodeURIComponent(reportSlug) + '/alerts/' + alertId,\n                method: 'DELETE',\n                headers: {\n                    'Authorization': 'Bearer ' + this.apiKey,\n                    'Accept': 'application/json'\n                },\n                timeout: 10000\n            }).done(function() {\n                // Orphaned backend alert cleaned up successfully.\n                return true;\n            }).fail(function() {\n                // Failed to delete orphaned alert - non-critical, continue silently.\n                return false;\n            });\n        },\n\n        /**\n         * Save alerts to the hidden textarea.\n         */\n        saveToTextarea: function() {\n            this.textarea.val(JSON.stringify(this.alerts));\n        },\n\n        /**\n         * Open the report dropdown.\n         */\n        openReportDropdown: function() {\n            if (this.isDropdownOpen) {\n                return;\n            }\n\n            this.isDropdownOpen = true;\n            var dropdown = $('#alert-report-dropdown');\n            var input = $('#alert-edit-report-search');\n\n            // Position dropdown.\n            dropdown.css('width', input.outerWidth() + 'px');\n            dropdown.show();\n\n            this.filteredReports = this.reports;\n            this.renderReportDropdown();\n        },\n\n        /**\n         * Close the report dropdown.\n         */\n        closeReportDropdown: function() {\n            this.isDropdownOpen = false;\n            $('#alert-report-dropdown').hide();\n        },\n\n        /**\n         * Handle report search input.\n         *\n         * @param {string} query Search query\n         */\n        handleReportSearch: function(query) {\n            var self = this;\n\n            if (this.searchTimeout) {\n                clearTimeout(this.searchTimeout);\n            }\n\n            this.searchTimeout = setTimeout(function() {\n                self.filteredReports = self.filterReports(query);\n                self.renderReportDropdown();\n            }, 150);\n        },\n\n        /**\n         * Filter reports based on search query.\n         *\n         * @param {string} query Search query\n         * @return {Array} Filtered reports\n         */\n        filterReports: function(query) {\n            if (!query || query.length < 1) {\n                return this.reports;\n            }\n\n            query = query.toLowerCase().trim();\n            var terms = query.split(/\\s+/);\n\n            return this.reports.filter(function(report) {\n                var searchText = (\n                    report.displayName + ' ' +\n                    report.categoryName + ' ' +\n                    report.source + ' ' +\n                    (report.slug || '')\n                ).toLowerCase();\n\n                return terms.every(function(term) {\n                    return searchText.indexOf(term) !== -1;\n                });\n            }).slice(0, 30);\n        },\n\n        /**\n         * Render the report dropdown.\n         */\n        renderReportDropdown: function() {\n            var dropdown = $('#alert-report-dropdown');\n            dropdown.empty();\n\n            if (this.filteredReports.length === 0) {\n                dropdown.append('<div class=\"p-3 text-muted text-center\">No matching reports found</div>');\n                return;\n            }\n\n            // Group by category.\n            var byCategory = {};\n            this.filteredReports.forEach(function(report) {\n                var cat = report.categoryName || 'Other';\n                if (!byCategory[cat]) {\n                    byCategory[cat] = [];\n                }\n                byCategory[cat].push(report);\n            });\n\n            Object.keys(byCategory).sort().forEach(function(category) {\n                dropdown.append(\n                    '<div class=\"px-3 py-1 bg-light border-bottom\">' +\n                    '<small class=\"text-muted font-weight-bold\">' + self.escapeHtml(category) + '</small>' +\n                    '</div>'\n                );\n\n                byCategory[category].forEach(function(report) {\n                    var sourceBadge = report.source === 'ai'\n                        ? '<span class=\"badge badge-info ml-2\">AI</span>'\n                        : '<span class=\"badge badge-primary ml-2\">Wizard</span>';\n\n                    dropdown.append(\n                        '<div class=\"report-dropdown-item px-3 py-2\" style=\"cursor:pointer;\" ' +\n                        'data-slug=\"' + report.slug + '\" data-name=\"' + self.escapeHtml(report.displayName) + '\">' +\n                        '<span>' + self.escapeHtml(report.displayName) + '</span>' +\n                        sourceBadge +\n                        '</div>'\n                    );\n                });\n            });\n\n            // Add hover effects.\n            dropdown.find('.report-dropdown-item').hover(\n                function() {\n                    $(this).addClass('bg-light');\n                },\n                function() {\n                    $(this).removeClass('bg-light');\n                }\n            );\n        },\n\n        /**\n         * Select a report from the dropdown.\n         *\n         * @param {string} slug Report slug\n         * @param {string} name Report display name\n         */\n        selectReport: function(slug, name) {\n            $('#alert-edit-report').val(slug);\n            $('#alert-edit-report-search').val(name);\n            $('#alert-edit-report-display').text(this.strings.selected.replace('{$a}', name));\n            this.closeReportDropdown();\n        },\n\n        /**\n         * Open the user search dropdown.\n         */\n        openUserDropdown: function() {\n            if (this.isUserDropdownOpen) {\n                return;\n            }\n\n            this.isUserDropdownOpen = true;\n            var dropdown = $('#alert-user-dropdown');\n            dropdown.show();\n\n            // Load users if not already loaded.\n            this.loadUsers();\n        },\n\n        /**\n         * Close the user search dropdown.\n         */\n        closeUserDropdown: function() {\n            this.isUserDropdownOpen = false;\n            $('#alert-user-dropdown').hide();\n        },\n\n        /**\n         * Load users from the server.\n         */\n        loadUsers: function() {\n            var self = this;\n            var roleId = $('#alert-edit-role-filter').val() || 0;\n            var search = $('#alert-edit-user-search').val() || '';\n\n            var dropdown = $('#alert-user-dropdown');\n            dropdown.html('<div class=\"p-3 text-center text-muted\"><i class=\"fa fa-spinner fa-spin\"></i> Loading...</div>');\n\n            require(['core/ajax'], function(Ajax) {\n                Ajax.call([{\n                    methodname: 'block_adeptus_insights_get_users_by_role',\n                    args: {\n                        roleid: parseInt(roleId, 10),\n                        search: search,\n                        limit: 50\n                    }\n                }])[0].done(function(response) {\n                    self.renderUserDropdown(response.users);\n                    return response.users;\n                }).fail(function() {\n                    dropdown.html('<div class=\"p-3 text-center text-danger\">Failed to load users</div>');\n                    return null;\n                });\n            });\n        },\n\n        /**\n         * Handle user search input with debouncing.\n         */\n        handleUserSearch: function() {\n            var self = this;\n\n            if (this.userSearchTimeout) {\n                clearTimeout(this.userSearchTimeout);\n            }\n\n            this.userSearchTimeout = setTimeout(function() {\n                self.loadUsers();\n            }, 300);\n        },\n\n        /**\n         * Render the user dropdown.\n         *\n         * @param {Array} users Array of user objects\n         */\n        renderUserDropdown: function(users) {\n            var self = this;\n            var dropdown = $('#alert-user-dropdown');\n            dropdown.empty();\n\n            if (users.length === 0) {\n                dropdown.html('<div class=\"p-3 text-center text-muted\">No users found</div>');\n                return;\n            }\n\n            users.forEach(function(user) {\n                // Check if already selected.\n                var isSelected = self.selectedUsers.some(function(s) {\n                    return s.id === user.id;\n                });\n\n                if (isSelected) {\n                    return; // Skip already selected users.\n                }\n\n                var html = '<div class=\"user-dropdown-item px-3 py-2 d-flex align-items-center\" ' +\n                    'style=\"cursor:pointer;\" ' +\n                    'data-userid=\"' + user.id + '\" ' +\n                    'data-name=\"' + self.escapeHtml(user.fullname) + '\" ' +\n                    'data-email=\"' + self.escapeHtml(user.email) + '\">' +\n                    '<img src=\"' + user.profileimageurl + '\" class=\"rounded-circle mr-2\" ' +\n                    'width=\"32\" height=\"32\" alt=\"\">' +\n                    '<div class=\"flex-grow-1 min-width-0\">' +\n                    '<div class=\"text-truncate font-weight-bold\">' + self.escapeHtml(user.fullname) + '</div>' +\n                    '<small class=\"text-muted text-truncate d-block\">' + self.escapeHtml(user.email) + '</small>' +\n                    '</div>' +\n                    '</div>';\n\n                dropdown.append(html);\n            });\n\n            if (dropdown.children().length === 0) {\n                dropdown.html('<div class=\"p-3 text-center text-muted\">All matching users already selected</div>');\n            }\n\n            // Add hover effects.\n            dropdown.find('.user-dropdown-item').hover(\n                function() {\n                    $(this).addClass('bg-light');\n                },\n                function() {\n                    $(this).removeClass('bg-light');\n                }\n            );\n        },\n\n        /**\n         * Add a user to the selected list.\n         *\n         * @param {number} userId User ID\n         * @param {string} userName User full name\n         * @param {string} userEmail User email\n         */\n        addSelectedUser: function(userId, userName, userEmail) {\n            // Check if already selected.\n            var exists = this.selectedUsers.some(function(u) {\n                return u.id === userId;\n            });\n\n            if (exists) {\n                return;\n            }\n\n            this.selectedUsers.push({\n                id: userId,\n                name: userName,\n                email: userEmail\n            });\n\n            this.renderSelectedUsers();\n            this.closeUserDropdown();\n            $('#alert-edit-user-search').val('');\n        },\n\n        /**\n         * Remove a user from the selected list.\n         *\n         * @param {number} userId User ID\n         */\n        removeSelectedUser: function(userId) {\n            this.selectedUsers = this.selectedUsers.filter(function(u) {\n                return u.id !== userId;\n            });\n\n            this.renderSelectedUsers();\n        },\n\n        /**\n         * Render the selected users list.\n         */\n        renderSelectedUsers: function() {\n            var self = this;\n            var container = $('#alert-selected-users');\n            container.empty();\n\n            if (this.selectedUsers.length === 0) {\n                container.html('<div class=\"text-muted small py-2\"><i class=\"fa fa-user-o mr-1\"></i> No recipients selected</div>');\n                return;\n            }\n\n            this.selectedUsers.forEach(function(user) {\n                var chipClass = 'selected-user-chip d-inline-flex align-items-center ';\n                chipClass += 'bg-light border rounded px-2 py-1 mr-2 mb-2';\n                var html = '<div class=\"' + chipClass + '\">' +\n                    '<span class=\"mr-2\">' + self.escapeHtml(user.name) + '</span>' +\n                    '<button type=\"button\" ' +\n                    'class=\"btn btn-sm btn-link p-0 text-danger remove-selected-user\" ' +\n                    'data-userid=\"' + user.id + '\" title=\"Remove\">' +\n                    '<i class=\"fa fa-times\"></i>' +\n                    '</button>' +\n                    '</div>';\n\n                container.append(html);\n            });\n\n            // Update hidden input with user data.\n            $('#alert-edit-notify-users-data').val(JSON.stringify(this.selectedUsers));\n        },\n\n        /**\n         * Escape HTML special characters.\n         *\n         * @param {string} text\n         * @return {string}\n         */\n        escapeHtml: function(text) {\n            if (!text) {\n                return '';\n            }\n            var div = document.createElement('div');\n            div.textContent = text;\n            return div.innerHTML;\n        }\n    };\n\n    // Track if module has been initialized to prevent duplicates.\n    var moduleInitialized = false;\n\n    return {\n        /**\n         * Initialize report selectors for the edit form.\n         * Uses MutationObserver to detect when modal content is loaded.\n         *\n         * @param {Object} options Configuration options\n         */\n        init: function(options) {\n            // Prevent duplicate initialization (can happen when both block and edit_form load the module).\n            if (moduleInitialized) {\n                return;\n            }\n            moduleInitialized = true;\n\n            var initialized = {\n                kpi: false,\n                tabs: false,\n                alerts: false\n            };\n\n            /**\n             * Try to initialize selectors if their containers exist.\n             */\n            var tryInitialize = function() {\n                // Initialize KPI report selector.\n                if (!initialized.kpi && $('#block-adeptus-kpi-report-selector-container').length) {\n                    new ReportSelector({\n                        mode: 'kpi',\n                        apiKey: options.apiKey,\n                        containerId: 'block-adeptus-kpi-report-selector-container',\n                        textareaName: 'config_kpi_selected_reports'\n                    });\n                    initialized.kpi = true;\n                }\n\n                // Initialize Tabs report selector.\n                if (!initialized.tabs && $('#block-adeptus-tabs-report-selector-container').length) {\n                    new ReportSelector({\n                        mode: 'tabs',\n                        apiKey: options.apiKey,\n                        containerId: 'block-adeptus-tabs-report-selector-container',\n                        textareaName: 'config_tabs_selected_reports'\n                    });\n                    initialized.tabs = true;\n                }\n\n                // Initialize Alerts manager.\n                if (!initialized.alerts && $('#alerts-manager-container').length) {\n                    new AlertsManager({\n                        apiKey: options.apiKey\n                    });\n                    initialized.alerts = true;\n                }\n\n                // Handle Alert Configuration notice visibility based on display mode.\n                // Shows a notice when non-KPI mode is selected, hides it for KPI mode.\n                var displayModeSelect = $('[name=\"config_display_mode\"]');\n                var alertsNotice = $('#block-adeptus-alerts-kpi-only-notice');\n                if (displayModeSelect.length && alertsNotice.length && !displayModeSelect.data('alerts-notice-bound')) {\n\n                    var updateAlertNoticeVisibility = function() {\n                        var isKpi = displayModeSelect.val() === 'kpi';\n                        if (isKpi) {\n                            alertsNotice.hide();\n                        } else {\n                            alertsNotice.show();\n                        }\n                    };\n\n                    // Bind change handler.\n                    displayModeSelect.on('change', updateAlertNoticeVisibility);\n\n                    // Set initial visibility.\n                    setTimeout(updateAlertNoticeVisibility, 50);\n\n                    // Mark as bound to prevent duplicate handlers.\n                    displayModeSelect.data('alerts-notice-bound', true);\n                }\n            };\n\n            // Try immediately in case elements exist.\n            tryInitialize();\n\n            // Watch for modal content to be added to DOM.\n            var observer = new MutationObserver(function() {\n                tryInitialize();\n\n                // Stop observing once all are initialized.\n                if (initialized.kpi && initialized.tabs && initialized.alerts) {\n                    observer.disconnect();\n                }\n            });\n\n            // Observe the entire document for added nodes.\n            observer.observe(document.body, {\n                childList: true,\n                subtree: true\n            });\n\n            // Also listen for Moodle modal events.\n            $(document).on('modal-shown', function() {\n                setTimeout(tryInitialize, 100);\n            });\n        }\n    };\n});\n"],"names":["define","$","Str","Notification","KPI_ICONS","id","label","category","DEFAULT_KPI_ICONS","ReportSelector","options","mode","apiKey","containerId","textareaName","container","textarea","reports","filteredReports","selectedReports","strings","searchTimeout","highlightedIndex","isDropdownOpen","init","prototype","self","this","length","loadExistingSelection","loadStrings","then","render","fetchReports","bindEvents","show","catch","get_strings","key","component","addreport","removereport","noreportsselected","selectareport","loading","searchplaceholder","failedLoadReports","value","val","JSON","parse","_e","html","Date","now","updateListDisplay","updateSelectedCount","find","hide","baseUrl","when","ajax","url","method","headers","timeout","wizardResult","aiResult","allReports","data","forEach","r","source","displayName","name","title","display_name","slug","categoryName","category_info","push","sort","a","b","localeCompare","getAvailableReports","renderSelectedList","fail","addNotification","message","type","filter","report","some","s","filterReports","query","available","terms","toLowerCase","trim","split","searchText","every","term","indexOf","slice","renderSearchResults","resultsContainer","emptyContainer","empty","byCategory","cat","index","Object","keys","append","escapeHtml","highlightedName","highlightMatch","sourceBadge","itemHtml","css","hover","addClass","parseInt","updateHighlight","removeClass","text","escaped","regex","RegExp","replace","items","item","eq","dropdown","itemTop","position","top","itemHeight","outerHeight","dropdownHeight","height","scrollTop","openDropdown","input","attr","closeDropdown","handleSearch","clearTimeout","setTimeout","selectHighlightedItem","addReport","defaultIcon","reportData","icon","saveSelection","list","selected","iconPicker","currentIcon","buildIconPicker","toUpperCase","initSortable","initIconPickers","categories","isActive","off","on","e","preventDefault","stopPropagation","$btn","$picker","closest","$menu","isOpen","hasClass","pickerRect","getBoundingClientRect","window","innerHeight","bottom","newIcon","document","target","count","fn","sortable","handle","update","updateOrderFromDOM","initManualSort","dragItem","originalEvent","dataTransfer","effectAllowed","rect","midY","clientY","before","after","newOrder","each","existing","maxIndex","keyCode","Math","min","max","blur","removeReport","stringify","trigger","div","createElement","textContent","innerHTML","AlertsManager","alerts","operators","intervals","cooldowns","roles","editingIndex","isUserDropdownOpen","userSearchTimeout","selectedUsers","existingAlerts","cleanupOrphanedAlerts","populateSelectOptions","renderAlertsList","saveToTextarea","handleAlertsEnabledToggle","editAlert","deleteAlert","deleteConfirm","addNewAlert","disabled","addAlert","noReports","noThresholdsSet","thresholdWarning","thresholdCritical","statusWarning","statusCritical","statusOk","failedCreateAlert","failedUpdateAlert","failedDeleteAlert","alertCreated","alertUpdated","alertDeleted","selectReport","enterThreshold","operatorSelect","intervalSelect","cooldownSelect","roleFilter","remove","kpiTextarea","kpiReports","Array","isArray","catInfo","defaultCategory","tabsTextarea","tabsReports","prepend","checkbox","displayMode","updateVisibility","enabled","is","isKpi","openEditPanel","confirm","closeEditPanel","saveEditPanel","searchInput","openReportDropdown","handleReportSearch","closeReportDropdown","closeUserDropdown","loadUsers","userSearchInput","userDropdown","openUserDropdown","handleUserSearch","userId","userName","userEmail","addSelectedUser","removeSelectedUser","emptyState","alert","reportName","report_name","report_slug","alertName","alert_name","operatorLabel","operator","thresholds","warning_value","critical_value","thresholdText","join","intervalLabel","check_interval","statusBadge","current_status","panel","prop","renderSelectedUsers","cooldown_seconds","notify_on_warning","notify_on_critical","notify_on_recovery","notify_email","notify_emails","notify_users","getReportEndpoint","reportSlug","thresholdValue","conditionType","backendOperator","abs","parseFloat","notifyEmail","backendPayload","condition_type","cooldown_minutes","is_enabled","notification_channels","alertData","threshold_value","backend_id","backendId","updateAlertOnBackend","createAlertOnBackend","payload","endpoint","encodeURIComponent","done","response","success","xhr","responseJSON","errors","errorDetails","field","hasOwnProperty","alertId","splice","reportSlugs","localBackendIds","localIds","backendAlert","deleteOrphanedAlert","outerWidth","renderReportDropdown","roleId","search","require","Ajax","call","methodname","args","roleid","limit","renderUserDropdown","users","user","fullname","email","profileimageurl","children","u","moduleInitialized","initialized","kpi","tabs","tryInitialize","displayModeSelect","alertsNotice","updateAlertNoticeVisibility","observer","MutationObserver","disconnect","observe","body","childList","subtree"],"mappings":"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"}